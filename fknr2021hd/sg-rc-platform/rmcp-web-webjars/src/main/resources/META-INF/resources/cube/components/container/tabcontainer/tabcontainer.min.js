define([],function(){function j(j){var a=this;a.tabContents=[];a.type="default";a.reusable=!1;a.tabLayout="top";a.tabLeftHeight="auto";a.closeTabFocus=!1;a.isShowContextMenu=!0;a.isShowCloseTab=!1;a.selectedTabRoute=null;a.isTabLineFeed=!1;a.isHrefRoute=!0;a.onSelectedChanged=null;a._showBtn=!1;a.$scrollDiv=null;a.$closeDialog=null;a._selectedTab=null;a._tabLockedText=null;a.ajaxHtml="";var k=null,m=null,n=0,o=!0;a.selectedTab=cube.comp(function(){var b=null;$.each(a.tabContents(),function(){if(a.selectedTabRoute()==
this.route&&(b=this,cube.notEmpty(b.templateOptions))){b.isOut=cube.notEmpty(b.templateOptions.name)&&b.templateOptions.name.indexOf("http")==0&&b.templateOptions.type!="viewModel"?!0:!1;if(cube.isEmpty(b.templateOptions.type))b.templateOptions.type="ajax";if(cube.isEmpty(b.templateOptions.iframeHeight))b.templateOptions.iframeHeight="auto",o=!1;b.isOut&&b.templateOptions.type=="ajax"&&(a.reusable()?a.getAjaxHtml(b.templateOptions.name,b):a.getAjaxHtml(b.templateOptions.name));if(b.templateOptions.type==
"iframe"&&cube.notEmpty(b.templateOptions.params))b.templateOptions.params.dialog={},b.templateOptions.name+=(b.templateOptions.name.indexOf("?")>0?"&":"?")+"params="+JSON.stringify(b.templateOptions.params)}});a.selectedTabChange();return b},a);a._init=function(){a.reusable()?$.each(a.tabContents(),function(){if(cube.notEmpty(this.templateOptions)){this.isOut=cube.notEmpty(this.templateOptions.name)&&this.templateOptions.name.indexOf("http")==0&&this.templateOptions.type!="viewModel"?!0:!1;if(cube.isEmpty(this.templateOptions.type))this.templateOptions.type=
"ajax";if(this.templateOptions.type=="ajax"&&cube.isEmpty(this.templateOptions.ajaxHtml))this.templateOptions.ajaxHtml=cube.obj("");if(cube.isEmpty(this.templateOptions.iframeHeight))this.templateOptions.iframeHeight="auto"}if(typeof this.isLocked==void 0)this.isLocked=cube.obj(!1);else if(!cube.isObservable(this.isLocked))this.isLocked=cube.obj(this.isLocked)}):$.each(a.tabContents(),function(){if(typeof this.isLocked==void 0)this.isLocked=cube.obj(!1);else if(!cube.isObservable(this.isLocked))this.isLocked=
cube.obj(this.isLocked)});a.selectedTabRoute()!=null?a.selectedTabRoute(a.selectedTabRoute()):a.tabContents()&&a.tabContents().length>0&&a.selectedTabRoute(a.tabContents()[0].route);a.selctedTabRouteSub=cube.subscribe(a.selectedTabRoute,function(b){if(a.onSelectedChanged!=null&&!cube.isObservable(a.onSelectedChanged)){var c=null;$.each(a.tabContents(),function(){b==this.route&&(c=this)});a.onSelectedChanged(c)}if(a.isHrefRoute())window.location.hash=b});a.tabContentsSub=cube.subscribe(a.tabContents,
a.itemsChange)};a.showTabContent=function(b){a.selectedTabRoute(b.route);b=$(k).children(".tab-content").children();b[0]&&b[0].tagName&&b[0].tagName.toLowerCase()=="section"&&cube.applyBindings(b,m)};a.hiddenTab=function(b){if(a.selectedTab()==b){var c=a.tabContents(),d=c.indexOf(b);d==0?c.length>1&&(a.selectedTabRoute(c[1].route),a.tabContents.remove(b)):(a.selectedTabRoute(c[d-1].route),a.tabContents.remove(b))}};a.next=function(a){var c=$(a).siblings(".scrollborder"),a=c.children(".scroll").children("ul"),
c=parseInt(c.width())-parseInt(a.width()),d=a.position().left;a.stop(!0,!0);d<=c||(d=parseInt(d)-100,d<=c&&(d=c),a.animate({left:d}))};a.prev=function(a){var a=$(a).siblings(".scrollborder").children(".scroll").children("ul"),c=a.position().left;a.stop(!0,!0);c>=0||(c=parseInt(c)+100,c>0&&(c=0),a.animate({left:c}))};a.nextLeft=function(a){var c=$(a).siblings(".scrollborder-main"),a=c.children(".scroll-main").children("ul"),c=parseInt(c.height())-parseInt(a.height()),d=a.position().top;a.stop(!0,!0);
d<=c||(d=parseInt(d)-100,d<=c&&(d=c),a.animate({top:d}))};a.prevLeft=function(a){var a=$(a).siblings(".scrollborder-main").children(".scroll-main").children("ul"),c=a.position().top;a.stop(!0,!0);c>=0||(c=parseInt(c)+100,c>0&&(c=0),a.animate({top:c}))};a.showTabCloseDialog=function(b,c,d){if(a.isShowContextMenu())c=a.$closeDialog[0],a._selectedTab(a.tabContents()[b()]),a._selectedTab().isLocked()==!0?a._tabLockedText(cube.msg("DEBLOCKING")):a._tabLockedText(cube.msg("LOCKED")),a.isShowCloseTab(!0),
a.closeTabFocus(!0),c.style.top=d.clientY+"px",c.style.left=d.clientX+"px"};a.tabLockedThis=function(){var b=a._selectedTab();b!=null&&(b.isLocked()==!0?(b.isLocked(!1),a._tabLockedText(cube.msg("DEBLOCKING"))):(b.isLocked(!0),a._tabLockedText(cube.msg("LOCKED"))));a.isShowCloseTab(!1)};a.tabCloseThis=function(){var b=a.tabContents(),c=b.length-1,d=a.selectedTabRoute();if(a._selectedTab()!=null)d=a._selectedTab().route;if(c>0)for(i=c;i>=0;i--)if(b[i].route==d){a.selectedTabRoute()==d&&(b[0].route==
d?a.selectedTabRoute(b[1].route):b[c]==a._selectedTab()?a.selectedTabRoute(b[c-1].route):a.selectedTabRoute(b[i-1].route));a.tabContents.remove(b[i]);break}a.isShowCloseTab(!1)};a.tabCloseOthers=function(){var b=a.tabContents(),c=a.selectedTabRoute();if(a._selectedTab()!=null)c=a._selectedTab().route;for(i=b.length-1;i>=0;i--)a.selectedTabRoute(c),b[i].route!=c&&(b[i].isLocked()||a.tabContents.remove(b[i]));a.isShowCloseTab(!1)};a.tabCloseAll=function(){var b=a.tabContents(),c=a.selectedTabRoute();
for(i=b.length-1;i>=0;i--)b[i].isLocked()||a.tabContents.remove(b[i]);if(b.length>0)for(i=b.length-1;i>=0;i--)if(b[i].route==c){a.selectedTabRoute(b[i].route);break}else a.selectedTabRoute(b[0].route);a.isShowCloseTab(!1)};a.refreshTab=function(b){var c=null,d=0;cube.isEmpty(b)&&(b=a.selectedTabRoute());var e=a.tabContents(),g=e.length;for(i=0;i<g;i++)if(e[i].route==b){c=e[i].templateOptions;d=i;break}cube.notEmpty(c)&&(cube.clearComponentCached(c.name),b!=a.selectedTabRoute()?a.selectedTabRoute(b):
(b=null,b=a.reusable()?$(k).find(".tab-content"+(a.tabLayout()=="left"?"-main":"")+":eq("+d+")"):$(k).find(".tab-content"+(a.tabLayout()=="left"?"-main":"")),cube.bindComponentByNode(b,{component:c})))};a.tabCancelClose=function(){a.isShowCloseTab(!1)};a.mouseoverPopoverDialog=function(){};a.mousedownInnerPopoverDialog=function(){};a.hiddenPopoverDialog=function(){a.isShowCloseTab(!1);a.closeTabFocus(!1)};a.itemsChange=function(b){var c=null;if(a.reusable()&&b)for(var d=0;d<b.length;d++){c=b[d];if(cube.notEmpty(c.templateOptions)){c.isOut=
cube.notEmpty(c.templateOptions.name)&&c.templateOptions.name.indexOf("http")==0&&c.templateOptions.type!="viewModel"?!0:!1;if(cube.isEmpty(c.templateOptions.type))c.templateOptions.type="ajax";if(c.templateOptions.type=="ajax"&&cube.isEmpty(c.templateOptions.ajaxHtml))c.templateOptions.ajaxHtml=cube.obj("");if(cube.isEmpty(c.templateOptions.iframeHeight))c.templateOptions.iframeHeight="auto"}if(typeof c.isLocked==void 0)c.isLocked=cube.obj(!1);else if(!cube.isObservable(c.isLocked))c.isLocked=cube.obj(c.isLocked)}else if(b)for(d=
0;d<b.length;d++)if(c=b[d],typeof c.isLocked==void 0)c.isLocked=cube.obj(!1);else if(!cube.isObservable(c.isLocked))c.isLocked=cube.obj(c.isLocked);a.isTabLineFeed()!=!0&&a.$scrollDiv!=null&&!cube.isObservable(a.$scrollDiv)&&a.$scrollDiv.length>0&&setTimeout(function(){var b=a.$scrollDiv.width(),c=a.$scrollLeftDiv.height(),d=a.$scrollDiv.children("ul"),h=a.$scrollLeftDiv.children("ul"),d=d.width(),h=h.height();a.tabLayout()=="top"?d>=b?a._showBtn(!0):a._showBtn(!1):h>=c?a._showBtn(!0):a._showBtn(!1)},
300)};a.selectedTabChange=function(){a.isTabLineFeed()!=!0&&a.$scrollDiv!=null&&!cube.isObservable(a.$scrollDiv)&&a.$scrollDiv.length>0&&setTimeout(function(){var b=a.$scrollDiv.width(),c=a.$scrollLeftDiv.height(),d=a.$scrollDiv.children("ul"),e=a.$scrollLeftDiv.children("ul");d.width();var e=e.height(),g=0,l=0,h=a.tabContents(),f=h.length;for(i=0;i<f;i++)g+=d.children("li")[i].clientWidth+4,h[i].route==a.selectedTabRoute()&&(l=b-g);a.tabLayout()=="top"?g>=b&&l<=0?d.animate({left:l}):d.animate({left:0}):
e>=c?a._showBtn(!0):(a._showBtn(!1),d.animate({top:0}))},300)};a.getAjaxHtml=function(b,c){$.ajax({url:b,crossDomain:cube.crosDomain(b),success:function(b){typeof c!="undefined"&&c.templateOptions&&cube.isObservable(c.templateOptions.ajaxHtml)?c.templateOptions.ajaxHtml(b):a.ajaxHtml(b)}})};a.iframeLoad=function(a,c){var d=c.currentTarget?c.currentTarget:c.srcElement;if(!o&&d){var e=d.contentWindow||d.contentDocument.parentWindow;try{e.document.body&&($(d).attr("scrolling","no"),$(e.document.body).resize(function(){$(d).height(this.scrollHeight+
"px")}))}catch(g){}}};a.onloading=function(b,c){k=b;m=c;var d=$(b).children("section");n=a.tabContents().length;var e=cube.getIEVersion();d.each(function(b,c){var d=$(c),f=d.wrap("<div></div>").parent().html();e>-1&&e<9&&(f=f.replace(/<:/g,"<").replace(/<\/:/g,"</"));f={title:d.attr("title"),route:d.attr("route"),content:f};a.tabContents.push(f);d.remove()})};a.onload=function(b){b=$(b);a.$scrollDiv=b.children(".tabsheader").children(".scrollborder").children(".scroll");a.$scrollLeftDiv=b.children(".tabsheader-main").children(".scrollborder-main").children(".scroll-main");
a.$closeDialog=b.children(".dropdown-menu");a.itemsChange();n==0&&a.tabContents()&&a.tabContents().length>0&&(a.selectedTabRoute(a.tabContents()[0].route),a.showTabContent(a.tabContents()[0]))};cube.endViewModel(a,j)}j.prototype.dispose=function(){this.selectedTab.dispose();this.selctedTabRouteSub.dispose();this.tabContentsSub.dispose()};return j});