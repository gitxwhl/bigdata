define(["Validator","CheckUtil"],function(j,l){function f(g){function f(c,b){var d=a.validType();c==!1?d==null?d="NOTNULL":d.indexOf("NOTNULL")==-1&&(d+=",NOTNULL"):d!=null&&cube.notEmpty(b)&&typeof b.validType!="undefined"&&b.validType.indexOf("NOTNULL")==-1&&(d=d.replace("NOTNULL",""));a.validType(d)}function m(){setTimeout(function(){var c=a.value()+"",b=/^[+|-]?\d*[\.]?\d*$/;(!/\-*(\d+(\.\d+)*)e([\+\-])(\d+)/.test(c)&&!b.test(c)&&!/^[+|-]?\d/.test(c)||/[a-zA-Z]+/.test(c))&&a.value("")},100)}function n(a,
b){if(cube.notEmpty(a)){cube.isString(a)||(a=String(a));var d=new Date(a.replace(/-/g,"/"));l.isDigit(a)&&(a.length==10&&(a+="000"),a.length==13&&(d=new Date(parseInt(a))));b=b.replace(/yyyy/g,d.getFullYear());b=b.replace(/MM/g,h(d.getMonth()+1,"00"));b=b.replace(/dd/g,h(d.getDate(),"00"));b=b.replace(/HH/g,h(d.getHours(),"00"));b=b.replace(/mm/g,h(d.getMinutes(),"00"));b=b.replace(/ss/g,h(d.getSeconds(),"00"))}else return a;return b}function h(a,b){if(a==null)return"";if(typeof b=="undefined")return a+
"";if(typeof b=="number")return a+"";var d=a+"";if(b!=null&&b!=""){var d=d.split("."),e=b.split(".");d[0].length<e[0].length&&(d[0]=e[0].substring(0,e[0].length-d[0].length)+d[0]);if(e.length==1)return d[0];else{if(d.length>1)for(;d[1].length<e[1].length;)d[1]+="0";else d[1]=e[1];return(new Number(d[0]+"."+d[1])).toFixed(e[1].length)}}else return d}var a=this;a.name="";a.value="";a.isShowNull=!0;a.isSelectedFirst=!1;a.isCheckListVer=!1;a.isExtDisplay=!1;a.isTextEllipsis=!1;a.isValueIsEmptyEnter=!1;
a.dropdownMenuHeight="auto";a.isShowScroll=!1;a.isShowCheckbox=!1;a.isClickShow=!1;a.isAllowEdit=!1;a.blurValid=!1;a.autoMatching=!0;a._checkListvalue=[];a.readOnly=!1;a.editorType="TextEditor";a.prefixText="";a.suffixText="";a.maxLength=null;a.textMode="normal";a.textAlign="left";a.nullable=!0;a.validType=null;a.validOptions=null;a.validStatus=null;a.validHint=null;a.customValidate=null;a.isValid=!0;a.hasFocus=!1;a.type="checkbox";a.list=[];a.treeOptions={};a.isSelectedClose=!0;a.width="100%";a.height=
"100px";a.increment=1;a.format=null;a.customBtnText=null;a.labelAutowrap=!0;a.labelValue="";a.labelTitle="";a.customBtnIcon="folder-open";a.customBtnEnabled=!0;a.transferHeight="200px";a.transferWidth="100px";a.checkListCols=null;a.displayAddButton=!0;a.displayDeleteButton=!0;a.displayAddAllButton=!0;a.displayDeleteAllButton=!0;a.listRight=cube.array([]);a._addData=null;a._deleteData=null;a._isValueIsEmptyEnter=!1;a._value=null;a._isValided=null;a.isShowPopDialog=!1;a.validHintType="inline";a.itemIndex=
null;a.onChanged=null;a.onSelectedChanged=null;a.onClick=null;a.onFocus=null;var i=a.onRendered=null;a._init=function(){var c=a.list();cube.notEmpty(c)&&!cube.isArray(c)&&a.itemIndex()!=null&&cube.notEmpty(c[a.itemIndex()])&&a.list(c[a.itemIndex()]);a.customBtnIcon()==null&&a.customBtnIcon("folder-open");c=a.editorType();c=="TextEditor"&&a.textMode()=="multiline"&&cube.notEmpty(a.value())&&cube.isString(a.value())&&(a.value(a.value().replace(/\\r\\n/gi,"\n").replace(/\\n/gi,"\r\n")),a.onChanged(a.name(),
a.value()));a.format()!=null&&a.value(n(a.value(),a.format()));a.valueSub=cube.subscribe(a.value,a._changed);a.checkListvalueSub=cube.subscribe(a._checkListvalue,a._checkListValuechanged);a.hasFocusSub=cube.subscribe(a.hasFocus,function(b){if(b&&a.onFocus!=null&&!cube.isObservable(a.onFocus))a.onFocus(a.value(),a)});c=="NumberEditor"&&cube.isEmpty(a.validType())&&(a.validType("DIGIT"),a._value(a.value()));a._changeCheckListvalue(c);if(c=="LabelEditor"){a.labelValue(cube.escapeString(a.value()));a.labelTitle(a.value());
for(var c=a.list(),b=a.value(),d=0;d<c.length;d++)if(c[d].value==b){a.labelValue(cube.escapeString(c[d].text));a.labelTitle(c[d].text);break}}if(typeof g.maxLength!="undefined"&&g.maxLength!=null)c=a.validOptions(),c==null&&(c={}),c.maxLength=g.maxLength,a.validOptions(c);cube.notEmpty(a.checkListCols())&&a.initList();a.validHint("");a.validStatus("");f(a.nullable(),g);a.nullableSub=cube.subscribe(a.nullable,f)};a._changeCheckListvalue=function(c,b){if(typeof b!="undefined"&&cube.isEmpty(b))a._checkListvalue([]);
else if((c=="CheckListEditor"||c=="DropDownEditor"&&a.isShowCheckbox()==!0)&&cube.notEmpty(a.value()))c=="CheckListEditor"&&a.type()=="radio"?a._checkListvalue(a.value()):a._checkListvalue(String(a.value()).split(","))};a._list=cube.array([]);a.initList=function(){for(var c=a.list().length,b=a.checkListCols(),d=c/b,e=0;e<d;e++){for(var k=cube.array([]),f=0;f<b;f++){var g=a.list()[e*b+f];e*b+f<c&&k().push(g)}a._list().push(k)}};a._selectListItem=function(){typeof this.value!="undefined"?a.value(this.value):
a.value(this)};a.setNumberDown=function(){if(!a.readOnly()){var c=parseFloat(a.value());isNaN(c)&&(c=0,a.isValueIsEmptyEnter()&&(a._isValided(!0),a._isValueIsEmptyEnter(!0)));var b=a.validOptions();if(b&&(b=b.maxValue,typeof b!="undefined"&&c>=b))return;a.value(c+a.increment())}};a.setNumberUp=function(){if(!a.readOnly()){var c=parseFloat(a.value());isNaN(c)&&(c=0,a.isValueIsEmptyEnter()&&(a._isValided(!0),a._isValueIsEmptyEnter(!0)));var b=a.validOptions();if(b&&(b=b.minValue,typeof b!="undefined"&&
c<=b))return;a.value(c-a.increment())}};a._input_keydown=function(c,b){if(a.readOnly()&&b.keyCode==8)return b.keyCode=0,!1;var d=null;return a.isValueIsEmptyEnter()?d=cube.notEmpty(a._value())?!1:cube.isEmpty(a._value())&&a._isValided()==!1?!0:a._isValueIsEmptyEnter()?!1:!0:!0};a._input_keyup=function(){m()};a._input_keypress=function(c,b){if(a.value()==null)return!0;if(a.value().toString().indexOf("-")==-1&&b.which==45)return!0;return a.value().toString().indexOf(".")==-1&&b.which==46?!0:b.which>=
48&&b.which<=57&&b.ctrlKey==!1&&b.shiftKey==!1||b.which==0||b.which==8?!0:b.ctrlKey==!0&&(b.which==99||b.which==118)?!0:!1};a._changed=function(c,b){b!=!1&&a.isValid()&&a._valid();var d=a.editorType();if(d=="LabelEditor"){a.labelValue(cube.escapeString(a.value()));a.labelTitle(a.value());var e=a.list(),c=a.value();if(cube.isArray(e))for(var f=0;f<e.length;f++)if(e[f].value==c){a.labelValue(cube.escapeString(e[f].text));a.labelTitle(e[f].text);break}}else d=="NumberEditor"&&a.isValueIsEmptyEnter()&&
cube.isEmpty(a._value())&&(event.srcElement.className=="btn btn-success"&&(a._isValided(!1),a._isValueIsEmptyEnter(!1)),(event.srcElement.className=="caret-down"||event.srcElement.className=="caret-up")&&a._isValided(!0));a._changeCheckListvalue(d,c);if(a.onChanged!=null&&!cube.isObservable(a.onChanged))if(d=a.itemIndex(),d!=null)a.onChanged(a.name(),a.value(),d);else a.onChanged(a.name(),a.value())};a._onclick=function(c){if(a.onClick!=null&&!cube.isObservable(a.onClick)&&(a.editorType()!="CustomEditor"&&
!a.readOnly()||a.editorType()=="CustomEditor"&&a.customBtnEnabled()))(c=a.onClick(a.value(),c))&&a.value(c)};a._onkeydown=function(a,b){if(a.readOnly()&&b.keyCode==8)return b.keyCode=0,!1;return!0};a._checkListValuechanged=function(){var c=a.editorType();if(c=="CheckListEditor"||c=="DropDownEditor")c=a._checkListvalue(),a.value(cube.isArray(c)?c.join(","):c)};a._valid=function(){a.isValueIsEmptyEnter()&&(a._isValided(!0),cube.notEmpty(a.value())?a._isValueIsEmptyEnter(!0):a._isValueIsEmptyEnter(!1));
if(a.isValid()&&!a.readOnly()){var c=a.validType();if(a.editorType()=="NumberEditor"){var b=a.value();if(cube.isEmpty(b)&&c.indexOf("NOTNULL")==-1)return;else b!="-"&&(b=j.validate(a.value(),"DIGIT",null),b.successful||a.value(""))}var d;a.customValidate!=null&&cube.isFunction(a.customValidate)&&!cube.isObservable(a.customValidate)&&(d=a.customValidate(a.value()));d==!1||$.isPlainObject(d)&&d.successful==!1?(a.validStatus("error"),$.isPlainObject(d)&&d.hint&&(a.validHintType()=="pop"?(a.isShowPopDialog(!1),
a.isShowPopDialog(!0),cube.showPopDialog($(i),{content:d.hint,popoverDirection:"bottom",msgType:"error",isShowDialog:a.isShowPopDialog})):a.validHint(d.hint))):(cube.isEmpty(c)||c.indexOf("NOTNULL")==-1)&&cube.isEmpty(a.value())?(a.validStatus(""),a.validHint(""),a.isShowPopDialog(!1)):(b=j.validate(a.value(),c,a.validOptions()),b.successful?(a.validStatus(""),a.validHint(""),a.isShowPopDialog(!1)):(a.validStatus("error"),a.validHintType()=="pop"?(a.isShowPopDialog(!1),a.isShowPopDialog(!0),cube.showPopDialog($(i),
{content:b.hint,popoverDirection:"bottom",msgType:"error",isShowDialog:a.isShowPopDialog})):a.validHint(b.hint)))}};a.onload=function(c,b){i=c;var d=a.editorType();if(d!="DropDownEditor"&&d!="DropDownTreeEditor"&&a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(c,b)};cube.endViewModel(a,g)}f.prototype.dispose=function(){this.isShowPopDialog(!1);this.valueSub.dispose();this.checkListvalueSub.dispose();this.nullableSub.dispose();this.hasFocusSub.dispose()};return f});