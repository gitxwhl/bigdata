define(["CheckUtil"],function(checkUtil){var me={};var _CRLF="\n";me.rules={NOTNULL:_isNOTNull,DIGIT:_isDigit,INTEGER:_isInteger,MINUSINTEGER:_isMinusInteger,PLUSINTEGER:_isPlusInteger,FLOAT:_isFloat,MINUSFLOAT:_isMinusFloat,PLUSFLOAT:_isPlusFloat,CHINESE:_isChinese,LETTER:_isLetter,ASCII:_isAcsii,DATE:_isDate,DATETIME:_isDateTime,TIME:_isTime,EMAIL:_isEmail,IP:_isIP,MOBILE:_isMobile,PHONE:_isPhone,URL:_isUrl,ZIPCODE:_isZipCode,SQL:_isSQL,IDCARD:_isIDCard,MAXVALUE:_isMaxValue,MINVALUE:_isMinValue,
MINLENGTH:_isMinLength,MAXLENGTH:_isMaxLength,REGEXP:_regularTest,UNIQUE:_unique};me.validate=function(p_str,p_validType,p_options){var result={successful:true,hint:cube.msg("INVALID_MESSAGE")};var rules=[];var validTypes=[];if(cube.notEmpty(p_validType))if(cube.isString(p_validType)){validTypes=p_validType.split(",");for(var i=0;i<validTypes.length;i++)if(cube.notEmpty(validTypes[i])){var validType=validTypes[i].replace(/\s*/,"");if(validType=="NOTNULL"){_validateRules(p_str,[me.rules[validType]],
result,validType,p_options);if(!result.successful)return result}else rules.push(me.rules[validType])}}if(cube.isEmpty(p_str))p_str=null;if(cube.notEmpty(p_options)&&cube.notEmpty(p_options.maxLength)){$.extend(result,_isMaxLength(p_str,p_options.maxLength));if(!result.successful){if(cube.notEmpty(p_options.validateMessage)){result.hint+=_CRLF;result.hint+=p_options.validateMessage}return result}}if(cube.notEmpty(p_options)&&cube.notEmpty(p_options.minLength)){$.extend(result,_isMinLength(p_str,p_options.minLength));
if(!result.successful){if(cube.notEmpty(p_options.validateMessage)){result.hint+=_CRLF;result.hint+=p_options.validateMessage}return result}}_validateRules(p_str,rules,result,validTypes,p_options);return result};function _validateRules(p_str,p_rules,p_result,p_validTypes,p_options){var ruleOption,tmpRet,tmpRet1,tmpRet2;for(var i=0;i<p_rules.length;i++){if(cube.notEmpty(p_options))ruleOption=p_options[p_validTypes[i]];if(cube.isEmpty(ruleOption))ruleOption=p_options;if(cube.notEmpty(ruleOption)&&cube.notEmpty(ruleOption.maxLength))tmpRet1=
_isMaxLength(p_str,ruleOption.maxLength);if(cube.notEmpty(ruleOption)&&cube.notEmpty(ruleOption.minLength))tmpRet2=_isMinLength(p_str,ruleOption.minLength);var p_ruleOption=$.extend(true,{},ruleOption);if(p_rules[i])tmpRet=p_rules[i](p_str,p_ruleOption);if(cube.notEmpty(tmpRet)){if(cube.notEmpty(tmpRet1)&&!tmpRet1.successful){p_result.successful=tmpRet1.successful;p_result.hint+=_CRLF;p_result.hint+=tmpRet1.hint;tmpRet1.successful=true;delete tmpRet1.hint}if(cube.notEmpty(tmpRet2)&&!tmpRet2.successful){p_result.successful=
tmpRet2.successful;p_result.hint+=_CRLF;p_result.hint+=tmpRet2.hint;tmpRet2.successful=true;delete tmpRet2.hint}if(!tmpRet.successful){p_result.successful=tmpRet.successful;if(cube.notEmpty(ruleOption)&&cube.notEmpty(ruleOption.validateMessage)){p_result.hint+=_CRLF;p_result.hint+=ruleOption.validateMessage}else if(cube.notEmpty(tmpRet.hint)){p_result.hint+=_CRLF;p_result.hint+=tmpRet.hint;delete tmpRet.hint}}}}return p_result}function _isNOTNull(p_str,p_options){var result={successful:!checkUtil.isNull(p_str)};
if(!result.successful)$.extend(result,{hint:cube.msg("INPUT_NON_NULLABLE")});return result}function _checkValue(p_result,p_str,p_options){p_options.validateMessage="";var result=p_result;if(cube.notEmpty(p_options)){if(cube.notEmpty(p_options.maxValue)){$.extend(result,_isMaxValue(p_str,p_options.maxValue,true));if(!result.successful)return result}if(cube.notEmpty(p_options.minValue)){$.extend(result,_isMinValue(p_str,p_options.minValue,true));if(!result.successful)return result}}}function _isDigit(p_str,
p_options){var result={successful:checkUtil.isDigit(p_str)};if(result.successful)_checkValue(result,p_str,p_options);else $.extend(result,{hint:cube.msg("ENTER_DIGIT")});return result}function _isInteger(p_str,p_options){var result={successful:checkUtil.isInteger(p_str)};if(result.successful)_checkValue(result,p_str,p_options);else $.extend(result,{hint:cube.msg("ENTER_INTEGER")});return result}function _isMinusInteger(p_str,p_options){var result={successful:checkUtil.isMinusInteger(p_str)};if(result.successful)_checkValue(result,
p_str,p_options);else $.extend(result,{hint:cube.msg("ENTER_MINUS_INTEGER")});return result}function _isPlusInteger(p_str,p_options){var result={successful:checkUtil.isPlusInteger(p_str)};if(result.successful)_checkValue(result,p_str,p_options);else $.extend(result,{hint:cube.msg("ENTER_PLUS_INTEGER")});return result}function _isFloat(p_str,p_options){var result={successful:checkUtil.isFloat(p_str)};if(result.successful)_checkValue(result,p_str,p_options);else $.extend(result,{hint:cube.msg("ENTER_FLOAT")});
return result}function _isMinusFloat(p_str,p_options){var result={successful:checkUtil.isMinusFloat(p_str)};if(result.successful)_checkValue(result,p_str,p_options);else $.extend(result,{hint:cube.msg("ENTER_MINUS_FLOAT")});return result}function _isPlusFloat(p_str,p_options){var result={successful:checkUtil.isPlusFloat(p_str)};if(result.successful)_checkValue(result,p_str,p_options);else $.extend(result,{hint:cube.msg("ENTER_PLUS_FLOAT")});return result}function _isMaxValue(p_str,p_maxValue,p_isFloat){var result=
{successful:checkUtil.isMaxValue(p_str,p_maxValue,p_isFloat)};if(!result.successful)$.extend(result,{hint:cube.msg("INPUT_GREATER_THAN_MAX",[p_maxValue])});return result}function _isMinValue(p_str,p_minValue,p_isFloat){var result={successful:checkUtil.isMinValue(p_str,p_minValue,p_isFloat)};if(!result.successful)$.extend(result,{hint:cube.msg("INPUT_LESS_THAN_MIN",[p_minValue])});return result}function _isMinLength(p_str,p_minLength){var result={successful:checkUtil.isMinLength(p_str,p_minLength-
1)};if(!result.successful)$.extend(result,{hint:cube.msg("INPUT_LENGTH_LESS_THAN_MIN",[p_minLength])});return result}function _isMaxLength(p_str,p_maxLength){var result={successful:checkUtil.isMaxLength(p_str,p_maxLength+1)};if(!result.successful)$.extend(result,{hint:cube.msg("INPUT_LENGTH_GREATER_THAN_MAX",[p_maxLength])});return result}function _isChinese(p_str,p_options){var result={successful:checkUtil.isChinese(p_str)};if(!result.successful)$.extend(result,{hint:cube.msg("ENTER_CHINESE")});
return result}function _isLetter(p_str,p_options){var result={successful:checkUtil.isLetter(p_str)};if(!result.successful)$.extend(result,{hint:cube.msg("ENTER_LETTER")});return result}function _isAcsii(p_str,p_options){var result={successful:checkUtil.isAcsii(p_str)};if(!result.successful)$.extend(result,{hint:cube.msg("NON_ASCII")});return result}function _isDate(p_str,p_options){var result={successful:checkUtil.isDate(p_str)};if(!result.successful)$.extend(result,{hint:cube.msg("ENTER_DATE")});
else if(cube.notEmpty(p_options))$.extend(result,_checkDateLimits(p_str,p_options));return result}function _isDateTime(p_str,p_options){var result={successful:checkUtil.isDateTime(p_str)};if(!result.successful)$.extend(result,{hint:cube.msg("ENTER_DATETIME")});else if(cube.notEmpty(p_options))$.extend(result,_checkDateLimits(p_str,p_options));return result}function _isTime(p_str,p_options){var result={successful:checkUtil.isTime(p_str)};if(result.successful){$.extend(result,_checkTimeMinAndMax(p_str,
p_options));if(!result.successful)return result}if(!result.successful)$.extend(result,{hint:cube.msg("ENTER_TIME")});return result}function _checkTimeMinAndMax(p_str,p_options){var result={successful:true};if(cube.notEmpty(p_options)&&(cube.notEmpty(p_options.maxValue)||cube.notEmpty(p_options.minValue))){var date=new Date;date.setHours(0);date.setMinutes(0);date.setSeconds(0);var v=date.clone();function setTime(p_date,p_param){if(cube.isString(p_param)){var hms=p_param.split(":");for(var i=0;i<hms.length;i++)if(i==
0)p_date.setHours(hms[i]);else if(i==1)p_date.setMinutes(hms[i]);else if(i==2)p_date.setSeconds(hms[i]);else break}else if(cube.isDate(p_param)){p_date.setHours(p_param.getHours());p_date.setMinutes(p_param.getMinutes());p_date.setSeconds(p_param.getSeconds())}}setTime(v,p_str);if(cube.notEmpty(p_options.maxValue)){var max=date.clone();setTime(max,p_options.maxValue);if(v>max){result.successful=false;result.hint=cube.msg("INPUT_GREATER_THAN_MAX",[p_options.maxValue]);return result}}if(cube.notEmpty(p_options.minValue)){var min=
date.clone();setTime(min,p_options.minValue);if(v<min){result.successful=false;result.hint=cube.msg("INPUT_LESS_THAN_MIN",[p_options.minValue]);return result}}}return result}function _isEmail(p_str,p_options){var result={successful:checkUtil.isEmail(p_str)};if(!result.successful)$.extend(result,{hint:cube.msg("ENTER_EMAIL")});return result}function _isIP(p_str,p_options){var result={successful:checkUtil.isIP(p_str)};if(!result.successful)$.extend(result,{hint:cube.msg("ENTER_IP")});return result}
function _isMobile(p_str,p_options){var result={successful:checkUtil.isMobile(p_str)};if(!result.successful)$.extend(result,{hint:cube.msg("ENTER_MOBILE")});return result}function _isPhone(p_str,p_options){var result={successful:checkUtil.isPhone(p_str)};if(!result.successful)$.extend(result,{hint:cube.msg("ENTER_PHONE")});return result}function _isUrl(p_str,p_options){var result={successful:checkUtil.isUrl(p_str)};if(!result.successful)$.extend(result,{hint:cube.msg("ENTER_URL")});return result}
function _isZipCode(p_str,p_options){var result={successful:checkUtil.isZipCode(p_str)};if(!result.successful)$.extend(result,{hint:cube.msg("ENTER_ZIPCODE")});return result}function _isSQL(p_str,p_options){var result=checkUtil.isSqlInjection(p_str);if(!result.successful)$.extend(result,{hint:cube.msg("SQL_INJECTION",{sql:result.hint})});return result}function _isIDCard(p_str,p_options){var result={successful:checkUtil.isIDCard(p_str)};if(!result.successful)$.extend(result,{hint:cube.msg("ENTER_IDCARD")});
return result}function _unique(p_str,p_options){var result={successful:checkUtil.isUnique(p_str,p_options.url)};if(!result.successful)$.extend(result,{hint:p_options.validateMessage?p_options.validateMessage:cube.msg("ENTER_UNIQUE")});return result}function _regularTest(p_str,p_options){var result={successful:true};if(cube.isEmpty(p_str))return result;if(cube.notEmpty(p_options)){var exp=p_options.expression;try{result.successful=exp.test(p_str)}catch(e){result.successful=false;result.hint=p_options.validateMessage}}return result}
function _checkDateLimits(p_value,p_options){var result={successful:true};if(cube.isDate(p_value))p_value=Date.format(p_value);if(cube.notEmpty(p_options.maxValue)){try{result.successful=parseDate(p_value)<=parseDate(p_options.maxValue)}catch(e){result.successful=false}if(!result.successful)$.extend(result,{hint:cube.msg("INPUT_GREATER_THAN_MAX",[p_options.maxValue])})}if(result.successful&&cube.notEmpty(p_options.minValue)){try{result.successful=parseDate(p_value)>=parseDate(p_options.minValue)}catch(e){result.successful=
false}if(!result.successful)$.extend(result,{hint:cube.msg("INPUT_LESS_THAN_MIN",[p_options.minValue])})}return result}return me});