define([],function(){return function(){var me=this;me.baseUrl=null;me.timeout=cube.timeout;me.async=null;me.mode="default";me.authorization=null;me.customHeaders=null;me.setBaseUrl=function(p_baseUrl){me.baseUrl=p_baseUrl};me.send=function(p_path,p_method,p_data,p_async,p_callback){var url=me._makeUrl(p_path);var method=p_method!=null?p_method.toUpperCase():"GET";var async=true;if(me.async!=null)async=me.async;else if(me.async==null&&p_async!=null)async=p_async;var ajaxSetting={url:url,timeout:me.timeout,
type:method,contentType:"application/json",dataType:"json",cache:false,async:async,data:cube.encryptData?cube.encryptData(p_data,url):p_data,success:function(p_resultValue){if(cube.isFunction(p_callback)){p_resultValue.parentId=p_path;p_callback(p_resultValue)}},error:function(p_request,p_status,p_err){if(cube.isFunction(p_callback)){var error=_resolveError(p_request,url,p_status,p_err);var context={successful:false,error:error};p_callback(context)}}};if(cube.notEmpty(me.authorization))ajaxSetting.headers=
{"Authorization":me.authorization};else if(cube.notEmpty(cube.authorization))ajaxSetting.headers={"Authorization":cube.authorization};var customHeaders=me.customHeaders;if(cube.isEmpty(customHeaders))customHeaders=cube.customHeaders;if(cube.notEmpty(customHeaders))if(ajaxSetting.headers)$.extend(ajaxSetting.headers,customHeaders);else ajaxSetting.headers=customHeaders;if(cube.notEmpty(cube.cl_u_id))if(ajaxSetting.headers)$.extend(ajaxSetting.headers,{"cl_u_id":cube.cl_u_id});else ajaxSetting.headers=
{"cl_u_id":cube.cl_u_id};var req=me.mode=="queue"?$.ajaxQueue(ajaxSetting):$.ajax(ajaxSetting);return req};me.sendSync=function(p_path,p_method,p_data){var c=null;me.send(p_path,p_method,p_data,false,function(p_context){c=p_context});return c};me.get=function(p_path,p_data,p_callback){if(cube.isFunction(p_data)){p_callback=p_data;p_data=null}var req=me.send(p_path,"GET",p_data,true,p_callback);return req};me.getSync=function(p_path,p_data){return me.sendSync(p_path,"GET",p_data)};me.put=function(p_path,
p_data,p_callback){if(cube.isFunction(p_data)){p_callback=p_data;p_data=null}var req=me.send(p_path,"PUT",p_data,true,p_callback);return req};me.post=function(p_path,p_data,p_callback){if(cube.isFunction(p_data)){p_callback=p_data;p_data=null}var req=me.send(p_path,"POST",p_data,true,p_callback);return req};me.postSync=function(p_path,p_data){return me.sendSync(p_path,"POST",p_data)};me.remove=function(p_path,p_data,p_callback){if(cube.isFunction(p_data)){p_callback=p_data;p_data=null}var req=me.send(p_path,
"DELETE",p_data,true,p_callback);return req};me._makeUrl=function(p_path){var result=null;if(cube.notEmpty(p_path)&&cube.isString(p_path)&&p_path.substring(0,4)=="http")result=p_path;else{if(cube.isNumber(p_path))p_path=""+p_path;if(cube.isEmpty(p_path))result=me.baseUrl;else if(p_path.substring(0,2)=="~/"||me.baseUrl==null)result=p_path;else if(cube.notEmpty(me.baseUrl)&&me.baseUrl.substring(me.baseUrl.length-1)!="/"&&p_path.substring(0,1)!="/")result=me.baseUrl+"/"+p_path;else result=me.baseUrl+
p_path;if(result.substring(0,2)=="~/"||result.substring(0,5)=="~/../")result=cube.mappath(result)}var res=_getQueryString(result,"authorization");if(cube.notEmpty(res[1]))me.authorization=res[1];result=res[0];result+=(result.indexOf("?")>0?"&":"?")+"rnd="+cube.random();var token,arr,reg=new RegExp("(^| )token=([^;]*)(;|$)");if(arr=document.cookie.match(reg)){token=unescape(arr[2]);if(token)result+="&token="+token}if(cube.cl_u_id)result+="&cl_u_id="+cube.cl_u_id;return result};function _resolveError(request,
url,status,error){if(error==null)error=new Error(request.responseText);error.url=url;return error}function _getQueryString(url,name){var result=[];if(url.indexOf("?")!=-1){var arr_url=url.split("?");var base=arr_url[0];var str=arr_url[1];if(str.toLowerCase().indexOf(name)!=-1){var index=-1;var strs=str.split("&");for(var i=0;i<strs.length;i++){var param=strs[i].split("=");if(cube.trim(param[0]).toLowerCase()==name){result[1]=cube.trim(param[1]);index=i;break}}if(index!=-1)strs.splice(index,1);if(strs.length>
0)result[0]=base+"?"+strs.join("&");else result[0]=base}else result[0]=url}else result[0]=url;return result}return me}});