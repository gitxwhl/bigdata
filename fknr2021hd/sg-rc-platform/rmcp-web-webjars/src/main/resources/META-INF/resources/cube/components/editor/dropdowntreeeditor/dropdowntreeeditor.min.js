define([],function(){function h(h){var a=this;a.treeOptions={};a.selectedValue=null;a.readOnly=!1;a.width="auto";a.isShowScroll=!1;a.isAllowEdit=!1;a.hasFocus=!1;a.autoMatching=!0;a.isSelectedClose=!0;a.isExtDisplay=!1;a.isShowDropdownOptions=!1;a.dropdownMenuHeight="auto";a.disabled=!1;a.textAlign="left";a._checkText=null;a._ulHeight=null;a.dropdownFocus=!1;a.onSelectedChanged=null;a.onFocus=null;a.onRendered=null;var i=a.commonRendered=null,k=!1;a._init=function(){var b=a.treeOptions(),c=typeof b.isShowCheckbox==
"undefined"?!1:b.isShowCheckbox;if(typeof b.selectedNode=="undefined"&&(b.selectedNode=cube.obj(null),!c))a.selectedNodeSub=cube.subscribe(b.selectedNode,a.selectedChanged);if(typeof b.selectedNodeId=="undefined")b.selectedNodeId=cube.obj(null);else if(!cube.isObservable(b.selectedNodeId))b.selectedNodeId=cube.obj(b.selectedNodeId);if(typeof b.checkedNode=="undefined"&&(b.checkedNode=cube.array(),c))a.checkedNodeSub=cube.subscribe(b.checkedNode,a.selectedChanged);if(a.isAllowEdit()&&a.autoMatching())b.keyword=
a._checkText;b.onLoaded=a.nodesChanged;a.selectedValueSub=cube.subscribe(a.selectedValue,function(a){cube.isEmpty(a)&&(cube.isObservable(b.selectedNodeId)&&b.selectedNodeId(null),cube.isObservable(b.checkedNode)&&b.checkedNode([]))});a.hasFocusSub=cube.subscribe(a.hasFocus,function(b){if(b&&a.onFocus!=null&&!cube.isObservable(a.onFocus))a.onFocus(a.selectedValue(),a)})};a.getCheckText=function(b,c,d,e){cube.isObservable(b)&&(b=b());d&&$.each(b,function(){for(var b=0;b<d.length;b++)d[b]==this.id&&
(c.push(this.text),e.push(this)),(cube.isObservable(this.hasChildren)&&this.hasChildren()==!0||this.hasChildren==!0)&&a.getCheckText(this.childNodes,c,d,e)});a._checkText(c.join(","))};a.nodesChanged=function(b){var c=a.selectedValue();cube.isString(c)&&(c=c.split(","));var d=a.treeOptions();a.getCheckText(b,[],c,d.checkedNode)};a.selectedChanged=function(b){var c="",d="";if(cube.isArray(b)){for(var e=0;e<b.length;e++)c+=b[e].text+",",d+=b[e].id+",";cube.notEmpty(c)&&(c=c.substring(0,c.length-1));
cube.notEmpty(d)&&(d=d.substring(0,d.length-1))}else cube.notEmpty(b)&&(c+=b.text,d+=b.id);a._checkText(c);a.selectedValue(d);if(a.onSelectedChanged!=null&&!cube.isObservable(a.onSelectedChanged))a.onSelectedChanged(d);a.isSelectedClose()&&!cube.isArray(b)&&a.isShowDropdownOptions(!1)};a.doClickDropdownOptions=function(b,c){i=$(b).parents(".input-append").siblings(".dropdown-menu");k=!1;if(a.disabled()==!1&&a.readOnly()==!1){var d=a.isShowDropdownOptions();d||(a.isExtDisplay()&&b!=void 0&&a.showlog(b,
c),a.isAllowEdit()?a.isShowDropdownOptions(!0):(d?a.isShowDropdownOptions(!1):a.isShowDropdownOptions(!0),a.dropdownFocus(!0)))}};a.showlog=function(b,c){var d=$(b).parents(".input-append").siblings(".dropdown-menu");d.css("position","fixed");d.css("z-index","5000");d.css("min-width",d.innerWidth()+"px");a.width()=="auto"||cube.isEmpty(a.width())?d.css("width","auto"):d.css("width",a.width());var e=c.target?c.target:c.srcElement,g=c.layerY?c.layerY:c.offsetY,f=c.layerX?c.layerX:c.offsetX;a._resize(b,
d,c,e,g,f);d.resize(function(){a._resize(b,d,c,e,g,f)})};a._resize=function(a,c,d,e,g,f){d.target.className=="caret"?(f=d.clientX-f-e.offsetLeft-4,e=d.clientY-g-e.offsetTop-3):(f=d.clientX-f-e.offsetLeft,e=d.clientY-g-e.offsetTop);k||(c.css("left",f),$(window).height()-d.clientY-a.offsetHeight>c.innerHeight()?c.css("top",e+a.offsetHeight):c.css("top",e-c.innerHeight()))};var j=!1,l=!1;a.doCloseDropdownOptions=function(){a.disabled()==!1&&a.isShowDropdownOptions()&&(j==!1||l==!0&&j==!0?(a.isShowDropdownOptions(!1),
a.dropdownFocus(!1),j=!1,a.isExtDisplay()&&(i.css("position","relative"),i.css("width","0px"),i.css("left","0px"),k=!0)):a.dropdownFocus(!0))};a.mouseoverPopoverDialog=function(){l=!0;a.dropdownFocus(!0)};a.mousedownInnerPopoverDialog=function(){j=!0;l=!1;a.dropdownFocus(!0)};a.onload=function(b,c){a.commonRendered!=null&&!cube.isObservable(a.commonRendered)&&a.commonRendered(b,c);if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(b,c)};cube.endViewModel(a,h)}h.prototype.dispose=
function(){this.selectedNodeSub&&this.selectedNodeSub.dispose();this.checkedNodeSub&&this.checkedNodeSub.dispose();this.hasFocusSub.dispose()};return h});