define(["../datagrid/datagrid.js"],function(l){function g(i){function g(a,d,e){var b=a.height(),f=d.height();b>f?(d.height(b),e.height(b)):(a.height(f),e.height(f))}function k(){if(!cube.isObservable(a.$node)){var c=a.$node.find(".table-main"),d=a.$node.find(".table-right"),c=c.find(".tableBody"),e=d.find(".tableBody"),b=a.$node.find(".table-operations .tableBody");d[0].scrollWidth>d[0].clientWidth?(a._hasHScroll(!0),a.isShowTempColumn(!1),c.height(parseInt(e.height(),10)-16),b.height(parseInt(e.height(),
10)-16)):(a._hasHScroll(!1),c.height(parseInt(e.height(),10)),b.height(parseInt(e.height(),10)),j==0&&a.isShowTempColumn(!0));c=a.height();isNaN(parseInt(c,10))||cube.isString(c)&&c.indexOf("%")!=-1?a.$node.children(".lockedgrid").height(parseInt(d.height(),10)):a._isSetHeight(!0)}}i._lazyInit=!0;l.call(this,i);var h={},a=this;a.lockedColumns=[];a._hasHScroll=!1;a._emptyWidth=null;a._isSetHeight=!1;a.$node=null;h._init=a._init;a._init=function(){a._hasVScrollSub=cube.subscribe(a._hasVScroll,a.adjustWidth);
a._selectedItemSub=cube.subscribe(a._selectedItem,a.adjustHeight);a.isShowLoadingSub=cube.subscribe(a.isShowLoading,a.adjustHeight);h._init()};var j=0;a.initColumn=function(c){var d=a.columns();if(d&&d.length>0&&a.lockedColumns().length==0){for(var e=0;e<d.length;e++){var b=d[e];if(cube.isEmpty(b))return!0;if(typeof b.validStatus=="undefined")b.validStatus=cube.obj("");else if(!cube.isObservable(b.validStatus))b.validStatus=cube.obj(b.validStatus);if(typeof b.validHint=="undefined")b.validHint=cube.obj("");
else if(!cube.isObservable(b.validHint))b.validHint=cube.obj(b.validHint);if(typeof b.align=="undefined")b.align="";if(typeof b.width=="undefined")b.width=cube.obj(a.columnDefaultWidth()),j++;else if(!cube.isObservable(b.width))cube.notEmpty(b.width)&&(b.width=="auto"||cube.isString(b.width)&&b.width.indexOf("%")!=-1)&&j++,b.width=cube.obj(b.width);if(!b.editorType)b.editorType="TextEditor";if(b.editorType=="DropDownEditor"||b.editorType=="CheckListEditor"||b.editorType=="ListEditor"||b.editorType==
"LabelEditor"){if(c&&c.dicts&&c.dicts[b.name])b.list=c.dicts[b.name]}else if(b.editorType=="FileEditor")if(b.pkVal){if(!cube.isObservable(b.pkVal))b.pkVal=cube.obj(b.pkVal)}else b.pkVal=cube.obj(null);b.locked===!0&&a.lockedColumns.push(b)}a.adjustWidth()}};a.adjustWidth=function(){if(cube.notEmpty(a.$node)&&!cube.isObservable(a.$node)){var c=0,d=a.$node.find(".table-main"),e=a.$node.find(".table-right"),b=d.find(".tableHeader th");d.find(".tableBody");e.find(".tableBody");a.$node.find(".table-operations .tableBody");
for(var f=0;f<b.length;f++)f!=b.length-1&&(c+=b.eq(f).outerWidth());b=2;a.isAllowOperations()&&(b=a.$node.find(".table-operations").outerWidth(),cube.ieVersion>-1&&cube.ieVersion<=8&&b++);d.width(c);e.css("left",c+1);e.width(a.$node.children(".lockedgrid").outerWidth()-c-b);a._emptyWidth(e.find(".tableHeader .table").width()+"px");k()}};a.adjustHeight=function(c){if(cube.isBoolean(c))c||setTimeout(function(){for(var b=a.$node.find(".table-main .tableBody .table tr"),d=a.$node.find(".table-right .tableBody .table tr"),
e=a.$node.find(".table-operations .tableBody .table tr"),c=0;c<b.length;c++)g(b.eq(c),d.eq(c),e.eq(c));k()},200);else{var d=a._editedItemIndex;cube.isObservable(d)&&(d=d());var e=a.$node.find(".table-main .tableBody .table tr:eq("+d+")"),b=a.$node.find(".table-right .tableBody .table tr:eq("+d+")"),f=a.$node.find(".table-operations .tableBody .table tr:eq("+d+")");c!=null?setTimeout(function(){g(e,b,f)},150):(e.css("height",""),b.css("height",""),f.css("height",""))}};h.onload=a.onload;a.onload=function(c){h.onload();
a.$node=$(c);a.$tableBody=a.$node.find(".table-right .tableBody");a.$tableHeader=a.$node.find(".table-right .tableHeader .table");var d=a.$node.find(".table-main .tableBody");a.$tableBody.scroll(function(c){a.$tableHeader.css("left",0-c.target.scrollLeft);a.isAllowOperations()||d.scrollTop(c.target.scrollTop)});a.isAllowOperations()&&a.$node.find(".table-operations .tableBody").scroll(function(c){d.scrollTop(c.target.scrollTop);a.$tableBody.scrollTop(c.target.scrollTop)});a.$node.children(".lockedgrid").resize(function(){a.adjustWidth()});
a.adjustWidth()};cube.endViewModel(a,i)}g.prototype.dispose=function(){this._hasVScrollSub.dispose();this._selectedItemSub.dispose();this.isShowLoadingSub&&this.isShowLoadingSub.dispose()};return g});