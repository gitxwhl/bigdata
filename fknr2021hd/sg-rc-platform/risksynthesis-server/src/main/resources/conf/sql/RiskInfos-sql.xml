<?xml version="1.0" encoding="UTF-8"?>
<sqls>
    <sql id="PlanPublishCount" desc="风险预警通知发布数统计">
        <mysql>
            SELECT
            count( 1 ) plan_cnt
            FROM
            SRP_RISK_GRIDWARNNOTICE
            WHERE
            ${filter} and ( DELETELOGO is null or DELETELOGO != '1' );
        </mysql>
    </sql>
    <sql id="StateGridRiskLevelCount" desc="电网风险等级统计">
        <mysql>
            SELECT
            WARNINGLEVEL GRIDRISK_LEVEL,
            count( 1 ) PLAN_CNT
            FROM
            SRP_RISK_GRIDWARNNOTICE
            WHERE
            ${filter} and ( DELETELOGO is null or DELETELOGO != '1' )
            GROUP BY
            WARNINGLEVEL
            ORDER BY
            WARNINGLEVEL ASC;
        </mysql>
    </sql>
    <sql id="WorkRiskLevelCount" desc="作业风险等级统计">
        <mysql>
            SELECT
            count(c.WORK_PLAN_ID) PLAN_CNT
            FROM
            SRP_RISK_GRIDWARNNOTICE a
            left join SRP_RISK_GRIDWARNTOWORKPLAN b on a.GRIDWARNNOTICE_ID = b.GRIDWARNNOTICE_ID
            left join SRP_WORK_WORKPLANDAY c on b.WORK_PLAN_ID = c.WORK_PLAN_ID
            WHERE
            ${filter} and ( a.DELETELOGO is null or a.DELETELOGO != '1' )
            ;
        </mysql>
    </sql>
    <sql id="WarnRiskCount" desc="风险预警解除数统计">
        <mysql>
            SELECT
            count( 1 ) PLAN_CNT
            FROM
            srp_risk_gridwarnnotice
            WHERE
            ${filter}
            AND WARNSTATUS = '04'
            and ( DELETELOGO is null or DELETELOGO != '1' );
        </mysql>
    </sql>
    <sql id="AreaRiskCountInfo" desc="各单位风险信息统计情况">
        <mysql>
            select
            a.column_type_code DATAREPORT_ORG_ID,
            a.column_type_name DATAREPORT_ORG,
            count(DISTINCT b.GRIDWARNNOTICE_ID) GRIDRISK_CNT,
            count(d.WORK_PLAN_ID) WORKRISK_CNT,
            COUNT( CASE WHEN d.POWER_CUT != '01' THEN 1 ELSE NULL END ) AS POWER_CNT
            from srp_risk_sys_tab a
            LEFT JOIN (select * from SRP_RISK_GRIDWARNNOTICE WHERE ${filter} and ( DELETELOGO is null or DELETELOGO != '1' ) ) b on a.column_type_code =
            b.DATAREPORT_ORG_ID
            LEFT JOIN SRP_RISK_GRIDWARNTOWORKPLAN c on b.GRIDWARNNOTICE_ID = c.GRIDWARNNOTICE_ID
            LEFT JOIN SRP_WORK_WORKPLANDAY d on c.WORK_PLAN_ID = d.WORK_PLAN_ID
            WHERE a.column_code = 'DATAREPORT_ORG'
            GROUP BY
            a.column_type_name,
            a.column_type_code
            ORDER BY
            a.column_type_code + 0 ASC;
        </mysql>
    </sql>

    <sql id="WarnCount" desc="预警数量">
        <mysql>
            SELECT
            a.column_type_code datareport_org_id,
            a.column_type_name datareport_org,
            COUNT( CASE WHEN WARNINGLEVEL='01' THEN 1 ELSE NULL END ) AS number01,
            COUNT( CASE WHEN WARNINGLEVEL='02' THEN 1 ELSE NULL END ) AS number02,
            COUNT( CASE WHEN WARNINGLEVEL='03' THEN 1 ELSE NULL END ) AS number03,
            COUNT( CASE WHEN WARNINGLEVEL='04' THEN 1 ELSE NULL END ) AS number04,
            COUNT( CASE WHEN WARNINGLEVEL='05' THEN 1 ELSE NULL END ) AS number05,
            COUNT( CASE WHEN WARNINGLEVEL='06' THEN 1 ELSE NULL END ) AS number06,
            COUNT( CASE WHEN WARNINGLEVEL='07' THEN 1 ELSE NULL END ) AS number07,
            COUNT( CASE WHEN WARNINGLEVEL='08' THEN 1 ELSE NULL END ) AS number08
            FROM
            (select * from srp_risk_sys_tab where column_code = 'DATAREPORT_ORG') a
            left join (select * from SRP_RISK_GRIDWARNNOTICE WHERE ${filter} and ( DELETELOGO is null or DELETELOGO != '1' )) b on
            b.DATAREPORT_ORG_ID=a.column_type_code
            GROUP BY
            a.column_type_name,
            a.column_type_code
            ORDER BY
            a.column_type_code + 0 ASC;


        </mysql>
    </sql>

    <sql id="VoltageClassCount" desc="电压等级">
        <mysql>
            SELECT
            a.column_type_code DATAREPORT_ORG_ID,
            a.column_type_name DATAREPORT_ORG,
            COUNT( CASE WHEN b.VOLTAGE_LEVEL IN ('01','02','03') THEN 1 ELSE NULL END ) AS VOLTAGE5_CNT,
            COUNT( CASE WHEN b.VOLTAGE_LEVEL IN ('04', '05', '06', '07', '08', '09', '10', '11', '12', '13', '14', '15',
            '16', '17', '18', '19', '20', '21', '22') THEN 1 ELSE NULL END ) AS VOLTAGE3_CNT
            from srp_risk_sys_tab a
            LEFT JOIN (select * from SRP_RISK_GRIDWARNNOTICE WHERE ${filter} and ( DELETELOGO is null or DELETELOGO != '1' )) b on a.column_type_code =
            b.DATAREPORT_ORG_ID
            WHERE a.column_code = 'DATAREPORT_ORG'
            GROUP BY
            a.column_type_name,
            a.column_type_code
            ORDER BY
            a.column_type_code + 0 ASC;
        </mysql>
    </sql>

    <sql id="FailureReasonCount" desc="停电事由">
        <mysql>
            SELECT
            a.column_type_code DATAREPORT_ORG_ID,
            a.column_type_name DATAREPORT_ORG,
            COUNT( CASE WHEN b.FAILURE_REASON = '06' THEN 1 ELSE NULL END ) AS DWJJ_CNT,
            COUNT( CASE WHEN b.FAILURE_REASON = '11' THEN 1 ELSE NULL END ) AS DCKH_CNT,
            COUNT( CASE WHEN b.FAILURE_REASON = '04' THEN 1 ELSE NULL END ) AS SZPH_CNT,
            COUNT( CASE WHEN b.FAILURE_REASON = '02' THEN 1 ELSE NULL END ) AS JGGC_CNT,
            COUNT( CASE WHEN b.FAILURE_REASON = '01' THEN 1 ELSE NULL END ) AS SBJX_CNT
            from srp_risk_sys_tab a
            LEFT JOIN (select * from SRP_RISK_GRIDWARNNOTICE WHERE ${filter} and ( DELETELOGO is null or DELETELOGO != '1' )) b on a.column_type_code =
            b.DATAREPORT_ORG_ID
            WHERE a.column_code = 'DATAREPORT_ORG'
            GROUP BY
            a.column_type_name,
            a.column_type_code
            ORDER BY
            a.column_type_code + 0 ASC;
        </mysql>
    </sql>

    <sql id="RiskDevCount" desc="停电设备">
        <mysql>
            SELECT
            a.column_type_code DATAREPORT_ORG_ID,
            a.column_type_name DATAREPORT_ORG,
            COUNT( CASE WHEN b.RISKDEV = '01' THEN 1 ELSE NULL END ) AS RISKDEVJL_CNT,
            COUNT( CASE WHEN b.RISKDEV = '02' THEN 1 ELSE NULL END ) AS RISKDEVMX_CNT,
            COUNT( CASE WHEN b.RISKDEV = '03' THEN 1 ELSE NULL END ) AS RISKDEVZB_CNT,
            COUNT( CASE WHEN b.RISKDEV = '04' THEN 1 ELSE NULL END ) AS RISKDEVZL_CNT,
            COUNT( CASE WHEN b.RISKDEV = '05' THEN 1 ELSE NULL END ) AS RISKDEVQT_CNT
            from srp_risk_sys_tab a
            LEFT JOIN (select * from SRP_RISK_GRIDWARNNOTICE WHERE ${filter} and ( DELETELOGO is null or DELETELOGO != '1' )) b on a.column_type_code =
            b.DATAREPORT_ORG_ID
            WHERE a.column_code = 'DATAREPORT_ORG'
            GROUP BY
            a.column_type_name,
            a.column_type_code
            ORDER BY
            a.column_type_code + 0 ASC;
        </mysql>
    </sql>

    <sql id="RiskKeepDayCount" desc="预警事件持续时间">
        <mysql>
            SELECT
            a.column_type_code DATAREPORT_ORG_ID,
            a.column_type_name DATAREPORT_ORG,
            COUNT( CASE WHEN TIMESTAMPDIFF( DAY, ACTUALBEGINTIME, ACTUALENDTIME ) &lt;=1 THEN 1 ELSE NULL END ) AS
            ACTUALDAY1_CNT,
            COUNT( CASE WHEN TIMESTAMPDIFF( DAY, ACTUALBEGINTIME, ACTUALENDTIME ) &gt;1 and TIMESTAMPDIFF( DAY,
            ACTUALBEGINTIME, ACTUALENDTIME ) &lt;=3 THEN 1 ELSE NULL END ) AS ACTUALDAY3_CNT,
            COUNT( CASE WHEN TIMESTAMPDIFF( DAY, ACTUALBEGINTIME, ACTUALENDTIME ) &gt;3 and TIMESTAMPDIFF( DAY,
            ACTUALBEGINTIME, ACTUALENDTIME ) &lt;=7 THEN 1 ELSE NULL END ) AS ACTUALDAY7_CNT,
            COUNT( CASE WHEN TIMESTAMPDIFF( DAY, ACTUALBEGINTIME, ACTUALENDTIME ) &gt;7 and TIMESTAMPDIFF( DAY,
            ACTUALBEGINTIME, ACTUALENDTIME ) &lt;=15 THEN 1 ELSE NULL END ) AS ACTUALDAY15_CNT,
            COUNT( CASE WHEN TIMESTAMPDIFF( DAY, ACTUALBEGINTIME, ACTUALENDTIME ) &gt;15 and TIMESTAMPDIFF( DAY,
            ACTUALBEGINTIME, ACTUALENDTIME ) &lt;=30 THEN 1 ELSE NULL END ) AS ACTUALDAY30_CNT,
            COUNT( CASE WHEN TIMESTAMPDIFF( DAY, ACTUALBEGINTIME, ACTUALENDTIME ) &gt;30 THEN 1 ELSE NULL END ) AS
            ACTUALDAY31_CNT
            from srp_risk_sys_tab a
            LEFT JOIN (select * from SRP_RISK_GRIDWARNNOTICE WHERE ${filter} and ( DELETELOGO is null or DELETELOGO != '1' )) b on a.column_type_code =
            b.DATAREPORT_ORG_ID
            WHERE a.column_code = 'DATAREPORT_ORG'
            GROUP BY
            a.column_type_name,
            a.column_type_code
            ORDER BY
            a.column_type_code + 0 ASC;
        </mysql>
    </sql>

    <sql id="WarnDevTypeCount" desc="预警影响类型">
        <mysql>
            SELECT
            a.column_type_code DATAREPORT_ORG_ID,
            a.column_type_name DATAREPORT_ORG,
            COUNT( CASE WHEN b.WARNDEVTYPE = '01' THEN 1 ELSE NULL END ) AS WARNDEVTYPEXLN1_CNT,
            COUNT( CASE WHEN b.WARNDEVTYPE = '02' THEN 1 ELSE NULL END ) AS WARNDEVTYPEMXN1_CNT,
            COUNT( CASE WHEN b.WARNDEVTYPE = '03' THEN 1 ELSE NULL END ) AS WARNDEVTYPEZBN1_CNT,
            COUNT( CASE WHEN b.WARNDEVTYPE = '04' THEN 1 ELSE NULL END ) AS WARNDEVTYPEJZN1_CNT,
            COUNT( CASE WHEN b.WARNDEVTYPE = '05' THEN 1 ELSE NULL END ) AS WARNDEVTYPELXN2_CNT,
            COUNT( CASE WHEN b.WARNDEVTYPE = '06' THEN 1 ELSE NULL END ) AS WARNDEVTYPELXN3_CNT,
            COUNT( CASE WHEN b.WARNDEVTYPE = '07' THEN 1 ELSE NULL END ) AS WARNDEVTYPEQT_CNT
            from srp_risk_sys_tab a
            LEFT JOIN (select * from SRP_RISK_GRIDWARNNOTICE WHERE ${filter} and ( DELETELOGO is null or DELETELOGO != '1' )) b on a.column_type_code =
            b.DATAREPORT_ORG_ID
            WHERE a.column_code = 'DATAREPORT_ORG'
            GROUP BY
            a.column_type_name,
            a.column_type_code
            ORDER BY
            a.column_type_code + 0 ASC;
        </mysql>
    </sql>

    <sql id="AllRiskWarnInfo" desc="全网今日电网风险信息列表">
        <mysql>
            SELECT
            a.GRIDWARNNOTICE_ID,
            a.TITLE,
            a.WARNNUM,
            a.WARNBEGINTIME,
            a.WARNENDTIME,
            a.PUBLISH_ORG,
            a.PUBLISH_STAFF,
            c.column_type_name WARNINGLEVEL,
            d.column_type_name WARNSTATUS,
            COUNT( CASE WHEN b.WORK_PLAN_ID IS NOT NULL THEN 1 ELSE NULL END ) AS WORK_PLAN_CODE_DAY_CNT,
            MAX(b.WORK_PLAN_ID) WORK_PLAN_ID,
            a.datareport_org,
            a.datareport_org_id
            FROM
            SRP_RISK_GRIDWARNNOTICE a
            LEFT JOIN SRP_RISK_GRIDWARNTOWORKPLAN e ON a.GRIDWARNNOTICE_ID = e.GRIDWARNNOTICE_ID
            LEFT JOIN srp_work_workplanday b ON e.WORK_PLAN_ID = b.WORK_PLAN_ID
            LEFT JOIN (select * from srp_risk_sys_tab where column_code = 'WARNINGLEVEL') c ON a.WARNINGLEVEL =
            c.column_type_code
            LEFT JOIN (select * from srp_risk_sys_tab where column_code = 'WARNSTATUS') d ON a.WARNSTATUS =
            d.column_type_code
            WHERE
            to_days( WARNBEGINTIME ) = to_days(
            now())
            and ( a.DELETELOGO is null or a.DELETELOGO != '1' )
            GROUP BY
            a.GRIDWARNNOTICE_ID,
            a.TITLE,
            a.WARNNUM,
            a.WARNBEGINTIME,
            a.WARNENDTIME,
            a.PUBLISH_ORG,
            a.PUBLISH_STAFF,
            c.column_type_name,
            d.column_type_name
            ORDER BY
            a.WARNINGLEVEL ASC
        </mysql>
    </sql>
    <sql id="GridWarnNoticeCount" desc="全网今日电网风险信息列表">
        <mysql>
            SELECT
            COUNT( 1 ) AS GRIDWARNNOTICE_CNT
            FROM
            SRP_RISK_GRIDWARNNOTICE a
            WHERE
            ${filter}
            and ( a.DELETELOGO is null or a.DELETELOGO != '1' )
        </mysql>
    </sql>

    <sql id="SrpRiskGridwarnnotice" desc="预警通知单">
        <mysql>
            select
            GRIDWARNNOTICE_ID,
            TITLE,
            MAINSEND,
            WARNNUM,
            c.column_type_name WARNINGLEVEL,
            b.column_type_name WARNDEVTYPE,
            d.column_type_name RISKDEV,
            FAILURE_REASON,
            WARNBEGINTIME,
            WARNENDTIME,
            ACTUALBEGINTIME,
            ACTUALENDTIME,
            e.column_type_name WARNSTATUS,
            WARNCONTENTS,
            WARNLOCATION,
            RISKANALYSIS,
            RISKMEASURE,
            WARNFACTOR,
            VOLTAGE_LEVEL,
            LINKNUM,
            WARNREADY,
            WARNINFORM,
            PUBLISH_ORG,
            PUBLISH_STAFF,
            WARNPUBLISH_TIME,
            CONTACT,
            RESPONSIBLE_ORG,
            EDITOR,
            COMPILE_TIME,
            AUDITOR,
            AUDIT_TIME,
            AUDIT_SUGGESTION,
            COUNTERSIGN_STAFF,
            COUNTERSIGN_DEP,
            COUNTERSIGN_SUGGESTION,
            APPRO_STAFF,
            SUBMIT_STAFF,
            ANNEX,
            CREATE_TIME,
            UPDATE_TIME,
            DATAFILL_ORG,
            DATAFILL_ORG_ID,
            DATAREPORT_ORG,
            DATAREPORT_ORG_ID,
            DATACOMMON_ID
            from SRP_RISK_GRIDWARNNOTICE a,
            (select * from srp_risk_sys_tab where column_code = 'WARNDEVTYPE') b,
            (select * from srp_risk_sys_tab where column_code = 'WARNINGLEVEL') c,
            (select * from srp_risk_sys_tab where column_code = 'RISKDEV') d,
            (select * from srp_risk_sys_tab where column_code = 'WARNSTATUS') e
            where
            ${filter} and ( a.DELETELOGO is null or a.DELETELOGO != '1' )
            and a.WARNDEVTYPE = b.column_type_code
            and a.WARNINGLEVEL = c.column_type_code
            and a.RISKDEV = d.column_type_code
            and a.WARNSTATUS = e.column_type_code
        </mysql>

    </sql>
    <sql id="SrpRiskGridwarnfeedback" desc="预警反馈单">
        <mysql>
            select
            GRIDWARNFEEDBACK_ID,
            MAINSEND,
            WARNNUM,
            FEEDBACKNUM,
            WARNENDTIME,
            WARNBEGINTIME,
            IMPLEMENTATION,
            RESPONSIBLE_ORG,
            ANNEX,
            FEEDBACK_STAFF,
            FEEDBACK_TIME,
            EDITOR,
            AUDITOR,
            APPRO_STAFF,
            NOTIFY_USER,
            USERLEVEL,
            GRIDWARNNOTICE_ID,
            CREATE_TIME,
            UPDATE_TIME,
            DATAFILL_ORG,
            DATAFILL_ORG_ID,
            DATAREPORT_ORG,
            DATAREPORT_ORG_ID,
            DATACOMMON_ID,
            FEEDBACK_ORG
            from SRP_RISK_GRIDWARNFEEDBACK
            where
            ${filter}
        </mysql>

    </sql>

    <sql id="SrpRiskGridwarnreport" desc="预警报告单">
        <mysql>
            select
            GRIDWARNREPORT_ID,
            MAINSEND,
            WARNREPORTNUM,
            SUBMIT_TIME,
            WARNENDTIME,
            WARNBEGINTIME,
            WARNCONTENTS,
            AREA,
            WORKSTEP,
            FORGOVERCOORDIATION,
            UP_DEPT,
            PHONEUSER,
            PHONENUMBER,
            CREATE_TIME,
            UPDATE_TIME,
            WARNNUM,
            ANNEX,
            GRIDWARNNOTICE_ID,
            DATAFILL_ORG,
            DATAFILL_ORG_ID,
            DATAREPORT_ORG,
            DATAREPORT_ORG_ID,
            DATACOMMON_ID
            from SRP_RISK_GRIDWARNREPORT
            where
            ${filter}
        </mysql>

    </sql>
    <sql id="SrpRiskGridwarninform" desc="预警告知单">
        <mysql>
            select
            GRIDWARNINFORM_ID,
            DELIVERY_DEPT,
            INFORMNUM,
            SUBMIT_TIME,
            WARNCONTENTS,
            WARNENDTIME,
            WARNBEGINTIME,
            RISKANALYSIS,
            RISKMEASURE,
            AUTHOR_DEPT,
            SIGNDATE,
            INFORM_DEP,
            PHONEUSER,
            PHONENUMBER,
            CREATE_TIME,
            UPDATE_TIME,
            WARNNUM,
            ANNEX,
            GRIDWARNNOTICE_ID,
            DATAFILL_ORG,
            DATAFILL_ORG_ID,
            DATAREPORT_ORG,
            DATAREPORT_ORG_ID,
            DATACOMMON_ID
            from SRP_RISK_GRIDWARNINFORM
            where
            ${filter}
        </mysql>


    </sql>

    <sql id="SrpRiskGridwarnrelinfo" desc="预警解除">
        <mysql>
            select
            GRIDWARNRELINFO_ID,
            RELINFONUM,
            WARNREMOVE_STAFF,
            WARNREL,
            REMOVEDATE,
            GRIDWARNNOTICE_ID,
            CREATE_TIME,
            UPDATE_TIME,
            DATAFILL_ORG,
            DATAFILL_ORG_ID,
            DATAREPORT_ORG,
            DATAREPORT_ORG_ID,
            DATACOMMON_ID
            from SRP_RISK_GRIDWARNRELINFO
            where
            ${filter}
        </mysql>
    </sql>

    <sql id="GetSrpRiskSysTab" desc="获取字典定义">
        <mysql>
            select em_id,
            column_code,
            column_name,
            column_type_name,
            column_type_code,
            column_num
            from srp_risk_sys_tab
        </mysql>
    </sql>

    <sql id="deleteInfo" desc="删除列表数据">
        <mysql>
            update SRP_RISK_GRIDWARNNOTICE set DELETELOGO = '1' where GRIDWARNNOTICE_ID in ( ${filter} )
        </mysql>
    </sql>


</sqls>


