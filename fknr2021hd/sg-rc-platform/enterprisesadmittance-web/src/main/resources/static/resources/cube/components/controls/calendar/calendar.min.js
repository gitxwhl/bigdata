define(["CheckUtil"],function(h){function k(k){function t(a){a=parseInt(a);return isNaN(a)||a<0||a>12?!1:!0}var a=this;a.date=new Date;a.showTimePicker=!0;a.showDayPicker=!0;a.showMonthPicker=!0;a.showQuarterPicker=!1;a.year=a.date.getFullYear();a.quarter=Math.ceil((a.date.getMonth()+1)/3);a.month=a.date.getMonth()+1;a.day=a.date.getDate();a.hour=a.date.getHours();a.minute=a.date.getMinutes();a.second=a.date.getSeconds();a.isClickCloseDialog=!1;a.minValue=null;a.maxValue=null;a.isWest=!0;a.weekDays=
["\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u65e5"];a.westWeekDays=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"];a.yearQuarters=["\u7b2c\u4e00\u5b63\u5ea6","\u7b2c\u4e8c\u5b63\u5ea6","\u7b2c\u4e09\u5b63\u5ea6","\u7b2c\u56db\u5b63\u5ea6"];a.yearMonths=["01\u6708","02\u6708","03\u6708","04\u6708","05\u6708","06\u6708","07\u6708","08\u6708","09\u6708","10\u6708","11\u6708","12\u6708"];a.Hours=["00","02","04","06","08","10","12","14","16","18","20","22"];a.Minutes=["00",
"05","10","15","20","25","30","35","40","45","50","55"];a.monthTotalDays=[31,31,28,31,30,31,30,31,31,30,31,30,31,31];a.thisMonthDay=cube.obj({year:1,month:1,dayNums:1});a.preMonthDay=cube.obj({year:1,month:1,dayNums:1});a.nextMonthDay=cube.obj({year:1,month:1,dayNums:1});a.showCalendar=cube.obj(1);a.timePickType=cube.obj(0);a.showState=cube.obj(-1);a.isShowDialog=null;a.titleText=cube.comp(function(){if(a.showState()==0)return a.year()+"\u5e74"+a.month()+"\u6708";else if(a.showState()==1||a.showState()==
3)return a.year()+"\u5e74";else if(a.showState()==2)return a.year()-6+"\u5e74-"+(parseInt(a.year(),10)+5)+"\u5e74"},a);a.onSelectDate=null;a.onRendered=null;a._init=function(){a.date=new Date;a.validYear();a.validQuarter();a.validMonth();a.validDay();a.validHour();a.validMinute();a.validSecond();a.showTimePicker()==!1&&a.showDayPicker()==!1&&a.showMonthPicker()==!1&&a.showQuarterPicker()==!1&&a.showState(2);a.changeShowState();a.yearSub=cube.subscribe(a.year,function(){a.validYear();g();l()});a.quarterSub=
cube.subscribe(a.quarter,function(b){a.validQuarter();t(b)&&u()});a.monthSub=cube.subscribe(a.month,function(b){a.validMonth();t(b)&&(g(),v())});a.daySub=cube.subscribe(a.day,function(){a.validDay();g()});a.hourSub=cube.subscribe(a.hour,function(){a.validHour()});a.minuteSub=cube.subscribe(a.minute,function(){a.validMinute()});a.secondSub=cube.subscribe(a.second,function(){a.validSecond()});a.minValueSub=cube.subscribe(a.minValue,g);a.maxValueSub=cube.subscribe(a.maxValue,g);a.initDateItems();a.initMonthItems();
a.initQuarterItems();a.initYearItems();a.initHourItems();a.initMinuteItems();g();a.showState()==0&&(a.showDayPicker()&&a.showMonthPicker()&&!a.showQuarterPicker()?a.showState(0):a.showMonthPicker()&&!a.showQuarterPicker()?a.showState(1):!a.showMonthPicker()&&!a.showQuarterPicker()?a.showState(2):a.showQuarterPicker()?a.showState(2):a.showState(0))};a.changeShowState=function(){a.showState(a.showState()+1);a.showState()==1?v():a.showState()==2?l():a.showState()==3?a.showDayPicker()&&a.showMonthPicker()&&
!a.showQuarterPicker()?a.showState(0):a.showMonthPicker()&&!a.showQuarterPicker()?a.showState(1):a.showQuarterPicker()?(a.showState(3),u()):a.showState(2):a.showQuarterPicker()?a.showState(2):a.showState(0)};a.changeShowCalendar=function(){a.showCalendar()==1?a.showCalendar(0):a.showCalendar(1)};a.hourUp=function(){a.hour()>22?a.hour(0):a.hour(parseInt(a.hour(),10)+1)};a.hourDown=function(){a.hour()<1?a.hour(23):a.hour(parseInt(a.hour(),10)-1)};a.minuteUp=function(){a.minute()>58?(a.minute(0),a.hourUp()):
a.minute(parseInt(a.minute(),10)+1)};a.minuteDown=function(){a.minute()<1?(a.minute(59),a.hourDown()):a.minute(parseInt(a.minute(),10)-1)};a.secondUp=function(){a.second()>58?(a.second(0),a.minuteUp()):a.second(parseInt(a.second(),10)+1)};a.secondDown=function(){a.second()==0?(a.second(59),a.minuteDown()):a.second(parseInt(a.second(),10)-1)};a.onHourClick=function(){a.showCalendar(0);a.timePickType(1)};a.onMinuteClick=function(){a.showCalendar(0);a.timePickType(2)};a.onSecondClick=function(){a.showCalendar(0);
a.timePickType(3)};var j=function(b,d,c,e){b!=null&&a.year(b);d!=null&&a.month(d);c!=null&&a.day(c);e!=null&&a.quarter(e)},m=function(b,d){return d==2?b%4==0&&b%100!=0||b%4==0&&b%100==0&&b%400==0?29:28:a.monthTotalDays()[d]},g=function(){var b=a.year(),d=parseInt(a.month(),10),c,e,f;a.date.setFullYear(b);a.date.setMonth(d-1);a.date.setDate(1);c=a.date.getFullYear();e=a.date.getMonth()+1;f=a.date.getDay();a.thisMonthDay({year:c,month:e,dayNums:m(c,e),firstWeekDay:f});a.date.setFullYear(b);a.date.setMonth(d-
2);c=a.date.getFullYear();e=a.date.getMonth()+1;f=a.date.getDay();a.preMonthDay({year:c,month:e,dayNums:m(c,e),firstWeekDay:f});a.date.setFullYear(b);a.date.setMonth(d);c=a.date.getFullYear();e=a.date.getMonth()+1;f=a.date.getDay();a.nextMonthDay({year:c,month:e,dayNums:m(c,e),firstWeekDay:f});b=null;d=a.minValue();cube.notEmpty(d)&&h.isDate(d)&&(b=(new Date(d)).getTime());d=null;c=a.maxValue();cube.notEmpty(c)&&h.isDate(c)&&(d=(new Date(c)).getTime());c=0;e=a.thisMonthDay().firstWeekDay;e==0&&(e=
7);for(i=0;i<42;i++){i<e?(f=a.DateItems()[c]()[i%7],f.monthInd(-1),f.year(a.preMonthDay().year),f.month(a.preMonthDay().month),f.day(a.preMonthDay().dayNums-(e-i)+1)):i<e+a.thisMonthDay().dayNums?(i%7==0&&c++,f=a.DateItems()[c]()[i%7],f.monthInd(0),f.year(a.thisMonthDay().year),f.month(a.thisMonthDay().month),f.day(i-e+1)):(i%7==0&&c++,f=a.DateItems()[c]()[i%7],f.monthInd(1),f.year(a.nextMonthDay().year),f.month(a.nextMonthDay().month),f.day(i-e-a.thisMonthDay().dayNums+1));f.day()==a.day()&&f.month()==
a.month()&&f.year()==a.year()&&a.selectDate(f);f.disable(!1);var g=(new Date(f.year()+"-"+f.month()+"-"+f.day())).getTime();b!=null&&g<b&&f.disable(!0);d!=null&&g>d&&f.disable(!0)}},l=function(){for(var b=0;b<3;b++)for(var d=0;d<4;d++){var c=a.YearItems()[b]()[d];c.yearName(a.year()-6+(4*b+d));c.yearName()==a.year()?c.isSelect(!0):c.isSelect(!1)}},u=function(){for(var b=0;b<2;b++)for(var d=0;d<2;d++){var c=a.QuarterItems()[b]()[d];c.quarterInd==a.quarter()-1?c.isSelect(!0):c.isSelect(!1)}},v=function(){for(var b=
0;b<3;b++)for(var d=0;d<4;d++){var c=a.MonthItems()[b]()[d];c.monthInd==a.month()-1?c.isSelect(!0):c.isSelect(!1)}};a.DateItems=cube.array([]);a.selectDate=cube.obj();a.initDateItems=function(){for(var b=0;b<6;b++){for(var d=cube.array([]),c=0;c<7;c++){var e={year:cube.obj(1),month:cube.obj(1),day:cube.obj(1),weekInd:b,weekDay:c,monthInd:cube.obj(0),isHover:cube.obj(!1),disable:cube.obj(!1),showHover:function(){this.disable()||this.isHover(!0)},hiddenHover:function(){this.isHover(!1)},selectDay:function(){if(!this.disable()){j(this.year(),
this.month(),this.day());this.monthInd()!=0?g():a.selectDate(this);if(a.onSelectDate!=null&&!cube.isObservable(a.onSelectDate))a.onSelectDate(this);a.isClickCloseDialog()&&a.isShowDialog(!1)}},selectDayAndClose:function(){this.disable()||(j(this.year(),this.month(),this.day()),this.monthInd()!=0?g():a.selectDate(this),a.isShowDialog(!1))}};e.isSelect=cube.comp(function(){if(!this.disable())return this.year()==a.year()&&this.month()==a.month()&&this.day()==a.day()},e);d().push(e)}a.DateItems().push(d)}};
a.MonthItems=cube.array([]);a.selectMonth=cube.obj();a.initMonthItems=function(){for(var b=0;b<3;b++){for(var d=cube.array([]),c=0;c<4;c++){var e={monthInd:b*4+c,monthName:a.yearMonths()[b*4+c],isSelect:cube.obj(!1),isHover:cube.obj(!1),showHover:function(){this.isHover(!0)},hiddenHover:function(){this.isHover(!1)},selectMonth:function(){a.selectMonth()!=null&&a.selectMonth().isSelect(!1);this.isSelect(!0);a.selectMonth(this);a.showDayPicker()&&a.showState(0);!a.showDayPicker()&&a.isClickCloseDialog()&&
a.isShowDialog(!1);a.validMaxDay(this.monthInd+1);j(null,this.monthInd+1,null);g();this.isHover(!1)}};d().push(e)}a.MonthItems().push(d)}};a.QuarterItems=cube.array([]);a.selectQuarter=cube.obj();a.initQuarterItems=function(){for(var b=0;b<2;b++){for(var d=cube.array([]),c=0;c<2;c++){var e={quarterInd:b*2+c,quarterName:a.yearQuarters()[b*2+c],isSelect:cube.obj(!1),isHover:cube.obj(!1),showHover:function(){this.isHover(!0)},hiddenHover:function(){this.isHover(!1)},selectQuarter:function(){a.selectQuarter()!=
null&&a.selectQuarter().isSelect(!1);this.isSelect(!0);a.selectQuarter(this);a.showDayPicker()&&a.showState(2);a.isClickCloseDialog()&&a.isShowDialog(!1);j(null,null,null,this.quarterInd+1);g();this.isHover(!1)}};d().push(e)}a.QuarterItems().push(d)}};a.YearItems=cube.array([]);a.selectYear=cube.obj();a.initYearItems=function(){for(var b=0;b<3;b++){for(var d=cube.array([]),c=0;c<4;c++){var e={yearName:cube.obj(a.year()-6+(4*b+c)),isSelect:cube.obj(!1),isHover:cube.obj(!1),showHover:function(){this.isHover(!0)},
hiddenHover:function(){this.isHover(!1)},selectYear:function(){a.selectYear()!=null&&a.selectYear().isSelect(!1);this.isSelect(!0);a.selectYear(this);!a.showMonthPicker()&&a.isClickCloseDialog()&&!a.showQuarterPicker()&&a.isShowDialog(!1);a.showMonthPicker()&&!a.showQuarterPicker()&&a.showState(1);a.showQuarterPicker()&&a.showState(3);this.isHover(!1);j(this.yearName(),null,null)}};d().push(e)}a.YearItems().push(d)}};a.HourItems=cube.array([]);a.selectHour=cube.obj();a.initHourItems=function(){for(var b=
0;b<3;b++){for(var d=cube.array([]),c=0;c<4;c++){var e={hourInd:(b*4+c)*2,hourName:a.Hours()[b*4+c],isSelect:cube.obj(!1),isHover:cube.obj(!1),showHover:function(){this.isHover(!0)},hiddenHover:function(){this.isHover(!1)},selectHour:function(){a.selectHour()!=null&&a.selectHour().isSelect(!1);this.isSelect(!0);a.selectHour(this);a.timePickType(0);a.hour(this.hourInd);this.isHover(!1);a.showCalendar(1)}};d().push(e)}a.HourItems().push(d)}};a.MinuteItems=cube.array([]);a.selectMinute=cube.obj();a.initMinuteItems=
function(){for(var b=0;b<3;b++){for(var d=cube.array([]),c=0;c<4;c++){var e={minuteInd:(b*4+c)*5,minuteName:a.Minutes()[b*4+c],isSelect:cube.obj(!1),isHover:cube.obj(!1),showHover:function(){this.isHover(!0)},hiddenHover:function(){this.isHover(!1)},selectMinute:function(){a.selectMinute()!=null&&a.selectMinute().isSelect(!1);this.isSelect(!0);a.selectMinute(this);a.timePickType(0);a.minute(this.minuteInd);this.isHover(!1);a.showCalendar(1)},selectSecond:function(){a.selectMinute()!=null&&a.selectMinute().isSelect(!1);
this.isSelect(!0);a.selectMinute(this);a.timePickType(0);a.second(this.minuteInd);this.isHover(!1);a.showCalendar(1)}};d().push(e)}a.MinuteItems().push(d)}};a.showPre=function(){if(a.showState()==0){if(a.month()==1)a.month(12),a.year(a.year()-1);else{var b=parseInt(a.month())-1;a.validMaxDay(b);a.month(a.month()-1)}g()}else a.showState()==1||a.showState()==3?a.year(a.year()-1):a.showState()==2&&(a.year(a.year()-12),l())};a.showNext=function(){if(a.showState()==0){if(a.month()==12)a.month(1),a.year(parseInt(a.year())+
1);else{var b=parseInt(a.month())+1;a.validMaxDay(b);a.month(parseInt(a.month())+1)}g()}else a.showState()==1||a.showState()==3?a.year(parseInt(a.year())+1):a.showState()==2&&(a.year(parseInt(a.year())+12),l())};a.validYear=function(){h.isPlusInteger(a.year())||a.year(a.date.getFullYear())};var n=!1;a.validQuarter=function(){var b=a.quarter();cube.isEmpty(b)&&(n=!0);n&&cube.notEmpty(b)&&(b<1||b>4)?(b=b.substring(0,b.length-1),a.quarter(b),n=!1):(!h.isPlusInteger(b)||b<1||b>4)&&a.quarter(a.date.getQuarter())};
var o=!1;a.validMonth=function(){var b=a.month();cube.isEmpty(b)&&(o=!0);o&&cube.notEmpty(b)&&(b<1||b>12)?(b=b.substring(0,b.length-1),a.month(b),o=!1):(!h.isPlusInteger(b)||b<1||b>12)&&a.month(a.date.getMonth())};var p=!1;a.validDay=function(){var b=a.day(),d=a.month(),c=30;if(d==2)c=28;else if(d==1||d==3||d==5||d==7||d==8||d==10||d==12)c=31;cube.isEmpty(b)&&(p=!0);p&&cube.notEmpty(b)&&(b<1||b>c)?(b.substring(0,b.length-1),p=!1):(!h.isPlusInteger(b)||b<1||b>c)&&a.day(a.date.getDate())};var q=!1;
a.validHour=function(){var b=a.hour();cube.isEmpty(b)&&(q=!0);q&&cube.notEmpty(b)&&(b<0||b>23)?(b=b.substring(0,b.length-1),a.hour(b),q=!1):(!h.isPlusInteger(b)||b<0||b>23)&&a.hour(a.date.getHours())};var r=!1;a.validMinute=function(){var b=a.minute();cube.isEmpty(b)&&(r=!0);r&&cube.notEmpty(b)&&(b<0||b>59)?(b=b.substring(0,b.length-1),a.minute(b),r=!1):(!h.isPlusInteger(b)||b<0||b>59)&&a.minute(a.date.getMinutes())};var s=!1;a.validSecond=function(){var b=a.second();cube.isEmpty(b)&&(s=!0);s&&cube.notEmpty(b)&&
(b<0||b>59)?(b=b.substring(0,b.length-1),a.second(b),s=!1):(!h.isPlusInteger(b)||b<0||b>59)&&a.second(a.date.getSeconds())};a.validMaxDay=function(b){var d=a.day(),c=30,e=a.year();if(b==2)c=e%4==0&&e%100!=0||e%4==0&&e%100==0&&e%400==0?29:28;else if(b==1||b==3||b==5||b==7||b==8||b==10||b==12)c=31;d>c&&a.day(c)};a.onload=function(b){if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(b)};cube.endViewModel(a,k)}k.prototype.dispose=function(){this.yearSub.dispose();this.quarterSub.dispose();
this.monthSub.dispose();this.daySub.dispose();this.hourSub.dispose();this.minuteSub.dispose();this.secondSub.dispose();this.minValueSub.dispose();this.maxValueSub.dispose()};return k});