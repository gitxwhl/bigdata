define([],function(){return function(b){var a=this;a.importExcelUrl=b.importExcelUrl;a.previewGridBaseUrl=b.previewGridBaseUrl;a.step=cube.obj(1);a.columnsValue=cube.obj(b.value);a.columns=cube.array([]);a.columnNames=b.columnNames;a.items=cube.array([]);a.showOption=typeof b.showOption=="undefined"?!0:b.showOption;a.$e=null;a.importExcelOptions={horizontalBegin:cube.obj(1),horizontalEnd:cube.obj(0),verticalBegin:cube.obj(1),verticalEnd:cube.obj(0),sheetNumber:cube.obj(1),separatorNum:cube.obj(0),
saveByDefault:cube.obj(!0)};a.columnFields=[{caption:cube.msg("IMPORT_OPTIONS"),icon:"th-list",isLine:!0,visible:a.showOption},{name:"column",caption:cube.msg("IMPORT_COLUMN"),editorType:"CheckListEditor",colspan:3,width:"90%",captionWidth:"100px",list:b.columns,value:cube.isArray(a.columnNames)&&a.columnNames.length>0?a.columnNames:b.value,nullable:!1,visible:a.showOption,onChanged:function(b){a.columnsValue(b)}},{caption:cube.msg("IMPORT_IMPORT_OPTIONS"),icon:"cog",isLine:!0,visible:a.showOption},
{name:"horizontalBegin",caption:cube.msg("IMPORT_EXCEL_HORIZONTALBEGIN"),width:"30px",captionWidth:"100px",nullable:!1,visible:a.showOption,validType:"PLUSINTEGER",validOptions:{minValue:1},value:a.importExcelOptions.horizontalBegin},{name:"horizontalEnd",caption:cube.msg("IMPORT_EXCEL_END"),width:"30px",captionWidth:"100px",nullable:!1,visible:a.showOption,validType:"PLUSINTEGER",validOptions:{minValue:0},value:a.importExcelOptions.horizontalEnd},{name:"verticalBegin",caption:cube.msg("IMPORT_EXCEL_VERTICALBEGIN"),
width:"30px",captionWidth:"100px",nullable:!1,visible:a.showOption,validType:"PLUSINTEGER",validOptions:{minValue:1},value:a.importExcelOptions.verticalBegin},{name:"verticalEnd",caption:cube.msg("IMPORT_EXCEL_VERTICALEND"),width:"30px",captionWidth:"100px",nullable:!1,visible:a.showOption,validType:"PLUSINTEGER",validOptions:{minValue:0},value:a.importExcelOptions.verticalEnd},{name:"sheetNumber",caption:cube.msg("IMPORT_EXCEL_SHEETNUMBER"),width:"30px",captionWidth:"100px",nullable:!1,visible:a.showOption,
validType:"PLUSINTEGER",validOptions:{minValue:1},value:a.importExcelOptions.sheetNumber},{name:"separatorNum",caption:cube.msg("IMPORT_EXCEL_SEPRATORNUM"),width:"30px",captionWidth:"100px",nullable:!1,visible:a.showOption,value:a.importExcelOptions.separatorNum},{caption:cube.msg("IMPORT_EXCEL_WIZARD_UPLOAD_EXCEL"),icon:"file",isLine:!0},{name:"excelFile",caption:cube.msg("IMPORT_EXCEL_SELECT_FILE"),editorType:"FileEditor",captionWidth:"100px",colspan:3,previewSize:"mini",allowTypes:"xls, xlsx",
maxCount:1,nullable:!1,autoLoadFiles:!1,validOptions:{validateMessage:cube.msg("IMPORT_EXCEL_SELECT_AND_UPLOAD_FILE")},validHintType:"inline",url:a.importExcelUrl,onItemUploading:function(g){var f=[],c=a.columnsValue().split(","),e=b.columns;a.columns([]);for(var d=0;d<e.length;d++)c.indexOf(e[d].value)!=-1&&(f.push(e[d].text),a.columns.push({name:e[d].value,caption:e[d].text}));g.fileUploaderParams={columnNames:c,columnCaptions:f.join(),impOptions:a.importExcelOptions.horizontalBegin()+","+a.importExcelOptions.horizontalEnd()+
","+a.importExcelOptions.verticalBegin()+","+a.importExcelOptions.verticalEnd()+","+a.importExcelOptions.sheetNumber()+","+a.importExcelOptions.separatorNum()}},onAllItemUploaded:function(g,f,c){cube.notEmpty(c)&&(c=$.parseJSON(c),c.successful===!0&&a.items(c.resultValue.items));a.step(2);b.dialog.customBtns()[0].visible(!0)}}];a.confirmBtnClick=b.confirmBtnClick;a._init=function(){b.dialog.step=a.step;a.actionsSub=cube.subscribe(b.dialog.step,function(b){a.step(b)});b.dialog.result=function(){if(!cube.getPageViewModelByNode(a.$e.find("#exceltmpl_excelForm")).validate())return!1;
var b=cube.getPageViewModelByNode(a.$e.find("#exceltmpl_excelGrid"));a.confirmBtnClick!=null&&!cube.isObservable(a.confirmBtnClick)?a.confirmBtnClick(b.items()):b.save();return!0}};a.onload=function(b){a.$e=$(b)}}});