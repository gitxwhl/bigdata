<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.raysdata.riskmanagementserver.dao.RiskEventWarnDao">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.raysdata.riskmanagementserver.bean.vo.SrpRiskSysTabVo">
<!--        <result column="id" property="id" />-->
<!--        <result column="model_table_name" property="modelTableName" />-->
<!--        <result column="model_table" property="modelTable" />-->
<!--        <result column="model_field" property="modelField" />-->
<!--        <result column="model_field_name" property="modelFieldName" />-->
<!--        <result column="model_field_hump" property="modelFieldHump" />-->
<!--        <result column="model_table_hump" property="modelTableHump" />-->
<!--        <result column="is_valid" property="isValid" />-->
    </resultMap>

    <sql id="sql_where">
        <if test="srpRiskSysTabVo.startTime != null and srpRiskSysTabVo.startTime != '' and srpRiskSysTabVo.endTime != null and srpRiskSysTabVo.endTime != ''">
            and a.WARNBEGINTIME between STR_TO_DATE(#{srpRiskSysTabVo.startTime},'%Y-%m-%d %H:%i:%s') and STR_TO_DATE(#{srpRiskSysTabVo.endTime},'%Y-%m-%d %H:%i:%s')
        </if>
        <if test="srpRiskSysTabVo.startTime == '' and  srpRiskSysTabVo.endTime == ''">
            and to_days(a.WARNBEGINTIME ) = to_days( now( ) )
        </if>
        <if test="srpRiskSysTabVo.warningLevel != null and srpRiskSysTabVo.warningLevel != ''">
            and  WARNINGLEVEL = #{srpRiskSysTabVo.warningLevel}
        </if>
        <if test="srpRiskSysTabVo.systremApplication != null and srpRiskSysTabVo.systremApplication != ''">
            and SYSTREM_APPLICATION = #{srpRiskSysTabVo.systremApplication}
        </if>
        <if test="srpRiskSysTabVo.netoprationStatus != null and srpRiskSysTabVo.netoprationStatus != ''">
            and NETOPRATION_STATUS = #{srpRiskSysTabVo.netoprationStatus}
        </if>
    </sql>

    <select id="getSrpriskeventwarnareacnt"  resultType="java.util.Map">
        SELECT
            srst.column_type_name DATAREPORT_ORG,
            srst.column_type_code DATAREPORT_ORG_ID,
            count( srg.INDUSRISKNOTICE_ID ) AS GRIDWARN_CNT
        FROM
            srp_risk_sys_tab srst
                LEFT JOIN ( SELECT a.*  FROM SRP_RISK_EVENTEWARNING a
                            WHERE 1=1  <include refid="sql_where"/>) srg ON  srst.column_type_code = srg.DATAREPORT_ORG_ID
        WHERE
            srst.column_code = 'DATAREPORT_ORG'
        GROUP BY
            srst.column_type_name
        ORDER BY
            srst.column_type_code + 0
    </select>

    <select id="getSrpriskeventtypecnt" parameterType="java.lang.String" resultType="java.util.Map">
        select
        count(SERVER_ID)  SERVER_CNT,
        sum(STORAGE_CAPACITY) STORAGE_CAPACITY_SUM,
        COUNT(case when THREATENED_ATTACK = '01' then 1 else NULL end) AS  ATTACK_THREAT_CNT,
        COUNT(case when VIRUS_DISPOSAL = '01' then 1
        when VIOLATION_TYPE = '02'	then 1
        when VIOLATION_TYPE = '03'	then 1
        when VIOLATION_TYPE = '04'	then 1
        when VIOLATION_TYPE = '05'	then 1
        else NULL end) AS  VIRUS_DISPOSAL_CNT,
        COUNT(case when EQUIPSUPPORT_ENDTIME &lt;=  now( )  then 1 else NULL end) AS  EQUIPSUPPORT_CNT,
        COUNT(case when ATTACK_THREAT_TYPE = '01' then 1
        when ATTACK_THREAT_TYPE = '02'	then 1
        when ATTACK_THREAT_TYPE = '03'	then 1
        when ATTACK_THREAT_TYPE = '04'	then 1
        when ATTACK_THREAT_TYPE = '05'	then 1
        when ATTACK_THREAT_TYPE = '06'	then 1
        when ATTACK_THREAT_TYPE = '07'	then 1
        else NULL end) AS  ILLEGAL_CNT
        from SRP_RISK_EVENTEWARNING where to_days( WARNBEGINTIME ) = to_days( now( ) )
    </select>
    <select id="getSrpriskeventwarnattackthreatcnt" parameterType="java.lang.String" resultType="java.util.Map">
        select
            COUNT(case when ATTACK_THREAT_TYPE = '01' then 1 else NULL end) AS  ATTACK_THREAT1,
            COUNT(case when ATTACK_THREAT_TYPE = '02' then 1 else NULL end) AS  ATTACK_THREAT2,
            COUNT(case when ATTACK_THREAT_TYPE = '03' then 1 else NULL end) AS  ATTACK_THREAT3,
            COUNT(case when ATTACK_THREAT_TYPE = '04' then 1 else NULL end) AS  ATTACK_THREAT4,
            COUNT(case when ATTACK_THREAT_TYPE = '05' then 1 else NULL end) AS  ATTACK_THREAT5,
            COUNT(case when ATTACK_THREAT_TYPE = '06' then 1 else NULL end) AS  ATTACK_THREAT6,
            COUNT(case when ATTACK_THREAT_TYPE = '07' then 1 else NULL end) AS  ATTACK_THREAT7
        from SRP_RISK_EVENTEWARNING where to_days( WARNBEGINTIME ) = to_days( now( ) )

    </select>
    <select id="getSrpriskeventwarnviolationcnt" parameterType="java.lang.String" resultType="java.util.Map">
        select
            COUNT(case when VIOLATION_TYPE = '01' then 1 else NULL end) AS  VIOLATION1,
            COUNT(case when VIOLATION_TYPE = '02' then 1 else NULL end) AS  VIOLATION2,
            COUNT(case when VIOLATION_TYPE = '03' then 1 else NULL end) AS  VIOLATION3,
            COUNT(case when VIOLATION_TYPE = '04' then 1 else NULL end) AS  VIOLATION4,
            COUNT(case when VIOLATION_TYPE = '05' then 1 else NULL end) AS  VIOLATION5
        from SRP_RISK_EVENTEWARNING where to_days( WARNBEGINTIME ) = to_days( now( ) )
    </select>
    <select id="getSrpriskeventwarncnt" parameterType="java.lang.String" resultType="java.util.Map">
        SELECT
            srst.column_type_name DATAREPORT_ORG,
            srst.column_type_code DATAREPORT_ORG_ID,
            count( srg.INDUSRISKNOTICE_ID ) AS EVENTEWARN_CNT
        FROM
            srp_risk_sys_tab srst
                LEFT JOIN ( SELECT a.*  FROM SRP_RISK_EVENTEWARNING a
                            WHERE to_days( WARNBEGINTIME ) = to_days( now( ) ) ) srg ON  srst.column_type_code = srg.DATAREPORT_ORG_ID
        WHERE
            srst.column_code = 'DATAREPORT_ORG'
        GROUP BY
            srst.column_type_name
        ORDER BY
            srst.column_type_code + 0
    </select>
    <select id="getProvinceList" parameterType="java.lang.String" resultType="java.util.Map">
        SELECT * FROM  srp_risk_sys_tab WHERE column_code = 'DATAREPORT_ORG'
    </select>
</mapper>
