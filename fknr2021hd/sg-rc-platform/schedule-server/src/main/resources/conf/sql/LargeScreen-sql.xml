<?xml version="1.0" encoding="UTF-8"?>
<sqls>
    <sql id="getTodayWorkPlanMapData" desc="获取今日作业计划数量">
        <mysql>
            SELECT
            COUNT(ID) todayWorkCount
            FROM
            AJ_REPORT
            WHERE
            SETYPE = '1'
            AND DATE_FORMAT(BEGIN_TIME,'%Y-%m-%d') ${DATETIME}
            AND SEPART ${SEPART}
            AND SECONDID <![CDATA[ <> ]]> :SECONDID
        </mysql>
    </sql>
    <sql id="getYestodayWorkPlanMapData" desc="获取昨日作业计划数量">
        <mysql>
            SELECT
            SUM(TOTALSUM) yestodayWorkCount
            FROM
            AJ_DATETIMESUM
            WHERE
            SETYPE = '1'
            AND ISDELETE = '0'
            AND COLNAME IN ${COLNAME}
            AND ROWNAME = ${ROWNAME}
            AND SEPART ${SEPART}
        </mysql>
    </sql>
    <sql id="getWeekWorkPlanMapData" desc="获取早报本周计划数量">
        <mysql>
            SELECT
            COUNT(WORK_PLAN_ID) weekWorkCount
            FROM
            WORK_PLAN
            WHERE
            STATE IN ('2', '3')
            AND DATE_FORMAT(BEGIN_TIME,'%Y-%m-%d') <![CDATA[ >= ]]> SUBDATE(CURDATE(),(DATE_FORMAT(CURDATE(),'%w') +
            6)%7)
            AND DATE_FORMAT(BEGIN_TIME,'%Y-%m-%d') <![CDATA[ <= ]]> SUBDATE(CURDATE(),(DATE_FORMAT(CURDATE(),'%w') +
            6)%7 - 6)
            ${BUILD_UNIT_NAME}
        </mysql>
    </sql>
    <sql id="getKeyWorkPlanMapData" desc="获取早报重点计划数量">
        <mysql>
            SELECT
            COUNT(ID) keyWorkCount
            FROM
            AJ_REPORT
            WHERE
            ISDELETE = '0'
            AND KEYTYPE = '1'
            AND SETYPE = '1'
            AND SEPART ${SEPART}
            AND DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d') ${BEGIN_TIME}
        </mysql>
    </sql>
    <sql id="getElecWorkCount" desc="获取早报带电作业计划数量">
        <mysql>
            SELECT
            COUNT(ID) elecWorkCount
            FROM
            AJ_REPORT
            WHERE
            ISDELETE = '0'
            AND SETYPE = '1'
            AND SEPART ${SEPART}
            AND LIVE_WORK_FLG = '1'
            AND DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d') ${BEGIN_TIME}
        </mysql>
    </sql>

    <sql id="searchHighVolCountByDept" desc="按地市统计500kV作业数量">
        <mysql>
            SELECT
            ${GROUP_BY_UNIT} secondid,
            COUNT(ID) workCount
            FROM
            aj_report
            WHERE
            SETYPE = '1'
            AND SEPART ${SEPART}
            AND DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d') ${BEGIN_TIME}
            AND VGID = ${VGID}
            AND ${UNIT}
            AND ISDELETE = '0'
            GROUP BY
            ${GROUP_BY_UNIT}
        </mysql>
    </sql>

    <sql id="gethigVolWorkPlanMapData" desc="获取早报500kV作业数量">
        <mysql>
            SELECT
            COUNT(ID) higVolWorkCount
            FROM
            AJ_REPORT AJR
            WHERE
            ISDELETE = '0'
            AND VGID = '1'
            AND SEPART = :SEPART
            AND SETYPE = '1'
            AND SECONDID IN (${SECONDID})
            AND DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d') ${BEGIN_TIME}
        </mysql>
    </sql>
    <sql id="getWorkPlanData" desc="获取今日作业计划列表">
        <mysql>
            SELECT
            TASKPOSITION workPlace,
            RGID risk,
            SECONDID unit,
            TASKCONTENT AS taskContent,
            CPNAME AS cpName
            FROM
            AJ_REPORT
            WHERE
            DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d') ${BEGIN_TIME}
            AND ISCHECK IN ('2', '3')
            ${SECONDID}
        </mysql>
    </sql>

    <sql id="getworkUnitWorkPlanMap" desc="按单位性质统计作业人员数">
        <mysql>
            SELECT
            SUM(TASKMANS) WORKCOUNT,
            TUID code
            FROM
            AJ_REPORT
            WHERE
            ISDELETE = '0'
            AND SETYPE= '1'
            AND TUID IN (${TUID})
            AND ISCHECK IN ('2','3')
            AND SEPART ${SEPART}
            AND DATE_FORMAT (BEGIN_TIME, '%Y-%m-%d') ${BEGIN_TIME}
            GROUP BY
            TUID,SEPART
            ORDER BY
            TUID ASC
        </mysql>
    </sql>

    <sql id="getworkTypeWorkPlanMap" desc="按作业性质获取作业数量">
        <mysql>
            SELECT
            COUNT(ID) WORKCOUNT,
            TTID iname
            FROM
            AJ_REPORT
            WHERE
            SEPART ${SEPART}
            AND DATE_FORMAT(BEGIN_TIME,'%Y-%m-%d') ${DATETIMETIME}
            AND SETYPE = '1'
            GROUP BY
            TTID
            ORDER BY
            TTID
        </mysql>
    </sql>

    <sql id="getYwCount" desc="按地市统计昨日作业数量">
        <mysql>
            SELECT
            SUM(TOTALSUM) workCount,
            ROWNAME unit
            FROM
            AJ_DATETIMESUM
            WHERE
            SEPART = :SEPART
            AND SETYPE = '1'
            AND ISDELETE = '0'
            AND ROWNAME IN (${ROWNAME})
            AND COLNAME IN (${COLNAME})
            GROUP BY
            ROWNAME
        </mysql>
    </sql>

    <sql id="getYesterWorkPlan" desc="按单位统计各种性质的作业数量">
        <mysql>
            SELECT
            ROWNAME rowName,
            max(
            CASE
            WHEN COLNAME = '500kV' THEN
            TOTALSUM
            ELSE
            0
            END
            ) dydj500kv,
            max(
            CASE
            WHEN COLNAME = '220kV' THEN
            TOTALSUM
            ELSE
            0
            END
            ) dydj220kv,
            max(
            CASE
            WHEN COLNAME = '66kV' THEN
            TOTALSUM
            ELSE
            0
            END
            ) dydj66kv,
            max(
            CASE
            WHEN COLNAME = '10kV' THEN
            TOTALSUM
            ELSE
            0
            END
            ) dydj10kv,
            max(
            CASE
            WHEN COLNAME = '10kV以下' THEN
            TOTALSUM
            ELSE
            0
            END
            ) dydjYx,
            max(
            CASE
            WHEN COLNAME = '其他' THEN
            TOTALSUM
            ELSE
            0
            END
            ) dydjQt,
            max(
            CASE
            WHEN COLNAME = '农网工程' THEN
            TOTALSUM
            ELSE
            0
            END
            ) zyxzNwgc,
            max(
            CASE
            WHEN COLNAME = '配网工程' THEN
            TOTALSUM
            ELSE
            0
            END
            ) zyxzPwgc,
            max(
            CASE
            WHEN COLNAME = '小型基建' THEN
            TOTALSUM
            ELSE
            0
            END
            ) zyxzXxjj,
            max(
            CASE
            WHEN COLNAME = '生产辅助技改大修' THEN
            TOTALSUM
            ELSE
            0
            END
            ) zyxzJgdx,
            max(
            CASE
            WHEN COLNAME = '大修技改' THEN
            TOTALSUM
            ELSE
            0
            END
            ) zyxzDxjg,
            max(
            CASE
            WHEN COLNAME = '运维检修' THEN
            TOTALSUM
            ELSE
            0
            END
            ) zyxzYjwx,
            max(
            CASE
            WHEN COLNAME = '信息通信' THEN
            TOTALSUM
            ELSE
            0
            END
            ) zyxzXxtx,
            max(
            CASE
            WHEN COLNAME = '电力监控' THEN
            TOTALSUM
            ELSE
            0
            END
            ) zyxzDljk,
            max(
            CASE
            WHEN COLNAME = '集体企业客户工程' THEN
            TOTALSUM
            ELSE
            0
            END
            ) zyxzJtqy,
            max(
            CASE
            WHEN COLNAME = '营销业扩' THEN
            TOTALSUM
            ELSE
            0
            END
            ) zyxzYxyk,
            max(
            CASE
            WHEN COLNAME = '抢修作业' THEN
            TOTALSUM
            ELSE
            0
            END
            ) zyxzQxzy,
            max(
            CASE
            WHEN COLNAME = '基建工程' THEN
            TOTALSUM
            ELSE
            0
            END
            ) zyxzJjgc,
            max(
            CASE
            WHEN COLNAME = '正在执行' THEN
            TOTALSUM
            ELSE
            0
            END
            ) zxqkZzzx,
            max(
            CASE
            WHEN COLNAME = '已执行' THEN
            TOTALSUM
            ELSE
            0
            END
            ) zxqkYzx,
            max(
            CASE
            WHEN COLNAME = '未开工' THEN
            TOTALSUM
            ELSE
            0
            END
            ) zxqkWkg,
            max(
            CASE
            WHEN COLNAME = '计划取消(天气原因)' THEN
            TOTALSUM
            ELSE
            0
            END
            ) zxqkWzxTq,
            max(
            CASE
            WHEN COLNAME = '计划取消(物料未到货)' THEN
            TOTALSUM
            ELSE
            0
            END
            ) zxqkWzxWl,
            max(
            CASE
            WHEN COLNAME = '计划取消(施工受阻)' THEN
            TOTALSUM
            ELSE
            0
            END
            ) zxqkWzxSg,
            max(
            CASE
            WHEN COLNAME = '计划取消(其它)' THEN
            TOTALSUM
            ELSE
            0
            END
            ) zxqkWzxQt
            FROM
            aj_datetimesum
            WHERE
            SEPART = :SEPART
            AND ISDELETE = '0'
            AND ROWNAME IN(${ROWNAME})
            GROUP BY
            ROWNAME
        </mysql>
    </sql>
    <sql id="getKeyCount" desc="重点作业数-按地市统计今日重点作业数">
        <mysql>
            SELECT
            SECONDID,
            COUNT(SECONDID) workCount
            FROM
            AJ_REPORT
            WHERE
            ISDELETE = '0'
            AND KEYTYPE = '1'
            AND SECONDID IN (${SECONDID})
            AND SEPART ${SEPART}
            AND DATE_FORMAT(BEGIN_TIME,'%Y-%m-%d') ${BEGIN_TIME}
            AND SETYPE = 1
            GROUP BY
            SECONDID
        </mysql>
    </sql>

    <sql id="getKeyWorkPlanBydept" desc="获取某单位今日重点作业计划列表">
        <mysql>
            SELECT
            TASKPOSITION workPlace,
            CPNAME enterPeople,
            DATE_FORMAT(BEGIN_TIME, '%H:%i:%S') beginTime,
            DATE_FORMAT(END_TIME, '%H:%i:%S') endTime,
            TASKCONTENT workContent,
            TASKGROP workUnit,
            SECONDID pubDept,
            TID reportUnit,
            VGID volCode,
            TTID workType,
            PTID preType,
            JTID workTicket,
            RGID fxdj
            FROM
            AJ_REPORT LEFT JOIN apporgunit dep ON AJ_REPORT.SECONDID = dep.APPORGUNIT_ID
            WHERE
            ISDELETE = '0'
            AND KEYTYPE = 1
            AND SEPART = :SEPART
            AND DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d') ${BEGIN_TIME}
            ${SECONDID}
            ORDER BY
            VGID ASC,
            dep.APPORGUNIT_ORDER
        </mysql>
    </sql>
    <sql id="getZDKeyWorkPlan" desc="获取全部今日重点作业计划列表">
        <mysql>
            SELECT
            TASKPOSITION workPlace,
            CPNAME enterPeople,
            DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d') beginTime,
            DATE_FORMAT(END_TIME, '%Y-%m-%d') endTime,
            TASKCONTENT workContent,
            TASKGROP workUnit,
            SECONDID pubDept,
            TID reportUnit,
            VGID volCode,
            TTID workType,
            PTID preType,
            JTID workTicket,
            RGID fxdj
            FROM
            AJ_REPORT
            WHERE
            ISDELETE = '0'
            AND KEYTYPE = '1'
            AND SETYPE = '1'
            AND SEPART ${SEPART}
            AND DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d') ${BEGIN_TIME}
            ORDER BY
            KEYSORT ASC,
            VGID ASC
        </mysql>
    </sql>

    <sql id="getDdCount" desc="带电作业数-按地市统计今日带电作业数">
        <mysql>
            SELECT
            SECONDID,
            COUNT(SECONDID) workCount
            FROM
            AJ_REPORT
            WHERE
            ISDELETE = '0'
            AND DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d') ${BEGIN_TIME}
            AND LIVE_WORK_FLG = '1'
            AND SECONDID IN (${SECONDID})
            AND SEPART ${SEPART}
            AND SETYPE = '1'
            GROUP BY
            SECONDID
        </mysql>
    </sql>
    <sql id="getDdWorkPlanBydept" desc="获取某单位今日带电作业计划列表">
        <mysql>
            SELECT
            TASKPOSITION workPlace,
            CPNAME enterPeople,
            DATE_FORMAT(BEGIN_TIME, '%H:%i:%S') beginTime,
            DATE_FORMAT(END_TIME, '%H:%i:%S') endTime,
            TASKCONTENT workContent,
            TASKGROP workUnit,
            SECONDID pubDept,
            TID reportUnit,
            VGID volCode,
            TTID workType,
            PTID preType,
            JTID workTicket,
            RGID fxdj
            FROM
            AJ_REPORT
            WHERE
            ISDELETE = '0'
            AND LIVE_WORK_FLG = '1'
            AND SETYPE = '1'
            AND SEPART = :SEPART
            AND DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d') ${BEGIN_TIME}
            AND SECONDID ${SECONDID}
            ORDER BY
            VGID ASC,
            TRIM(TASKPOSITION) ASC
        </mysql>
    </sql>
    <sql id="getDdPlanStais" desc="获取带电作业计划列表">
        <mysql>
            SELECT
            TASKPOSITION workPlace,
            CPNAME enterPeople,
            DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d %H:%i') beginTime,
            DATE_FORMAT(END_TIME, '%Y-%m-%d %H:%i') endTime,
            TASKCONTENT workContent,
            SECONDID pubDept,
            TASKGROP workUnit,
            TID reportUnit,
            VGID volCode,
            TTID workType,
            PTID preType,
            JTID workTicket,
            RGID fxdj
            FROM
            AJ_REPORT LEFT JOIN apporgunit dep ON AJ_REPORT.SECONDID = dep.APPORGUNIT_ID
            WHERE
            ISDELETE = '0'
            AND LIVE_WORK_FLG = '1'
            AND SETYPE = '1'
            AND SEPART ${SEPART}
            AND DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d') ${BEGIN_TIME}
            ORDER BY
            VGID ASC,
            dep.APPORGUNIT_ORDER,
            TRIM(TASKPOSITION) ASC
        </mysql>
    </sql>
    <sql id="getFivVolPlan" desc="获取500kV作业计划列表">
        <mysql>
            SELECT
            TASKPOSITION workPlace,
            CPNAME enterPeople,
            DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d %H:%i') beginTime,
            DATE_FORMAT(END_TIME, '%Y-%m-%d %H:%i') endTime,
            TASKCONTENT workContent,
            TASKGROP workUnit,
            SECONDID pubDept,
            TID reportUnit,
            VGID volCode,
            TTID workType,
            PTID preType,
            JTID workTicket,
            RGID fxdj
            FROM
            AJ_REPORT LEFT JOIN apporgunit dep ON AJ_REPORT.SECONDID = dep.APPORGUNIT_ID
            WHERE
            ISDELETE = '0'
            AND VGID = '1'
            AND SETYPE = '1'
            AND SEPART = :SEPART
            AND SECONDID IN (${SECONDID})
            AND DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d') ${BEGIN_TIME}
            order by dep.APPORGUNIT_ORDER
        </mysql>
    </sql>
    <sql id="getTwRyCountPeopleNum" desc="获取按地市统计今日作业人员数量">
        <mysql>
            SELECT
            SECONDID secondid,
            COUNT(SECONDID) AS count,
            SUM(TASKMANS) AS workPeopleNum
            FROM
            AJ_REPORT
            WHERE
            DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d') ${BEGIN_TIME}
            AND ISCHECK IN ('2', '3')
            AND ISDELETE = '0'
            AND SETYPE = '1'
            AND SECONDID IN (${SECONDID})
            AND SEPART = ${SEPART}
            GROUP BY
            SECONDID
        </mysql>
    </sql>
    <sql id="searchTwCount" desc="按地市统计今日作业数">
        <mysql>
            SELECT
            TYPE,
            SEPART,
            SUM(TOTALSUM) TOTALSUM
            FROM
            aj_newreport
            WHERE
            SETYPE = '1'
            AND SEPART = ${SEPART}
            AND DATETIMETIME ${DATETIMETIME}
            AND TYPE IN (${TYPE})
            GROUP BY
            TYPE,
            SEPART
        </mysql>
    </sql>
    <sql id="getOverVideoALLWorkCount" desc="获取视频在线总数，视频总数，视频覆盖率，视频开机在线率-总作业数">
        <mysql>
            SELECT
            COUNT(WORK_PLAN_ID) workNum
            FROM
            WORK_PLAN
            WHERE
            :TIME BETWEEN DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d')
            AND DATE_FORMAT(END_TIME, '%Y-%m-%d')
            AND STATE IN ('2', '3')
            AND IS_DELETE = '0'
            AND BUILD_UNIT_NAME ${UNIT}
        </mysql>
    </sql>
    <sql id="getOverVideoWorkCount" desc="获取视频在线总数，视频总数，视频覆盖率，视频开机在线率-绑定布控球作业计划">
        <mysql>
            SELECT
            COUNT(DISTINCT(c.WORK_PLAN_ID)) videoWorkPlanNum
            FROM
            CAMERA_INFO c
            ${WHERE_QUERY}
        </mysql>
    </sql>
    <sql id="getAllWorkPlan" desc="获取地图展示所有计划点">
        <mysql>
            SELECT
            w.WORK_PLAN_ID AS workPlanId,
            IFNULL(fb.LONGITUDE, ca.LONGITUDE) longitude,
            IFNULL(fb.LATITUDE, ca.LATITUDE) latitude
            FROM
            WORK_PLAN w
            LEFT JOIN work_plan_fb fb ON w.work_plan_id = fb.WORK_PLAN_ID
            LEFT JOIN camera_info ci on w.work_plan_id=ci.WORK_PLAN_ID
            LEFT JOIN CAMERA_NAME ca ON ci.PUID = ca.PUID
            WHERE
            ${TIME} BETWEEN DATE_FORMAT(w.BEGIN_TIME, '%Y-%m-%d')
            AND DATE_FORMAT(w.end_TIME, '%Y-%m-%d')
            AND w.IS_DELETE = '0'
            AND ca.DEVICE_TYPE = '1'
            ${BUILD_UNIT_NAME}
        </mysql>
    </sql>
    <sql id="getFirstWorkPlan" desc="获取计划点的一条作业计划">
        <mysql>
            SELECT
            WORK_PLACE as workPlace,
            ENTER_PEOPLE_NAME as enterPeople,
            DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d') as beginTime,
            WORK_CONTENT as workContent,
            WORK_UNIT_NAME as workUnit,
            BUILD_UNIT_NAME as pubDept,
            REPORT_UNIT as reportUnit,
            VOLT_CODE as volCode,
            WORK_TYPE as workType,
            WORK_TICKET as workTicket,
            RISK_LEVEL as fxdj
            FROM
            WORK_PLAN
            WHERE
            IS_DELETE = '0'
            AND STATE IN ('2', '3')
            AND WORK_PLAN_ID = :workPlanId
            ${BUILD_UNIT_NAME}
        </mysql>
    </sql>
    <sql id="getWorkPlanById" desc="地图上点击作业计划点显示作业详情和视频信息">
        <mysql>
            SELECT
            cn.CAMERA_CODE as cameraCode,
            cn.CAMERA_NAME as cameraName,
            cn.CAMERA_STATUS as cameraStatus,
            cn.DECODER_TAG as decoderTag
            FROM
            CAMERA_NAME cn
            LEFT JOIN
            CAMERA_INFO ci
            ON cn.PUID = ci.PUID
            WHERE
            ci.WORK_PLAN_ID = :workPlanId
            AND cn.DEVICE_TYPE = '1'
        </mysql>
    </sql>
    <sql id="getPlayVedioParam" desc="点击节点（设备编码）获取播放视频参数">
        <mysql>
            SELECT
            CAMERA_CODE as cameraCode,
            case when wp.WORK_PLACE is null then CAMERA_NAME ELSE wp.WORK_PLACE END AS cameraName,
            CAMERA_STATUS as cameraStatus,
            DECODER_TAG as decoderTag,
            case
            when DATE_FORMAT(NOW(), '%Y-%m-%d %T') BETWEEN DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d %T')
            AND DATE_FORMAT(END_TIME, '%Y-%m-%d %T') THEN 0
            when DATE_FORMAT(NOW(), '%Y-%m-%d %T') <![CDATA[ <= ]]> DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d %T')
            then TIMESTAMPDIFF(second,DATE_FORMAT(NOW(), '%Y-%m-%d %T'),DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d %T'))
            when DATE_FORMAT(NOW(), '%Y-%m-%d %T') <![CDATA[ >= ]]> DATE_FORMAT(END_TIME, '%Y-%m-%d %T')
            then TIMESTAMPDIFF(second,DATE_FORMAT(END_TIME, '%Y-%m-%d %T'),DATE_FORMAT(NOW(), '%Y-%m-%d %T'))
            end as timeDiff
            FROM
            CAMERA_NAME cn LEFT JOIN camera_info ci on cn.PUID = ci.PUID
            LEFT JOIN work_plan wp on ci.WORK_PLAN_ID = wp.WORK_PLAN_ID
            WHERE
            CAMERA_CODE = :cameraCode
            AND DATE_FORMAT(NOW(), '%Y-%m-%d') BETWEEN DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d')
            AND DATE_FORMAT(end_time, '%Y-%m-%d')
            AND cn.DEVICE_TYPE = '1'
            order by timeDiff limit 1
        </mysql>
    </sql>
    <sql id="unitTreeWcpSearch" desc="根据作业内容或者作业作业地点或电压等级检索作业计划">
        <mysql>
            SELECT
            WORK_PLACE as workPlace,
            WORK_PLAN_ID as workPlanId,
            BUILD_UNIT_NAME as buildUnitName
            FROM
            WORK_PLAN
            WHERE
            :nowDate BETWEEN DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d') and DATE_FORMAT(END_TIME, '%Y-%m-%d')
            and IS_DELETE = '0'
            ${CONDITION}
        </mysql>
    </sql>
    <sql id="getICode" desc="根据作业内容或者作业作业地点或电压等级检索相应code">
        <mysql>
            SELECT
            I_CODE as iCode
            FROM
            DATA_TYPE_ITEM
            WHERE
            I_NAME = :iName
        </mysql>
    </sql>
    <sql id="getVedioByVoltCode" desc="根据电压等级检索大屏视频初始值">
        <mysql>
            SELECT
            cn.CAMERA_CODE as cameraCode,
            cn.CAMERA_NAME as cameraName,
            cn.CAMERA_STATUS as cameraStatus,
            cn.DECODER_TAG as decoderTag
            FROM
            CAMERA_NAME cn
            LEFT JOIN
            CAMERA_INFO ca
            ON
            ca.PUID = cn.PUID
            LEFT JOIN
            WORK_PLAN w
            ON
            ca.WORK_PLAN_ID = w.WORK_PLAN_ID
            WHERE
            w.VOLT_CODE = :volCode
            AND cn.DEVICE_TYPE = '1'
            AND w.BUILD_UNIT_NAME <![CDATA[ >= ]]> :SBZID
            LIMIT 4
        </mysql>
    </sql>
    <sql id="getMiddleVolWorkPlanMapData" desc="获取各地市220kV作业数量">
        <mysql>
            SELECT
            COUNT(ID) as middleVolNum
            FROM
            AJ_REPORT
            WHERE
            ISDELETE ='0'
            AND VGID = '2'
            AND SETYPE = '1'
            AND SEPART = :iscId
            AND DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d') ${reportTime}
        </mysql>
    </sql>
    <sql id="getMiddleVolPlan" desc="获取地市220kV作业计划列表">
        <mysql>
            SELECT
            TASKPOSITION as workPlace,
            CPNAME as enterPeople,
            RGID as fxdj
            FROM
            AJ_REPORT
            WHERE
            ISDELETE ='0'
            AND VGID = '2'
            AND SETYPE = '1'
            AND SEPART = :iscId
            AND DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d') ${reportTime}
        </mysql>
    </sql>
    <sql id="getAllCamera" desc="获取地图展示所有布控球点">
        <mysql>
            SELECT
            PUID puid,
            LONGITUDE longitude,
            LATITUDE latitude
            FROM
            CAMERA_NAME
            WHERE
            DATE_FORMAT(UPDATE_TIME, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')
            AND LONGITUDE IS NOT NULL AND LONGITUDE <![CDATA[ <> ]]> ''
            AND LATITUDE IS NOT NULL AND LATITUDE <![CDATA[ <> ]]> ''
            AND CAMERA_STATUS = '1'
            AND DEVICE_TYPE = '1'
            ${QUERY}
        </mysql>
    </sql>
    <sql id="getWorkPlanDetail" desc="获取一条作业计划信息">
        <mysql>
            SELECT
            WORK_PLACE AS workPlace,
            ENTER_PEOPLE_NAME enterPeopleName,
            DATE_FORMAT(NOW(), '%Y-%m-%d') beginTime,
            WORK_CONTENT workContent,
            WORK_UNIT_NAME workUnit,
            BUILD_UNIT_NAME buildUnitName,
            REPORT_UNIT reportUnit,
            VOLT_CODE voltCode,
            WORK_TYPE workType,
            WORK_TICKET workTicket,
            RISK_LEVEL riskLevel
            FROM
            WORK_PLAN
            WHERE
            IS_DELETE = '0'
            AND STATE IN ('2', '3')
            AND (
            DATE_FORMAT(NOW(), '%Y-%m-%d') BETWEEN DATE_FORMAT(begin_time, '%Y-%m-%d')
            AND DATE_FORMAT(end_time, '%Y-%m-%d')
            ) ${SEPART}
        </mysql>
    </sql>
    <sql id="getWorkPlanByPUID" desc="根据puid获取作业详情">
        <mysql>
            SELECT
            w.WORK_PLACE workPlace,
            w.work_plan_id workPlanId,
            w.ENTER_PEOPLE_NAME enterPeopleName,
            DATE_FORMAT(w.BEGIN_TIME, '%Y-%m-%d') beginTime,
            w.WORK_CONTENT workContent,
            w.WORK_UNIT_NAME workUnit,
            w.BUILD_UNIT_NAME buildUnitName,
            w.REPORT_UNIT reportUnit,
            w.VOLT_CODE voltCode,
            w.WORK_TYPE workType,
            w.WORK_TICKET workTicket,
            w.RISK_LEVEL riskLevel,
            w.WORK_EXECUTION workExecution,
            ci.PUID,
            case
            when DATE_FORMAT(NOW(), '%Y-%m-%d %T') BETWEEN DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d %T')
            AND DATE_FORMAT(END_TIME, '%Y-%m-%d %T') THEN 0
            when DATE_FORMAT(NOW(), '%Y-%m-%d %T') <![CDATA[ <= ]]> DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d %T')
            then TIMESTAMPDIFF(second,DATE_FORMAT(NOW(), '%Y-%m-%d %T'),DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d %T'))
            when DATE_FORMAT(NOW(), '%Y-%m-%d %T') <![CDATA[ >= ]]> DATE_FORMAT(END_TIME, '%Y-%m-%d %T')
            then TIMESTAMPDIFF(second,DATE_FORMAT(END_TIME, '%Y-%m-%d %T'),DATE_FORMAT(NOW(), '%Y-%m-%d %T'))
            end as timeDiff
            FROM
            camera_info ci INNER JOIN work_plan w ON ci.work_plan_id = w.WORK_PLAN_ID
            WHERE
            w.IS_DELETE = '0'
            AND w.STATE IN ('2', '3')
            AND ci.PUID ${PUID}
            AND (
            DATE_FORMAT(NOW(), '%Y-%m-%d') BETWEEN DATE_FORMAT(BEGIN_TIME, '%Y-%m-%d')
            AND DATE_FORMAT(end_time, '%Y-%m-%d')
            )
            ORDER BY
            timeDiff limit 1
        </mysql>
    </sql>
    <sql id="getCamerById" desc="根据条件获取作布控球信息">
        <mysql>
            SELECT
            cn.CAMERA_CODE cameraCode,
            cn.CAMERA_NAME cameraName,
            cn.CAMERA_STATUS cameraStatus,
            cn.DECODER_TAG decoderTag
            FROM
            CAMERA_NAME cn
            WHERE
            cn.DEVICE_TYPE = '1'
            AND cn.PUID ${PUID}
        </mysql>
    </sql>
    <sql id="getYesTodayOverVideo" desc="获取昨日视频上线总数，视频覆盖率">
        <mysql>
            SELECT
            LINE_VIDEO_NUM lineVideoNum,
            VIDEO_PRO videoPro
            FROM
            CAMERA_STATIS
            WHERE
            DATE_FORMAT(UPDATE_TIME, '%Y-%m-%d') = DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 1 DAY), '%Y-%m-%d')
            ${DEPT_ID}
        </mysql>
    </sql>

    <sql id="getRiskCount" desc="获取各地市风险预警统计信息">
        <mysql>
            SELECT
            B.APPORGUNIT_ID as unit,
            sum(case when A.EVENTLEVEL = 2 then 1 else 0 end) as levelFiveRiskCount,
            sum(case when A.EVENTLEVEL = 3 then 1 else 0 end) as levelSixRiskCount,
            sum(case when A.EVENTLEVEL = 4 then 1 else 0 end) as levelSevenRiskCount,
            sum(case when A.EVENTLEVEL = 5 then 1 else 0 end) as levelEightRiskCount
            FROM
            f_risk A INNER JOIN apporgunit B ON FIND_IN_SET(B.APPORGUNIT_ID, A.TURNOFF_FACILITY_UNIT)
            OR B.APPORGUNIT_ID = A.CREATEUSER_UNIT
            WHERE
            A.STATE = '1'
            AND (
            DATE_FORMAT(A.PLAN_START_TIME, '%Y-%m-%d') BETWEEN SUBDATE(CURDATE(),(DATE_FORMAT(CURDATE(),'%w') + 6)%7)
            AND SUBDATE(CURDATE(),(DATE_FORMAT(CURDATE(),'%w')+6)%7 -6)
            AND
            DATE_FORMAT(A.PLAN_END_TIME, '%Y-%m-%d') BETWEEN SUBDATE(CURDATE(),(DATE_FORMAT(CURDATE(),'%w') + 6)%7)
            AND SUBDATE(CURDATE(),(DATE_FORMAT(CURDATE(),'%w')+6)%7 -6)
            )
            GROUP BY B.APPORGUNIT_ID
        </mysql>
    </sql>

    <sql id="getRiskInfo" desc="获取全省风险预警详细信息">
        <mysql>
            SELECT
            TURNOFF_FACILITY_UNIT as unit,
            RISK AS risk,
            TURNOFF_FACILITY_ID AS facility,
            CONCAT(DATE_FORMAT(PLAN_START_TIME,'%c.%e'),'-',DATE_FORMAT(PLAN_END_TIME,'%c.%e')) AS risktime,
            EVENTLEVEL
            FROM
            f_risk
            WHERE
            STATE = '1'
            AND (
            DATE_FORMAT(PLAN_START_TIME, '%Y-%m-%d') BETWEEN SUBDATE(CURDATE(),(DATE_FORMAT(CURDATE(),'%w') + 6)%7)
            AND SUBDATE(CURDATE(),(DATE_FORMAT(CURDATE(),'%w')+6)%7 -6)
            AND
            DATE_FORMAT(PLAN_END_TIME, '%Y-%m-%d') BETWEEN SUBDATE(CURDATE(),(DATE_FORMAT(CURDATE(),'%w') + 6)%7)
            AND SUBDATE(CURDATE(),(DATE_FORMAT(CURDATE(),'%w')+6)%7 -6)
            )
            ORDER BY
            CREATEUSER_UNIT, PLAN_START_TIME
        </mysql>
    </sql>

    <sql id="getRecorderCoordinate" desc="获取执法记录仪坐标信息">
        <mysql>
            SELECT
            PUID,
            LONGITUDE,
            LATITUDE
            FROM
            camera_name
            WHERE
            DATE_FORMAT(UPDATE_TIME, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')
            AND LONGITUDE IS NOT NULL AND LONGITUDE <![CDATA[ <> ]]> ''
            AND LATITUDE IS NOT NULL AND LATITUDE <![CDATA[ <> ]]> ''
            AND CAMERA_STATUS = '1'
            AND DEVICE_TYPE = '2'
            ${DEPT_ID}
        </mysql>
    </sql>

    <sql id="getRecorderStatistics" desc="获取执法记录仪坐标信息">
        <mysql>
            SELECT
            AUDITID
            FROM
            audit_plan
            WHERE
            DATE_FORMAT(AUDITTIME, '%Y-%m-%d') = DATE_FORMAT(${AUDITTIME}, '%Y-%m-%d')
            AND WORK_UNIT ${iscId}
            ${STATUS}
        </mysql>
    </sql>

    <sql id="getOutsideProvinceWorkPlanNum" desc="获取早报省外作业数量">
        <mysql>
            SELECT
            COUNT(ID) count,
            COALESCE(SUM(
            case when TASKMANS is null then 0 else TASKMANS end
            ), 0) as people
            FROM
            AJ_REPORT AJR
            WHERE
            ISDELETE = '0'
            AND SECONDID = :SECONDID
            AND SETYPE = '1'
            AND SEPART = :SEPART
        </mysql>
    </sql>

    <sql id="countTodayOutsideProvinceWorkPlanByWorkPlace" desc="获取省外按作业地理范围统计今日作业数量">
        <mysql>
            SELECT
            COUNT(ID) count,
            TASKPOSITION
            FROM
            AJ_REPORT AJR
            WHERE
            ISDELETE = '0'
            AND SECONDID = :SECONDID
            AND SETYPE = '1'
            AND SEPART = :SEPART
            group by TASKPOSITION
            order by VGID
        </mysql>
    </sql>

    <sql id="countTodayOutsideProvinceWorkPlanByRiskLevel" desc="获取省外按风险等级统计今日作业数量">
        <mysql>
            SELECT
            COUNT(ID) count,
            RGID risk
            FROM
            AJ_REPORT AJR
            WHERE
            ISDELETE = '0'
            AND SECONDID = :SECONDID
            AND SETYPE = '1'
            AND SEPART = :SEPART
            group by RGID
        </mysql>
    </sql>

    <sql id="countTodayOutsideProvinceWorkerByWorkPlace" desc="获取省外按作业地理范围统计今日作业人员数量">
        <mysql>
            SELECT
            SUM(TASKMANS) count,
            TASKPOSITION
            FROM
            AJ_REPORT AJR
            WHERE
            ISDELETE = '0'
            AND SECONDID = :SECONDID
            AND SETYPE = '1'
            AND SEPART = :SEPART
            group by TASKPOSITION
            order by VGID
        </mysql>
    </sql>

    <sql id="countTodayLevelOneOrTwoOutsideProvinceWorkPlan" desc="获取省外今日一二级风险作业计划列">
        <mysql>
            SELECT
            AJR.secondid UNIT,
            AJR.TID DEPT,
            AJR.TUID DWXZ,
            AJR.VGID DYDJ,
            AJR.TTID ZYXZ,
            AJR.PTID ZYLX,
            AJR.JTID GZP,
            AJR.TASKPOSITION WORK_PLACE,
            WPF.WORK_LOOCATION WORK_LOCATION,
            AJR.TASKCONTENT WORK_CONTENT,
            DATE_FORMAT(AJR.BEGIN_TIME, '%Y-%m-%d') WORK_TIME,
            DATE_FORMAT(AJR.BEGIN_TIME, '%H:%i') BEGIN_TIME,
            DATE_FORMAT(AJR.END_TIME, '%H:%i') END_TIME,
            AJR.TASKGROP WORK_UNIT,
            AJR.RGID RISK_LEVEL,
            AJR.RPNAME WORK_MANAGE_NAME,
            AJR.RPPHNOE WORK_MANAGE_PHONE,
            AJR.CPNAME ENTER_PEOPLE,
            AJR.TASKMANS WORKER_NUM
            FROM
            AJ_REPORT AJR INNER JOIN WORK_PLAN_FB WPF ON AJR.OLDID = WPF.WORK_PLAN_ID
            WHERE
            AJR.ISDELETE = '0'
            AND SECONDID = :SECONDID
            AND SETYPE = '1'
            AND SEPART = :SEPART
            order by AJR.VGID
        </mysql>
    </sql>
</sqls>
