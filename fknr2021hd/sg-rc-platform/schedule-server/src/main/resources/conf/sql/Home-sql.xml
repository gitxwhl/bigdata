<?xml version="1.0" encoding="UTF-8"?>
<sqls>
    <sql id="ProvinceList" desc="查询统计省用户作业计划一览">
        <mysql>
            SELECT
            DS_UNIT_ID AS unit_id,
            COUNT(1) AS total_num,
            SUM(EXE_STATE = '1') AS undo_num,
            SUM(EXE_STATE = '2') AS doing_num,
            SUM(EXE_STATE = '5') AS done_num
            FROM
            WP_WORK_PLAN_DAY
            WHERE
            ${filter}
            GROUP BY
            DS_UNIT_ID
        </mysql>
    </sql>

    <sql id="CityList" desc="查询统计市用户作业计划一览">
        <mysql>
            SELECT
            INSERT_UNIT_ID AS unit_id,
            COUNT(1) AS total_num,
            SUM(EXE_STATE = '1') AS undo_num,
            SUM(EXE_STATE = '2') AS doing_num,
            SUM(EXE_STATE = '5') AS done_num
            FROM
            WP_WORK_PLAN_DAY
            WHERE
            ${filter}
            GROUP BY
            INSERT_UNIT_ID
        </mysql>
    </sql>
    <sql id="CountyList" desc="查询统计县用户作业计划一览">
        <mysql>
            SELECT
            INSERT_UNIT_ID AS unit_id,
            COUNT(1) AS total_num,
            SUM(EXE_STATE = '1') AS undo_num,
            SUM(EXE_STATE = '2') AS doing_num,
            SUM(EXE_STATE = '5') AS done_num
            FROM
            WP_WORK_PLAN_DAY
            WHERE
            ${filter}
            GROUP BY
            INSERT_UNIT_ID
        </mysql>
    </sql>

    <sql id="ZyaqRisk" desc="查询统计作业风险等级">
        <mysql>
            SELECT
            ZYAQ_RISK AS risk_level,
            COUNT(1) AS count_num
            FROM
            WP_WORK_PLAN_DAY
            WHERE
            ${filter}
            AND ZYAQ_RISK IS NOT NULL
            GROUP BY
            ZYAQ_RISK
        </mysql>
    </sql>

    <sql id="ExeState" desc="查询统计今日施工情况">
        <mysql>
            SELECT
            EXE_STATE AS exe_state,
            COUNT(1) AS count_num
            FROM
            WP_WORK_PLAN_DAY
            WHERE
            ${filter}
            GROUP BY
            EXE_STATE
        </mysql>
    </sql>

    <sql id="DwyxRisk" desc="查询统计电网风险等级">
        <mysql>
            SELECT
            DWYX_RISK AS risk_level,
            COUNT(1) AS count_num
            FROM
            WP_WORK_PLAN_DAY
            WHERE
            ${filter}
            GROUP BY
            DWYX_RISK
        </mysql>
    </sql>
    <sql id="SgRisk" desc="查询统计施工风险等级">
        <mysql>
            SELECT
            SG_RISK AS risk_level,
            COUNT(1) AS count_num
            FROM
            WP_WORK_PLAN_DAY
            WHERE
            ${filter}
            AND SG_RISK IS NOT NULL
            GROUP BY
            SG_RISK
        </mysql>
    </sql>
    <sql id="ZyglbmType" desc="查询统计管理专业">
        <mysql>
            SELECT
            ZYGLBM_TYPE,
            COUNT(1) AS count_num
            FROM
            WP_WORK_PLAN_DAY
            WHERE
            ${filter}
            GROUP BY
            ZYGLBM_TYPE
        </mysql>
    </sql>
    <sql id="WorkplanMap" desc="查询作业计划地图分布">
        <mysql>
            SELECT
            WORK_PLAN_ID,
            EXE_STATE,
            LONGITUDE,
            LATITUDE,
            WORK_PLAN_NAME,
            ZYGLBM_TYPE,
            ZYLB_TYPE,
            ZYLX_TYPE,
            WORK_PLACE,
            WORK_MANAGE,
            RISK_LEVEL
            FROM
            WP_WORK_PLAN_DAY
            WHERE
            ${filter}
        </mysql>
    </sql>
    <sql id="PeccancyList" desc="查询违章统计一览">
        <mysql>
            SELECT
            PM.ID,
            PM.VIOLATION_LEVEL,
            PM.VIOLATION_ORG,
            DATE_FORMAT(PM.INSERT_TIME,'%Y-%m-%d %H:%i' ) AS PECCANCY_DATETIME
            FROM
            WP_WORK_PLAN_DAY WP
            INNER JOIN PECCANCY_MANAGE PM
            ON WP.WORK_PLAN_ID = PM.WORK_PLAN_ID
            WHERE
            DATE_FORMAT(PM.INSERT_TIME,'%Y-%m-%d')= :nowdate
            ${filter}
            ORDER BY PM.INSERT_TIME DESC
        </mysql>
    </sql>
    <sql id="PeccancyAmount" desc="查询违章数量">
        <mysql>
            SELECT
            COUNT(1) AS YEAR_NUM,
            <![CDATA[IFNULL(SUM(DATE_FORMAT(PM.PECCANCY_DATETIME,'%Y-%m-%d') >= :nowweek),0) AS WEEK_NUM,	]]>
            IFNULL(SUM(DATE_FORMAT(PM.PECCANCY_DATETIME,'%Y-%m-%d')= :nowdate),0) AS DAY_NUM
            FROM
            WP_WORK_PLAN_DAY WP
            INNER JOIN peccancy_manage PM
            ON WP.WORK_PLAN_ID = PM.WORK_PLAN_ID
            WHERE
            DATE_FORMAT(PM.PECCANCY_DATETIME,'%Y')= :nowyear
            ${filter}
        </mysql>
    </sql>
</sqls>
