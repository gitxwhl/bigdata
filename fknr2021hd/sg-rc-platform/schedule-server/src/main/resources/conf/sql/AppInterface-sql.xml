<?xml version="1.0" encoding="UTF-8"?>
<sqls>
    <sql id="insertUpdateWorkOrder" desc="判断是新增还是更新工作票">
        <mysql>
            SELECT
            id
            FROM
            workorder
            WHERE
            WORK_PLAN_ID= ${WORK_PLAN_ID}
        </mysql>
    </sql>
    <sql id="selectWorkPlaceInfo" desc="查询到岗到位信息">
        <mysql>
            SELECT
            WWPD.WORK_PLAN_ID AS workPlanId,
            WWPD.EXE_STATE AS exeState,
            WWPD.XJ_UNIT_NAME AS xjUnitName,
            WWPD.LINE_SUBSTATION_NAME AS lineSubstationName,
            WWPD.WORK_MANAGE_ID AS workManageId,
            WWPD.WORK_MANAGE AS workManage,
            WWPD.DS_DGR_ID AS dsDgrId,
            WWPD.DS_DGR AS dsDgr,
            WWPD.XJ_DGR_ID AS xjDgrId,
            WWPD.XJ_DGR AS xjDgr,
            WWPD.WORK_CONTENT AS workContent,
            WWPD.WORK_PLACE AS workPlace,
            WWPD.POWER_CUT as powerCut,
            WWPD.DWYX_RISK as dwyxRisk,
            WWPD.ZYAQ_RISK as zyaqRisk,
            WWPD.SG_RISK as sgRisk,
            WWPD.BEGIN_TIME AS beginTime,
            WWPD.END_TIME AS endTime ,
            WEI.WORK_UNIT workUnit
            FROM
            wp_work_plan_day WWPD
            LEFT JOIN work_entr_info WEI ON WWPD.WORK_PLAN_ID = WEI.WORK_PLAN_ID
            where ${filter}
        </mysql>
    </sql>

    <sql id="insertUpdateSiteSurvey" desc="判断是新增还是更新现场勘查信息">
        <mysql>
            SELECT
            id
            FROM
            SITE_SURVEY
            WHERE
            WORK_PLAN_ID= ${WORK_PLAN_ID}
        </mysql>
    </sql>

    <sql id="appGetWorkPlan" desc="获取作业计划信息">
        <mysql>
            SELECT
            w.WORK_PLAN_ID AS workPlanId,
            w.BUILD_UNIT_NAME AS
            buildUnitName,
            w.REPORT_UNIT AS reportUnit,
            w.VOLT_CODE AS voltCode,
            w.RISK_LEVEL AS riskLevel,
            w.BEGIN_TIME AS beginTime,
            w.END_TIME AS
            endTime,
            w.ENTER_PEOPLE_NAME AS enterPeopleName,
            w.WORK_TICKET AS
            workTicket,
            w.WORK_MANAGE_NAME AS workManageName,
            w.WORK_MANAGE_PHONE
            AS workManagePhone,
            w.WORK_PEOPLE_NUM AS workPeopleNum,
            w.WORK_PLACE AS
            workPlace,
            w.WORK_CONTENT AS workContent,
            w.WORK_EXECUTION AS
            workExecution,
            w.WORK_UNIT AS workUnit,
            wpf.WORK_UNIT_TYPE AS
            workUnitType,
            wpf.LONGITUDE AS longitude,
            wpf.LATITUDE AS latitude,
            wpf.INSERT_USER AS insertUser,
            wpf.CANCEL_RESON as cancelReson
            FROM
            work_plan w
            LEFT JOIN work_plan_fb
            wpf ON w.WORK_PLAN_ID = wpf.WORK_PLAN_ID
            LEFT JOIN camera_info cai ON
            cai.WORK_PLAN_ID = w.WORK_PLAN_ID
            WHERE ${filter}
        </mysql>
    </sql>
    <sql id="getPeopleByphone" desc="获取人员信息">
        <mysql>
            SELECT
            PERSONID
            FROM
            audit_person
            WHERE
            NAME= ${name}
            and PHONE=
            ${phone}
        </mysql>
    </sql>
    <sql id="savecancelReson" desc="新增作业计划取消原因">
        <mysql>
            SELECT
            PERSONID
            FROM
            audit_person
            WHERE
            NAME= ${name}
            and PHONE=
            ${phone}
        </mysql>
    </sql>
    <sql id="getCameraByWorkPlanID" desc="根据作业计划Id获取布控球信息">
        <mysql>
            SELECT
            ci.puid,ca.camera_name
            FROM
            camera_info ci
            left join
            camera_name ca on ci.puid=ca.puid
            WHERE
            ci.work_plan_id= ${workPlanId}
        </mysql>
    </sql>
    <sql id="getinformation" desc="根据作业计划Id获取回显信息">
        <mysql>
            SELECT
            w.FIRST_ISSUER AS firstIssUser,
            w.SECOND_ISSUER AS secondIssUser,
            w.LICENSOR AS licensor,
            w.WORKORDER_NO AS workOrderNo,
            s.KEEP_LIVE_PART AS keepLivePart
            FROM
            workorder w LEFT JOIN site_survey s ON w.WORK_PLAN_ID = s.WORK_PLAN_ID
            WHERE
            w.WORK_PLAN_ID= ${WORK_PLAN_ID}
        </mysql>
    </sql>

    <sql id="Shouldtoworkplaceweek" desc="根据组织单位统计当前周应到工作负责人数，应到市级到岗到位人员数，应到县级到岗到位人员数">
        <mysql>
            SELECT
            DS_UNIT_ID AS type,
            sum( WORK_MANAGE_NUM ) AS workManageCount,
            sum( SJ_DGR_NUM ) AS sjDgrCount,
            sum( XJ_DGR_NUM ) AS xjDgrCount
            FROM
            wp_work_plan_day WWPD
            WHERE
            1 = 1
            AND
            '${endDate}' >= DATE_FORMAT(ACTUAL_BEGIN_TIME,'%Y-%m-%d')
            AND DATE_FORMAT(ACTUAL_END_TIME,'%Y-%m-%d')>= '${startDate}'
            GROUP BY
            WWPD.DS_UNIT_ID
            ORDER BY
            WWPD.UPDATE_TIME DESC
        </mysql>
    </sql>

    <sql id="Actualtoworkplaceweek" desc="根据组织单位统计当前周实际工作负责人数，应到市级到岗到位人员数，应到县级到岗到位人员数">
        <mysql>
            SELECT
            WWPD.DS_UNIT_ID AS type,
            sum( CASE WHEN WEI.ARRIVAL_STAFF_TYPE = '1' THEN + 1 ELSE + 0 END ) AS 'workManageCount',
            sum( CASE WHEN WEI.ARRIVAL_STAFF_TYPE = '2' THEN + 1 ELSE + 0 END ) AS 'sjDgrCount',
            sum( CASE WHEN WEI.ARRIVAL_STAFF_TYPE = '3' THEN + 1 ELSE + 0 END ) AS 'xjDgrCount'
            FROM
            wp_work_plan_day WWPD
            LEFT JOIN work_entr_info WEI ON WWPD.WORK_PLAN_ID = WEI.WORK_PLAN_ID
            WHERE
            1 = 1
            AND
            '${endDate}' >= DATE_FORMAT(ACTUAL_BEGIN_TIME,'%Y-%m-%d')
            AND DATE_FORMAT(ACTUAL_END_TIME,'%Y-%m-%d')>= '${startDate}'
            GROUP BY
            WWPD.DS_UNIT_ID
            ORDER BY
            WWPD.UPDATE_TIME DESC
        </mysql>
    </sql>
    <sql id="Shouldtoworkplacetoday" desc="根据组织单位统计当天应到工作负责人数，应到市级到岗到位人员数，应到县级到岗到位人员数">
        <mysql>
            SELECT
            WWPD.DS_UNIT_ID AS type,
            sum( WORK_MANAGE_NUM ) AS 'workManageCount',
            sum( SJ_DGR_NUM ) AS 'sjDgrCount',
            sum( XJ_DGR_NUM ) AS 'xjDgrCount'
            FROM
            wp_work_plan_day WWPD
            WHERE
            1 = 1
            AND
            '${today}' between DATE_FORMAT(ACTUAL_BEGIN_TIME,'%Y-%m-%d')
            AND DATE_FORMAT(ACTUAL_END_TIME,'%Y-%m-%d')
            GROUP BY
            WWPD.DS_UNIT_ID
            ORDER BY
            WWPD.UPDATE_TIME DESC
        </mysql>
    </sql>
    <sql id="Actualtoworkplacetoday" desc="根据组织单位统计当天实际工作负责人数，应到市级到岗到位人员数，应到县级到岗到位人员数">
        <mysql>
            SELECT
            WWPD.DS_UNIT_ID AS type,
            sum( CASE WHEN WEI.ARRIVAL_STAFF_TYPE = '1' THEN + 1 ELSE + 0 END ) AS 'workManageCount',
            sum( CASE WHEN WEI.ARRIVAL_STAFF_TYPE = '2' THEN + 1 ELSE + 0 END ) AS 'sjDgrCount',
            sum( CASE WHEN WEI.ARRIVAL_STAFF_TYPE = '3' THEN + 1 ELSE + 0 END ) AS 'xjDgrCount'
            FROM
            wp_work_plan_day WWPD
            LEFT JOIN work_entr_info WEI ON WWPD.WORK_PLAN_ID = WEI.WORK_PLAN_ID
            WHERE
            1 = 1
            AND
            '${today}' between DATE_FORMAT(ACTUAL_BEGIN_TIME,'%Y-%m-%d')
            AND DATE_FORMAT(ACTUAL_END_TIME,'%Y-%m-%d')
            GROUP BY
            WWPD.DS_UNIT_ID
            ORDER BY
            WWPD.UPDATE_TIME DESC
        </mysql>
    </sql>
    <sql id="getTaskPlanInfo" desc="获取当前用户的作业计划列表信息">
        <mysql>
            SELECT
            wwpd.WORK_PLAN_ID AS workPlanId,
            wwpd.DS_UNIT_NAME AS dsUnitName,
            wwpd.XJ_UNIT_NAME AS xjUnitName,
            date_format(wwpd.BEGIN_TIME,'%Y-%m-%d %H:%i:%s') AS beginTime,
            date_format(wwpd.END_TIME,'%Y-%m-%d %H:%i:%s') AS endTime,
            wwpd.VOLT_CODE AS voltCode,
            wwpd.ZYAQ_RISK AS ayaqRisk,
            date_format(wwpd.ACTUAL_BEGIN_TIME,'%Y-%m-%d %H:%i:%s') AS actualBeginTime,
            wwpd.XJ_DGR AS xjDgr,
            wwpd.DS_DGR AS dsDgr,
            wwpd.WORK_MANAGE AS workManage,
            wwpd.WORK_NUM AS workNum,
            wwpd.WORK_PLACE AS workPlace,
            wwpd.WORK_CONTENT AS workContent,
            wwpd.LONGITUDE AS longitude,
            wwpd.LATITUDE AS latitude,
            wwpd.SS_UNIT AS ssUnit,
            wwpd.EXE_STATE AS exeState,
            wwpd.WORK_MANAGE_ID AS workManageId,
            wwpd.XJ_DGR_ID AS xjDgrId,
            wwpd.DS_DGR_ID AS dsDgrId,
            ip.INSPECTION_STAFF_ID AS inspectionStaffId
            FROM
            wp_work_plan_day wwpd LEFT JOIN INSPECTION_PLAN ip ON wwpd.WORK_PLAN_ID = ip.WORK_PLAN_ID
            WHERE
            ${filter}
        </mysql>
    </sql>


    <sql id="appGetExamInfo" desc="根据所选专业获取考试题目信息">
        <mysql>
            SELECT * FROM safety_questions
            WHERE
            ${filter}
        </mysql>
    </sql>


    <sql id="getCameraPuidInfo" desc="获取布控球相关信息">
        <mysql>
            SELECT
            PUID AS puid
            FROM
            camera_info
            WHERE
            ${cameraFilter}
        </mysql>
    </sql>

    <sql id="getStaffSelecValue" desc="获取作业负责人或到岗到位人员的下拉列表值">
        <mysql>
            SELECT
            WORK_MANAGE_ID AS workManageId,
            WORK_MANAGE AS workManage,
            XJ_DGR_ID AS xjDgrId,
            XJ_DGR AS xjDgr,
            DS_DGR_ID AS dsDgrId,
            DS_DGR AS dsDgr
            FROM
            wp_work_plan_day
        </mysql>
    </sql>

    <sql id="judgePlanChange" desc="获取当前计划变更的次数">
        <mysql>
            SELECT
            ID AS id
            FROM
            WP_WORK_PLAN_WEEK_CHANGE
            WHERE
            ${changePlanFilter}
        </mysql>
    </sql>

    <sql id="getWorkPlanDayById" desc="获取当前的日管控信息">
        <mysql>
            SELECT
            *
            FROM
            wp_work_plan_day
            WHERE
            ${planDayFilter}
        </mysql>
    </sql>

    <sql id="getPlanWeekId" desc="根据作业计划编号检索周计划作业计划ID">
        <mysql>
            SELECT
            WORK_PLAN_ID AS workPlanId
            FROM
            wp_work_plan_week
            WHERE
            ${planWeekFilter}
        </mysql>
    </sql>
</sqls>
