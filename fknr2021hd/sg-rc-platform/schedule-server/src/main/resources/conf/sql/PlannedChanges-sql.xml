<?xml version="1.0" encoding="UTF-8"?>
<sqls>
    <sql id="countWorkPlans" desc="根据相应查询条件，统计新增、修改、删除、延迟、惩罚的作业计划数量">
        <mysql>
            SELECT wp.BUILD_UNIT_NAME,wp.REPORT_UNIT,
            COUNT(wp.WORK_PLAN_ID) AS total,
            sum( CASE WHEN wpfp.UPDATE_USER IS NOT NULL AND wpfp.UPDATE_TIME IS NOT NULL
            AND wp.IS_DELETE != '1' THEN 1 ELSE 0 END) AS updateWorkCount,
            sum(CASE WHEN wpfp.DUTY_CYCLE_TYPE = '3' AND wp.IS_DELETE != '1' THEN 1 ELSE 0 END) AS addWorkCount,
            sum(CASE WHEN wp.IS_DELETE = '1' OR CANCEL_RESON IS NOT NULL THEN 1 ELSE 0 END) AS delWorkCount,
            sum(CASE WHEN POSTPONE_REASONS IS NOT NULL AND wp.IS_DELETE != '1' THEN 1 ELSE 0 END) AS postPoneWorkCount,
            sum(CASE WHEN ILLEGAL_INSTRUCTIONS IS NOT NULL AND wp.IS_DELETE != '1' THEN 1 ELSE 0 END) AS punishWorkCount
            FROM work_plan wp INNER JOIN work_plan_fb wpfp ON wp.WORK_PLAN_ID = wpfp.WORK_PLAN_ID ${state}
            LEFT JOIN work_plan_postpone wppost ON wp.WORK_PLAN_ID = wppost.WORK_PLAN_ID
            LEFT JOIN work_plan_punish wppunish ON wp.WORK_PLAN_ID = wppunish.WORK_PLAN_ID ${filters}
        </mysql>
    </sql>
    <sql id="updateWork" desc="根据相应查询条件查询修改的作业计划相关信息">
        <mysql>
            SELECT
            wp.WORK_PLAN_ID,
            wp.BUILD_UNIT_NAME,
            wp.REPORT_UNIT,
            wp.REPORT_UNIT_NAME,
            wp.STATE,
            wp.WORK_EXECUTION,
            wp.EMPHASIS_FLAG,
            wp.VOLT_CODE,
            wp.WORK_TYPE,
            wpfp.PRPFESSIONAL_TYPES,
            wp.WORK_TICKET,
            wp.WORK_PLACE,
            wpfp.WORK_LOOCATION,
            wp.WORK_CONTENT,
            wp.BEGIN_TIME,
            wp.END_TIME,
            wp.RISK_LEVEL,
            wpfp.PERSONAL_RISK,
            wp.WORK_MANAGE_NAME,
            wp.WORK_MANAGE_PHONE,
            wpfp.UPDATE_USER,
            wpfp.UPDATE_TIME
            FROM
            work_plan wp
            INNER JOIN work_plan_fb wpfp ON wp.WORK_PLAN_ID = wpfp.WORK_PLAN_ID
            AND wpfp.UPDATE_USER IS NOT NULL
            AND wpfp.UPDATE_TIME IS NOT NULL
            AND wp.IS_DELETE != '1' ${filters}
        </mysql>
    </sql>
    <sql id="delWork" desc="根据相应查询条件查询根据相应查询条件查询删除的作业计划相关信息">
        <mysql>
            SELECT
            wp.WORK_PLAN_ID,
            wp.BUILD_UNIT_NAME,
            wp.REPORT_UNIT,
            wp.REPORT_UNIT_NAME,
            wp.STATE,
            wp.WORK_EXECUTION,
            wp.EMPHASIS_FLAG,
            wp.VOLT_CODE,
            wp.WORK_TYPE,
            wpfp.PRPFESSIONAL_TYPES,
            wp.WORK_TICKET,
            wp.WORK_PLACE,
            wpfp.WORK_LOOCATION,
            wp.WORK_CONTENT,
            wp.BEGIN_TIME,
            wp.END_TIME,
            wp.RISK_LEVEL,
            wpfp.PERSONAL_RISK,
            wp.WORK_MANAGE_NAME,
            wp.WORK_MANAGE_PHONE,
            wp.DELETE_MAN,
            wp.DELETE_TIME,
            wpfp.CANCEL_RESON
            FROM
            work_plan wp
            INNER JOIN work_plan_fb wpfp ON wp.WORK_PLAN_ID = wpfp.WORK_PLAN_ID
            AND (
            wp.IS_DELETE = '1'
            OR CANCEL_RESON IS NOT NULL
            ) ${filters}
        </mysql>
    </sql>
    <sql id="postponeWork" desc="根据相应查询条件查询延迟的作业计划相关信息">
        <mysql>
            SELECT
            wp.WORK_PLAN_ID,
            wp.BUILD_UNIT_NAME,
            wp.REPORT_UNIT,
            wp.REPORT_UNIT_NAME,
            wp.STATE,
            wp.WORK_EXECUTION,
            wp.EMPHASIS_FLAG,
            wp.VOLT_CODE,
            wp.WORK_TYPE,
            wpfp.PRPFESSIONAL_TYPES,
            wp.WORK_TICKET,
            wp.WORK_PLACE,
            wpfp.WORK_LOOCATION,
            wp.WORK_CONTENT,
            wp.BEGIN_TIME,
            wp.END_TIME,
            wp.RISK_LEVEL,
            wpfp.PERSONAL_RISK,
            wp.WORK_MANAGE_NAME,
            wp.WORK_MANAGE_PHONE,
            wpp.POSTPONE_REASONS,
            wpp.OPRATION_MAN postPoneMan
            FROM
            work_plan wp
            INNER JOIN work_plan_postpone wpp ON wp.WORK_PLAN_ID = wpp.WORK_PLAN_ID
            INNER JOIN work_plan_fb wpfp ON wp.WORK_PLAN_ID = wpfp.WORK_PLAN_ID
            AND POSTPONE_REASONS IS NOT NULL
            AND wp.IS_DELETE != '1' ${filters}
        </mysql>
    </sql>
    <sql id="temporaryWork" desc="根据相应查询条件查询临时的作业计划相关信息">
        <mysql>
            SELECT
            wp.WORK_PLAN_ID,
            wp.BUILD_UNIT_NAME,
            wp.REPORT_UNIT,
            wp.REPORT_UNIT_NAME,
            wp.STATE,
            wp.WORK_EXECUTION,
            wp.EMPHASIS_FLAG,
            wp.VOLT_CODE,
            wp.WORK_TYPE,
            wpfp.PRPFESSIONAL_TYPES,
            wp.WORK_TICKET,
            wp.WORK_PLACE,
            wpfp.WORK_LOOCATION,
            wp.WORK_CONTENT,
            wp.BEGIN_TIME,
            wp.END_TIME,
            wp.RISK_LEVEL,
            wpfp.PERSONAL_RISK,
            wpfp.TEMPORARY_REASON,
            wp.WORK_MANAGE_NAME,
            wp.WORK_MANAGE_PHONE
            FROM
            work_plan wp
            INNER JOIN work_plan_fb wpfp ON wp.WORK_PLAN_ID = wpfp.WORK_PLAN_ID
            AND wpfp.DUTY_CYCLE_TYPE = '3'
            AND wp.IS_DELETE != '1' ${filters}
        </mysql>
    </sql>
    <sql id="punishWork" desc="根据相应查询条件查询处罚的作业计划相关信息">
        <mysql>
            SELECT
            wp.WORK_PLAN_ID,
            wp.BUILD_UNIT_NAME,
            wp.REPORT_UNIT,
            wp.REPORT_UNIT_NAME,
            wp.STATE,
            wp.WORK_EXECUTION,
            wp.EMPHASIS_FLAG,
            wp.VOLT_CODE,
            wp.WORK_TYPE,
            wpfp.PRPFESSIONAL_TYPES,
            wp.WORK_TICKET,
            wp.WORK_PLACE,
            wpfp.WORK_LOOCATION,
            wp.WORK_CONTENT,
            wp.BEGIN_TIME,
            wp.END_TIME,
            wp.RISK_LEVEL,
            wpfp.PERSONAL_RISK,
            wpfp.TEMPORARY_REASON,
            wp.WORK_MANAGE_NAME,
            wp.WORK_MANAGE_PHONE,
            wpp.OPRATION_MAN punishMan,
            wpp.OPRATION_TIME
            FROM
            work_plan wp
            INNER JOIN work_plan_punish wpp ON wp.WORK_PLAN_ID = wpp.WORK_PLAN_ID
            INNER JOIN work_plan_fb wpfp ON wp.WORK_PLAN_ID = wpfp.WORK_PLAN_ID
            AND ILLEGAL_INSTRUCTIONS IS NOT NULL
            AND wp.IS_DELETE != '1' ${filters}
        </mysql>
    </sql>
</sqls>
