define("accordion",[],function(){function e(e){var a=this;a.panels=[];a.selectedPanelRoute=null;a.isEnabledDrawer=!1;a.isLazyRender=!1;var i=0,j=0;a.selectedPanel=cube.comp(function(){var c=null;$.each(a.panels(),function(b,d){if(c!=null)return c;c==null&&a.selectedPanelRoute()==d.route&&(c=d,j=b)});return c},a);a._init=function(){a.isEnabledDrawer()&&$.each(a.panels(),function(a,b){if(typeof b.expanded=="undefined")b.expanded=cube.obj(!1);else if(!cube.isObservable(b.expanded))b.expanded=cube.obj(b.expanded)});
a.panels()&&a.panels().length>0&&(a.selectedPanelRoute()!="undefined"&&a.selectedPanelRoute()!=null?a.selectedPanelRoute(a.selectedPanelRoute()):a.selectedPanelRoute(a.panels()[0].route))};a.setSelectedPanel=function(c,b){a.isLazyRender()&&!a.isEnabledDrawer()&&a.renderPanel(this,b.currentTarget?b.currentTarget:b.srcElement);a.selectedPanelRoute(this.route);a.isEnabledDrawer()&&this.expanded(!this.expanded())};a.renderPanel=function(a,b){var d=null,h=$(b).parent().parent().find(".accordion-inner");
typeof a.content!="undefined"?(d={html:a.content},cube.bindComponentByNode(h,d)):typeof a.content=="undefined"&&typeof a.templateOptions!="undefined"&&(d={component:{name:a.templateOptions.name,params:a.templateOptions.params}},cube.bindComponentByNode(h,d))};a.onloading=function(c){c=$(c).children("section");i=a.panels().length;var b=cube.getIEVersion();c.each(function(c,h){var f=$(h),g=f.wrap("<div></div>").parent().html();b>-1&&b<9&&(g=g.replace(/<:/g,"<").replace(/<\/:/g,"</"));var e=f.attr("expanded"),
g={title:f.attr("title"),route:f.attr("route"),expanded:cube.obj(typeof e=="undefined"?!1:e),content:g};a.panels.push(g);f.remove()})};a.onload=function(c,b){for(var d=$(c),e=a.panels(),f=i;f<e.length;f++)cube.applyBindings(d.find(">.accordion>.accordion-group:nth-child("+(f+1)+")>.accordion-body").children(".accordion-inner").children(),b);i==0&&a.panels()&&a.panels().length>0&&cube.isEmpty(a.selectedPanelRoute())&&a.selectedPanelRoute(a.panels()[0].route);a.isLazyRender()&&!a.isEnabledDrawer()&&
a.renderPanel(a.selectedPanel(),d.find(".accordion-inner:eq("+j+")"))};cube.endViewModel(a,e)}e.prototype.dispose=function(){this.selectedPanel.dispose()};return e});define("hsplit",[],function(){function e(e){var c=this;c.height="100%";c.width="100%";c.btnbgcolor=null;c.resizable=!0;c.showBorder=!0;c.contents=[];var i=0;c._init=function(){for(var a=c.contents(),d=a.length,b=0;b<d;b++){if(a[b])a[b].display=cube.obj("block"),a[b].height=cube.initComponentProperty(a[b].height,"auto","obj"),a[b].splitClass=cube.obj("top");if(cube.notEmpty(a[b].templateOptions)){a[b].isOut=cube.notEmpty(a[b].templateOptions.name)&&a[b].templateOptions.name.indexOf("http")==0&&a[b].templateOptions.type!=
"viewModel"?!0:!1;if(cube.isEmpty(a[b].templateOptions.type))a[b].templateOptions.type="ajax";if(cube.isEmpty(a[b].templateOptions.iframeHeight))a[b].templateOptions.iframeHeight="100%";if(a[b].isOut&&a[b].templateOptions.type=="ajax")a[b].ajaxHtml=cube.obj(""),c.getAjaxHtml(a[b])}}};c.setPanel=function(a){var d=c.contents()[a()].display,a=c.contents()[a()].splitClass;d()=="block"?(d("none"),a("collapsed")):(d("block"),a("top"))};var j=0,k=0,h;c.mousedown=function(a,d,b){j=b.clientY;h=c.contents()[a()].height;
a=h();k=a=="auto"||a.indexOf("%")!=-1?$(b.currentTarget?b.currentTarget:b.srcElement).prev().height():parseInt(a);$(document).unbind("mousemove").bind("mousemove",c.mousemove)};c.mouseup=function(){$(document).unbind("mousemove")};c.mousemove=function(){h(k+(event.clientY-j)+"px")};c.getAjaxHtml=function(a){$.ajax({url:a.templateOptions.name,crossDomain:cube.crosDomain(a.templateOptions.name),success:function(c){a.ajaxHtml(c)}})};c.onloading=function(a){a=$(a).children("section");i=c.contents().length;
var d=cube.getIEVersion();a.each(function(a,e){var f=$(e),g=f.wrap("<div></div>").parent().html();d>-1&&d<9&&(g=g.replace(/<:/g,"<").replace(/<\/:/g,"</"));g={height:cube.obj(f.attr("height")),display:cube.obj(f.attr("display")||"block"),splitClass:cube.obj("top"),content:g};c.contents.push(g);f.remove()})};c.onload=function(a,d){for(var b=$(a),e=c.contents(),f=i;f<e.length;f++)cube.applyBindings(b.find(">.row-fluid>div.row-fluid").eq(f).children().eq(0).children(),d)};cube.endViewModel(c,e)}e.prototype.dispose=
function(){};return e});define("panelcontainer",[],function(){function c(c){var a=this;a.width="400px";a.height="300px";a.type="panel";a.titleheight="40px";a.marginBottom=null;a.bgcolor="#eee";a.visible=!0;a.content="";a.templateOptions=null;a.title="";a.customBtns=[];a.ajaxHtml="";var e=a.isOut=!1;a._init=function(){var b=a.templateOptions();if(cube.notEmpty(b)){cube.notEmpty(b.name)&&b.name.indexOf("http")==0&&b.type!="viewModel"&&a.isOut(!0);if(cube.isEmpty(b.type))b.type="ajax";if(cube.isEmpty(b.iframeHeight))b.iframeHeight=a.height();
a.isOut()&&b.type=="ajax"&&a.getAjaxHtml(b.name)}a.type()=="title"&&(a.height("0px"),a.marginBottom("0px"))};a.customClick=function(b){cube.notEmpty(b.click)&&typeof b.click=="function"&&b.click(a)};a.getAjaxHtml=function(b){$.ajax({url:b,crossDomain:cube.crosDomain(b),success:function(b){a.ajaxHtml(b)}})};a.onloading=function(b){var b=$(b).contents().not("div.cube.accordion"),d=$("<div></div>"),c=$("<div></div>");c.append(b);d.append(c);a.content()==""&&a.templateOptions()==null&&(e=!0,a.content(d.html()));
d.remove()};a.onload=function(a,c){if(e){var f=$(a);cube.applyBindings(f.find(">.accordion>.accordion-group>.accordion-body").children(".accordion-inner").children(".panel-content").children(),c)}};cube.endViewModel(a,c)}c.prototype.dispose=function(){};return c});define("tabcontainer",[],function(){function j(j){var a=this;a.tabContents=[];a.type="default";a.reusable=!1;a.tabLayout="top";a.tabLeftHeight="auto";a.closeTabFocus=!1;a.isShowContextMenu=!0;a.isShowCloseTab=!1;a.selectedTabRoute=null;a.isTabLineFeed=!1;a.isHrefRoute=!0;a.onSelectedChanged=null;a._showBtn=!1;a.$scrollDiv=null;a.$closeDialog=null;a._selectedTab=null;a._tabLockedText=null;a.ajaxHtml="";var k=null,m=null,n=0,o=!0;a.selectedTab=cube.comp(function(){var b=null;$.each(a.tabContents(),function(){if(a.selectedTabRoute()==
this.route&&(b=this,cube.notEmpty(b.templateOptions))){b.isOut=cube.notEmpty(b.templateOptions.name)&&b.templateOptions.name.indexOf("http")==0&&b.templateOptions.type!="viewModel"?!0:!1;if(cube.isEmpty(b.templateOptions.type))b.templateOptions.type="ajax";if(cube.isEmpty(b.templateOptions.iframeHeight))b.templateOptions.iframeHeight="auto",o=!1;b.isOut&&b.templateOptions.type=="ajax"&&(a.reusable()?a.getAjaxHtml(b.templateOptions.name,b):a.getAjaxHtml(b.templateOptions.name));if(b.templateOptions.type==
"iframe"&&cube.notEmpty(b.templateOptions.params))b.templateOptions.params.dialog={},b.templateOptions.name+=(b.templateOptions.name.indexOf("?")>0?"&":"?")+"params="+JSON.stringify(b.templateOptions.params)}});a.selectedTabChange();return b},a);a._init=function(){a.reusable()?$.each(a.tabContents(),function(){if(cube.notEmpty(this.templateOptions)){this.isOut=cube.notEmpty(this.templateOptions.name)&&this.templateOptions.name.indexOf("http")==0&&this.templateOptions.type!="viewModel"?!0:!1;if(cube.isEmpty(this.templateOptions.type))this.templateOptions.type=
"ajax";if(this.templateOptions.type=="ajax"&&cube.isEmpty(this.templateOptions.ajaxHtml))this.templateOptions.ajaxHtml=cube.obj("");if(cube.isEmpty(this.templateOptions.iframeHeight))this.templateOptions.iframeHeight="auto"}if(typeof this.isLocked==void 0)this.isLocked=cube.obj(!1);else if(!cube.isObservable(this.isLocked))this.isLocked=cube.obj(this.isLocked)}):$.each(a.tabContents(),function(){if(typeof this.isLocked==void 0)this.isLocked=cube.obj(!1);else if(!cube.isObservable(this.isLocked))this.isLocked=
cube.obj(this.isLocked)});a.selectedTabRoute()!=null?a.selectedTabRoute(a.selectedTabRoute()):a.tabContents()&&a.tabContents().length>0&&a.selectedTabRoute(a.tabContents()[0].route);a.selctedTabRouteSub=cube.subscribe(a.selectedTabRoute,function(b){if(a.onSelectedChanged!=null&&!cube.isObservable(a.onSelectedChanged)){var c=null;$.each(a.tabContents(),function(){b==this.route&&(c=this)});a.onSelectedChanged(c)}if(a.isHrefRoute())window.location.hash=b});a.tabContentsSub=cube.subscribe(a.tabContents,
a.itemsChange)};a.showTabContent=function(b){a.selectedTabRoute(b.route);b=$(k).children(".tab-content").children();b[0]&&b[0].tagName&&b[0].tagName.toLowerCase()=="section"&&cube.applyBindings(b,m)};a.hiddenTab=function(b){if(a.selectedTab()==b){var c=a.tabContents(),d=c.indexOf(b);d==0?c.length>1&&(a.selectedTabRoute(c[1].route),a.tabContents.remove(b)):(a.selectedTabRoute(c[d-1].route),a.tabContents.remove(b))}};a.next=function(a){var c=$(a).siblings(".scrollborder"),a=c.children(".scroll").children("ul"),
c=parseInt(c.width())-parseInt(a.width()),d=a.position().left;a.stop(!0,!0);d<=c||(d=parseInt(d)-100,d<=c&&(d=c),a.animate({left:d}))};a.prev=function(a){var a=$(a).siblings(".scrollborder").children(".scroll").children("ul"),c=a.position().left;a.stop(!0,!0);c>=0||(c=parseInt(c)+100,c>0&&(c=0),a.animate({left:c}))};a.nextLeft=function(a){var c=$(a).siblings(".scrollborder-main"),a=c.children(".scroll-main").children("ul"),c=parseInt(c.height())-parseInt(a.height()),d=a.position().top;a.stop(!0,!0);
d<=c||(d=parseInt(d)-100,d<=c&&(d=c),a.animate({top:d}))};a.prevLeft=function(a){var a=$(a).siblings(".scrollborder-main").children(".scroll-main").children("ul"),c=a.position().top;a.stop(!0,!0);c>=0||(c=parseInt(c)+100,c>0&&(c=0),a.animate({top:c}))};a.showTabCloseDialog=function(b,c,d){if(a.isShowContextMenu())c=a.$closeDialog[0],a._selectedTab(a.tabContents()[b()]),a._selectedTab().isLocked()==!0?a._tabLockedText(cube.msg("DEBLOCKING")):a._tabLockedText(cube.msg("LOCKED")),a.isShowCloseTab(!0),
a.closeTabFocus(!0),c.style.top=d.clientY+"px",c.style.left=d.clientX+"px"};a.tabLockedThis=function(){var b=a._selectedTab();b!=null&&(b.isLocked()==!0?(b.isLocked(!1),a._tabLockedText(cube.msg("DEBLOCKING"))):(b.isLocked(!0),a._tabLockedText(cube.msg("LOCKED"))));a.isShowCloseTab(!1)};a.tabCloseThis=function(){var b=a.tabContents(),c=b.length-1,d=a.selectedTabRoute();if(a._selectedTab()!=null)d=a._selectedTab().route;if(c>0)for(i=c;i>=0;i--)if(b[i].route==d){a.selectedTabRoute()==d&&(b[0].route==
d?a.selectedTabRoute(b[1].route):b[c]==a._selectedTab()?a.selectedTabRoute(b[c-1].route):a.selectedTabRoute(b[i-1].route));a.tabContents.remove(b[i]);break}a.isShowCloseTab(!1)};a.tabCloseOthers=function(){var b=a.tabContents(),c=a.selectedTabRoute();if(a._selectedTab()!=null)c=a._selectedTab().route;for(i=b.length-1;i>=0;i--)a.selectedTabRoute(c),b[i].route!=c&&(b[i].isLocked()||a.tabContents.remove(b[i]));a.isShowCloseTab(!1)};a.tabCloseAll=function(){var b=a.tabContents(),c=a.selectedTabRoute();
for(i=b.length-1;i>=0;i--)b[i].isLocked()||a.tabContents.remove(b[i]);if(b.length>0)for(i=b.length-1;i>=0;i--)if(b[i].route==c){a.selectedTabRoute(b[i].route);break}else a.selectedTabRoute(b[0].route);a.isShowCloseTab(!1)};a.refreshTab=function(b){var c=null,d=0;cube.isEmpty(b)&&(b=a.selectedTabRoute());var e=a.tabContents(),g=e.length;for(i=0;i<g;i++)if(e[i].route==b){c=e[i].templateOptions;d=i;break}cube.notEmpty(c)&&(cube.clearComponentCached(c.name),b!=a.selectedTabRoute()?a.selectedTabRoute(b):
(b=null,b=a.reusable()?$(k).find(".tab-content"+(a.tabLayout()=="left"?"-main":"")+":eq("+d+")"):$(k).find(".tab-content"+(a.tabLayout()=="left"?"-main":"")),cube.bindComponentByNode(b,{component:c})))};a.tabCancelClose=function(){a.isShowCloseTab(!1)};a.mouseoverPopoverDialog=function(){};a.mousedownInnerPopoverDialog=function(){};a.hiddenPopoverDialog=function(){a.isShowCloseTab(!1);a.closeTabFocus(!1)};a.itemsChange=function(b){var c=null;if(a.reusable()&&b)for(var d=0;d<b.length;d++){c=b[d];if(cube.notEmpty(c.templateOptions)){c.isOut=
cube.notEmpty(c.templateOptions.name)&&c.templateOptions.name.indexOf("http")==0&&c.templateOptions.type!="viewModel"?!0:!1;if(cube.isEmpty(c.templateOptions.type))c.templateOptions.type="ajax";if(c.templateOptions.type=="ajax"&&cube.isEmpty(c.templateOptions.ajaxHtml))c.templateOptions.ajaxHtml=cube.obj("");if(cube.isEmpty(c.templateOptions.iframeHeight))c.templateOptions.iframeHeight="auto"}if(typeof c.isLocked==void 0)c.isLocked=cube.obj(!1);else if(!cube.isObservable(c.isLocked))c.isLocked=cube.obj(c.isLocked)}else if(b)for(d=
0;d<b.length;d++)if(c=b[d],typeof c.isLocked==void 0)c.isLocked=cube.obj(!1);else if(!cube.isObservable(c.isLocked))c.isLocked=cube.obj(c.isLocked);a.isTabLineFeed()!=!0&&a.$scrollDiv!=null&&!cube.isObservable(a.$scrollDiv)&&a.$scrollDiv.length>0&&setTimeout(function(){var b=a.$scrollDiv.width(),c=a.$scrollLeftDiv.height(),d=a.$scrollDiv.children("ul"),h=a.$scrollLeftDiv.children("ul"),d=d.width(),h=h.height();a.tabLayout()=="top"?d>=b?a._showBtn(!0):a._showBtn(!1):h>=c?a._showBtn(!0):a._showBtn(!1)},
300)};a.selectedTabChange=function(){a.isTabLineFeed()!=!0&&a.$scrollDiv!=null&&!cube.isObservable(a.$scrollDiv)&&a.$scrollDiv.length>0&&setTimeout(function(){var b=a.$scrollDiv.width(),c=a.$scrollLeftDiv.height(),d=a.$scrollDiv.children("ul"),e=a.$scrollLeftDiv.children("ul");d.width();var e=e.height(),g=0,l=0,h=a.tabContents(),f=h.length;for(i=0;i<f;i++)g+=d.children("li")[i].clientWidth+4,h[i].route==a.selectedTabRoute()&&(l=b-g);a.tabLayout()=="top"?g>=b&&l<=0?d.animate({left:l}):d.animate({left:0}):
e>=c?a._showBtn(!0):(a._showBtn(!1),d.animate({top:0}))},300)};a.getAjaxHtml=function(b,c){$.ajax({url:b,crossDomain:cube.crosDomain(b),success:function(b){typeof c!="undefined"&&c.templateOptions&&cube.isObservable(c.templateOptions.ajaxHtml)?c.templateOptions.ajaxHtml(b):a.ajaxHtml(b)}})};a.iframeLoad=function(a,c){var d=c.currentTarget?c.currentTarget:c.srcElement;if(!o&&d){var e=d.contentWindow||d.contentDocument.parentWindow;try{e.document.body&&($(d).attr("scrolling","no"),$(e.document.body).resize(function(){$(d).height(this.scrollHeight+
"px")}))}catch(g){}}};a.onloading=function(b,c){k=b;m=c;var d=$(b).children("section");n=a.tabContents().length;var e=cube.getIEVersion();d.each(function(b,c){var d=$(c),f=d.wrap("<div></div>").parent().html();e>-1&&e<9&&(f=f.replace(/<:/g,"<").replace(/<\/:/g,"</"));f={title:d.attr("title"),route:d.attr("route"),content:f};a.tabContents.push(f);d.remove()})};a.onload=function(b){b=$(b);a.$scrollDiv=b.children(".tabsheader").children(".scrollborder").children(".scroll");a.$scrollLeftDiv=b.children(".tabsheader-main").children(".scrollborder-main").children(".scroll-main");
a.$closeDialog=b.children(".dropdown-menu");a.itemsChange();n==0&&a.tabContents()&&a.tabContents().length>0&&(a.selectedTabRoute(a.tabContents()[0].route),a.showTabContent(a.tabContents()[0]))};cube.endViewModel(a,j)}j.prototype.dispose=function(){this.selectedTab.dispose();this.selctedTabRouteSub.dispose();this.tabContentsSub.dispose()};return j});define("vsplit",[],function(){function e(e){var c=this;c.height="100%";c.width="100%";c.btnbgcolor=null;c.resizable=!0;c.contents=[];var i=0;c._init=function(){for(var a=c.contents(),d=a.length,b=0;b<d;b++)if(a[b]&&(a[b].display=cube.obj("block"),a[b].width=cube.initComponentProperty(a[b].width,"auto","obj"),a[b].splitClass=cube.obj("top"),cube.notEmpty(a[b].templateOptions))){a[b].isOut=cube.notEmpty(a[b].templateOptions.name)&&a[b].templateOptions.name.indexOf("http")==0&&a[b].templateOptions.type!="viewModel"?
!0:!1;if(cube.isEmpty(a[b].templateOptions.type))a[b].templateOptions.type="ajax";if(cube.isEmpty(a[b].templateOptions.iframeHeight))a[b].templateOptions.iframeHeight="100%";if(a[b].isOut&&a[b].templateOptions.type=="ajax")a[b].ajaxHtml=cube.obj(""),c.getAjaxHtml(a[b])}};c.setPanel=function(a){var d=c.contents()[a()].display,a=c.contents()[a()].splitClass;d()=="block"?(d("none"),a("collapsed")):(d("block"),a("top"))};var j=0,k=0,h;c.mousedown=function(a,d,b){j=b.clientX;h=c.contents()[a()].width;
a=h();k=a=="auto"||a.indexOf("%")!=-1?$(b.currentTarget?b.currentTarget:b.srcElement).prev().width():parseInt(a);$(document).unbind("mousemove").bind("mousemove",c.mousemove)};c.mouseup=function(){$(document).unbind("mousemove")};c.mousemove=function(){h(k+(event.clientX-j)+"px")};c.getAjaxHtml=function(a){$.ajax({url:a.templateOptions.name,crossDomain:cube.crosDomain(a.templateOptions.name),success:function(c){a.ajaxHtml(c)}})};c.onloading=function(a){a=$(a).children("section");i=c.contents().length;
var d=cube.getIEVersion();a.each(function(a,e){var f=$(e),g=f.wrap("<div></div>").parent().html();d>-1&&d<9&&(g=g.replace(/<:/g,"<").replace(/<\/:/g,"</"));g={width:cube.obj(f.attr("width")),display:cube.obj(f.attr("display")||"block"),splitClass:cube.obj("top"),content:g};c.contents.push(g);f.remove()})};c.onload=function(a,d){for(var b=$(a),e=c.contents(),f=i;f<e.length;f++)cube.applyBindings(b.find(">.row-fluid>div.split-body").eq(f).children().eq(0).children(),d)};cube.endViewModel(c,e)}e.prototype.dispose=
function(){};return e});define("breadcrumb",[],function(){function b(b){var a=this;a.items=[];a.selectedRoute=null;a.splitTxt="/";a.icon=null;a.isHrefRoute=!0;a.onSelectedChanged=null;a.onRendered=null;a._init=function(){a.selectedRouteSub=cube.subscribe(a.selectedRoute,function(c){var b=!1,d=[];$.each(a.items(),function(){c==this.route?b=!0:b==!0&&d.push(this)});a.items.removeAll(d);if(a.onSelectedChanged!=null&&!cube.isObservable(a.onSelectedChanged))a.onSelectedChanged(c);if(a.isHrefRoute())window.location.hash=c})};a.setSelectRoute=
function(){a.selectedRoute(this.route)};a.onload=function(b){if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(b)};cube.endViewModel(a,b)}b.prototype.dispose=function(){this.selectedRouteSub.dispose()};return b});define("calendar",["CheckUtil"],function(h){function k(k){function t(a){a=parseInt(a);return isNaN(a)||a<0||a>12?!1:!0}var a=this;a.date=new Date;a.showTimePicker=!0;a.showDayPicker=!0;a.showMonthPicker=!0;a.showQuarterPicker=!1;a.year=a.date.getFullYear();a.quarter=Math.ceil((a.date.getMonth()+1)/3);a.month=a.date.getMonth()+1;a.day=a.date.getDate();a.hour=a.date.getHours();a.minute=a.date.getMinutes();a.second=a.date.getSeconds();a.isClickCloseDialog=!1;a.minValue=null;a.maxValue=null;a.isWest=!0;a.weekDays=
["\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u65e5"];a.westWeekDays=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"];a.yearQuarters=["\u7b2c\u4e00\u5b63\u5ea6","\u7b2c\u4e8c\u5b63\u5ea6","\u7b2c\u4e09\u5b63\u5ea6","\u7b2c\u56db\u5b63\u5ea6"];a.yearMonths=["01\u6708","02\u6708","03\u6708","04\u6708","05\u6708","06\u6708","07\u6708","08\u6708","09\u6708","10\u6708","11\u6708","12\u6708"];a.Hours=["00","02","04","06","08","10","12","14","16","18","20","22"];a.Minutes=["00",
"05","10","15","20","25","30","35","40","45","50","55"];a.monthTotalDays=[31,31,28,31,30,31,30,31,31,30,31,30,31,31];a.thisMonthDay=cube.obj({year:1,month:1,dayNums:1});a.preMonthDay=cube.obj({year:1,month:1,dayNums:1});a.nextMonthDay=cube.obj({year:1,month:1,dayNums:1});a.showCalendar=cube.obj(1);a.timePickType=cube.obj(0);a.showState=cube.obj(-1);a.isShowDialog=null;a.titleText=cube.comp(function(){if(a.showState()==0)return a.year()+"\u5e74"+a.month()+"\u6708";else if(a.showState()==1||a.showState()==
3)return a.year()+"\u5e74";else if(a.showState()==2)return a.year()-6+"\u5e74-"+(parseInt(a.year(),10)+5)+"\u5e74"},a);a.onSelectDate=null;a.onRendered=null;a._init=function(){a.date=new Date;a.validYear();a.validQuarter();a.validMonth();a.validDay();a.validHour();a.validMinute();a.validSecond();a.showTimePicker()==!1&&a.showDayPicker()==!1&&a.showMonthPicker()==!1&&a.showQuarterPicker()==!1&&a.showState(2);a.changeShowState();a.yearSub=cube.subscribe(a.year,function(){a.validYear();g();l()});a.quarterSub=
cube.subscribe(a.quarter,function(b){a.validQuarter();t(b)&&u()});a.monthSub=cube.subscribe(a.month,function(b){a.validMonth();t(b)&&(g(),v())});a.daySub=cube.subscribe(a.day,function(){a.validDay();g()});a.hourSub=cube.subscribe(a.hour,function(){a.validHour()});a.minuteSub=cube.subscribe(a.minute,function(){a.validMinute()});a.secondSub=cube.subscribe(a.second,function(){a.validSecond()});a.minValueSub=cube.subscribe(a.minValue,g);a.maxValueSub=cube.subscribe(a.maxValue,g);a.initDateItems();a.initMonthItems();
a.initQuarterItems();a.initYearItems();a.initHourItems();a.initMinuteItems();g();a.showState()==0&&(a.showDayPicker()&&a.showMonthPicker()&&!a.showQuarterPicker()?a.showState(0):a.showMonthPicker()&&!a.showQuarterPicker()?a.showState(1):!a.showMonthPicker()&&!a.showQuarterPicker()?a.showState(2):a.showQuarterPicker()?a.showState(2):a.showState(0))};a.changeShowState=function(){a.showState(a.showState()+1);a.showState()==1?v():a.showState()==2?l():a.showState()==3?a.showDayPicker()&&a.showMonthPicker()&&
!a.showQuarterPicker()?a.showState(0):a.showMonthPicker()&&!a.showQuarterPicker()?a.showState(1):a.showQuarterPicker()?(a.showState(3),u()):a.showState(2):a.showQuarterPicker()?a.showState(2):a.showState(0)};a.changeShowCalendar=function(){a.showCalendar()==1?a.showCalendar(0):a.showCalendar(1)};a.hourUp=function(){a.hour()>22?a.hour(0):a.hour(parseInt(a.hour(),10)+1)};a.hourDown=function(){a.hour()<1?a.hour(23):a.hour(parseInt(a.hour(),10)-1)};a.minuteUp=function(){a.minute()>58?(a.minute(0),a.hourUp()):
a.minute(parseInt(a.minute(),10)+1)};a.minuteDown=function(){a.minute()<1?(a.minute(59),a.hourDown()):a.minute(parseInt(a.minute(),10)-1)};a.secondUp=function(){a.second()>58?(a.second(0),a.minuteUp()):a.second(parseInt(a.second(),10)+1)};a.secondDown=function(){a.second()==0?(a.second(59),a.minuteDown()):a.second(parseInt(a.second(),10)-1)};a.onHourClick=function(){a.showCalendar(0);a.timePickType(1)};a.onMinuteClick=function(){a.showCalendar(0);a.timePickType(2)};a.onSecondClick=function(){a.showCalendar(0);
a.timePickType(3)};var j=function(b,d,c,e){b!=null&&a.year(b);d!=null&&a.month(d);c!=null&&a.day(c);e!=null&&a.quarter(e)},m=function(b,d){return d==2?b%4==0&&b%100!=0||b%4==0&&b%100==0&&b%400==0?29:28:a.monthTotalDays()[d]},g=function(){var b=a.year(),d=parseInt(a.month(),10),c,e,f;a.date.setFullYear(b);a.date.setMonth(d-1);a.date.setDate(1);c=a.date.getFullYear();e=a.date.getMonth()+1;f=a.date.getDay();a.thisMonthDay({year:c,month:e,dayNums:m(c,e),firstWeekDay:f});a.date.setFullYear(b);a.date.setMonth(d-
2);c=a.date.getFullYear();e=a.date.getMonth()+1;f=a.date.getDay();a.preMonthDay({year:c,month:e,dayNums:m(c,e),firstWeekDay:f});a.date.setFullYear(b);a.date.setMonth(d);c=a.date.getFullYear();e=a.date.getMonth()+1;f=a.date.getDay();a.nextMonthDay({year:c,month:e,dayNums:m(c,e),firstWeekDay:f});b=null;d=a.minValue();cube.notEmpty(d)&&h.isDate(d)&&(b=(new Date(d)).getTime());d=null;c=a.maxValue();cube.notEmpty(c)&&h.isDate(c)&&(d=(new Date(c)).getTime());c=0;e=a.thisMonthDay().firstWeekDay;e==0&&(e=
7);for(i=0;i<42;i++){i<e?(f=a.DateItems()[c]()[i%7],f.monthInd(-1),f.year(a.preMonthDay().year),f.month(a.preMonthDay().month),f.day(a.preMonthDay().dayNums-(e-i)+1)):i<e+a.thisMonthDay().dayNums?(i%7==0&&c++,f=a.DateItems()[c]()[i%7],f.monthInd(0),f.year(a.thisMonthDay().year),f.month(a.thisMonthDay().month),f.day(i-e+1)):(i%7==0&&c++,f=a.DateItems()[c]()[i%7],f.monthInd(1),f.year(a.nextMonthDay().year),f.month(a.nextMonthDay().month),f.day(i-e-a.thisMonthDay().dayNums+1));f.day()==a.day()&&f.month()==
a.month()&&f.year()==a.year()&&a.selectDate(f);f.disable(!1);var g=(new Date(f.year()+"-"+f.month()+"-"+f.day())).getTime();b!=null&&g<b&&f.disable(!0);d!=null&&g>d&&f.disable(!0)}},l=function(){for(var b=0;b<3;b++)for(var d=0;d<4;d++){var c=a.YearItems()[b]()[d];c.yearName(a.year()-6+(4*b+d));c.yearName()==a.year()?c.isSelect(!0):c.isSelect(!1)}},u=function(){for(var b=0;b<2;b++)for(var d=0;d<2;d++){var c=a.QuarterItems()[b]()[d];c.quarterInd==a.quarter()-1?c.isSelect(!0):c.isSelect(!1)}},v=function(){for(var b=
0;b<3;b++)for(var d=0;d<4;d++){var c=a.MonthItems()[b]()[d];c.monthInd==a.month()-1?c.isSelect(!0):c.isSelect(!1)}};a.DateItems=cube.array([]);a.selectDate=cube.obj();a.initDateItems=function(){for(var b=0;b<6;b++){for(var d=cube.array([]),c=0;c<7;c++){var e={year:cube.obj(1),month:cube.obj(1),day:cube.obj(1),weekInd:b,weekDay:c,monthInd:cube.obj(0),isHover:cube.obj(!1),disable:cube.obj(!1),showHover:function(){this.disable()||this.isHover(!0)},hiddenHover:function(){this.isHover(!1)},selectDay:function(){if(!this.disable()){j(this.year(),
this.month(),this.day());this.monthInd()!=0?g():a.selectDate(this);if(a.onSelectDate!=null&&!cube.isObservable(a.onSelectDate))a.onSelectDate(this);a.isClickCloseDialog()&&a.isShowDialog(!1)}},selectDayAndClose:function(){this.disable()||(j(this.year(),this.month(),this.day()),this.monthInd()!=0?g():a.selectDate(this),a.isShowDialog(!1))}};e.isSelect=cube.comp(function(){if(!this.disable())return this.year()==a.year()&&this.month()==a.month()&&this.day()==a.day()},e);d().push(e)}a.DateItems().push(d)}};
a.MonthItems=cube.array([]);a.selectMonth=cube.obj();a.initMonthItems=function(){for(var b=0;b<3;b++){for(var d=cube.array([]),c=0;c<4;c++){var e={monthInd:b*4+c,monthName:a.yearMonths()[b*4+c],isSelect:cube.obj(!1),isHover:cube.obj(!1),showHover:function(){this.isHover(!0)},hiddenHover:function(){this.isHover(!1)},selectMonth:function(){a.selectMonth()!=null&&a.selectMonth().isSelect(!1);this.isSelect(!0);a.selectMonth(this);a.showDayPicker()&&a.showState(0);!a.showDayPicker()&&a.isClickCloseDialog()&&
a.isShowDialog(!1);a.validMaxDay(this.monthInd+1);j(null,this.monthInd+1,null);g();this.isHover(!1)}};d().push(e)}a.MonthItems().push(d)}};a.QuarterItems=cube.array([]);a.selectQuarter=cube.obj();a.initQuarterItems=function(){for(var b=0;b<2;b++){for(var d=cube.array([]),c=0;c<2;c++){var e={quarterInd:b*2+c,quarterName:a.yearQuarters()[b*2+c],isSelect:cube.obj(!1),isHover:cube.obj(!1),showHover:function(){this.isHover(!0)},hiddenHover:function(){this.isHover(!1)},selectQuarter:function(){a.selectQuarter()!=
null&&a.selectQuarter().isSelect(!1);this.isSelect(!0);a.selectQuarter(this);a.showDayPicker()&&a.showState(2);a.isClickCloseDialog()&&a.isShowDialog(!1);j(null,null,null,this.quarterInd+1);g();this.isHover(!1)}};d().push(e)}a.QuarterItems().push(d)}};a.YearItems=cube.array([]);a.selectYear=cube.obj();a.initYearItems=function(){for(var b=0;b<3;b++){for(var d=cube.array([]),c=0;c<4;c++){var e={yearName:cube.obj(a.year()-6+(4*b+c)),isSelect:cube.obj(!1),isHover:cube.obj(!1),showHover:function(){this.isHover(!0)},
hiddenHover:function(){this.isHover(!1)},selectYear:function(){a.selectYear()!=null&&a.selectYear().isSelect(!1);this.isSelect(!0);a.selectYear(this);!a.showMonthPicker()&&a.isClickCloseDialog()&&!a.showQuarterPicker()&&a.isShowDialog(!1);a.showMonthPicker()&&!a.showQuarterPicker()&&a.showState(1);a.showQuarterPicker()&&a.showState(3);this.isHover(!1);j(this.yearName(),null,null)}};d().push(e)}a.YearItems().push(d)}};a.HourItems=cube.array([]);a.selectHour=cube.obj();a.initHourItems=function(){for(var b=
0;b<3;b++){for(var d=cube.array([]),c=0;c<4;c++){var e={hourInd:(b*4+c)*2,hourName:a.Hours()[b*4+c],isSelect:cube.obj(!1),isHover:cube.obj(!1),showHover:function(){this.isHover(!0)},hiddenHover:function(){this.isHover(!1)},selectHour:function(){a.selectHour()!=null&&a.selectHour().isSelect(!1);this.isSelect(!0);a.selectHour(this);a.timePickType(0);a.hour(this.hourInd);this.isHover(!1);a.showCalendar(1)}};d().push(e)}a.HourItems().push(d)}};a.MinuteItems=cube.array([]);a.selectMinute=cube.obj();a.initMinuteItems=
function(){for(var b=0;b<3;b++){for(var d=cube.array([]),c=0;c<4;c++){var e={minuteInd:(b*4+c)*5,minuteName:a.Minutes()[b*4+c],isSelect:cube.obj(!1),isHover:cube.obj(!1),showHover:function(){this.isHover(!0)},hiddenHover:function(){this.isHover(!1)},selectMinute:function(){a.selectMinute()!=null&&a.selectMinute().isSelect(!1);this.isSelect(!0);a.selectMinute(this);a.timePickType(0);a.minute(this.minuteInd);this.isHover(!1);a.showCalendar(1)},selectSecond:function(){a.selectMinute()!=null&&a.selectMinute().isSelect(!1);
this.isSelect(!0);a.selectMinute(this);a.timePickType(0);a.second(this.minuteInd);this.isHover(!1);a.showCalendar(1)}};d().push(e)}a.MinuteItems().push(d)}};a.showPre=function(){if(a.showState()==0){if(a.month()==1)a.month(12),a.year(a.year()-1);else{var b=parseInt(a.month())-1;a.validMaxDay(b);a.month(a.month()-1)}g()}else a.showState()==1||a.showState()==3?a.year(a.year()-1):a.showState()==2&&(a.year(a.year()-12),l())};a.showNext=function(){if(a.showState()==0){if(a.month()==12)a.month(1),a.year(parseInt(a.year())+
1);else{var b=parseInt(a.month())+1;a.validMaxDay(b);a.month(parseInt(a.month())+1)}g()}else a.showState()==1||a.showState()==3?a.year(parseInt(a.year())+1):a.showState()==2&&(a.year(parseInt(a.year())+12),l())};a.validYear=function(){h.isPlusInteger(a.year())||a.year(a.date.getFullYear())};var n=!1;a.validQuarter=function(){var b=a.quarter();cube.isEmpty(b)&&(n=!0);n&&cube.notEmpty(b)&&(b<1||b>4)?(b=b.substring(0,b.length-1),a.quarter(b),n=!1):(!h.isPlusInteger(b)||b<1||b>4)&&a.quarter(a.date.getQuarter())};
var o=!1;a.validMonth=function(){var b=a.month();cube.isEmpty(b)&&(o=!0);o&&cube.notEmpty(b)&&(b<1||b>12)?(b=b.substring(0,b.length-1),a.month(b),o=!1):(!h.isPlusInteger(b)||b<1||b>12)&&a.month(a.date.getMonth())};var p=!1;a.validDay=function(){var b=a.day(),d=a.month(),c=30;if(d==2)c=28;else if(d==1||d==3||d==5||d==7||d==8||d==10||d==12)c=31;cube.isEmpty(b)&&(p=!0);p&&cube.notEmpty(b)&&(b<1||b>c)?(b.substring(0,b.length-1),p=!1):(!h.isPlusInteger(b)||b<1||b>c)&&a.day(a.date.getDate())};var q=!1;
a.validHour=function(){var b=a.hour();cube.isEmpty(b)&&(q=!0);q&&cube.notEmpty(b)&&(b<0||b>23)?(b=b.substring(0,b.length-1),a.hour(b),q=!1):(!h.isPlusInteger(b)||b<0||b>23)&&a.hour(a.date.getHours())};var r=!1;a.validMinute=function(){var b=a.minute();cube.isEmpty(b)&&(r=!0);r&&cube.notEmpty(b)&&(b<0||b>59)?(b=b.substring(0,b.length-1),a.minute(b),r=!1):(!h.isPlusInteger(b)||b<0||b>59)&&a.minute(a.date.getMinutes())};var s=!1;a.validSecond=function(){var b=a.second();cube.isEmpty(b)&&(s=!0);s&&cube.notEmpty(b)&&
(b<0||b>59)?(b=b.substring(0,b.length-1),a.second(b),s=!1):(!h.isPlusInteger(b)||b<0||b>59)&&a.second(a.date.getSeconds())};a.validMaxDay=function(b){var d=a.day(),c=30,e=a.year();if(b==2)c=e%4==0&&e%100!=0||e%4==0&&e%100==0&&e%400==0?29:28;else if(b==1||b==3||b==5||b==7||b==8||b==10||b==12)c=31;d>c&&a.day(c)};a.onload=function(b){if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(b)};cube.endViewModel(a,k)}k.prototype.dispose=function(){this.yearSub.dispose();this.quarterSub.dispose();
this.monthSub.dispose();this.daySub.dispose();this.hourSub.dispose();this.minuteSub.dispose();this.secondSub.dispose();this.minValueSub.dispose();this.maxValueSub.dispose()};return k});define("carousel",[],function(){return function(b){function d(){var c=parseInt(a.interval());c<500&&(c=500);return c}var a=this;a.id="";a.style="";a.autoPlay=!0;a.showArrow=!0;a.showCaption=!1;a.interval=5E3;a.currentImgIndex=1;a.showImgFull=!1;a.imgItems=[];a._carousel=null;a.onCurrentImgIndexChanged=null;a.onRendered=null;a._init=function(){cube.isEmpty(a.id())&&a.id("carousel_"+cube.random().toString().split("&")[0]);a.autoPlaySub=cube.subscribe(a.autoPlay,function(c){c?(c=d(),a._carousel.carousel("cycle",
c,a)):a._carousel.carousel("pause")});a.intervalSub=cube.subscribe(a.interval,function(){if(a.autoPlay()){var c=d();a._carousel.carousel("pause");a._carousel.carousel("cycle",c,a)}});a.currentImgIndexSub=cube.subscribe(a.currentImgIndex,function(c){var b=a.imgItems().length,c=parseInt(c);isNaN(c)||c<=0?a.currentImgIndex(1):c>b?a.currentImgIndex(b):a.currentImgIndex(c)})};a.onload=function(c){a._carousel=$(c).children(":first");a.autoPlay()&&a._carousel.carousel("cycle",a.interval,a);a._carousel.on("slide.bs.carousel",
function(c){c=c.relatedTarget.getAttribute("num");if(a.onCurrentImgIndexChanged!=null&&!cube.isObservable(a.onCurrentImgIndexChanged))a.onCurrentImgIndexChanged(c)});if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(c)};cube.endViewModel(a,b)}});
(function(b){b.fn.emulateTransitionEnd=function(d){var a=!1,c=this;b(this).one(b.support.transition.end,function(){a=!0});setTimeout(function(){a||b(c).trigger(b.support.transition.end)},d);return this};b(function(){var d=b.support,a;a:{var c=document.createElement("bootstrap"),k={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},e;for(e in k)if(c.style[e]!==void 0){a={end:k[e]};break a}}d.transition=a})})(jQuery);
(function(b){var d=function(c,a){this.$element=b(c);this.$indicators=this.$element.find(".carousel-indicators");this.options=a;this.paused=this.sliding=this.interval=this.$active=this.$items=null;this.vm=a.vm;this.options.pause=="hover"&&this.$element.on("mouseenter",b.proxy(this.pause,this)).on("mouseleave",b.proxy(this.cycle,this))};d.DEFAULTS={interval:5E3,pause:"hover",wrap:!0};d.prototype.cycle=function(a){a||(this.paused=!1);this.interval&&clearInterval(this.interval);this.options.interval&&
!this.paused&&(this.interval=setInterval(b.proxy(this.next,this),this.options.interval));return this};d.prototype.getActiveIndex=function(){this.$active=this.$element.find(".item.active");this.$items=this.$active.parent().children();return this.$items.index(this.$active)};d.prototype.to=function(a){var d=this,e=this.getActiveIndex();if(!(a>this.$items.length-1||a<0)){if(this.sliding)return this.$element.one("slid.bs.carousel",function(){d.to(a)});if(e==a)return this.pause().cycle();return this.slide(a>
e?"next":"prev",b(this.$items[a]))}};d.prototype.pause=function(a){a||(this.paused=!0);this.$element.find(".next, .prev").length&&b.support.transition.end&&(this.$element.trigger(b.support.transition.end),this.cycle(!0));this.interval=clearInterval(this.interval);return this};d.prototype.next=function(){if(!this.sliding)return this.slide("next")};d.prototype.prev=function(){if(!this.sliding)return this.slide("prev")};d.prototype.slide=function(a,d){var e=this.$element.find(".item.active"),g=d||e[a](),
f=this.interval,h=a=="next"?"left":"right",i=a=="next"?"first":"last",j=this;if(!g.length){if(!this.options.wrap)return;g=this.$element.find(".item")[i]()}this.sliding=!0;f&&this.pause();i=b.Event("slide.bs.carousel",{relatedTarget:g[0],direction:h});if(!g.hasClass("active")){this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid.bs.carousel",function(){var a=b(j.$indicators.children()[j.getActiveIndex()]);a&&a.addClass("active")}));if(b.support.transition&&
this.$element.hasClass("slide")){this.$element.trigger(i);if(i.isDefaultPrevented())return;g.addClass(a);e.addClass(h);g.addClass(h);e.one(b.support.transition.end,function(){g.removeClass([a,h].join(" ")).addClass("active");e.removeClass(["active",h].join(" "));j.sliding=!1;setTimeout(function(){j.$element.trigger("slid.bs.carousel")},0)}).emulateTransitionEnd(600);var l=this.vm;setTimeout(function(){l.currentImgIndex(j.getActiveIndex()+1)},600)}else{this.$element.trigger(i);if(i.isDefaultPrevented())return;
e.removeClass("active");g.addClass("active");this.sliding=!1;this.$element.trigger("slid.bs.carousel");this.vm.currentImgIndex(j.getActiveIndex()+1)}f&&this.cycle();return this}};var a=b.fn.carousel;b.fn.carousel=function(a,k,e){return this.each(function(){var g=b(this),f=g.data("bs.carousel"),h=b.extend({},d.DEFAULTS,g.data(),typeof a=="object"&&a);h.vm=e;var i=typeof a=="string"?a:h.slide;if(k!=void 0&&f!=void 0&&f.options!=void 0)f.options.interval=k;if(e!=void 0&&f!=void 0&&f.options!=void 0)f.options.vm=
e;f||g.data("bs.carousel",f=new d(this,h));if(typeof a=="number")f.to(a);else if(i)f[i]();else h.interval&&f.pause().cycle()})};b.fn.carousel.Constructor=d;b.fn.carousel.noConflict=function(){b.fn.carousel=a;return this};b(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(a){var d=b(this),e,g=b(d.attr("data-target")||(e=d.attr("href"))&&e.replace(/.*(?=#[^\s]+$)/,""));e=b.extend({},g.data(),d.data());var f=d.attr("data-slide-to");if(f)e.interval=!1;g.carousel(e);(f=
d.attr("data-slide-to"))&&g.data("bs.carousel").to(f);a.preventDefault()});b(window).on("load",function(){b('[data-ride="carousel"]').each(function(){var a=b(this);a.carousel(a.data())})})})(jQuery);define("contextmenu",[],function(){cube.importComponent("controls.menu");return function(e){var a=this;a.isShowMenu=!1;a.popoverDirection="right";a.contextMenuItems=[];a.zIndex=1060;a.left=null;a.arrowLeft=null;a.right=null;a.top=null;a.bottom=null;a.eleId=null;a.onSelectItemChanged=null;a.onRendered=null;a.ctxItemChanged=function(b){a.isShowMenu(!1);if(a.onSelectItemChanged!=null&&!cube.isObservable(a.onSelectItemChanged))a.onSelectItemChanged(b)};a.hideContextMenu=function(){a.isShowMenu(!1)};a.mouseout=function(b,
d){for(var c=d.relatedTarget?d.relatedTarget:d.toElement;c&&c!=b;)c=c.parentNode;c!=b&&(a.hideContextMenu(),a.eleId()!=null&&$("#"+a.eleId()).remove())};a.onload=function(b){if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(b)};cube.endViewModel(a,e)}});define("cubeaudio",[],function(){return function(k){function f(a){g(a.currentTarget?a.currentTarget:a.srcElement,a)}function h(a){i(a.currentTarget?a.currentTarget:a.srcElement,a)}function g(d,b){d=$(d);if(b.pageX==null&&b.clientX!=null){var c=document.documentElement,e=document.body;b.pageX=b.clientX+(c&&c.scrollLeft||e&&e.scrollLeft||0)-(c&&c.clientLeft||e&&e.clientLeft||0)}a.audio.currentTime=Math.round(a.audio.duration*(b.pageX-d.offset().left)/d.width())}function i(d,b){d=$(d);if(b.pageY==null&&b.clientY!=
null){var c=document.documentElement,e=document.body;b.pageY=b.clientY+(c&&c.scrollTop||e&&e.scrollTop||0)-(c&&c.clientTop||e&&e.clientTop||0)}a.audio.volume=Math.abs((b.pageY-(d.offset().top+d.height()))/d.height())}function j(a){var b=Math.floor(a/3600),c=Math.floor(a%3600/60),a=Math.ceil(a%600%60);return(b==0?"":b>0&&b.toString().length<2?"0"+b+":":b+":")+(c.toString().length<2?"0"+c:c)+":"+(a.toString().length<2?"0"+a:a)}var a=this;a.width="auto";a.src=null;a.autoplay=!1;a.preload=!0;a.loop=!1;
a.muted=!1;a.volume=null;a.currentTime=null;a.audio=null;a.isplaying=!1;a.isstop=!1;a.ismuted=!1;a.volumelow=!1;a.currentTime="00.00";a.timeDuration="00.00";a.playedwidth="0";a.volumeheight="100%";a.currentTimeVisible=!0;a.timeDurationVisible=!0;a.onPlay=null;a.onPlaying=null;a.onPause=null;a.onEnded=null;a.onTimeupdate=null;a.onRendered=null;a._init=function(){a.autoplay()==!0&&a.isplaying(!0);a.muted()==!0&&a.ismuted(!0)};a.playpause=function(){a.osplaying()==!0?(a.audio.pause(),a.isplay(!1)):(a.audio.play(),
a.isplaying(!0),a.isstop(!1))};a.stop=function(){a.audio.pause();a.isplaying(!1);a.isstop(!0);a.audio.currentTime=0};a.setmuted=function(){a.audio.muted=!a.audio.muted;a.audio.muted==!0?a.ismuted(!0):a.ismuted(!1)};a.barmousedown=function(a,b){g(a,b);$(a).bind("mousemove",f)};a.barmouseup=function(a){$(a).unbind("mousemove",f)};a.volumemousedown=function(a,b){i(a,b);$(a).bind("mousemove",h)};a.volumemouseup=function(a){$(a).unbind("mousemove",h)};a.onload=function(d){a.audio=$(d).find("audio").get(0);
var b=$(d).children(":first");parseInt(b.width(),10)<180&&a.timeDurationVisible(!1);parseInt(b.width(),10)<150&&a.timeDurationVisible(!1);var b=a.volume(),c=a.currentTime();if(b!=null)a.audio.volume=b;if(c!=null)a.audio.currentTime=c;a.audio.muted=a.muted();b=$(a.audio);b.on("loadeddata",function(){a.timeDuration(j(a.audio.duration));a.volume(a.audio.volume);a.volumeheight(a.audio.volume*100+"%");a.audio.volume*100<50?a.volumelow(!0):a.volumelow(!1)});b.on("play",function(){if(a.onPlay!=null&&cube.isObservable(a.onPlay))a.onPlay()});
b.on("pause",function(){if(a.onPause!=null&&cube.isObservable(a.onPause))a.onPause()});b.on("playing",function(){if(a.onPlaying!=null&&cube.isObservable(a.onPlaying))a.onPlaying()});b.on("timeupdate",function(){a.currentTime(j(a.audio.currentTime));a.playedwidth(a.audio.currentTime/a.audio.duration*100+"%");if(a.onTimeupdate!=null&&cube.isObservable(a.onTimeupdate))a.onTimeupdate(a.audio.currentTime)});b.on("volumechange",function(){a.volumeheight(a.audio.volume*100+"%");a.audio.volume*100<50?a.volumelow(!0):
a.volumelow(!1)});b.on("ended",function(){a.isplaying(!1);a.isstop(!0);if(a.onEnded!=null&&cube.isObservable(a.onEnded))a.onEnded()});if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(d)};cube.endViewModel(a,k)}});define("cubebutton",["CheckUtil"],function(c){function d(d){var a=this;a.title="";a.width="";a.height="";a.bgcolor="";a.border="";a.text="";a.type="default";a.disabled=!1;a.visible=!0;a._width="";a._height="";a.onClick=null;a.onRendered=null;a._init=function(){c.isDigit(a.width())?a._width(a.width()+"px"):a._width(a.width());c.isDigit(a.height())?a._height(a.height()+"px"):a._height(a.height());a.widthSub=cube.subscribe(a.width,function(b){c.isDigit(b)?a._width(b+"px"):a._width(b)});a.heightSub=cube.subscribe(a.height,
function(b){c.isDigit(b)?a._height(b+"px"):a._height(b)})};a._onclick=function(){if(!a.disabled()&&a.onClick!=null&&!cube.isObservable(a.onClick))a.onClick()};a.onload=function(b){if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(b)};cube.endViewModel(a,d)}d.prototype.dispose=function(){this.widthSub.dispose();this.heightSub.dispose()};return d});define("cubelabel",["CheckUtil"],function(c){function d(d){var a=this;a.width="100px";a.height="30px";a.textAlign="center";a.bgcolor="";a.border="";a.fontSize="14px";a.fontWeight="normal";a.text="";a._width="";a._height="";a.onRendered=null;a._init=function(){c.isDigit(a.width())?a._width(a.width()+"px"):a._width(a.width());c.isDigit(a.height())?a._height(a.height()+"px"):a._height(a.height());a.widthSub=cube.subscribe(a.width,function(b){c.isDigit(b)?a._width(b+"px"):a._width(b)});a.heightSub=cube.subscribe(a.height,
function(b){c.isDigit(b)?a._height(b+"px"):a._height(b)})};a.onload=function(b){if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(b)};cube.endViewModel(a,d)}d.prototype.dispose=function(){this.widthSub.dispose();this.heightSub.dispose()};return d});define("loading",[],function(){return function(a){this.content=null;this.imgUrl=cube.cubepath("$/images/window_loading.gif");this.backgroundColor=null;this.fixed=!1;this.isShow=!0;this.zIndex=1050;cube.endViewModel(this,a)}});define("menu",[],function(){function d(d){var a=this;a.menuItems=[];a.width="100%";a.dropdownMenuHeight="auto";a.isList=!1;a.isHorizontalChildren=!1;a.onSelectItemChanged=null;a.onRendered=null;a.hoverItem=null;a._init=function(){if(!a.isList()&&a.isHorizontalChildren()){var b=a.menuItems();b!=null&&b.length>0&&typeof b[0].children!="undefined"&&b[0].children!=null&&a.hoverItem(b[0])}if(a.isList())for(var b=a.menuItems(),c=0;c<b.length;c++)if(typeof b[c].expanded=="undefined")b[c].expanded=cube.obj(!1);
else if(!cube.isObservable(b[c].expanded))b[c].expanded=cube.obj(b[c].expanded)};a.openSubItems=function(){(!a.isList()||a.isList()&&a.isHorizontalChildren())&&a.hoverItem(this)};a.closeSubItems=function(){(!a.isList()&&!a.isHorizontalChildren()||a.isList()&&a.isHorizontalChildren())&&a.hoverItem(null)};a.selectMenuItem=function(){if(a.onSelectItemChanged!=null&&!cube.isObservable(a.onSelectItemChanged))a.onSelectItemChanged(this);a.isList()&&typeof this.expanded=="function"&&(this.expanded()?this.expanded(!1):
this.expanded(!0))};a.onload=function(b){if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(b)};cube.endViewModel(a,d)}cube.importComponent("navigation.submenutmpl");d.prototype.dispose=function(){};return d});define("navbar",["CheckUtil"],function(g){function e(e){var a=this;a.navLogo="";a.navTitle="";a.bgcolor="";a.navWidth=null;a.activeBgColor="";a.fontColor="";a.height="40px";a.items=[];a.operations=[];a.iconAlign="left";a.isShowSearchbox=!1;a.isSearchboxRight=!1;a.isShowDividerVertical=!1;a.isMenuWrap=!1;a.selectedRoute=null;a.isFixTop=!1;a.isInverse=!1;a.isHrefRoute=!0;a.isShowChildren=!1;a._showBtn=!1;a._showBtnTop="20px";a.$scrollDiv=null;a._children=null;a._menuHeight=null;a.$node=null;a.$childrenDialog=
null;a.$navsHeader=null;a.onSelectedChanged=null;a.onSearchBtnClick=null;a.onRendered=null;a.selectedItem=cube.comp(function(){var c=null;$.each(a.items(),function(){this.hasChildren==!0&&$.each(this.children,function(){a.selectedRoute()==this.route&&(c=this)});if(c!=null)return c;c==null&&a.selectedRoute()==this.route&&(c=this)});return c},a);a.hoverItem=cube.obj();a._init=function(){a.selectedRouteSub=cube.subscribe(a.selectedRoute,function(c){if(a.onSelectedChanged!=null&&!cube.isObservable(a.onSelectedChanged)){var b=
a.selectedItem();b==null&&(b=c);a.onSelectedChanged(b)}if(a.isHrefRoute())window.location.hash=c});a.items()&&a.items().length>0&&a.selectedRoute(a.items()[0].route);a._showBtnTop(parseInt(a.height().replace("px","")/2)+"px")};a.setSelectRoute=function(){cube.notEmpty(this.route)&&a.selectedRoute(this.route);cube.isFunction(this.click)&&!cube.isObservable(this.click)&&this.click();a.closeChildrenDialog()};a.openSubItems=function(c,b){var d=a.$childrenDialog[0],e=null,h=a.$scrollDiv.children("ul").position().left,
f=a.$node.children(".cubenavbar")[0].offsetTop,i=a.$navsHeader.position().left,j=c.offsetLeft;g.isDigit(a.height())||(e=parseInt(a.height().replace("px","")));a.hoverItem(this);if(b.hasChildren&&!a.isShowChildren())a.isShowChildren(!0),d.style.left=i+h+j+15+"px",d.style.top=f+e+"px",a._menuHeight(f+e+"px"),a._children(b.children)};a.closeSubItems=function(){a.hoverItem(null);a.isShowChildren(!1)};a.openChildrenDialog=function(){a.isShowChildren(!0)};a.closeChildrenDialog=function(){a.isShowChildren(!1)};
a.prev=function(a){var a=$(a).siblings(".scrollborder").children(".scroll").children("ul"),b=a.position().left;a.stop(!0,!0);b>=0||(b=parseInt(b)+100,b>0&&(b=0),a.animate({left:b}))};a.next=function(a){var b=$(a).siblings(".scrollborder"),a=b.children(".scroll").children("ul"),b=parseInt(b.width())-parseInt(a.width()),d=a.position().left;a.stop(!0,!0);d<=b||(d=parseInt(d)-100,d<=b&&(d=b),a.animate({left:d}))};a.itemsChange=function(){a.$scrollDiv!=null&&!cube.isObservable(a.$scrollDiv)&&setTimeout(function(){var c=
a.$scrollDiv.width();a.$scrollDiv.children("ul").width()>=c?a._showBtn(!0):a._showBtn(!1)},300)};a._onSearchBtnClick=function(c){a.onSearchBtnClick!=null&&!cube.isObservable(a.onSearchBtnClick)&&(c=$(c).siblings(".search-query"),a.onSearchBtnClick(c.val()))};a.onload=function(c){var b=$(c);a.$node=b;a.$childrenDialog=b.children(".cubenavbar").children(".dropdown-menu");a.$navsHeader=b.children(".cubenavbar").children(".navbar-inner").children(".navsheader");a.$scrollDiv=b.children(".cubenavbar").children(".navbar-inner").children(".navsheader").children(".scrollborder").children(".scroll");
if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(c);a.itemsChange()};cube.endViewModel(a,e)}e.prototype.dispose=function(){this.selectedItem.dispose();this.selectedRouteSub.dispose()};return e});define("progressbar",[],function(){return function(c){var a=this;a.style="";a.progressValue=0;a.warningValue=1;a.dangerValue=1;a.onProgressChanged=null;a.onRendered=null;a._init=function(){cube.subscribe(a.progressValue,function(b){if(a.onProgressChanged!=null&&!cube.isObservable(a.onProgressChanged))a.onProgressChanged(b)})};a.progressItems=cube.comp(function(){var b=[];a.progressValue()<a.warningValue()?(b.push(a.progressValue()),b.push(0),b.push(0)):a.progressValue()>a.dangerValue()?(b.push(a.warningValue()),
b.push(a.dangerValue()-a.warningValue()),b.push(a.progressValue()-a.dangerValue())):(b.push(a.warningValue()),b.push(a.progressValue()-a.warningValue()),b.push(0));return b},a);a.onload=function(b){if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(b)};cube.endViewModel(a,c)}});define("switch",["CheckUtil"],function(c){function d(d){var a=this;a.width="48px";a.height="24px";a.border="";a.bgcolor="";a.trueText="";a.falseText="";a.value=!1;a.disabled=!1;a._width="";a._type="";a._height="";a._sliph="";a._textleft="";a._bgcolor="";a._slipbg="";a._value=!1;a._text="";a.onClick=null;a.onRendered=null;a._init=function(){c.isDigit(a.width())?a._width(a.width()+"px"):a._width(a.width());c.isDigit(a.height())?(a._height(a.height()+"px"),a._sliph(a.height()-4+"px"),a._textleft(a.height()+4+
"px")):(a._height(a.height()),a._sliph(parseInt(a.height().replace("px","")-4)+"px"),a._textleft(parseInt(a.height().replace("px",""))+4+"px"));a.widthSub=cube.subscribe(a.width,function(b){c.isDigit(b)?a._width(b+"px"):a._width(b)});a.heightSub=cube.subscribe(a.height,function(b){c.isDigit(b)?a._height(b+"px"):a._height(b)});a._value(a.value());a.value()?(a.value=!1,a._text(a.trueText()),a._bgcolor(a.bgcolor()),a._type("switch-checked"),c.isDigit(a.height())?a._textleft(parseInt(a.height()/3)+"px"):
a._textleft(parseInt(a.height().replace("px","")/3)+"px")):(a.value=!0,a._text(a.falseText()),a._bgcolor("#ccc"),a._type(""),c.isDigit(a.height())?a._textleft(parseInt(a.height()*7/6)+"px"):a._textleft(parseInt(parseInt(a.height().replace("px",""))*7/6)+"px"));a.disabled()&&(a._bgcolor("#f3f3f3"),a._slipbg("#ccc"),a._text(""))};a._onclick=function(){if(!a.disabled()&&a.onClick!=null&&!cube.isObservable(a.onClick))a.onClick(a.value),a.value?(a.value=!1,a._text(a.trueText()),a._bgcolor(a.bgcolor()),
a._type("switch-checked"),a._value(!a.value),c.isDigit(a.height())?a._textleft(parseInt(a.height()/3)+"px"):a._textleft(parseInt(a.height().replace("px","")/3)+"px")):(a.value=!0,a._text(a.falseText()),a._bgcolor("#ccc"),a._type(""),a._value(!a.value),c.isDigit(a.height())?a._textleft(parseInt(a.height()*7/6)+"px"):a._textleft(parseInt(parseInt(a.height().replace("px",""))*7/6)+"px"))};a.onload=function(b){if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(b)};cube.endViewModel(a,
d)}d.prototype.dispose=function(){this.widthSub.dispose();this.heightSub.dispose()};return d});define("titlebar",[],function(){function b(b){var a=this;a.width="400px";a.height="40px";a.bgcolor="#fff";a.icon=null;a.type="default";a.marginBottom="2px";a.visible=!0;a.title="";a.customBtns=[];a.customClick=function(b){cube.notEmpty(b.click)&&typeof b.click=="function"&&b.click(a)};cube.endViewModel(a,b)}b.prototype.dispose=function(){};return b});define("toolbar",[],function(){cube.importComponent("navigation.submenutmpl");return function(c){function b(){$.each(a.toolbarContent(),function(){if(this.onItemClick==void 0&&!cube.isObservable(a.onItemClick))this.onItemClick=function(){if(cube.isEmpty(this.enable)||(cube.isObservable(this.enable)?this.enable():this.enable))a.onItemClick(this.func)}})}var a=this;a.toolbarContent=[];a.showtext=!1;a.isShowBackground=!0;a.onItemClick=null;a.onSelectItemChanged=null;a.onRendered=null;a.hoverItem=null;a._init=
function(){b();cube.subscribe(a.toolbarContent,b)};a.openSubItems=function(){a.hoverItem(this)};a.closeSubItems=function(){a.hoverItem(null)};a.selectMenuItem=function(){if(a.onSelectItemChanged!=null&&!cube.isObservable(a.onSelectItemChanged))a.onSelectItemChanged(this)};a.onload=function(b){if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(b)};cube.endViewModel(a,c)}});define("chart",["echarts"],function(d){function c(c){var a=this;a.title={};a.width="auto";a.height="400px";a.tooltip={};a.legend={};a.grid={};a.toolbox={};a.xAxis=null;a.yAxis=null;a.series=[];a._width="";a._height="";a.option={};a.chart=null;a.onRendered=null;a._init=function(){a.width()&&a._width(a.width());a.height()&&a._height(a.height());a.widthSub=cube.subscribe(a.width,function(b){a._width(b)});a.heightSub=cube.subscribe(a.height,function(b){a._height(b)});a.titleSub=cube.subscribe(a.title,function(){a.setOption({title:a.title()})});
a.tooltipSub=cube.subscribe(a.tooltip,function(){a.setOption({tooltip:a.tooltip()})});a.legendSub=cube.subscribe(a.legend,function(){a.setOption({legend:a.legend()})});a.gridSub=cube.subscribe(a.grid,function(){a.setOption({grid:a.grid()})});a.toolboxSub=cube.subscribe(a.toolbox,function(){a.setOption({toolbox:a.toolbox()})});a.xAxisSub=cube.subscribe(a.xAxis,function(){a.setOption({xAxis:a.xAxis()})});a.yAxisSub=cube.subscribe(a.yAxis,function(){a.setOption({yAxis:a.yAxis()})});a.seriesSub=cube.subscribe(a.series,
function(){a.setOption({series:a.series()})});a.optionSub=cube.subscribe(a.option,function(){a.setOption(a.option())})};a.setOption=function(b){var c=a.chart.getOption();$.extend(c,b);a.chart.setOption(c)};a.onload=function(b){$.isEmptyObject(this.option())?(a.chart=d.init($(b).children(":first").get(0)),a.chart.setOption({title:a.title(),tooltip:a.tooltip(),legend:a.legend(),grid:a.grid(),toolbox:a.toolbox(),xAxis:a.xAxis(),yAxis:a.yAxis(),series:a.series()})):(a.chart=d.init($(b).children(":first").get(0)),
a.chart.setOption(a.option()));if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(b)};cube.endViewModel(a,c)}c.prototype.dispose=function(){this.widthSub.dispose();this.heightSub.dispose();this.titleSub.dispose();this.tooltipSub.dispose();this.legendSub.dispose();this.gridSub.dispose();this.toolboxSub.dispose();this.xAxisSub.dispose();this.yAxisSub.dispose();this.seriesSub.dispose();this.optionSub.dispose()};return c});define("dataform",["entityContainer","JSONUtil","PrintUtil","FileUploader","Validator"],function(y,m,z,s,t){function n(n){function A(a){var d=a.columns,c={},c=cube.isEmpty(a.items)?{}:cube.isArray(a.items)?a.items[0]:a.items;cube.isEmpty(c)&&(c={});p=0;b.fields([]);b.dicts(a.dicts);_fieldCells=[];B(d,c,a.dicts);if(b.isCustomTemplate()==!0&&u==!0)b.onload(l);b.isShowLoading(!1);if(b.onLoad!=null&&!cube.isObservable(b.onLoad))b.onLoad(b.data)}function C(a){b.isShowLoading(!1);if(b.onLoadError!=null&&!cube.isObservable(b.onLoadError))b.onLoadError(a)}
function B(a,d,c){var e=cube.clone(o);if(cube.isEmpty(a)||a.length<=0){if(a=m.getItem(e,"name",f.primaryKey,3),cube.notEmpty(a))a.readOnly=!0,a.nullable=cube.obj(!1),a.visible=b.displayPrimaryKey()}else $.each(a,function(a,b){if(cube.isArray(b))for(var f=0;f<b.length;f++)!cube.notEmpty(b[f].isGroupInfo)&&!cube.notEmpty(b[f].isLine)&&v(b[f],e,c,d);else cube.isEmpty(b.isGroupInfo)&&cube.isEmpty(b.isLine)&&v(b,e,c,d)});b.data=d!=null?d:{};b.fields(e);q=cube.clone(b.data)}function v(a,b,c,e){var f=D(a.name,
b);if(cube.notEmpty(f)){for(i in a)i=="length"&&delete a[i];$.each(a,function(a,b){if(cube.isEmpty(f[a])||cube.isEqual(a,"readOnly")||cube.isEqual(a,"maxLength")||cube.isEqual(a,"nullable"))f[a]=b});w(f,c,e)}else f=a,f.validStatus=cube.obj(""),f.validHint=cube.obj(""),w(f,c,e),b.push(f)}function w(a,d,c){cube.isEqual(a.name,f.primaryKey)?(a.readOnly=!0,a.nullable=cube.obj(!1),a.visible=b.displayPrimaryKey()):typeof a.value!="undefined"&&typeof c[a.name]=="undefined"&&f.setValue(c,a.name,cube.isObservable(a.value)?
a.value():a.value,!0);if(a.editorType=="DropDownEditor"||a.editorType=="CheckListEditor"||a.editorType=="ListEditor"||a.editorType=="LabelEditor"){if(d&&d[a.name])cube.isObservable(a.list)?a.list(d[a.name]):a.list=d[a.name]}else if(a.editorType=="FileEditor")if(a.pkVal&&cube.isObservable(a.pkVal))cube.isEmpty(a.pkVal())&&a.pkVal(f.data[f.primaryKey]);else if(cube.isEmpty(a.pkVal))a.pkVal=cube.obj(f.data[f.primaryKey]);if(cube.isEmpty(a.nullable))a.nullable=cube.obj(!0);else if(!cube.isObservable(a.nullable))a.nullable=
cube.obj(a.nullable);typeof a.validStatus=="undefined"?a.validStatus=cube.obj(""):cube.isObservable(a.validStatus)?a.validStatus(""):a.validStatus=cube.obj(a.validStatus);if(cube.notEmpty(a.visible)&&!cube.isObservable(a.visible))a.visible=cube.obj(a.visible);if(cube.notEmpty(a.readOnly)&&!cube.isObservable(a.readOnly))a.readOnly=cube.obj(a.readOnly);return b.editors[a.name]=a}function D(a,b){var c=null,e=o;typeof b!=null&&(e=b);cube.notEmpty(a)&&cube.isArray(e)&&e.length>0&&(c=m.getItem(e,"name",
a),cube.isEmpty(c)&&(c=m.getItem(e,"name",a,3)));return c}function x(a,d,c,e){if(cube.isEmpty(a))c[e]={columns:d};else if(cube.isEmpty(a.columns))a.columns=d;else if(cube.isString(a.columns)){for(var d=d.split(","),c=a.columns.split(","),e=d.length,f=0;f<e;f++)c.indexOf(d[f])==-1&&c.push(d[f]);a.columns=c.join(",");d.length=0;c.length=0}else b.showError("ERR_UNSUPPORTED_FORMAT",[a.columns])}function E(a){if(b.isRefreshPk())for(var d=b.fields(),c=0;c<d.length;c++)if(cube.isArray(d[c]))for(var e=0;e<
d[c].length;e++){if(d[c][e].editorType=="FileEditor"&&cube.isArray(a.result)&&a.result.length>0&&d[c][c].type!="path"){var j=a.result,h=f.primaryKey,k=d[c][e],g=new s;g.url=k.url;g.refreshPk(j,h,k)}}else if(!cube.isString(d[c])&&cube.isEmpty(d[c].isGroupInfo)&&cube.isEmpty(d[c].isLine)&&d[c].editorType=="FileEditor"&&cube.isArray(a.result)&&a.result.length>0&&d[c].type!="path")e=a.result,j=f.primaryKey,h=d[c],k=new s,k.url=h.url,k.refreshPk(e,j,h);if(b.onSaved!=null&&!cube.isObservable(b.onSaved))b.onSaved(a)}
var b=this,f=new y;b.url="";b.actions={};b.timeout=null;b.customHeaders=null;b.loadByPost=!1;b.primaryKey="id";b.loadMeta=!0;b.displayPrimaryKey=!1;b.displaySubmitButton=!0;b.displaySaveButton=!1;b.displayResetButton=!1;b.buttonAlign=null;b.id=null;b.param=null;b.cols=1;b.style="";b.fields=[];b.editors=null;b.data=null;b.dicts=null;b.isEditState=!0;b.isShowPopDialog=!1;b.validHintType="inline";b.separator="";b.isCustomTemplate=!1;b.isSaveAll=!1;b.customBtns=[];b.isShowLoading=!1;b.isRefreshPk=!0;
b.onSubmit=null;b.onSaved=null;b.onLoad=null;b.onLoadError=null;var o=b.onRendered=null,q=null,u=!1,l=null,p=0;b._init=function(){b.editors={};var a=b.data()||{};$.each(b.fields(),function(d,c){if(cube.isArray(c))for(var e=0;e<c.length;e++)b._initField(c[e],a);else!cube.isString(c)&&cube.isEmpty(c.isGroupInfo)&&cube.isEmpty(c.isLine)&&b._initField(c,a)});b.data(a);o=cube.clone(b.fields());q=cube.clone(a);f.primaryKey=b.primaryKey();f.baseUrl=b.url();f.actions=b.actions();f.meta=o;f.type="form";f.loadMeta=
b.loadMeta();f.timeout=b.timeout();f.onload=A;f.onsaved=E;f.onerror=C;f.data=b.data();f.dicts=b.dicts();f.customHeaders=b.customHeaders();f.loadByPost=b.loadByPost();f.init();b.actionsSub=cube.subscribe(b.actions,function(a){f.actions=a});b.idSub=cube.subscribe(b.id,function(){b.load(b.id(),b.param())});if(cube.isEmpty(b.url()))b.dataSub=cube.subscribe(b.data,function(a){f.data=a;b.load(b.id(),b.param())});b.load(b.id(),b.param())};b._initField=function(a,d){if(!cube.notEmpty(a.isLine))if(cube.notEmpty(a.isGroupInfo))if(typeof a.expanded==
"undefined")a.expanded=cube.obj(!0);else{if(!cube.isObservable(a.expanded))a.expanded=cube.obj(a.expanded)}else{if(typeof a.validStatus=="undefined")a.validStatus=cube.obj("");else if(!cube.isObservable(a.validStatus))a.validStatus=cube.obj(a.validStatus);if(typeof a.validHint=="undefined")a.validHint=cube.obj("");else if(!cube.isObservable(a.validHint))a.validHint=cube.obj(a.validHint);if(a.name==b.primaryKey())a.visible=b.displayPrimaryKey();if(!a.editorType)a.editorType="TextEditor";if(a.editorType==
"DropDownEditor"||a.editorType=="CheckListEditor"||a.editorType=="ListEditor"||a.editorType=="LabelEditor")if(a.list){if(!cube.isObservable(a.list))a.list=cube.array(a.list)}else a.list=cube.array([]);else if(a.editorType=="FileEditor")if(a.pkVal){if(!cube.isObservable(a.pkVal))a.pkVal=cube.obj(a.pkVal)}else a.pkVal=cube.obj(null);if(cube.isEmpty(a.nullable))a.nullable=cube.obj(!0);else if(!cube.isObservable(a.nullable))a.nullable=cube.obj(a.nullable);if(typeof a.value!="undefined"&&typeof d[a.name]==
"undefined")d[a.name]=a.value;b.editors[a.name]=a}};b.submitForm=function(a){arguments.length==1&&cube.isBoolean(a)||(a=b.isSaveAll());if(b.validate()){if(b.onSubmit!=null&&!cube.isObservable(b.onSubmit)){var d={cancel:!1,data:cube.isObservable(b.data)?b.data():b.data};b.onSubmit(d);if(d.cancel)return!1}f.save(a)}else return!1;return!0};b.reset=function(){f.data=cube.clone(q);f.clearChanges();b.load(b.id(),b.param());if(b.onReset!=null&&!cube.isObservable(b.onReset))b.onReset()};b.submitFiles=function(){for(var a=
b.fields(),d=null,c=0;c<a.length;c++)if(cube.isArray(a[c]))for(var e=0;e<a[c].length;e++)a[c][e].editorType=="FileEditor"&&(d=cube.getPageViewModelByNode($(l).find("#"+a[c][e].name)))&&d.uploadFiles&&d.uploadFiles();else!cube.isString(a[c])&&cube.isEmpty(a[c].isGroupInfo)&&cube.isEmpty(a[c].isLine)&&a[c].editorType=="FileEditor"&&(d=cube.getPageViewModelByNode($(l).find("#"+a[c].name)))&&d.uploadFiles&&d.uploadFiles()};b.setActions=function(a){b.actions(cube.isObservable(a)?a():a);f.actions=a};b.load=
function(a,d){b.isShowLoading(!0);var c=null,e=null;if(cube.isEmpty(a)||cube.isString(a)||cube.isNumber(a)){if(c=a,cube.isEmpty(d)||$.isPlainObject(d))e=d}else $.isPlainObject(a)&&(e=a);var j;j=b.fields();if(r==null){var h=[];if(cube.notEmpty(j))for(var k=0;k<j.length;k++){var g=j[k];if(cube.isArray(g))for(var l=0;l<g.length;l++)$.isPlainObject(g[l])&&h.push(g[l].name);else $.isPlainObject(g)&&h.push(g.name)}r=h}j=r;j=j.length>0?j.join(","):null;if(cube.notEmpty(e)&&cube.isEmpty(e.dataParams)&&cube.isEmpty(e.metaParams))h=
{},h.dataParams=e,e=h;cube.notEmpty(j)&&cube.isString(j)&&(cube.isEmpty(e)?e={metaParams:{columns:j},dataParams:{columns:j}}:(x(e.metaParams,j,e,"metaParams"),x(e.dataParams,j,e,"dataParams")));f.load(c,e)};b.print=function(){z.print(b.data,b.fields,b.dicts,"dataform")};var r=null;b.validate=function(){for(var a=b.fields(),d=null,d=null,c=0;c<a.length;c++)if(cube.isArray(a[c]))for(var e=0;e<a[c].length;e++){if(!cube.notEmpty(a[c][e].isGroupInfo)&&!cube.notEmpty(a[c][e].isLine)&&(d=cube.isObservable(a[c][e].visible)?
a[c][e].visible():a[c][e].visible,cube.isEmpty(d)||d==!0))if(d=b.valid(a[c][e]),d.validStatus()!="")return!1}else if(!cube.isString(a[c])&&cube.isEmpty(a[c].isGroupInfo)&&cube.isEmpty(a[c].isLine)&&(d=cube.isObservable(a[c].visible)?a[c].visible():a[c].visible,cube.isEmpty(d)||d==!0))if(d=b.valid(a[c]),d.validStatus()!="")return!1;return!0};b.valid=function(a){if((cube.isObservable(a.visible)?a.visible():a.visible)===!1)return a.validStatus(""),a.validHint(""),b.isShowPopDialog(!1),a;if(cube.notEmpty(a.validStatus()))return a;
var d=f.data[a.name];cube.isObservable(d)&&(d=d());if(a.editorType=="NumberEditor"){var c=t.validate(d,"DIGIT",null);c.successful||(d="")}var e;a.customValidate!=null&&cube.isFunction(a.customValidate)&&!cube.isObservable(a.customValidate)&&(e=a.customValidate(d));var j=b.validHintType();cube.notEmpty(a.validHintType)&&(j=cube.isObservable(a.validHintType)?a.validHintType():a.validHintType);if(e===!1||$.isPlainObject(e)&&e.successful===!1)return a.validStatus("error"),$.isPlainObject(e)&&e.hint&&
(j=="pop"?(b.isShowPopDialog(!1),b.isShowPopDialog(!0),cube.showPopDialog($(l).find("#"+a.name),{content:e.hint,popoverDirection:"bottom",msgType:"error",isShowDialog:b.isShowPopDialog})):a.validHint(e.hint)),a;c=a.validType;e=cube.isObservable(a.nullable)?a.nullable():a.nullable;typeof e!="undefined"&&e===!1&&(c==null?c="NOTNULL":c.indexOf("NOTNULL")==-1&&(c+=", NOTNULL"));if((cube.isEmpty(c)||c.indexOf("NOTNULL")==-1)&&cube.isEmpty(d))return a;c!=null&&(c=t.validate(d,c,a.validOptions),c.successful?
(a.validStatus(""),a.validHint(""),b.isShowPopDialog(!1)):(a.validStatus("error"),j=="pop"?(b.isShowPopDialog(!1),b.isShowPopDialog(!0),cube.showPopDialog($(l).find("#"+a.name),{content:c.hint,popoverDirection:"bottom",msgType:"error",isShowDialog:b.isShowPopDialog})):a.validHint(c.hint)));return a};b._editor_changed=function(a,d){f!=null&&cube.notEmpty(f.data[b.primaryKey()])&&f.setValue(f.data,a,d,!0);var c=m.getItem(b.fields(),"name",a,3);if(cube.notEmpty(c)&&typeof c.onChanged=="function")c.onChanged(d)};
b._editor_upload=function(a,d){if(f!=null&&cube.notEmpty(f.data[b.primaryKey()])&&(f.setValue(f.data,a,d,!0),b.editors!=null&&(!cube.isEmpty(f.data[a])||!cube.isEmpty(d)))){var c=b.editors[a];c&&(c.validStatus(""),b.valid(b.editors[a]))}};b.customBtnClick=function(a,d){var c=!0;cube.notEmpty(d)&&d==!0&&(c=b.validate());cube.isFunction(a)&&c&&a()};b.expandGroup=function(a){a[0].expanded(!a[0].expanded())};b.getEditorParam=function(a){var d=cube.clone(a),c=cube.isObservable(b.data)?b.data():b.data;
cube.isObservable(d.value)?(c=c[a.name],d.value(cube.isObservable(c)?c._latestValue:c)):d.value=c[a.name];d.readOnly=b.isEditState()?typeof a.readOnly!="undefined"?a.readOnly:!1:!0;if(cube.isEmpty(d.validHintType))d.validHintType=b.validHintType;d.isShowPopDialog=b.isShowPopDialog;d.onChanged=b._editor_changed;d.onRendered=b.editorRendered;if(a.editorType=="FileEditor")d.onChanged=b._editor_upload;if(a.editorType=="DateTimeEditor"||a.editorType=="RichEditor")d.width=typeof a.width!="undefined"?a.width:
b.cols()>1?null:"85%";else if(a.editorType!="DateTimeEditor"&&a.editorType!="FileEditor"&&a.editorType!="RichEditor")d.width=typeof a.width!="undefined"?a.width:b.cols()>1?null:a.editorType=="DropDownEditor"||a.editorType=="DropDownTreeEditor"?"auto":"85%";return d};b.renderEditor=function(a,d){var c=a.renderEditor(d);b.triggerRendered();return c};b.editorRendered=function(a,d){if(cube.notEmpty(d)&&cube.isFunction(d.onRendered))d.onRendered(a,d);b.triggerRendered()};b.triggerRendered=function(){p++;
if(p==b.fields().length&&b.onRendered!=null&&!cube.isObservable(b.onRendered))b.onRendered(l,this)};b.onload=function(a,d){u=!0;l=a;if(b.isCustomTemplate()==!0)for(var c=$(a).find("*[option]"),e={},f=0;f<c.length;f++){var h=$(c[f]);cube.cleanNode(h);var k=h.attr("option"),g=k.substring(0,k.lastIndexOf(".")),e=k.substring(k.lastIndexOf(".")+1),g=b.editors[g],d={editors:b.editors},k="visible: typeof(editors['"+g.name+"'].visible) != 'undefined' ? editors['"+g.name+"'].visible : true";if(e=="editor"){var e=
b.getEditorParam(g),m="commoneditor";if(g.editorType=="DateTimeEditor"||g.editorType=="FileEditor"||g.editorType=="RichEditor")m=g.editorType.toLowerCase();e={component:{name:m,params:e}};h.attr("data-bind",k+" , attr: {id:'"+g.name+"', 'class' : 'form-inline control-group form-custom ' + editors['"+g.name+"'].validStatus()+' "+g.name+(h.is("span")?" editor-option":"")+"',title:editors['"+g.name+"'].validHint()}");cube.bindComponentByNode(h,e)}else e=="validHint"?h.attr("data-bind","css:'text-error', text: editors['"+
g.name+"'].validHint()"):e=="visible"?h.attr("data-bind",k):h.attr("data-bind","text: '"+g[e]+"', "+k);cube.bindTemlate(h,d);h.is("span")&&h.addClass("editor-option")}};cube.endViewModel(b,n)}cube.importComponent("editor.commoneditor");cube.importComponent("editor.datetimeeditor");cube.importComponent("editor.dropdowneditor");cube.importComponent("editor.dropdowntreeeditor");cube.importComponent("editor.fileeditor");cube.importComponent("datacontainer.datagrid");cube.importComponent("controls.loading");
n.prototype.dispose=function(){this.isShowPopDialog(!1);this.idSub.dispose();this.actionsSub.dispose();this.dataSub!=null&&this.dataSub.dispose()};return n});define("datagrid",["entityContainer","JSONUtil","PrintUtil","Validator","CheckUtil","ExcelUtil","PinyinUtil"],function(C,s,D,E,F,l,t){function o(o){function u(a,b){if(cube.isArray(a)&&!cube.isEmpty(b))if(b.columns!=void 0&&cube.isArray(b.columns))for(var d=0;d<b.columns.length;d++)u(a,b.columns[d]);else a.push(b.name)}function G(c){cube.notEmpty(a.url())&&cube.notEmpty(a._columns)&&a._columns.length==0&&a.columns(c.columns);a.initColumn(c);if(a.searchBoxId()){var b=cube.getPageViewModelByNode($("#"+a.searchBoxId()));
b&&(_params=cube.isObservable(b._params)?b._params():b._params,!_params&&c.dicts&&c.dicts.length>0&&b.setDicts(c.dicts))}a.dicts(c.dicts);a._dictsKeyValue(c.dictsKeyValue);cube.notEmpty(c.items)&&!(c.items.length==1&&c.items[0]==null)?a.items(c.items):a.items([]);a.itemCount(c.itemCount);a._pageCount(parseInt((c.itemCount+parseInt(a.pageSize())-1)/parseInt(a.pageSize())));a.itemsChange();a.isAllowAppend()&&v();a.itemsSub=cube.subscribe(a.items,function(){a.itemsChange()});c=a.selectedIds();c.length>
0&&a._selectedIds(c);a.isShowLoading(!1);c=(new Date).getTime()-w;a.loadTime(c>1E3?c/1E3+"s":c+"ms");if(a.onLoaded!=null&&!cube.isObservable(a.onLoaded))a.onLoaded(a.items())}function H(c){a.isShowLoading(!1);if(a.onLoadError!=null&&!cube.isObservable(a.onLoadError))a.onLoadError(c)}function v(){var c=cube.clone(a._columns),b=a.dicts(),d={},e={};c&&c.length>0&&$.each(c,function(){typeof this.value!="undefined"?cube.isObservable(this.value)?(d[this.name]=this.value,e[this.name]=this.value()):(d[this.name]=
cube.obj(this.value),e[this.name]=this.value):(d[this.name]=cube.obj(null),e[this.name]=null);if(!this.editorType)this.editorType="TextEditor";if(this.editorType=="DropDownEditor"||this.editorType=="CheckListEditor"||this.editorType=="ListEditor"||this.editorType=="LabelEditor")if(typeof this.list=="undefined")this.list=b&&b[this.name]?b[this.name]:cube.array();else if(!cube.isObservable(this.list))this.list=cube.isArray(this.list)?cube.array(this.list):cube.obj(this.list);this.validStatus=cube.obj("");
this.validHint=cube.obj("")});a._appendedItem=d;a._appendedItemObj=e;a.appendColumns(c)}function m(a,b){if(a==null)return"";if(typeof b=="undefined")return a+"";if(typeof b=="number")return a+"";var d=a+"";if(b!=null&&b!=""){var d=d.split("."),e=b.split(".");d[0].length<e[0].length&&(d[0]=e[0].substring(0,e[0].length-d[0].length)+d[0]);if(e.length==1)return d[0];else{if(d.length>1)for(;d[1].length<e[1].length;)d[1]+="0";else d[1]=e[1];return(new Number(d[0]+"."+d[1])).toFixed(e[1].length)}}else return d}
var a=this,j=new C;a.url="";a.style="";a.height="auto";a.maxHeight="auto";a.rowNumberWidth="40px";a.operationsColumnWidth="40px";a.operationsColumnAlign="left";a.items=[];a.columns=[];a.subUrl="";a.subColumns=null;a.customOperations=[];a.columnDefaultWidth="auto";a.markColumn=null;a.trBackground=null;a.checkboxHideCondition=null;a._columns=[];a.appendColumns=null;a.actions={};a.customHeaders=null;a.loadByPost=!1;a.timeout=null;a.pageSize=20;a.pageIndex=1;a.itemCount=0;a.pageInfoToLeft=!1;a.isShowBtnText=
!1;a.firstIcon="";a.previousIcon="";a.nextIcon="";a.endIcon="";a.isShowLoadTime=!1;a.loadTimeFadeout=0;a.blurGoto=!1;a.isShowEditBtnText=!1;a.pageVisibleCount=5;a._pageCount=0;a.primaryKey="id";a.loadMeta=!0;a.selectedIds=[];a._selectedIds=[];a._selectedItems=[];a._selectedAll=!1;a._selectedItem=null;a._editedItem=null;a._editedItemObj=null;a._editedItemIndex=null;a._appendedItem={};a._appendedItemObj={};a._isEdited=!1;a.isAllEdited=!1;a.isShowPrimaryKey=!1;a.isShowRowNumber=!0;a.rowNumberColumnName=
null;a.isRowNumberSerial=!1;a.isShowCheckBox=!1;a.isRadio=!1;a.isShowBorder=!0;a.isShowStripe=!1;a.isShowHover=!1;a.isShowCondense=!1;a.isAllowOperations=!1;a.isAllowAdjustColumn=!0;a.isShowSave=!0;a.isShowAdd=!0;a.isAllowEdit=!1;a.isAllowDelete=!1;a.isAllowShift=!1;a.isAllowAppend=!1;a.isAllowSort=!0;a.isAllowPaging=!0;a.isAllowAutowrap=!1;a.isShowTips=!0;a.args=null;a.searchBoxId=null;a.autoLoad=!0;a.autoSave=!0;a.autoDelete=!0;a.refreshDeleted=!0;a.dicts=null;a.watermarkOptions=null;a._watermarkOptionsDefaultValue=
{text:"",x:40,y:40,xSpace:150,ySpace:60,color:"#278874",alpha:0.2,fontSize:"16px",width:100,height:20,rotate:25};a.watermarkRows=[];a.watermarkCols=[];a.scriptProcessing="escape";a._dictsKeyValue=null;a._bodyHeight="auto";a._bodyMaxHeight="auto";a._headerOperationsColumnWidth=null;a._hasVScroll=!1;a.isShowTempColumn=!1;a.isShowLoading=!1;a._indexNotLoad=!1;a.$tableBody=null;a.$node=null;a.$tableHeader=null;a.showCellPopDialog=cube.obj(!1);a._editorValid=[];a.subGridId=null;a.loadTime=0;a.onSelectedItem=
null;a.onSelectedIds=null;a.onSelectedItems=null;a.onDblClick=null;a.onSaving=null;a.onSaved=null;a.onItemSaving=null;a.onItemSaved=null;a.onItemEditing=null;a.onItemDeleting=null;a.onItemDeleted=null;a.onLoaded=null;a.onLoadError=null;var x=a.onRendered=null,w=0;a._init=function(){a._appendedItem={};var c=a.height(),b=a.maxHeight();c!="auto"&&c!=null&&c.indexOf("%")==-1&&a._bodyHeight(parseInt(c)-41+"px");c=="auto"&&b!="auto"&&a._bodyMaxHeight(parseInt(b)-41+"px");a._headerOperationsColumnWidth(a.operationsColumnWidth());
x=a.isAllowOperations()?a.operationsColumnWidth():0;a._columns=a.columns();a.pageSizeSub=cube.subscribe(a.pageSize,function(){a.load()});a.argsSub=cube.subscribe(a.args,function(){a.pageIndex.silentUpdate(1);a.load()});a._selectedIdsSub=cube.subscribe(a._selectedIds,a.chkboxClick);a._selectedAllSub=cube.subscribe(a._selectedAll,a.chkboxAllClick);a.selectedIdsSub=cube.subscribe(a.selectedIds,function(b){a._selectedIds(b)});a.actionsSub=cube.subscribe(a.actions,function(a){j.actions=a});a.dictsSub=
cube.subscribe(a.dicts,function(b){if(cube.isArray(b)&&b.length>0&&(a._dictsKeyValue()!=null||a.autoLoad()==!1))j._parseDicts({dicts:b}),a._dictsKeyValue(j.dictsKeyValue),a.initColumn({dicts:b})});a.itemsChange();j.primaryKey=a.primaryKey();j.baseUrl=a.url();j.actions=a.actions();j.type="grid";j.timeout=a.timeout();j.loadMeta=a.loadMeta();j.data=a.items();j.dicts=a.dicts();j.onload=G;j.onerror=H;j.customHeaders=a.customHeaders();j.loadByPost=a.loadByPost();j.init();a.autoLoad()?(c=cube.getPageViewModelByNode($("#"+
a.searchBoxId())))&&!c._isload()&&(cube.notEmpty(c.url())||c._lazyload())?cube.subscribe(c._isload,function(){a.load()}):a.load():a.initColumn();a.isAllowAppend()&&v();if(a.isAllEdited())a._initItems(a.items()),a.itemsSub=cube.subscribe(a.items,function(b){a._initItems(b);a.itemsChange()});else if(cube.isEmpty(a.url())||!a.autoLoad())a.itemsSub=cube.subscribe(a.items,function(b){a.itemCount(b.length);a._pageCount(parseInt((b.length+parseInt(a.pageSize())-1)/parseInt(a.pageSize())));setTimeout(function(){a.itemsChange()},
500)})};a._initItems=function(c){if(cube.notEmpty(c)&&c.length>0){var b=a.columns(),d=a._editorValid();if(b&&b.length>0)for(var e=0;e<c.length;e++)d[e]={},$.each(b,function(a,b){var h=c[e][b.name];typeof h=="undefined"?c[e][b.name]=cube.obj():cube.isObservable(h)||(c[e][b.name]=cube.obj(h));h={validStatus:cube.obj(""),validHint:cube.obj("")};d[e][b.name]=h});a._editorValid(d)}else a._editorValid([])};a.setActions=function(c){a.actions(cube.isObservable(c)?c():c);j.actions=c};a.chkboxClick=function(c){for(var b=
a.items(),d=a.primaryKey(),e=0,f=b.length;e<f;e++){if(typeof b[e][d]=="undefined"){cube.indicate("warning",cube.msg("SET_PRIMARYKEY"));break}a.isRadio()&&cube.notEmpty(c)&&c==String(b[e][d])?a._selectedItems.indexOf(b[e])==-1&&a._selectedItems.push(b[e]):cube.notEmpty(c)&&cube.isArray(c)&&c.indexOf(String(b[e][d]))!=-1?a._selectedItems.indexOf(b[e])==-1&&a._selectedItems.push(b[e]):a._selectedItems.remove(b[e])}if(b.length>0){a._selectedAllSub.dispose();a._selectedItems().length==b.length?a._selectedAll(!0):
a._selectedAll(!1);a._selectedAllSub=cube.subscribe(a._selectedAll,a.chkboxAllClick);if(a.onSelectedItems!=null&&!cube.isObservable(a.onSelectedItems))a.onSelectedItems(a._selectedItems());if(a.onSelectedIds!=null&&!cube.isObservable(a.onSelectedIds))a.onSelectedIds(a._selectedIds())}};a.chkboxAllClick=function(){a._selectedIdsSub.dispose();for(var c=a._selectedIds(),b=a.items(),d=a.primaryKey(),e=0,f=b.length;e<f;e++){if(typeof b[e][d]=="undefined"){cube.indicate("warning",cube.msg("SET_PRIMARYKEY"));
break}a._selectedAll()?c.indexOf(String(b[e][d]))==-1&&a.checkboxVisible(b[e])&&(a._selectedIds.push(String(b[e][d])),a._selectedItems.push(b[e])):(a._selectedIds.shift(),a._selectedItems.shift())}if(a.onSelectedItems!=null&&!cube.isObservable(a.onSelectedItems))a.onSelectedItems(a._selectedItems());if(a.onSelectedIds!=null&&!cube.isObservable(a.onSelectedIds))a.onSelectedIds(a._selectedIds());a._selectedIdsSub=cube.subscribe(a._selectedIds,a.chkboxClick)};a.setSelectedItem=function(c,b){if(a._isEdited()&&
a._selectedItem()!=c){if(!a.validate(1))return;if(a.onItemEditing!=null&&!cube.isObservable(a.onItemEditing))a.onItemEditing(c,b);for(var d in a._editedItem)d!="mxVirtualId"&&j.setValue(a._editedItemObj,d,a._editedItem[d]());a.replaceItem(a._editedItemIndex,a._editedItemObj);var e={},f={};for(d in c)e[d]=cube.obj(c[d]),f[d]=c[d];a._editedItem=e;a._editedItemObj=f;a._editedItemIndex=b}a._selectedItem(c);if(a.onSelectedItem!=null&&!cube.isObservable(a.onSelectedItem))a.onSelectedItem(c)};a.replaceItem=
function(c,b){cube.isNumber(c)?a.items.replace(a.items()[a._editedItemIndex],b):a.items.replace(c,b)};a.cancelSelectedItem=function(){a._selectedItem(null)};a.dblclick=function(c){if(a.onDblClick!=null&&!cube.isObservable(a.onDblClick))a.onDblClick(c)};a.delItem=function(c){cube.indicate("confirm",cube.msg("CONFIRM_DELETE"),function(){if(a.onItemDeleting!=null&&!cube.isObservable(a.onItemDeleting)){var b={cancel:!1,data:c};a.onItemDeleting(b);if(b.cancel)return}var d=c[a.primaryKey()];cube.isObservable(d)&&
(d=d());if(d&&a.autoDelete())j.ondeleted=function(b,f){a.items.remove(c);a._selectedIds.remove(d);if(a.onItemDeleted!=null&&!cube.isObservable(a.onItemDeleted))a.onItemDeleted(c,f);a.refreshDeleted()&&a.load()},j.remove(d,c);else if(a.items.remove(c),a.onItemDeleted!=null&&!cube.isObservable(a.onItemDeleted))a.onItemDeleted(c);a.itemsChange()})};a.delSelectedItem=function(){cube.indicate("confirm",cube.msg("CONFIRM_DELETE"),function(){var c=a._selectedItem();if(c!=null){if(a.onItemDeleting!=null&&
!cube.isObservable(a.onItemDeleting)){var b={cancel:!1,data:c};a.onItemDeleting(b);if(b.cancel)return}var d=c[a.primaryKey()];if(d&&a.autoDelete())j.ondeleted=function(b,f){a.items.remove(c);a._selectedIds.remove(d);if(a.onItemDeleted!=null&&!cube.isObservable(a.onItemDeleted))a.onItemDeleted(c,f);a.refreshDeleted()&&a.load()},j.remove(d);else if(a.items.remove(c),a.onItemDeleted!=null&&!cube.isObservable(a.onItemDeleted))a.onItemDeleted(c);a.itemsChange()}})};a.delCheckedItem=function(){cube.indicate("confirm",
cube.msg("CONFIRM_DELETE"),function(){var c=a._selectedIds();if(a.onItemDeleting!=null&&!cube.isObservable(a.onItemDeleting)){var b={cancel:!1,data:c};a.onItemDeleting(b);if(b.cancel)return}if(a.autoDelete())j.ondeleted=function(b,e){for(var f=0;f<c.length;f++)a.items.remove(s.getItem(a.items(),a.primaryKey(),c[f]));if(a.onItemDeleted!=null&&!cube.isObservable(a.onItemDeleted))a.onItemDeleted(c,e);a.refreshDeleted()&&a.load()},j.remove(c);else{for(b=0;b<c.length;b++)a.items.remove(s.getItem(a.items(),
a.primaryKey(),c[b]));if(a.onItemDeleted!=null&&!cube.isObservable(a.onItemDeleted))a.onItemDeleted(c)}a._selectedIds([]);a.itemsChange()})};a.editItem=function(c,b){if(a._isEdited()&&a._selectedItem()!=c){if(!a.validate(1))return;for(var d in a._editedItem)d!="mxVirtualId"&&j.setValue(a._editedItemObj,d,a._editedItem[d]());a.replaceItem(a._editedItemIndex,a._editedItemObj)}if(a.onItemEditing!=null&&!cube.isObservable(a.onItemEditing))a.onItemEditing(c,b);var e={},f={};for(d in c)d==a.primaryKey()&&
c[d]==null||(e[d]=cube.obj(c[d]),f[d]=c[d]);(d=a.columns())&&d.length>0&&$.each(d,function(b,d){if(d.editorType=="FileEditor")d.pkVal&&cube.isObservable(d.pkVal)?d.pkVal(c[a.primaryKey()]):d.pkVal=cube.obj(c[a.primaryKey()])});a._editedItemIndex=b;a._editedItem=e;a._editedItemObj=f;a._isEdited(!0);a._selectedItem(c)};a.shiftupItem=function(){var c=a.items.indexOf(this);c>0&&(a.items.splice(c,1),a.items.splice(c-1,0,this))};a.shiftdownItem=function(){var c=a.items.indexOf(this);c<a.items().length-
1&&(a.items.splice(c,1),a.items.splice(c+1,0,this))};a.saveItem=function(c){if(a.validate(1)){if(a.autoSave()){if(a.isAllEdited())for(var b in c)b!="mxVirtualId"&&j.setValue(c,b,cube.isObservable(c[b])?c[b]():c[b]);else for(b in a._editedItem)b!="mxVirtualId"&&j.setValue(a._editedItemObj,b,a._editedItem[b]());if(a.onItemSaving!=null&&!cube.isObservable(a.onItemSaving)&&(c={cancel:!1,data:a._editedItemObj},a.onItemSaving(c),c.cancel))return;j.onsaved=function(b){if(typeof a._editedItemObj[a.primaryKey()]==
"undefined"&&b.result.newData.length>0){if(a.isAllEdited()||a.replaceItem(a._editedItemIndex,b.result.newData[0]),a.onItemSaved!=null&&!cube.isObservable(a.onItemSaved))a.onItemSaved(b.result.newData[0])}else if(a.isAllEdited()||a.replaceItem(a._editedItemIndex,a._editedItemObj),a.onItemSaved!=null&&!cube.isObservable(a.onItemSaved))a.onItemSaved(a._editedItemObj)};j.save()}else{var d={};if(a.isAllEdited())for(b in c)b!="mxVirtualId"&&(d[b]=cube.isObservable(c[b])?c[b]():c[b]);else for(b in a._editedItem)b!=
"mxVirtualId"&&(d[b]=a._editedItem[b]());if(a.onItemSaving!=null&&!cube.isObservable(a.onItemSaving)&&(c={cancel:!1,data:d},a.onItemSaving(c),c.cancel))return;a.isAllEdited()||a.replaceItem(a._editedItemIndex,d);if(a.onItemSaved!=null&&!cube.isObservable(a.onItemSaved))a.onItemSaved(d)}a._isEdited(!1);a._editedItem=null;a._selectedItem(null)}};var k=null;a.saveAppend=function(c,b){if(a.validate(0)){k==null&&(k=j.create());if(a.isAllEdited()){var d=a._editorValid(),e=d.length;d[e]={}}for(var f in a._appendedItem)if(!(f==
"mxVirtualId"||f==a.primaryKey()))if(k[f]=a._appendedItem[f](),a.isAllEdited()){var i={validStatus:cube.obj(""),validHint:cube.obj("")};d[e][f]=i}if(c&&cube.isArray(c))for(d=0;d<c.length;d++)for(f in c[d])f=="mxVirtualId"||f==a.primaryKey()||(k[f]=c[d][f]);if(a.autoSave()||b===!0){if(a.onItemSaving!=null&&!cube.isObservable(a.onItemSaving)&&(d={cancel:!1,data:k},a.onItemSaving(d),d.cancel))return;for(f in k)f!=a.primaryKey()&&j.setValue(k,f,k[f]);j.onsaved=function(b){for(var c=0;c<b.result.newData.length;c++)a.items.push(b.result.newData[c]);
var b=!1,c=a.columns(),d;for(d in a._appendedItem){for(var e=0;e<c.length;e++)if(d==c[e].name&&typeof c[e].value!="undefined"){cube.isObservable(c[e].value)?(a._appendedItem[d]=c[e].value,a._appendedItemObj[d]=c[e].value()):(a._appendedItem[d](c[e].value),a._appendedItemObj[d]=c[e].value);b=!0;break}b||(a._appendedItem[d](null),a._appendedItemObj[d]=null,b=!1);delete a._appendedItem.mxVirtualId;delete a._appendedItem[a.primaryKey()]}if(a.onItemSaved!=null&&!cube.isObservable(a.onItemSaved))a.onItemSaved(k);
k=null};j.save()}else{if(a.onItemSaving!=null&&!cube.isObservable(a.onItemSaving)&&(d={cancel:!1,data:k},a.onItemSaving(d),d.cancel))return;a.items.push(k);d=!1;e=a.columns();for(f in a._appendedItem){for(i=0;i<e.length;i++)if(f==e[i].name&&typeof e[i].value!="undefined"){cube.isObservable(e[i].value)?(a._appendedItem[f]=e[i].value,a._appendedItemObj[f]=e[i].value()):(a._appendedItem[f](e[i].value),a._appendedItemObj[f]=e[i].value);d=!0;break}d||(a._appendedItem[f](null),a._appendedItemObj[f]=null,
d=!1);delete a._appendedItem.mxVirtualId;delete a._appendedItem[a.primaryKey()]}if(a.onItemSaved!=null&&!cube.isObservable(a.onItemSaved))a.onItemSaved(k);k=null}a._isEdited(!1);a._editedItem=null;a._selectedItem(null)}};a.cancelSaveItem=function(){a._isEdited(!1);a._editedItem=null;a._selectedItem(null);for(var c=a.columns(),b=0;b<c.length;b++)c[b].validStatus("")};a.appendItem=function(c){if(a.isAllEdited()||a.validate(0)){var b={},d=!1,e=a.columns();if(a.isAllEdited()){var f=a._editorValid(),i=
f.length;f[i]={}}var h=a._appendedItem;cube.notEmpty(c)&&(h=c);var c=0,g;for(g in h){c++;b[g]=a.isAllEdited()?cube.obj(cube.isObservable(h[g])?h[g]():h[g]):cube.isObservable(h[g])?h[g]():h[g];if(a.isAllEdited()){var j={validStatus:cube.obj(""),validHint:cube.obj("")};f[i][g]=j}for(j=0;j<e.length;j++)if(g==e[j].name&&typeof e[j].value!="undefined"){cube.isObservable(e[j].value)?(a._appendedItem[g]=e[j].value,a._appendedItemObj[g]=e[j].value()):(a._appendedItem[g](e[j].value),a._appendedItemObj[g]=
e[j].value);d=!0;break}if(!d){if(cube.notEmpty(a._appendedItem[g])&&cube.isObservable(a._appendedItem[g]))a._appendedItem[g](null);cube.notEmpty(a._appendedItemObj[g])&&(a._appendedItemObj[g]=null);d=!1}}if(c==0)(d=a._columns)&&d.length>0&&$.each(d,function(){b[this.name]=typeof this.value!="undefined"?cube.isObservable(this.value)?this.value:cube.obj(this.value):cube.obj(null);if(a.isAllEdited()){var c={validStatus:cube.obj(""),validHint:cube.obj("")};f[i][this.name]=c}});a.items.push(b);a.itemsChange()}};
a.sortType=cube.obj(-1);a.sortName=cube.obj("");a.sortGrid=function(c,b){var d=null,d=cube.notEmpty(c)?c.name!=void 0?c.name:c:a.sortName();a.sortName(d);a.items.sort(function(c,f){var i=cube.isObservable(c[d])?c[d]():c[d],h=cube.isObservable(f[d])?f[d]():f[d];if(i==null&&h==null)return 0;else if(i==null&&h!=null)return b==!0?1:b==!1?-1:a.sortType()==1?-1:1;else if(i!=null&&h==null)return b==!0?-1:b==!1?1:a.sortType()==1?1:-1;!isNaN(i)&&!isNaN(h)?(i=Number(i),h=Number(h)):(i=t.convertPinyin(i),h=
t.convertPinyin(h));var g=null;return g=b==!0?i==h?0:i<h?-1:1:b==!1?i==h?0:i<h?1:-1:i==h?0:i<h?a.sortType():a.sortType()*-1});b==!0?a.sortType(1):b==!1?a.sortType(-1):a.sortType(a.sortType()*-1)};var p=!1,q=!1,y=0,z=0,A,B,r;a.mousedown=function(c,b,d,e){if(a.isAllowAdjustColumn()&&p)q=!0,y=d.clientX,z=$(c).width(),A=$(c),B=c.cellIndex,r=e,a.$tableBody.find("table>tbody>tr>td:eq("+B+")")};a.mouseup=function(){a.isAllowAdjustColumn()&&(q=!1,a.itemsChange())};a.mousemove=function(c,b){if(a.isAllowAdjustColumn()&&
(b.offsetX>$(c).width()-10?(c.style.cursor="e-resize",p=!0):(c.style.cursor="default",p=!1),q)){var d=z+(b.clientX-y);d<20&&(d=20);A.width(d+"px");if(r!=-1){var e=a.columns()[r],f=e.width();!a.isShowTempColumn()&&n==0&&a.isShowTempColumn(!0);(f=="auto"||cube.isString(f)&&f.indexOf("%")!=-1)&&n--;e.width(d+"px")}}};a.onCurrentPageIndexChanged=function(){a._selectedAll(!1);a.sortName("");a._indexNotLoad()||a.load()};a.itemsChange=function(){a.$tableBody[0]&&a.$tableBody[0].scrollHeight>a.$tableBody[0].clientHeight?
(a._headerOperationsColumnWidth(parseInt(x)+(a.isAllowOperations()?17:6)+"px"),a._hasVScroll(!0)):(a._headerOperationsColumnWidth(a.operationsColumnWidth()),a._hasVScroll(!1))};a.load=function(c){a.isShowLoading(!0);w=(new Date).getTime();a._selectedItem(null);a._selectedIds([]);a._selectedItems.removeAll();var b=null;cube.notEmpty(c)&&$.isPlainObject(c)&&(b=c);var d={metaParams:null,dataParams:null};if(cube.notEmpty(b))cube.isEmpty(b.metaParams)&&cube.isEmpty(b.dataParams)?d.dataParams=b:d=$.extend(d,
b);var e=!1;if(cube.notEmpty(c)&&cube.notEmpty(c.isSearchLoad))e=c.isSearchLoad,delete c.isSearchLoad;b="";if(cube.notEmpty(c)&&cube.notEmpty(c.filter))b=c.filter;else if(b=cube.clone(c))delete b.pageIndex,delete b.pageSize;var c=null,c=cube.isObservable(a.args)?a.args():a.args,f=null,i=null;if(a.searchBoxId()&&(i=cube.getPageViewModelByNode($("#"+a.searchBoxId()))))if(f=cube.isObservable(i._params)?i._params():i._params,!e||!f)f=i.searchParamType()=="json"?i.getJsonSearchParam():i.getSearchParam();
if(i&&i.searchParamType()=="json"){if(f.length>0){if(cube.isArray(c))for(var h=0;h<c.length;h++)f.push(c[h]);else f.push(c);if(cube.isArray(b))for(h=0;h<b.length;h++)f.push(b[h]);else f.push(b)}else f=c;b=f}else{i=e="";if($.isPlainObject(b)){for(h in b)var g=b[h],i=i+"&"+h+"="+(cube.isObservable(g)?g():g);b=i}if($.isPlainObject(c)){for(h in c)g=c[h],e=e+"&"+h+"="+(cube.isObservable(g)?g():g);cube.notEmpty(b)?b+=e:b=e.substring(1,e.length)}else cube.isString(c)&&(b=cube.notEmpty(b)?b+"&"+c:c);if($.isPlainObject(f)){for(h in f)g=
f[h],e=e+"&"+h+"="+(cube.isObservable(g)?g():g);cube.notEmpty(b)?b+=e:b=e.substring(1,e.length)}else cube.isString(f)&&(b=cube.notEmpty(b)?b+"&"+f:f)}if(cube.notEmpty(b))d.dataParams=$.extend({filter:b},d.dataParams);if(a.loadMeta()&&cube.notEmpty(a._columns))b="",b=a._getColunmsNames().join(","),h={columns:b},d.metaParams=$.extend({columns:b},d.metaParams),d.dataParams=$.extend(h,d.dataParams);d.dataParams&&cube.notEmpty(d.dataParams.pageIndex)&&d.dataParams.pageIndex!=a.pageIndex()&&(a._indexNotLoad(!0),
a.pageIndex(d.dataParams.pageIndex),a._indexNotLoad(!1));b={};a.isAllowPaging()&&(b={pageIndex:parseInt(a.pageIndex()),pageSize:parseInt(a.pageSize())});d.dataParams=$.extend(b,d.dataParams);j.load(d)};a._getColunmsNames=function(){for(var c=[],b=0;b<a._columns.length;b++)u(c,a._columns[b]);return c};a.print=function(){D.print(a.items,a.columns,a.dicts,"datagrid")};a.save=function(c){var b=null,d=a.items(),e=a.primaryKey();if(d.length>0){for(var f=0;f<d.length;f++){var i=d[f];if(i!=null){var h=cube.isObservable(d[f][e])?
d[f][e]():d[f][e];if(h){if(b={},b[e]=h,a._editedItem&&a._editedItem[e]&&i[e]==a._editedItem[e]())i=a._editedItem}else b=j.create();if(a.isAllEdited())for(var g in i)g=="mxVirtualId"||g==e||(b[g]=cube.isObservable(i[g])?i[g]():i[g]);else if(cube.isObservable(a._appendedItemObj))for(g in i)g=="mxVirtualId"||g==e||(b[g]=cube.isObservable(i[g])?i[g]():i[g]);else for(g in a._appendedItemObj)g=="mxVirtualId"||g==e||(b[g]=a._appendedItemObj[g]);if(c&&cube.isArray(c))for(h=0;h<c.length;h++)for(g in c[h])g==
"mxVirtualId"||g==e||(b[g]=c[h][g]);if(a.validate(b,f))for(g in b)g=="mxVirtualId"||g==e||(cube.isFunction(i[g])?j.setValue(b,g,b[g]!=null?b[g]:i[g]()):j.setValue(b,g,b[g]!=null?b[g]:i[g]));else return}}if(a.onSaving!=null&&!cube.isObservable(a.onSaving)){c=[];for(g in j._changedItems)c.push(j._changedItems[g]);g={cancel:!1,data:c};a.onSaving(g);if(g.cancel)return}j.onsaved=function(b){if(b.p_result.resultValue.items){if(!a.isAllEdited())for(var c=0;c<d.length;c++)a.replaceItem(d[c],b.p_result.resultValue.items[c]);
if(a.onSaved!=null&&!cube.isObservable(a.onSaved))a.onSaved(b.p_result.resultValue.items)}};j.save()}else a.saveAppend(c,!0);a._isEdited(!1);a._editedItem=null;a._selectedItem(null)};a.importExcel=function(c,b,d,e){for(var f=[],i=[],h=a.columns(),g=0;g<h.length;g++)f.push({value:h[g].name,text:h[g].caption}),i.push(h[g].name);typeof d!="undefined"&&cube.isArray(d)&&(e=d,d=!0);cube.showDialog({title:cube.msg("IMPORT_EXCEL"),templateOptions:{name:"exceltmpl",params:{columns:f,columnNames:e,value:i.join(),
importExcelUrl:c,previewGridBaseUrl:a.url(),confirmBtnClick:b,showOption:d}},confirmBtnText:cube.msg("SAVE"),closeBtnText:cube.msg("CANCEL"),onConfirmBtnClick:function(a){if(!a.result)a.cancel=!0},customBtns:[{text:cube.msg("PREVIOUS"),visible:cube.obj(!1),click:function(a){a.step(1);this.visible(!1);a.customBtns()[1].visible(!0)}},{text:cube.msg("NEXT"),visible:cube.obj(!1),click:function(a){a.step(2);this.visible(!1);a.customBtns()[0].visible(!0)}}]})};a.exportExcel=function(c,b,d,e){l.setBaseUrl(c);
l.setParams(b);d===!0&&l.setIds(a._selectedIds());e==!0&&l.setType("post");l.exportExcel()};var n=0;a.initColumn=function(c){var b=a.columns();if(b&&b.length>0){for(var d=0;d<b.length;d++){var e=b[d];if(cube.isEmpty(e))return!0;if(typeof e.validStatus=="undefined")e.validStatus=cube.obj("");else if(!cube.isObservable(e.validStatus))e.validStatus=cube.obj(e.validStatus);if(typeof e.validHint=="undefined")e.validHint=cube.obj("");else if(!cube.isObservable(e.validHint))e.validHint=cube.obj(e.validHint);
if(typeof e.align=="undefined")e.align="";if(typeof e.width=="undefined")e.width=cube.obj(a.columnDefaultWidth()),n++;else if(!cube.isObservable(e.width))cube.notEmpty(e.width)&&(e.width=="auto"||cube.isString(e.width)&&e.width.indexOf("%")!=-1)&&n++,e.width=cube.obj(e.width);if(!e.editorType)e.editorType="TextEditor";if(e.editorType=="DropDownEditor"||e.editorType=="CheckListEditor"||e.editorType=="ListEditor"||e.editorType=="LabelEditor"){if(c&&c.dicts&&c.dicts[e.name])e.list=c.dicts[e.name]}else if(e.editorType==
"FileEditor")if(e.pkVal){if(!cube.isObservable(e.pkVal))e.pkVal=cube.obj(e.pkVal)}else e.pkVal=cube.obj(null)}n==0&&a.isShowTempColumn(!0)}};a.validate=function(c,b){var d=null,e=null;c==1?(d=a._editedItem,e=a.columns()):c==0?(d=a._appendedItem,e=a.appendColumns):(d=c,e=a.columns());for(var f=0;f<e.length;f++)if(e[f].validStatus&&typeof e[f].validStatus=="function"&&e[f].validStatus()!="")return!1;else if(d!=null)for(var i in d)if(e[f].name==i&&e[f].nullable==!1){var h=cube.isObservable(d[i])?d[i]():
d[i],h=E.validate(h,"NOTNULL",{});if(h.successful)a.isAllEdited()?(g=a._editorValid()[b][i],g.validStatus(""),g.validHint("")):(e[f].validStatus(""),e[f].validHint(""));else{if(a.isAllEdited()){var g=a._editorValid()[b][i];g.validStatus("error");g.validHint(h.hint)}else e[f].validStatus("error"),e[f].validHint(h.hint);return!1}break}return!0};a._editor_changed=function(c,b,d){var e=a.columns(),f=a.items()[d];e&&e.length>0&&$.each(e,function(a,d){if(d.onChanged)return d.onChanged(c,b,f),!0})};a._editor_upload=
function(c,b){if(a._editedItem!=null&&!cube.isObservable(a._editedItem))a._editedItem[c](b)};a._parseDate=function(a,b){if(cube.notEmpty(a)){cube.isString(a)||(a=String(a));var d=new Date(a.replace(/-/g,"/"));F.isDigit(a)&&(cube.isEmpty(b)&&(b="yyyy-MM-dd HH:mm:ss"),a.length==10&&(a+="000"),a.length==13&&(d=new Date(parseInt(a))));cube.isEmpty(b)?b=a:(b=b.replace(/yyyy/g,d.getFullYear()),b=b.replace(/MM/g,m(d.getMonth()+1,"00")),b=b.replace(/dd/g,m(d.getDate(),"00")),b=b.replace(/HH/g,m(d.getHours(),
"00")),b=b.replace(/mm/g,m(d.getMinutes(),"00")),b=b.replace(/ss/g,m(d.getSeconds(),"00")))}else b=a;return b};a.checkboxVisible=function(c){var b=a.checkboxHideCondition(),d=!0;if(cube.isEmpty(b))return!0;else if(typeof b=="boolean")return b;else if(cube.isArray(b))for(var e=0;e<b.length;e++){if(d=a._checkCondition(c,b[e]),!d)break}else d=a._checkCondition(c,b);return!d};a.customOperationsVisible=function(c,b){var d=!0;if(cube.isEmpty(b))d=!0;else if(typeof b=="boolean")return b;else if(cube.isObservable(b)&&
typeof b()=="boolean")return b();else if(cube.isArray(b))for(var e=0;e<b.length;e++){if(d=a._checkCondition(c,b[e]),!d)break}else d=a._checkCondition(c,b);return d};a._checkCondition=function(a,b){var d=!1;switch(b.operation){case "==":d=a[b.column]==b.value;break;case "!=":d=a[b.column]!=b.value;break;case ">":d=a[b.column]>b.value;break;case "<":d=a[b.column]<b.value;break;case ">=":d=a[b.column]>=b.value;break;case "<=":d=a[b.column]<=b.value;break;case "in":cube.isArray(b.value)&&b.value.indexOf(a[b.column])!=
-1&&(d=!0)}return d};a.renderCell=function(c,b,d,e){cube.isObservable(c)&&(c=c());var f="",i=!1,h="",g=a._dictsKeyValue();if(d.renderCell)cube.notEmpty(g)&&cube.notEmpty(g[d.name])&&(h=g[d.name][c],typeof h=="undefined"&&(h="")),f=d.renderCell(c,b,h,e,d),f==null?f=cube.notEmpty(h)?h:c:i=!0;else if(cube.notEmpty(g)&&cube.notEmpty(g[d.name]))f=g[d.name][c],typeof f=="undefined"&&(f=c);else if(cube.notEmpty(d.list)){e=[];e=cube.isObservable(d.list)?d.list():d.list;for(h=0;h<e.length;h++)if(e[h].value==
c){f=e[h].text;break}}else if(typeof d.editorType!="undefined"&&d.editorType=="DateTimeEditor")f=a._parseDate(c,d.format);else if(f=c,e=$(b),typeof d.displayLength!="undefined"&&cube.notEmpty(f)?(f=String(f),f.length>d.displayLength&&(f=f.substring(0,d.displayLength)+"...")):typeof d.displayRow!="undefined"&&cube.notEmpty(f)&&(f=String(f),h=e.width(),g=parseInt(e.css("fontSize")),h=parseInt(h/g*d.displayRow)-3,f.length>h&&(f=f.substring(0,h)+"...")),typeof d.displayRow!="undefined"||typeof d.displayLength!=
"undefined")e.css("white-space","normal"),e.css("word-break","break-all");e=a.trBackground();if(e!=null&&d.name==e.column){h=!1;switch(e.operation){case "==":h=c==e.value;break;case "!=":h=c!=e.value;break;case ">":h=c>e.value;break;case "<":h=c<e.value;break;case ">=":h=c>=e.value;break;case "<=":h=c<=e.value;break;case "in":cube.isArray(e.value)&&e.value.indexOf(c)!=-1&&(h=!0)}h&&$(b).parent().css("background",e.background)}f&&(f=String(f),f=a.scriptProcessing()=="clean"||i?cube.cleanScript(f):
cube.escapeString(f,typeof d.isAllowAutowrap!="undefined"?d.isAllowAutowrap:a.isAllowAutowrap()));return f};a.renderMarkCell=function(c,b){var d="",d=a.markColumn();return d=d.renderCell?d.renderCell(c,b):d.value};a.mouseenter=function(c,b,d,e){if(typeof d.onMouseenter=="function")d.onMouseenter(c,b);var b=String(b),c="",f=a._dictsKeyValue();cube.notEmpty(f)&&cube.notEmpty(f[d.name])&&(c=f[d.name][b],typeof c=="undefined"&&(c=""));b=cube.notEmpty(c)?c:b;typeof d.editorType!="undefined"&&d.editorType==
"DateTimeEditor"&&(b=a._parseDate(b,d.format));if(f=b)b=String(b),a.scriptProcessing()=="clean"?f=b=cube.cleanScript(b):b=cube.escapeString(b,typeof d.isAllowAutowrap!="undefined"?d.isAllowAutowrap:a.isAllowAutowrap());c=(a.isAllowAutowrap()==!1||d.isAllowAutowrap==!1)&&e.scrollWidth>e.clientWidth;if((typeof d.displayLength!="undefined"||typeof d.displayRow!="undefined"||c)&&cube.notEmpty(b))if(a.isShowTips()){f=d.displayLength;if(typeof d.displayRow!="undefined")var f=$(e).width(),i=parseInt($(e).css("fontSize")),
f=parseInt(f/i*d.displayRow)-3;if(b.length>f||c)a.showCellPopDialog(!0),cube.showPopDialog(e,{popoverDirection:"top",content:b.replace(/\n/g,"<br/>"),isShowDialog:a.showCellPopDialog})}else $(e).attr("title",f)};a.mouseleave=function(c,b,d){if(typeof d.onMouseleave=="function")d.onMouseleave(c,b);a.showCellPopDialog(!1)};a.getEditorParam=function(c,b,d){var e=cube.clone(c);if(c.editorType=="FileEditor"){if(e.onChanged=a._editor_upload,e.type="grid",e.previewSize="small",b)e.pkVal=b[a.primaryKey()]}else e.onChanged=
a._editor_changed;if(typeof c.align!="undefined")e.textAlign=c.align;if(typeof c.isExtDisplay=="undefined")e.isExtDisplay=!0;if(typeof c.appendEditorType!="undefined")e.editorType=c.appendEditorType;else if(typeof c.editorType=="undefined")e.editorType="TextEditor";e.width=c.editorType=="DateTimeEditor"?"65%":c.editorType=="DropDownEditor"?"auto":c.editorType=="NumberEditor"?"40%":"85%";if(cube.notEmpty(b))if(a.isAllEdited()){if(a._editorValid().length>0)e.validStatus=a._editorValid()[d][c.name].validStatus,
e.validHint=a._editorValid()[d][c.name].validHint;e.value=b[c.name]}else e.value=a._editedItem[c.name];else e.value=a._appendedItem[c.name];e.itemIndex=d;if(c.editorType=="CheckEditor"||c.editorType=="CheckListEditor")e.name=c.name+d;return e};a.openSubGrid=function(c){a.subGridId()==c[a.primaryKey()]?a.subGridId(null):a.subGridId(c[a.primaryKey()]);setTimeout(function(){a.itemsChange()},300)};a.appendCustomClick=function(c){if(cube.isFunction(c.click)){var b={},d;for(d in a._appendedItem)d=="mxVirtualId"||
d==a.primaryKey()||(b[d]=a._appendedItem[d]());c.click(b)}};a.customOperationsClick=function(a,b,d){b.click(a,d)};a.onload=function(c){var b=$(c);a.$tableBody=b.find(".tableBody");a.$tableHeader=b.find(".tableHeader");a.$tableBody.scroll(function(b){a.$tableHeader.css("left",0-b.target.scrollLeft)});a.itemsChange();b=a.watermarkOptions();if(cube.notEmpty(b)&&cube.notEmpty(b.text)){b=$.extend(a._watermarkOptionsDefaultValue(),b);b.indent=(parseInt(b.width)+parseInt(b.xSpace))/2;a.watermarkOptions(b);
for(var d=parseInt((a.$tableBody.height()-b.y)/(parseInt(b.height)+parseInt(b.ySpace)))+1,e=0;e<d;e++)a.watermarkRows.push({y:b.y+(parseInt(b.height)+parseInt(b.ySpace))*e});d=parseInt((a.$tableBody.width()-b.x)/(parseInt(b.width)+parseInt(b.xSpace)))+1;for(e=0;e<d;e++)a.watermarkCols.push({x:b.x+(parseInt(b.width)+parseInt(b.xSpace))*e})}if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(c)};cube.endViewModel(a,o)}cube.importComponent("editor.commoneditor");cube.importComponent("editor.datetimeeditor");
cube.importComponent("editor.dropdowneditor");cube.importComponent("datacontainer.pagenavibar");cube.importComponent("datacontainer.exceltmpl");cube.importComponent("controls.loading");o.prototype.dispose=function(){this.pageSizeSub.dispose();this.argsSub.dispose();this._selectedIdsSub.dispose();this._selectedAllSub.dispose();this.actionsSub.dispose();this.dictsSub.dispose();this.selectedIdsSub.dispose()};return o});define("exceltmpl",[],function(){return function(b){var a=this;a.importExcelUrl=b.importExcelUrl;a.previewGridBaseUrl=b.previewGridBaseUrl;a.step=cube.obj(1);a.columnsValue=cube.obj(b.value);a.columns=cube.array([]);a.columnNames=b.columnNames;a.items=cube.array([]);a.showOption=typeof b.showOption=="undefined"?!0:b.showOption;a.$e=null;a.importExcelOptions={horizontalBegin:cube.obj(1),horizontalEnd:cube.obj(0),verticalBegin:cube.obj(1),verticalEnd:cube.obj(0),sheetNumber:cube.obj(1),separatorNum:cube.obj(0),
saveByDefault:cube.obj(!0)};a.columnFields=[{caption:cube.msg("IMPORT_OPTIONS"),icon:"th-list",isLine:!0,visible:a.showOption},{name:"column",caption:cube.msg("IMPORT_COLUMN"),editorType:"CheckListEditor",colspan:3,width:"90%",captionWidth:"100px",list:b.columns,value:cube.isArray(a.columnNames)&&a.columnNames.length>0?a.columnNames:b.value,nullable:!1,visible:a.showOption,onChanged:function(b){a.columnsValue(b)}},{caption:cube.msg("IMPORT_IMPORT_OPTIONS"),icon:"cog",isLine:!0,visible:a.showOption},
{name:"horizontalBegin",caption:cube.msg("IMPORT_EXCEL_HORIZONTALBEGIN"),width:"30px",captionWidth:"100px",nullable:!1,visible:a.showOption,validType:"PLUSINTEGER",validOptions:{minValue:1},value:a.importExcelOptions.horizontalBegin},{name:"horizontalEnd",caption:cube.msg("IMPORT_EXCEL_END"),width:"30px",captionWidth:"100px",nullable:!1,visible:a.showOption,validType:"PLUSINTEGER",validOptions:{minValue:0},value:a.importExcelOptions.horizontalEnd},{name:"verticalBegin",caption:cube.msg("IMPORT_EXCEL_VERTICALBEGIN"),
width:"30px",captionWidth:"100px",nullable:!1,visible:a.showOption,validType:"PLUSINTEGER",validOptions:{minValue:1},value:a.importExcelOptions.verticalBegin},{name:"verticalEnd",caption:cube.msg("IMPORT_EXCEL_VERTICALEND"),width:"30px",captionWidth:"100px",nullable:!1,visible:a.showOption,validType:"PLUSINTEGER",validOptions:{minValue:0},value:a.importExcelOptions.verticalEnd},{name:"sheetNumber",caption:cube.msg("IMPORT_EXCEL_SHEETNUMBER"),width:"30px",captionWidth:"100px",nullable:!1,visible:a.showOption,
validType:"PLUSINTEGER",validOptions:{minValue:1},value:a.importExcelOptions.sheetNumber},{name:"separatorNum",caption:cube.msg("IMPORT_EXCEL_SEPRATORNUM"),width:"30px",captionWidth:"100px",nullable:!1,visible:a.showOption,value:a.importExcelOptions.separatorNum},{caption:cube.msg("IMPORT_EXCEL_WIZARD_UPLOAD_EXCEL"),icon:"file",isLine:!0},{name:"excelFile",caption:cube.msg("IMPORT_EXCEL_SELECT_FILE"),editorType:"FileEditor",captionWidth:"100px",colspan:3,previewSize:"mini",allowTypes:"xls, xlsx",
maxCount:1,nullable:!1,autoLoadFiles:!1,validOptions:{validateMessage:cube.msg("IMPORT_EXCEL_SELECT_AND_UPLOAD_FILE")},validHintType:"inline",url:a.importExcelUrl,onItemUploading:function(g){var f=[],c=a.columnsValue().split(","),e=b.columns;a.columns([]);for(var d=0;d<e.length;d++)c.indexOf(e[d].value)!=-1&&(f.push(e[d].text),a.columns.push({name:e[d].value,caption:e[d].text}));g.fileUploaderParams={columnNames:c,columnCaptions:f.join(),impOptions:a.importExcelOptions.horizontalBegin()+","+a.importExcelOptions.horizontalEnd()+
","+a.importExcelOptions.verticalBegin()+","+a.importExcelOptions.verticalEnd()+","+a.importExcelOptions.sheetNumber()+","+a.importExcelOptions.separatorNum()}},onAllItemUploaded:function(g,f,c){cube.notEmpty(c)&&(c=$.parseJSON(c),c.successful===!0&&a.items(c.resultValue.items));a.step(2);b.dialog.customBtns()[0].visible(!0)}}];a.confirmBtnClick=b.confirmBtnClick;a._init=function(){b.dialog.step=a.step;a.actionsSub=cube.subscribe(b.dialog.step,function(b){a.step(b)});b.dialog.result=function(){if(!cube.getPageViewModelByNode(a.$e.find("#exceltmpl_excelForm")).validate())return!1;
var b=cube.getPageViewModelByNode(a.$e.find("#exceltmpl_excelGrid"));a.confirmBtnClick!=null&&!cube.isObservable(a.confirmBtnClick)?a.confirmBtnClick(b.items()):b.save();return!0}};a.onload=function(b){a.$e=$(b)}}});define("groupheadergrid",["entityContainer","JSONUtil","PrintUtil","Validator","CheckUtil","ExcelUtil","PinyinUtil"],function(C,u,D,E,F,n,v){function p(p){function w(a,b){if(cube.isArray(a)&&!cube.isEmpty(b))if(b.columns!=void 0&&cube.isArray(b.columns))for(var d=0;d<b.columns.length;d++)w(a,b.columns[d]);else a.push(b.name)}function G(c){if(cube.notEmpty(a.url())&&cube.notEmpty(a._columns)&&a._columns.length==0)a.isAllowAppend()&&x(c.columns),a.columns(c.columns),a._columns=a.columns(),q(a._columns,null,0,0);r(c);
if(a.searchBoxId()){var b=cube.getPageViewModelByNode($("#"+a.searchBoxId()));b&&c.dicts&&c.dicts.length>0&&b.setDicts(c.dicts)}a.dicts(c.dicts);a._dictsKeyValue(c.dictsKeyValue);cube.notEmpty(c.items)&&!(c.items.length==1&&c.items[0]==null)?a.items(c.items):a.items([]);a.itemCount(c.itemCount);a._pageCount(parseInt((c.itemCount+parseInt(a.pageSize())-1)/parseInt(a.pageSize())));c=a.selectedIds();c.length>0&&a._selectedIds(c);a.isShowLoading(!1);c=(new Date).getTime()-_startLoadTime;a.loadTime(c>
1E3?c/1E3+"s":c+"ms");if(a.onLoaded!=null&&!cube.isObservable(a.onLoaded))a.onLoaded(a.items())}function H(c){a.isShowLoading(!1);if(a.onLoadError!=null&&!cube.isObservable(a.onLoadError))a.onLoadError(c)}function r(c){var b=a._showItemColumns();b&&b.length>0&&$.each(b,function(a,b){if(cube.isEmpty(b))return!0;if(typeof b.validStatus=="undefined")b.validStatus=cube.obj("");else if(!cube.isObservable(b.validStatus))b.validStatus=cube.obj(b.validStatus);if(typeof b.validHint=="undefined")b.validHint=
cube.obj("");else if(!cube.isObservable(b.validHint))b.validHint=cube.obj(b.validHint);if(typeof b.align=="undefined")b.align="";if(!b.editorType)b.editorType="TextEditor";if(b.editorType=="DropDownEditor"||b.editorType=="CheckListEditor"||b.editorType=="ListEditor")c.dicts&&c.dicts[b.name]&&b.list(c.dicts[b.name]);else if(b.editorType=="FileEditor")if(b.pkVal){if(!cube.isObservable(p_field.pkVal))b.pkVal=cube.obj(p_field.pkVal)}else b.pkVal=cube.obj(null)})}function x(c){a.appendColumns=cube.clone(c);
var b={},d={};$.each(a.appendColumns,function(){typeof this.value!="undefined"?cube.isObservable(this.value)?(b[this.name]=this.value,d[this.name]=this.value()):(b[this.name]=cube.obj(this.value),d[this.name]=this.value):(b[this.name]=cube.obj(null),d[this.name]=null);if(!this.editorType)this.editorType="TextEditor";this.validStatus=cube.obj("");this.validHint=cube.obj("")});a._appendedItem=b;a._appendedItemObj=d}function q(c,b,d,f){d++;for(var e=f=0;e<c.length;e++){c[e].validStatus=cube.obj("");
c[e].validHint=cube.obj("");if(c[e].editorType=="DropDownEditor"||c[e].editorType=="CheckListEditor"||c[e].editorType=="ListEditor"||c[e].editorType=="LabelEditor")if(typeof c[e].list=="undefined")c[e].list=cube.array([]);else if(!cube.isObservable(c[e].list))c[e].list=cube.array(c[e].list);if(c[e].columns&&c[e].columns.length>0){var h=$.extend({},c[e]);y(h,d,0);f=q(c[e].columns,h,d,f);b!=null&&(b.colspan+=f)}else h=$.extend({},c[e]),y(h,d,1),a._showItemColumns.push(h),h=c[e].visible,cube.isObservable(h)&&
(h=h()),b!=null&&(c[e].name==a.primaryKey()&&a.isShowPrimaryKey()||c[e].name!=a.primaryKey()&&h!==!1)&&b.colspan++,c[e]!=null&&(c[e].name==a.primaryKey()&&a.isShowPrimaryKey()||c[e].name!=a.primaryKey()&&h!==!1)&&f++}return b?b.colspan:f}function y(c,b,d){delete c.columns;c.colspan=d;a._levelColumns().length>=b?(l=a._levelColumns()[b-1],typeof l=="undefined"&&(l=[],a._levelColumns()[b-1]=l)):(l=[],a._levelColumns()[b-1]=l);l.push(c)}function m(c){var b=null,d=null;c==1?(b=a._editedItem,d=a._showItemColumns()):
c==0?(b=a._appendedItem,d=a.appendColumns):d=a._showItemColumns();for(c=0;c<d.length;c++)if(d[c].validStatus&&typeof d[c].validStatus=="function"&&d[c].validStatus()!="")return!1;else if(b!=null)for(var f in b)if(d[c].name==f&&d[c].nullable==!1){var e=E.validate(b[f](),"NOTNULL",{});if(e.successful)d[c].validStatus(""),d[c].validHint("");else return d[c].validStatus("error"),d[c].validHint(e.hint),!1;break}return!0}function o(a,b){if(a==null)return"";if(typeof b=="undefined")return a+"";if(typeof b==
"number")return a+"";var d=a+"";if(b!=null&&b!=""){var d=d.split("."),f=b.split(".");d[0].length<f[0].length&&(d[0]=f[0].substring(0,f[0].length-d[0].length)+d[0]);if(f.length==1)return d[0];else{if(d.length>1)for(;d[1].length<f[1].length;)d[1]+="0";else d[1]=f[1];return(new Number(d[0]+"."+d[1])).toFixed(f[1].length)}}else return d}var a=this,i=new C;a.style="";a.height="auto";a.operationsColumnWidth="40px";a.operationsColumnAlign="left";a.items=[];a.columns=[];a.customOperations=[];a.columnDefaultWidth=
"auto";a.tableLayout="auto";a.trBackground=null;a.checkboxHideCondition=null;a._columns=[];a._levelColumns=[];a._showItemColumns=[];a.appendColumns=null;a.url="";a.actions={};a.customHeaders=null;a.loadByPost=!1;a.timeout=null;a.pageSize=20;a.pageIndex=1;a.itemCount=0;a.isShowBtnText=!1;a.firstIcon="";a.previousIcon="";a.nextIcon="";a.endIcon="";a.isShowLoadTime=!1;a.loadTimeFadeout=0;a.pageInfoToLeft=!1;a.pageVisibleCount=5;a.blurGoto=!1;a._pageCount=0;a.primaryKey="id";a.loadMeta=!0;a.selectedIds=
[];a._selectedIds=[];a._selectedItems=[];a._selectedAll=!1;a._selectedItem=null;a._editedItem=null;a._editedItemObj=null;a._editedItemIndex=null;a._appendedItem={};a._appendedItemObj={};a._isEdited=!1;a.isShowPrimaryKey=!1;a.isShowRowNumber=!0;a.rowNumberColumnName=null;a.isRowNumberSerial=!1;a.isShowCheckBox=!1;a.isRadio=!1;a.isShowBorder=!0;a.isShowStripe=!1;a.isShowHover=!1;a.isShowCondense=!1;a.isAllowOperations=!1;a.isShowSave=!0;a.isShowAdd=!0;a.isAllowEdit=!1;a.isAllowDelete=!1;a.isAllowShift=
!1;a.isAllowAppend=!1;a.isAllowSort=!0;a.isAllowPaging=!0;a.isAllowAutowrap=!1;a.args=null;a.searchBoxId=null;a.autoLoad=!0;a.autoSave=!0;a.autoDelete=!0;a.refreshDeleted=!0;a.dicts=null;a.watermarkOptions=null;a._watermarkOptionsDefaultValue={text:"",x:40,y:40,xSpace:150,ySpace:60,color:"#278874",alpha:0.2,fontSize:"16px",width:100,height:20,rotate:25};a.watermarkRows=[];a.watermarkCols=[];a.scriptProcessing="escape";a.isShowLoading=!1;a._indexNotLoad=!1;a._dictsKeyValue=null;a.showCellPopDialog=
cube.obj(!1);a.loadTime=0;a.onSelectedItem=null;a.onSelectedIds=null;a.onSelectedItems=null;a.loadCompleted=!1;a.onDblClick=null;a.onItemSaving=null;a.onItemSaved=null;a.onItemEditing=null;a.onItemDeleting=null;a.onItemDeleted=null;a.onLoaded=null;a.onLoadError=null;a.onRendered=null;a._init=function(){a._columns=a.columns();q(a._columns,null,0,0);a.pageSizeSub=cube.subscribe(a.pageSize,a.load);a.argsSub=cube.subscribe(a.args,function(){a.load()});a._selectedIdsSub=cube.subscribe(a._selectedIds,a.chkboxClick);
a._selectedAllSub=cube.subscribe(a._selectedAll,a.chkboxAllClick);a.selectedIdsSub=cube.subscribe(a.selectedIds,function(b){a._selectedIds(b)});a.actionsSub=cube.subscribe(a.actions,function(a){i.actions=a});a.dictsSub=cube.subscribe(a.dicts,function(c){if(cube.isArray(c)&&c.length>0&&(a._dictsKeyValue()!=null||a.autoLoad()==!1))i._parseDicts({dicts:c}),a._dictsKeyValue(i.dictsKeyValue),r({dicts:c})});i.primaryKey=a.primaryKey();i.baseUrl=a.url();i.actions=a.actions();i.type="grid";i.timeout=a.timeout();
i.loadMeta=a.loadMeta();i.data=a.items();i.onload=G;i.onerror=H;i.customHeaders=a.customHeaders();i.loadByPost=a.loadByPost();i.init();if(a.autoLoad()){var c=cube.getPageViewModelByNode($("#"+a.searchBoxId()));c&&!c._isload()&&(cube.notEmpty(c.url())||c._lazyload())?cube.subscribe(c._isload,function(){a.load()}):a.load()}else r();a.isAllowAppend()&&x(a._showItemColumns())};a.setActions=function(c){a.actions=c};a.chkboxClick=function(c){for(var b=a.items(),d=a.primaryKey(),f=0,e=b.length;f<e;f++){if(typeof b[f][d]==
"undefined"){cube.indicate("warning",cube.msg("SET_PRIMARYKEY"));break}a.isRadio()&&cube.notEmpty(c)&&c==String(b[f][d])?a._selectedItems.indexOf(b[f])==-1&&a._selectedItems.push(b[f]):cube.notEmpty(c)&&cube.isArray(c)&&c.indexOf(String(b[f][d]))!=-1?a._selectedItems.indexOf(b[f])==-1&&a._selectedItems.push(b[f]):a._selectedItems.remove(b[f])}if(b.length>0){a._selectedAllSub.dispose();a._selectedItems().length==b.length?a._selectedAll(!0):a._selectedAll(!1);a._selectedAllSub=cube.subscribe(a._selectedAll,
a.chkboxAllClick);if(a.onSelectedItems!=null&&!cube.isObservable(a.onSelectedItems))a.onSelectedItems(a._selectedItems());if(a.onSelectedIds!=null&&!cube.isObservable(a.onSelectedIds))a.onSelectedIds(a._selectedIds())}};a.chkboxAllClick=function(){a._selectedIdsSub.dispose();for(var c=a._selectedIds(),b=a.items(),d=a.primaryKey(),f=0,e=b.length;f<e;f++){if(typeof b[f][d]=="undefined"){cube.indicate("warning",cube.msg("SET_PRIMARYKEY"));break}a._selectedAll()?c.indexOf(String(b[f][d]))==-1&&a.checkboxVisible(b[f])&&
(a._selectedIds.push(String(b[f][d])),a._selectedItems.push(b[f])):(a._selectedIds.shift(),a._selectedItems.shift())}if(a.onSelectedItems!=null&&!cube.isObservable(a.onSelectedItems))a.onSelectedItems(a._selectedItems());if(a.onSelectedIds!=null&&!cube.isObservable(a.onSelectedIds))a.onSelectedIds(a._selectedIds());a._selectedIdsSub=cube.subscribe(a._selectedIds,a.chkboxClick)};a.setSelectedItem=function(c,b){if(a._isEdited()&&a._selectedItem()!=c){if(!m(1))return;if(a.onItemEditing!=null&&!cube.isObservable(a.onItemEditing))a.onItemEditing(c,
b);for(var d in a._editedItem)d!="mxVirtualId"&&i.setValue(a._editedItemObj,d,a._editedItem[d]());a.items.replace(a.items()[a._editedItemIndex],a._editedItemObj);var f={},e={};for(d in c)f[d]=cube.obj(c[d]),e[d]=c[d];a._editedItem=f;a._editedItemObj=e;a._editedItemIndex=b}a._selectedItem(c);if(a.onSelectedItem!=null&&!cube.isObservable(a.onSelectedItem))a.onSelectedItem(c)};a.cancelSelectedItem=function(){a._selectedItem(null)};a.dblclick=function(c){if(a.onDblClick!=null&&!cube.isObservable(a.onDblClick))a.onDblClick(c)};
a.delItem=function(c){cube.indicate("confirm",cube.msg("CONFIRM_DELETE"),function(){if(a.onItemDeleting!=null&&!cube.isObservable(a.onItemDeleting)){var b={cancel:!1,data:c};a.onItemDeleting(b);if(b.cancel)return}var d=c[a.primaryKey()];if(d&&a.autoDelete())i.ondeleted=function(b,e){a.items.remove(c);a._selectedIds.remove(d);if(a.onItemDeleted!=null&&!cube.isObservable(a.onItemDeleted))a.onItemDeleted(c,e);a.refreshDeleted()&&a.load()},i.remove(d,c);else if(a.items.remove(c),a.onItemDeleted!=null&&
!cube.isObservable(a.onItemDeleted))a.onItemDeleted(c)})};a.delSelectedItem=function(){cube.indicate("confirm",cube.msg("CONFIRM_DELETE"),function(){var c=a._selectedItem();if(a.onItemDeleting!=null&&!cube.isObservable(a.onItemDeleting)){var b={cancel:!1,data:c};a.onItemDeleting(b);if(b.cancel)return}var d=c[a.primaryKey()];if(d&&a.autoDelete())i.ondeleted=function(b,e){a.items.remove(c);a._selectedIds.remove(d);if(a.onItemDeleted!=null&&!cube.isObservable(a.onItemDeleted))a.onItemDeleted(c,e);a.refreshDeleted()&&
a.load()},i.remove(d);else if(a.items.remove(c),a.onItemDeleted!=null&&!cube.isObservable(a.onItemDeleted))a.onItemDeleted(c)})};a.delCheckedItem=function(){cube.indicate("confirm",cube.msg("CONFIRM_DELETE"),function(){var c=a._selectedIds();if(a.onItemDeleting!=null&&!cube.isObservable(a.onItemDeleting)){var b={cancel:!1,data:c};a.onItemDeleting(b);if(b.cancel)return}if(a.autoDelete())i.ondeleted=function(b,f){for(var e=0;e<c.length;e++)a.items.remove(u.getItem(a.items(),a.primaryKey(),c[e]));if(a.onItemDeleted!=
null&&!cube.isObservable(a.onItemDeleted))a.onItemDeleted(c,f);a.refreshDeleted()&&a.load()},i.remove(c);else{for(b=0;b<c.length;b++)a.items.remove(u.getItem(a.items(),a.primaryKey(),c[b]));if(a.onItemDeleted!=null&&!cube.isObservable(a.onItemDeleted))a.onItemDeleted(c)}a._selectedIds([])})};a.editItem=function(c,b){if(a._isEdited()&&a._selectedItem()!=c){if(!m(1))return;for(var d in a._editedItem)d!="mxVirtualId"&&i.setValue(a._editedItemObj,d,a._editedItem[d]());a.items.replace(a.items()[a._editedItemIndex],
a._editedItemObj)}if(a.onItemEditing!=null&&!cube.isObservable(a.onItemEditing))a.onItemEditing(c,b);var f={},e={};for(d in c)d==a.primaryKey()&&c[d]==null||(f[d]=cube.obj(c[d]),e[d]=c[d]);(d=a._showItemColumns())&&d.length>0&&$.each(d,function(b,d){if(d.editorType=="FileEditor")d.pkVal&&cube.isObservable(d.pkVal)?d.pkVal(c[a.primaryKey()]):d.pkVal=cube.obj(c[a.primaryKey()])});a._editedItemIndex=b;a._editedItem=f;a._editedItemObj=e;a._isEdited(!0);a._selectedItem(c)};a.shiftupItem=function(){var c=
a.items.indexOf(this);c>0&&(a.items.splice(c,1),a.items.splice(c-1,0,this))};a.shiftdownItem=function(){var c=a.items.indexOf(this);c<a.items().length-1&&(a.items.splice(c,1),a.items.splice(c+1,0,this))};a.saveItem=function(){if(m(1)){if(a.autoSave()){for(var c in a._editedItem)c!="mxVirtualId"&&i.setValue(a._editedItemObj,c,a._editedItem[c]());if(a.onItemSaving!=null&&!cube.isObservable(a.onItemSaving)&&(c={cancel:!1,data:a._editedItemObj},a.onItemSaving(c),c.cancel))return;i.onsaved=function(c){if(typeof a._editedItemObj[a.primaryKey()]==
"undefined"&&c.result.newData.length>0){if(a.items.replace(a.items()[a._editedItemIndex],c.result.newData[0]),a.onItemSaved!=null&&!cube.isObservable(a.onItemSaved))a.onItemSaved(c.result.newData[0])}else if(a.items.replace(a.items()[a._editedItemIndex],a._editedItemObj),a.onItemSaved!=null&&!cube.isObservable(a.onItemSaved))a.onItemSaved(a._editedItemObj)};i.save()}else{var b={};for(c in a._editedItem)c!="mxVirtualId"&&(b[c]=a._editedItem[c]());if(a.onItemSaving!=null&&!cube.isObservable(a.onItemSaving)&&
(c={cancel:!1,data:b},a.onItemSaving(c),c.cancel))return;a.items.replace(a.items()[a._editedItemIndex],b);if(a.onItemSaved!=null&&!cube.isObservable(a.onItemSaved))a.onItemSaved(b)}a._isEdited(!1);a._editedItem=null;a._selectedItem(null)}};var k=null;a.saveAppend=function(c,b){if(m(0)){k==null&&(k=i.create());for(var d in a._appendedItem)d=="mxVirtualId"||d==a.primaryKey()||(k[d]=a._appendedItem[d]());if(c&&cube.isArray(c))for(var f=0;f<c.length;f++)for(d in c[f])d=="mxVirtualId"||d==a.primaryKey()||
(k[d]=c[f][d]);if(a.autoSave()||b===!0){if(a.onItemSaving!=null&&!cube.isObservable(a.onItemSaving)&&(f={cancel:!1,data:k},a.onItemSaving(f),f.cancel))return;for(d in k)d!=a.primaryKey()&&i.setValue(k,d,k[d]);i.onsaved=function(c){for(var b=0;b<c.result.newData.length;b++)a.items.push(c.result.newData[b]);var c=!1,b=a._showItemColumns(),d;for(d in a._appendedItem){for(var e=0;e<b.length;e++)if(d==b[e].name&&typeof b[e].value!="undefined"){cube.isObservable(b[e].value)?(a._appendedItem[d]=b[e].value,
a._appendedItemObj[d]=b[e].value()):(a._appendedItem[d](b[e].value),a._appendedItemObj[d]=b[e].value);c=!0;break}c||(a._appendedItem[d](null),a._appendedItemObj[d]=null,c=!1);delete a._appendedItem.mxVirtualId;delete a._appendedItem[a.primaryKey()]}if(a.onItemSaved!=null&&!cube.isObservable(a.onItemSaved))a.onItemSaved(k);k=null};i.save()}else{if(a.onItemSaving!=null&&!cube.isObservable(a.onItemSaving)&&(f={cancel:!1,data:k},a.onItemSaving(f),f.cancel))return;a.items.push(k);var f=!1,e=a._showItemColumns();
for(d in a._appendedItem){for(var h=0;h<e.length;h++)if(d==e[h].name&&typeof e[h].value!="undefined"){cube.isObservable(e[h].value)?(a._appendedItem[d]=e[h].value,a._appendedItemObj[d]=e[h].value()):(a._appendedItem[d](e[h].value),a._appendedItemObj[d]=e[h].value);f=!0;break}f||(a._appendedItem[d](null),a._appendedItemObj[d]=null,f=!1);delete a._appendedItem.mxVirtualId;delete a._appendedItem[a.primaryKey()]}if(a.onItemSaved!=null&&!cube.isObservable(a.onItemSaved))a.onItemSaved(k);k=null}a._isEdited(!1);
a._editedItem=null;a._selectedItem(null)}};a.cancelSaveItem=function(){a._isEdited(!1);a._editedItem=null;a._selectedItem(null);for(var c=a._showItemColumns(),b=0;b<c.length;b++)c[b].validStatus("")};a.appendItem=function(){if(m(0)){var c={},b=!1,d=a._showItemColumns(),f;for(f in a._appendedItem){c[f]=a._appendedItem[f]();for(var e=0;e<d.length;e++)if(f==d[e].name&&typeof d[e].value!="undefined"){cube.isObservable(d[e].value)?(a._appendedItem[f]=d[e].value,a._appendedItemObj[f]=d[e].value()):(a._appendedItem[f](d[e].value),
a._appendedItemObj[f]=d[e].value);b=!0;break}b||(a._appendedItem[f](null),a._appendedItemObj[f]=null,b=!1)}a.items.push(c)}};a.sortType=cube.obj(-1);a.sortName=cube.obj("");a.sortGrid=function(){var c=this.name;a.sortName(c);a.items.sort(function(b,d){var f=b[c],e=d[c];if(f==null&&e==null)return 0;else if(f==null&&e!=null)return a.sortType()==1?-1:1;else if(f!=null&&e==null)return a.sortType()==1?1:-1;!isNaN(f)&&!isNaN(e)?(f=Number(f),e=Number(e)):(f=v.convertPinyin(f),e=v.convertPinyin(e));return f==
e?0:f<e?a.sortType():a.sortType()*-1});a.sortType(a.sortType()*-1)};var s=!1,t=!1,z=0,A=0,B;a.mousedown=function(a,b,d){if(s)t=!0,z=d.clientX,A=$(a).width(),B=$(a)};a.mouseup=function(){t=!1};a.mousemove=function(a,b){if(a.colSpan==1)b.offsetX>$(a).width()-10?(a.style.cursor="e-resize",s=!0):(a.style.cursor="default",s=!1),t&&B.width(A+(b.clientX-z)+"px")};a.onCurrentPageIndexChanged=function(){a._selectedAll(!1);a._indexNotLoad()||a.load()};a.load=function(c){a.isShowLoading(!0);_startLoadTime=(new Date).getTime();
a._selectedItem(null);a._selectedIds([]);a._selectedItems.removeAll();var b=null;cube.notEmpty(c)&&$.isPlainObject(c)&&(b=c);var d={metaParams:null,dataParams:null};if(cube.notEmpty(b))cube.isEmpty(b.metaParams)&&cube.isEmpty(b.dataParams)?d.dataParams=b:d=$.extend(d,b);var f=!1;if(cube.notEmpty(c)&&cube.notEmpty(c.isSearchLoad))f=c.isSearchLoad,delete c.isSearchLoad;b="";if(cube.notEmpty(c)&&cube.notEmpty(c.filter))b=c.filter;else if(b=cube.clone(c))delete b.pageIndex,delete b.pageSize;var c=null,
c=cube.isObservable(a.args)?a.args():a.args,e=null,h=null;if(a.searchBoxId()&&(h=cube.getPageViewModelByNode($("#"+a.searchBoxId()))))if(e=cube.isObservable(h._params)?h._params():h._params,!f||!e)e=h.searchParamType()=="json"?h.getJsonSearchParam():h.getSearchParam();if(h&&h.searchParamType()=="json"){if(e.length>0){if(cube.isArray(c))for(var g=0;g<c.length;g++)e.push(c[g]);else e.push(c);if(cube.isArray(b))for(g=0;g<b.length;g++)e.push(b[g]);else e.push(b)}else e=c;b=e}else{h=f="";if($.isPlainObject(b)){for(g in b)var j=
b[g],h=h+"&"+g+"="+(cube.isObservable(j)?j():j);b=h}if($.isPlainObject(c)){for(g in c)j=c[g],f=f+"&"+g+"="+(cube.isObservable(j)?j():j);cube.notEmpty(b)?b+=f:b=f.substring(1,f.length)}else cube.isString(c)&&(b=cube.notEmpty(b)?b+"&"+c:c);if($.isPlainObject(e)){for(g in e)j=e[g],f=f+"&"+g+"="+(cube.isObservable(j)?j():j);cube.notEmpty(b)?b+=f:b=f.substring(1,f.length)}else cube.isString(e)&&(b=cube.notEmpty(b)?b+"&"+e:e)}if(cube.notEmpty(b))d.dataParams=$.extend({filter:b},d.dataParams);if(a.loadMeta()&&
cube.notEmpty(a._columns))b="",b=a._getColunmsNames().join(","),g={columns:b},d.metaParams=$.extend({columns:b},d.metaParams),d.dataParams=$.extend(g,d.dataParams);d.dataParams&&cube.notEmpty(d.dataParams.pageIndex)&&d.dataParams.pageIndex!=a.pageIndex()&&(a._indexNotLoad(!0),a.pageIndex(d.dataParams.pageIndex),a._indexNotLoad(!1));b={pageIndex:parseInt(a.pageIndex()),pageSize:parseInt(a.pageSize())};d.dataParams=$.extend(b,d.dataParams);i.load(d)};a._getColunmsNames=function(){for(var c=[],b=0;b<
a._columns.length;b++)w(c,a._columns[b]);return c};a.print=function(){D.print(a.items,a.columns,a.dicts,"groupheadergrid")};a.save=function(c){var b=null,d=a.items(),f=a.primaryKey();if(d.length>0){for(var e=0;e<d.length;e++){var h=d[e];if(h!=null){if(d[e][f]){if(b={},b[f]=d[e][f],a._editedItem&&a._editedItem[f]&&h[f]==a._editedItem[f]())h=a._editedItem}else b=i.create();for(var g in a._appendedItemObj)g=="mxVirtualId"||g==f||(b[g]=a._appendedItemObj[g]());if(c&&cube.isArray(c))for(var j=0;j<c.length;j++)for(g in c[j])g==
"mxVirtualId"||g==f||(b[g]=c[j][g]);if(m())for(g in b)g=="mxVirtualId"||g==f||(cube.isFunction(h[g])?i.setValue(b,g,b[g]!=null?b[g]:h[g]()):i.setValue(b,g,b[g]!=null?b[g]:h[g]))}}i.onsaved=function(b){if(b.p_result.resultValue.items)for(var c=0;c<d.length;c++)a.items.replace(d[c],b.p_result.resultValue.items[c])};i.save()}else a.saveAppend(c,!0);a._isEdited(!1);a._editedItem=null;a._selectedItem(null)};a.exportExcel=function(c,b,d,f){n.setBaseUrl(c);n.setParams(b);d===!0&&n.setIds(a._selectedIds());
f==!0&&n.setType("post");n.exportExcel()};var l;a._editor_upload=function(c,b){a._editedItem[c](b)};a.checkboxVisible=function(c){var b=a.checkboxHideCondition(),d=!0;if(cube.isEmpty(b))return!0;else if(typeof b=="boolean")return b;else if(cube.isArray(b))for(var f=0;f<b.length;f++){if(d=a._checkCondition(c,b[f]),!d)break}else d=a._checkCondition(c,b);return!d};a.customOperationsVisible=function(c,b){var d=!0;if(cube.isEmpty(b))d=!0;else if(typeof b=="boolean")return b;else if(cube.isArray(b))for(var f=
0;f<b.length;f++){if(d=a._checkCondition(c,b[f]),!d)break}else d=a._checkCondition(c,b);return d};a._checkCondition=function(a,b){var d=!1;switch(b.operation){case "==":d=a[b.column]==b.value;break;case "!=":d=a[b.column]!=b.value;break;case ">":d=a[b.column]>b.value;break;case "<":d=a[b.column]<b.value;break;case ">=":d=a[b.column]>=b.value;break;case "<=":d=a[b.column]<=b.value;break;case "in":cube.isArray(b.value)&&b.value.indexOf(a[b.column])!=-1&&(d=!0)}return d};a.renderCell=function(c,b,d,
f){cube.isObservable(c)&&(c=c());var e=null,h=!1,g="",e=a._dictsKeyValue();if(d.renderCell)cube.notEmpty(e)&&cube.notEmpty(e[d.name])&&(g=e[d.name][c],typeof g=="undefined"&&(g="")),e=d.renderCell(c,b,g,f,d),e==null?e=cube.notEmpty(g)?g:c:h=!0;else if(cube.notEmpty(e)&&cube.notEmpty(e[d.name]))e=e[d.name][c],typeof e=="undefined"&&(e=c);else if(typeof d.editorType!="undefined"&&d.editorType=="DateTimeEditor")e=a._parseDate(c,d.format);else{e=c;f=$(b);if(typeof d.displayLength!="undefined"&&cube.notEmpty(e))e=
String(e),e.length>d.displayLength&&(e=e.substring(0,d.displayLength)+"...");else if(typeof d.displayRow!="undefined"&&cube.notEmpty(e)){var e=String(e),g=f.width(),i=parseInt(f.css("fontSize")),g=parseInt(g/i*d.displayRow)-3;e.length>g&&(e=e.substring(0,g)+"...")}if(typeof d.displayRow!="undefined"||typeof d.displayLength!="undefined")f.css("white-space","normal"),f.css("word-break","break-all")}f=a.trBackground();if(f!=null&&d.name==f.column){g=!1;switch(f.operation){case "==":g=c==f.value;break;
case "!=":g=c!=f.value;break;case ">":g=c>f.value;break;case "<":g=c<f.value;break;case ">=":g=c>=f.value;break;case "<=":g=c<=f.value;break;case "in":cube.isArray(f.value)&&f.value.indexOf(c)!=-1&&(g=!0)}g&&$(b).parent().css("background",f.background)}e&&(e=String(e),e=a.scriptProcessing()=="clean"||h?cube.cleanScript(e):cube.escapeString(e,typeof d.isAllowAutowrap!="undefined"?d.isAllowAutowrap:a.isAllowAutowrap()));return e};a.mouseenter=function(c,b,d,f){if(typeof d.onMouseenter=="function")d.onMouseenter(c,
b);var b=String(b),c="",e=a._dictsKeyValue();cube.notEmpty(e)&&cube.notEmpty(e[d.name])&&(c=e[d.name][b],typeof c=="undefined"&&(c=""));b=cube.notEmpty(c)?c:b;typeof d.editorType!="undefined"&&d.editorType=="DateTimeEditor"&&(b=a._parseDate(b,d.format));if(e=b)b=String(b),a.scriptProcessing()=="clean"?e=b=cube.cleanScript(b):b=cube.escapeString(b,typeof d.isAllowAutowrap!="undefined"?d.isAllowAutowrap:a.isAllowAutowrap());c=(a.isAllowAutowrap()==!1||d.isAllowAutowrap==!1)&&f.scrollWidth>f.clientWidth;
if((typeof d.displayLength!="undefined"||typeof d.displayRow!="undefined"||c)&&cube.notEmpty(b))if(a.isShowTips()){e=d.displayLength;if(typeof d.displayRow!="undefined")var e=$(f).width(),h=parseInt($(f).css("fontSize")),e=parseInt(e/h*d.displayRow)-3;if(b.length>e||c)a.showCellPopDialog(!0),cube.showPopDialog(f,{popoverDirection:"top",content:b.replace(/\n/g,"<br/>"),isShowDialog:a.showCellPopDialog})}else $(f).attr("title",e)};a.mouseleave=function(c,b,d){if(typeof d.onMouseleave=="function")d.onMouseleave(c,
b);a.showCellPopDialog(!1)};a._parseDate=function(a,b){if(cube.notEmpty(a)){cube.isString(a)||(a=String(a));var d=new Date(a.replace(/-/g,"/"));F.isDigit(a)&&(cube.isEmpty(b)&&(b="yyyy-MM-dd HH:mm:ss"),a.length==10&&(a+="000"),a.length==13&&(d=new Date(parseInt(a))));cube.isEmpty(b)?b=a:(b=b.replace(/yyyy/g,d.getFullYear()),b=b.replace(/MM/g,o(d.getMonth()+1,"00")),b=b.replace(/dd/g,o(d.getDate(),"00")),b=b.replace(/HH/g,o(d.getHours(),"00")),b=b.replace(/mm/g,o(d.getMinutes(),"00")),b=b.replace(/ss/g,
o(d.getSeconds(),"00")))}else b=a;return b};a.appendCustomClick=function(c){if(cube.isFunction(c.click)){var b={},d;for(d in a._appendedItem)d=="mxVirtualId"||d==a.primaryKey()||(b[d]=a._appendedItem[d]());c.click(b)}};a.onload=function(c){var b=$(c).find(".tableBody"),d=a.watermarkOptions();if(cube.notEmpty(d)&&cube.notEmpty(d.text)){d=$.extend(a._watermarkOptionsDefaultValue(),d);d.indent=(parseInt(d.width)+parseInt(d.xSpace))/2;a.watermarkOptions(d);for(var f=parseInt((b.height()-d.y)/(parseInt(d.height)+
parseInt(d.ySpace)))+1,e=0;e<f;e++)a.watermarkRows.push({y:d.y+(parseInt(d.height)+parseInt(d.ySpace))*e});b=parseInt((b.width()-d.x)/(parseInt(d.width)+parseInt(d.xSpace)))+1;for(e=0;e<b;e++)a.watermarkCols.push({x:d.x+(parseInt(d.width)+parseInt(d.xSpace))*e})}if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(c)};cube.endViewModel(a,p)}cube.importComponent("editor.commoneditor");cube.importComponent("editor.datetimeeditor");cube.importComponent("editor.dropdowneditor");cube.importComponent("datacontainer.pagenavibar");
cube.importComponent("controls.loading");p.prototype.dispose=function(){this.pageSizeSub.dispose();this.argsSub.dispose();this._selectedIdsSub.dispose();this._selectedAllSub.dispose();this.actionsSub.dispose();this.dictsSub.dispose();this.selectedIdsSub.dispose()};return p});define("lockedgrid",["../datagrid/datagrid.js"],function(l){function g(i){function g(a,d,e){var b=a.height(),f=d.height();b>f?(d.height(b),e.height(b)):(a.height(f),e.height(f))}function k(){if(!cube.isObservable(a.$node)){var c=a.$node.find(".table-main"),d=a.$node.find(".table-right"),c=c.find(".tableBody"),e=d.find(".tableBody"),b=a.$node.find(".table-operations .tableBody");d[0].scrollWidth>d[0].clientWidth?(a._hasHScroll(!0),a.isShowTempColumn(!1),c.height(parseInt(e.height(),10)-16),b.height(parseInt(e.height(),
10)-16)):(a._hasHScroll(!1),c.height(parseInt(e.height(),10)),b.height(parseInt(e.height(),10)),j==0&&a.isShowTempColumn(!0));c=a.height();isNaN(parseInt(c,10))||cube.isString(c)&&c.indexOf("%")!=-1?a.$node.children(".lockedgrid").height(parseInt(d.height(),10)):a._isSetHeight(!0)}}i._lazyInit=!0;l.call(this,i);var h={},a=this;a.lockedColumns=[];a._hasHScroll=!1;a._emptyWidth=null;a._isSetHeight=!1;a.$node=null;h._init=a._init;a._init=function(){a._hasVScrollSub=cube.subscribe(a._hasVScroll,a.adjustWidth);
a._selectedItemSub=cube.subscribe(a._selectedItem,a.adjustHeight);a.isShowLoadingSub=cube.subscribe(a.isShowLoading,a.adjustHeight);h._init()};var j=0;a.initColumn=function(c){var d=a.columns();if(d&&d.length>0&&a.lockedColumns().length==0){for(var e=0;e<d.length;e++){var b=d[e];if(cube.isEmpty(b))return!0;if(typeof b.validStatus=="undefined")b.validStatus=cube.obj("");else if(!cube.isObservable(b.validStatus))b.validStatus=cube.obj(b.validStatus);if(typeof b.validHint=="undefined")b.validHint=cube.obj("");
else if(!cube.isObservable(b.validHint))b.validHint=cube.obj(b.validHint);if(typeof b.align=="undefined")b.align="";if(typeof b.width=="undefined")b.width=cube.obj(a.columnDefaultWidth()),j++;else if(!cube.isObservable(b.width))cube.notEmpty(b.width)&&(b.width=="auto"||cube.isString(b.width)&&b.width.indexOf("%")!=-1)&&j++,b.width=cube.obj(b.width);if(!b.editorType)b.editorType="TextEditor";if(b.editorType=="DropDownEditor"||b.editorType=="CheckListEditor"||b.editorType=="ListEditor"||b.editorType==
"LabelEditor"){if(c&&c.dicts&&c.dicts[b.name])b.list=c.dicts[b.name]}else if(b.editorType=="FileEditor")if(b.pkVal){if(!cube.isObservable(b.pkVal))b.pkVal=cube.obj(b.pkVal)}else b.pkVal=cube.obj(null);b.locked===!0&&a.lockedColumns.push(b)}a.adjustWidth()}};a.adjustWidth=function(){if(cube.notEmpty(a.$node)&&!cube.isObservable(a.$node)){var c=0,d=a.$node.find(".table-main"),e=a.$node.find(".table-right"),b=d.find(".tableHeader th");d.find(".tableBody");e.find(".tableBody");a.$node.find(".table-operations .tableBody");
for(var f=0;f<b.length;f++)f!=b.length-1&&(c+=b.eq(f).outerWidth());b=2;a.isAllowOperations()&&(b=a.$node.find(".table-operations").outerWidth(),cube.ieVersion>-1&&cube.ieVersion<=8&&b++);d.width(c);e.css("left",c+1);e.width(a.$node.children(".lockedgrid").outerWidth()-c-b);a._emptyWidth(e.find(".tableHeader .table").width()+"px");k()}};a.adjustHeight=function(c){if(cube.isBoolean(c))c||setTimeout(function(){for(var b=a.$node.find(".table-main .tableBody .table tr"),d=a.$node.find(".table-right .tableBody .table tr"),
e=a.$node.find(".table-operations .tableBody .table tr"),c=0;c<b.length;c++)g(b.eq(c),d.eq(c),e.eq(c));k()},200);else{var d=a._editedItemIndex;cube.isObservable(d)&&(d=d());var e=a.$node.find(".table-main .tableBody .table tr:eq("+d+")"),b=a.$node.find(".table-right .tableBody .table tr:eq("+d+")"),f=a.$node.find(".table-operations .tableBody .table tr:eq("+d+")");c!=null?setTimeout(function(){g(e,b,f)},150):(e.css("height",""),b.css("height",""),f.css("height",""))}};h.onload=a.onload;a.onload=function(c){h.onload();
a.$node=$(c);a.$tableBody=a.$node.find(".table-right .tableBody");a.$tableHeader=a.$node.find(".table-right .tableHeader .table");var d=a.$node.find(".table-main .tableBody");a.$tableBody.scroll(function(c){a.$tableHeader.css("left",0-c.target.scrollLeft);a.isAllowOperations()||d.scrollTop(c.target.scrollTop)});a.isAllowOperations()&&a.$node.find(".table-operations .tableBody").scroll(function(c){d.scrollTop(c.target.scrollTop);a.$tableBody.scrollTop(c.target.scrollTop)});a.$node.children(".lockedgrid").resize(function(){a.adjustWidth()});
a.adjustWidth()};cube.endViewModel(a,i)}g.prototype.dispose=function(){this._hasVScrollSub.dispose();this._selectedItemSub.dispose();this.isShowLoadingSub&&this.isShowLoadingSub.dispose()};return g});define("pagenavibar",["CheckUtil"],function(i){function f(f){function j(a,b,e){var a=parseInt(a),d=parseInt(b),b=parseInt(e);isNaN(b)||b<=0?b=1:b>a&&(b=a);e=[];if(d>=a){for(d=1;d<=a;d++)e.push({text:d});return e}var h=parseInt(d/2);b-=h;for(var f=b+d,g=0,h=0,d=b;d<f;d++)d<=0?g+=1:d>a?h+=1:e.push({text:d});for(d=0;d<g;d++)e.push({text:d+f});if(h>0){a=[];for(d=h;d>=1;d--)a.push({text:b-d});$.merge(a,e);return a}return e}function g(){var c=parseInt(a.pageIndex()),b=parseInt(a.pageTotalCount());return isNaN(c)||isNaN(b)||
c<=0||c>b?!1:!0}var a=this;a.size="middle";a.p_size=cube.comp(function(){var c;a.size()=="large"?c="pagination-large page-large":a.size()=="middle"?c="page-middle":a.size()=="small"?c="pagination-small page-small":a.size()=="mini"&&(c="pagination-mini page-mini");return c},a);a.showArrow=!0;a.isShowBtnText=!1;a.showTotal=!0;a.showGoto=!0;a.showAllPage=!1;a.pageTotalCount=0;a.count=0;a.pageIndex=1;a.pageVisibleCount=5;a.pageInfoToLeft=!1;a.blurGoto=!1;a.isShowLoadTime=!1;a.loadTimeFadeout=0;a.firstIcon=
"";a.previousIcon="";a.nextIcon="";a.endIcon="";a.loadTime=0;a.pageNumbers=cube.comp(function(){return a.showAllPage()?j(a.pageTotalCount(),a.pageTotalCount(),a.pageIndex()):j(a.pageTotalCount(),a.pageVisibleCount(),a.pageIndex())},a);a.onPageIndexChanged=null;a.onRendered=null;a.oldPageIndex=1;a._init=function(){a.pageIndexSub=cube.subscribe(a.pageIndex,function(c){cube.isEmpty(c)||(i.isPlusInteger(c)?(c<=0&&(a.pageIndex(1),c=1),c>a.pageTotalCount()&&(c=parseInt(a.pageTotalCount()),c==0&&(c=1),a.pageIndex(c)),
a.oldPageIndex()!=c&&a.onPageIndexChanged!=null&&!cube.isObservable(a.onPageIndexChanged)&&(a.oldPageIndex(c),a.onPageIndexChanged(parseInt(c)))):(a.pageIndex(a.oldPageIndex()),a.oldPageIndex()))})};a.onFirstPageClick=function(){g()&&a.pageIndex()!=1&&a.pageIndex(1)};a.onPagePreviousClick=function(){g()&&a.pageIndex()!=1&&a.pageIndex(a.pageIndex()-1)};a.onPageNextClick=function(){g()&&a.pageIndex()!=a.pageTotalCount()&&a.pageIndex(parseInt(a.pageIndex())+1)};a.onEndPageClick=function(){g()&&a.pageIndex()!=
a.pageTotalCount()&&a.pageIndex(a.pageTotalCount())};a.onPageIndexClick=function(){a.pageIndex(this.text)};a._input_keydown=function(a,b){var e=(b.currentTarget?b.currentTarget:b.srcElement).value;if(cube.notEmpty(e)&&!i.isPlusInteger(e))return!1;return!0};a._input_keypress=function(c,b){a.pageIndex();return b.which>=48&&b.which<=57&&b.ctrlKey==!1&&b.shiftKey==!1||b.which==0||b.which==8?!0:b.ctrlKey==!0&&(b.which==99||b.which==118)?!0:!1};a.onload=function(c){var b=a.loadTimeFadeout();a.isShowLoadTime()&&
b>0&&$(c).find("ul.loadtime").fadeOut(b);if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(c)};cube.endViewModel(a,f)}f.prototype.dispose=function(){this.p_size.dispose()};return f});define("searchbox",["entityContainer","JSONUtil","CheckUtil","Validator"],function(t,x,n,o){function k(k){function u(b){var c={},c=cube.isEmpty(b.items)?{}:cube.isArray(b.items)?b.items[0]:b.items;cube.notEmpty(b.dicts)&&cube.isArray(b.dicts)&&b.dicts.length>0&&a._dicts(b.dicts);if(cube.notEmpty(c))for(var b=a.fields(),e=0;e<b.length;e++){var d=c[b[e].name];if(cube.notEmpty(d))b[e].value(d),h[e].value=d}a._isload(!0);if(a.isCustomTemplate()==!0&&p==!0&&q==!1)a.onload(l);if(a.onLoaded!=null&&!cube.isObservable(a.onLoaded))a.onLoaded(c)}
function v(){a._isload(!0)}function w(b,c,e){b.editorType=="DateTimeEditor"&&cube.notEmpty(b.value)&&a._lazyload(!0);if(cube.notEmpty(c.value))b.value=cube.obj(c.value);else if(b.value){if(!cube.isObservable(b.value))b.value=cube.obj(b.value)}else b.value=cube.obj("");if(b.editorType=="DropDownEditor"||b.editorType=="CheckListEditor"||b.editorType=="ListEditor")if(e&&e[b.name]&&(cube.isEmpty(b.autoDict)||b.autoDict==!0))cube.isObservable(b.list)?b.list(e[b.name]):b.list=e[b.name];else if(c.list)b.list=
cube.array(c.list);else if(b.list){if(!cube.isObservable(b.list))b.list=cube.array(b.list)}else b.list=cube.array([]);if(cube.isEmpty(b.nullable))b.nullable=cube.obj(!0);else if(!cube.isObservable(b.nullable))b.nullable=cube.obj(b.nullable);if(typeof b.validStatus=="undefined")b.validStatus=cube.obj("");else if(!cube.isObservable(b.validStatus))b.validStatus=cube.obj(b.validStatus);if(typeof b.validHint=="undefined")b.validHint=cube.obj("");else if(!cube.isObservable(b.validHint))b.validHint=cube.obj(b.validHint);
a.isCustomTemplate()==!0&&(a.editors[b.name]=b);return b}var a=this,f=new t;a.url="";a.id=null;a.timeout=null;a.loadByPost=!1;a.displaySearchButton=!0;a.displayResetBtns=!0;a.buttonAlign=null;a.separator="";a.param=null;a.style="";a.fields=[];a.data=null;a.editors=null;a.sqlCheck=!0;a.editorWidth=cube.theme=="small"?"98px":cube.theme=="middle"?"116px":"136px";a.captionSpanNum=5;a.editorSpanNum=7;a.isLineFeed=!0;a.isDefaultLayout=!0;a.colNum=3;a.emptyDefaultValue=!1;a.allowSqlKeyQuery=!0;a.searchParamType=
"string";a.encodeValue=!1;a.gridId=null;a.customBtns=[];a.validHintType="pop";a.isValid=!0;a.isCustomTemplate=!0;a._params=null;a._dicts=null;a._editorWidth1="";a._editorWidth2="";a._colnum="three";a.isShowPopDialog=!1;a.onSearch=null;a.onReset=null;a.onRendered=null;a.onLoaded=null;a._isload=!1;a._lazyload=!1;var h=null,l=null,r=0,q=!1,p=!1;a._init=function(){a.editors={};a._editorWidth1(parseInt(a.editorWidth().replace("px",""),10)+38+"px");a._editorWidth2(parseInt(a.editorWidth().replace("px",
""),10)+52+"px");a.dictsSub=cube.subscribe(a._dicts,a.setFiledDicts);h=a.fields();a._mergeFields();if(cube.notEmpty(a.url())||a.data()!=null)f.baseUrl=a.url(),f.meta=h,f.type="form",f.timeout=a.timeout(),f.loadMeta=!1,f.onload=u,f.onerror=v,f.data=a.data(),f.dicts=a._dicts(),f.loadByPost=a.loadByPost(),f.init(),a.load()};a.load=function(){f.load(a.id(),a.param())};a.search=function(){if(!a.isValid()||a.validate())if(l_params=a.searchParamType()=="json"?a.getJsonSearchParam():a.getSearchParam(),!(a.allowSqlKeyQuery()==
!1&&a._isSqlInject)){a._params=l_params;if(a.onSearch!=null&&!cube.isObservable(a.onSearch)){var b=1,c=null;a.gridId()!=null&&(c=cube.getPageViewModelByNode($("#"+a.gridId())));c&&(b=c.pageIndex(),c._indexNotLoad(!0),c.pageIndex(1),c._indexNotLoad(!1));var e={cancel:!1},d=a.onSearch(l_params,e);if(e.cancel||d===!1){c&&(c._indexNotLoad(!0),c.pageIndex(b),c._indexNotLoad(!1));return}}a.loadGrid(!0)}};a.reset=function(){a.isShowPopDialog(!1);for(var b=a.fields(),c=0;c<b.length;c++){var e=null;if(!a.emptyDefaultValue())for(var d=
0;d<h.length;d++)if(h[d].name==b[c].name){e=h[d].editorType=="DropDownEditor"&&h[d].isSelectedFirst&&cube.notEmpty(h[d].list[0].value)?cube.isObservable(h[d].list[0].value)?h[d].list[0].value():h[d].list[0].value:h[d].editorType=="DateTimeEditor"&&h[d].isShowValue?(new Date).getTime():cube.isObservable(h[d].value)?h[d].value():h[d].value;break}b[c].value.silentUpdate(typeof e=="undefined"?"":e)}if(a.onReset!=null&&!cube.isObservable(a.onReset))a.onReset()};a.getJsonSearchParam=function(){a._isSqlInject=
!1;for(var b=[],c=a.fields(),e=[],d=0;d<c.length;d++){var m=c[d].name,g=c[d].value();if(cube.notEmpty(g)){var j={},h=[];if((c[d].editorType=="TextEditor"||c[d].editorType=="NumberEditor")&&a.sqlCheck()){var f=n.isSqlInjection(g);if(!f.successful&&e.indexOf(f.hint)==-1){e.push(f.hint);continue}}f={};f.fieldName=m;f.operator="=";f.value=g;h.push(f);j.criterions=h;j.junction="and";j.columnJunction="and";b.push(j)}}if(!a.allowSqlKeyQuery()&&e.length>0)a._isSqlInject=!0,c=e.join(","),cube.indicate("error",
cube.msg("SQL_INJECTION",{sql:c}));return b};a.getSearchParam=function(){a._isSqlInject=!1;for(var b="",c=a.fields(),e=[],d=0;d<c.length;d++){var m=c[d].name,g=c[d].value();if(cube.notEmpty(g))if(c[d].editorType=="TextEditor"||c[d].editorType=="NumberEditor")if(a.sqlCheck()){var j=n.isSqlInjection(g);j.successful?b=b+m+"="+(a.encodeValue()==!0?encodeURIComponent(g):g)+"&":e.indexOf(j.hint)==-1&&e.push(j.hint)}else b=b+m+"="+(a.encodeValue()==!0?encodeURIComponent(g):g)+"&";else b=b+m+"="+(a.encodeValue()==
!0?encodeURIComponent(g):g)+"&"}if(!a.allowSqlKeyQuery()&&e.length>0)a._isSqlInject=!0,c=e.join(","),cube.indicate("error",cube.msg("SQL_INJECTION",{sql:c}));b.length>0&&(b=b.substring(0,b.length-1));return b};var s=!1;a.setDicts=function(b){s||(a._dicts(b),s=!0)};a.setFiledDicts=function(b){var c=a.fields();$.each(c,function(a,c){if(cube.notEmpty(c)&&(c.editorType=="DropDownEditor"||c.editorType=="CheckListEditor"||c.editorType=="ListEditor"))if(b&&b[c.name]&&(cube.isEmpty(c.autoDict)||c.autoDict==
!0))cube.isObservable(c.list)?c.list(b[c.name]):c.list=b[c.name];else if(c.list)c.list=cube.array(c.list);else if(c.list){if(!cube.isObservable(c.list))c.list=cube.array(c.list)}else c.list=cube.array([])})};a.loadGrid=function(b){if(a.gridId()!=null){var c=cube.getPageViewModelByNode($("#"+a.gridId()));c&&c.load({pageIndex:1,isSearchLoad:b})}};a._mergeFields=function(){var b=cube.clone(h),c=a.fields(),e=a._dicts();$.each(b,function(a,b){if(cube.notEmpty(b)){for(i in b)i=="length"&&delete p_field[i];
$.each(b,function(a,c){if(cube.isEmpty(b[a])||cube.isEqual(a,"readOnly")||cube.isEqual(a,"maxLength")||cube.isEqual(a,"nullable"))b[a]=c});var g=null;c&&(g=c[a]);w(b,g,e)}});a.fields(b)};a.validate=function(){for(var b=a.fields(),c=0;c<b.length;c++)if(!a.valid(b[c])||cube.isObservable(b[c].validStatus)&&b[c].validStatus()!="")return!1;return!0};a.valid=function(b){var c=!0;if((cube.isObservable(b.visible)?b.visible():b.visible)===!1)return b.validStatus(""),b.validHint(""),a.isShowPopDialog(!1),c;
var e=b.value();if(b.editorType=="NumberEditor"){var d=o.validate(e,"DIGIT",null);d.successful||(e="")}var f;b.customValidate!=null&&cube.isFunction(b.customValidate)&&!cube.isObservable(b.customValidate)&&(f=b.customValidate(e));if(f===!1||$.isPlainObject(f)&&f.successful===!1)return $.isPlainObject(f)&&f.hint&&(c=!1,b.validStatus("error"),a.validHintType()=="pop"?(a.isShowPopDialog(!1),a.isShowPopDialog(!0),cube.showPopDialog($(l).find("#"+b.name),{content:f.hint,popoverDirection:"bottom",msgType:"error",
isShowDialog:a.isShowPopDialog})):b.validHint(f.hint)),c;d=b.validType;f=cube.isObservable(b.nullable)?b.nullable():b.nullable;typeof f!="undefined"&&f===!1&&(d==null?d="NOTNULL":d.indexOf("NOTNULL")==-1&&(d+=", NOTNULL"));if(d&&d.indexOf("NOTNULL")==-1&&cube.isEmpty(e))return c;d!=null?(d=o.validate(e,d,b.validOptions),d.successful?(b.validStatus(""),b.validHint(""),a.isShowPopDialog(!1)):(b.validStatus("error"),c=!1,a.validHintType()=="pop"?(a.isShowPopDialog(!1),a.isShowPopDialog(!0),cube.showPopDialog($(l).find("#"+
b.name),{content:d.hint,popoverDirection:"bottom",msgType:"error",isShowDialog:a.isShowPopDialog})):b.validHint(d.hint))):(b.validStatus(""),b.validHint(""),a.isShowPopDialog(!1));return c};a.customBtnClick=function(b,c){var e=!0;a.isValid()&&cube.notEmpty(c)&&c==!0&&(e=a.validate());cube.isFunction(b)&&e&&b()};a._getSpanNum=function(b,c){if(c==0)return b&&typeof b.spanNum!="undefined"?"span"+b.spanNum:a.isDefaultLayout()?b&&typeof b.colspan!="undefined"?a.colNum()==5?"span50":"span"+b.colspan*Math.floor(12/
a.colNum()):a.colNum()==5?"span50":"span"+Math.floor(12/a.colNum()):"fluid";else if(c==1){if(a.isDefaultLayout())return b&&typeof b.captionSpanNum!="undefined"?a.colNum()==5?"span51":"span"+b.captionSpanNum:a.colNum()==5?"span51":"span"+a.captionSpanNum()}else if(c==2)return a.isDefaultLayout()?b&&typeof b.editorSpanNum!="undefined"?a.colNum()==5?"span52":"span"+b.editorSpanNum:a.colNum()==5?"span52":"span"+a.editorSpanNum():"fluid";else if(c==3)if(a.isDefaultLayout()){var e=a.buttonAlign(),d=a.fields();
if(e==null||e=="left")return a.colNum()==5?"span50":"span"+Math.floor(12/a.colNum());else if(a.isLineFeed()==!1&&cube.isArray(d))return a.colNum()==5?"span50":"span"+(a.colNum()-d.length%a.colNum())*Math.floor(12/a.colNum())}else return"";else if(c==4){if(e=a.buttonAlign(),e==null||e=="left")return a.colNum()==5?"span51":"span"+a.captionSpanNum()}else if(c==5&&(e=a.buttonAlign(),e==null||e=="left"))return a.colNum()==5?"span52":"span"+a.editorSpanNum()};a.getEditorParam=function(b){var c=cube.clone(b);
c.validHintType=a.validHintType;c.isValid=a.isValid;c.isShowPopDialog=a.isShowPopDialog;c.onRendered=a.editorRendered;if(b.editorType=="DateTimeEditor")c.width=typeof b.width!="undefined"?b.width:a.editorWidth;else if(b.editorType=="DropDownTreeEditor")c.width=typeof b.width!="undefined"?b.width:a.editorWidth,c.isExtDisplay=typeof b.isExtDisplay!="undefined"?b.isExtDisplay:!0;else if(b.editorType!="DateTimeEditor"&&b.editorType!="FileEditor"&&b.editorType!="RichEditor")c.width=typeof b.width!="undefined"?
b.width:typeof b.editorType!="undefined"&&(b.editorType!="DropDownEditor"||b.editorType=="DropDownEditor"&&typeof b.isAllowEdit!="undefined"&&b.isAllowEdit==!0)&&b.editorType!="TextEditor"?a.editorWidth:typeof b.editorType!="undefined"&&b.editorType=="DropDownEditor"?a._editorWidth2():a._editorWidth1();return c};a.editorRendered=function(b,c){if(cube.notEmpty(c)&&cube.isFunction(c.onRendered))c.onRendered(b,c);r++;if(r==a.fields().length){if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(l,
this);a._lazyload()&&cube.isEmpty(a.url())&&a._isload(!0)}};a.onload=function(b,c){l=b;p=!0;if(a.isCustomTemplate()==!0&&(cube.isEmpty(a.url())||a._isload()==!0)){q=!0;for(var e=$(b).find("*[option]"),d={},f=0;f<e.length;f++){var g=$(e[f]);cube.cleanNode(g);var d=g.attr("option").split("."),j=a.editors[d[0]],c={editors:a.editors},h="visible: typeof(editors['"+j.name+"'].visible) != 'undefined' ? editors['"+j.name+"'].visible : true";if(d[1]=="editor"){var d=a.getEditorParam(j),k="commoneditor";if(j.editorType==
"DateTimeEditor"||j.editorType=="FileEditor"||j.editorType=="RichEditor")k=j.editorType.toLowerCase();d={component:{name:k,params:d}};g.attr("data-bind",h+", attr: {id:'"+j.name+"', 'class' : 'form-inline ' + editors['"+j.name+"'].validStatus()+' "+j.name+"',title:editors['"+j.name+"'].validHint()}");cube.bindComponentByNode(g,d)}else d[1]=="validHint"?g.attr("data-bind","text: editors['"+j.name+"'].validHint()"):d[1]=="visible"?g.attr("data-bind",h):g.attr("data-bind","text: '"+j[d[1]]+"', "+h);
cube.bindTemlate(g,c);g.is("span")&&g.addClass("editor-option")}}};cube.endViewModel(a,k)}cube.importComponent("editor.commoneditor");cube.importComponent("editor.datetimeeditor");cube.importComponent("editor.dropdowneditor");cube.importComponent("editor.dropdowntreeeditor");cube.importComponent("controls.loading");k.prototype.dispose=function(){this.isShowPopDialog(!1);this.dictsSub.dispose()};return k});define("tree",["treeEntityContainer"],function(m){function i(i){function k(){var b=a.nodes();cube.notEmpty(a.selectedNodeId())&&(a.selectedNode(b["#"+a.selectedNodeId()]),a.setExpandedById(a.selectedNodeId()));if(cube.notEmpty(a.checkedNodeId()))for(var d=a.checkedNode(),c=a.checkedNodeId(),e=0;e<c.length;e++){var g=b["#"+c[e]];cube.notEmpty(g)&&d.indexOf(g)==-1&&(g.checked(!0),a.checkedNode.push(g),a.checkCascade()&&a.checkCascadeNodes(g,!0))}a.isShowLoading(!1);if(a.onLoaded!=null&&!cube.isObservable(a.onLoaded))a.onLoaded(a.nodes())}
function n(b){a.isShowLoading(!1);a.isNodeShowLoading(!1);if(a.onLoadError!=null&&!cube.isObservable(a.onLoadError))a.onLoadError(b)}var a=this,f=new m;a.width="auto";a.height="auto";a.url="";a.primaryKey="id";a.timeout=null;a.loadByPost=!1;a.textColName="text";a.args=null;a.keyword=null;a.autoLoad=!0;a.type="default";a.isEnabledContextMenu=!1;a.addLevel=0;a.isShowCheckbox=!1;a.checkboxType="checkbox";a.onlyCheckedOne=!1;a.isShowBorder=!0;a.isShowBorderShadow=!1;a.isAllowEdit=!1;a.checkCascade=!0;
a.onlyCheckLeafNode=!1;a.contextMenuItems=[{text:cube.msg("EDIT"),route:"#edit",icon:"edit"},{text:cube.msg("ADD"),route:"#add",icon:"plus"},{text:cube.msg("DELETE"),route:"#delete",icon:"remove"}];a.nodes=[];a.selectedNode=null;a.selectedNodeId=null;a.checkedNode=[];a.checkedNodeId=[];a.customHeaders=null;a.isEnabledAccordion=!1;a.isShowLoading=!1;a.readOnlyCondition=null;a.isNodeShowLoading=!1;a._editedItem=null;a._showeditedItem=null;a.ctxMenuEdit=!1;a.level=1;a.onToggleExpand=null;a.onSelectedChanged=
null;a.onCheckedChanged=null;a.onRemoveSelected=null;a.onDblClickTreeNode=null;a.onCtxMenuItemChanged=null;a.onNodeSaving=null;a.onNodeSaved=null;a.onLoaded=null;a.onLoadError=null;a.mouseLeft=cube.obj("");a.mouseTop=cube.obj("");a._init=function(){a.type()=="menu"&&(a.isAllowEdit(!1),a.isShowCheckbox(!1));a.selectedNodeIdSub=cube.subscribe(a.selectedNodeId,function(b){a.setExpandedById(b)});a.urlSub=cube.subscribe(a.url,function(b){f.baseUrl=b;a.load()});a.argsSub=cube.subscribe(a.args,function(){a.load()});
a.checkNodeIdSub=cube.subscribe(a.checkedNodeId,function(b){for(var d=a.nodes(),c=a.checkedNode(),e=0;e<b.length;e++){var g=d["#"+b[e]];cube.notEmpty(g)&&c.indexOf(g)==-1&&(g.checked(!0),a.checkedNode.push(g),a.checkCascade()&&a.checkCascadeNodes(g,!0))}for(e=c.length-1;e>=0;e--)g=c[e],b.indexOf(g.id)==-1&&(g.checked(!1),a.checkCascade()&&a.checkCascadeNodes(g,!1),a.checkedNode.remove(g))});a.checkedNodeSub=cube.subscribe(a.checkedNode,function(b){if(b.length==0){var b=a.nodes(),d;for(d in b)b[d]&&
typeof b[d].checked=="function"&&(b[d].checked(!1),b[d].indeterminate(!1))}});a.keywordSub=cube.subscribe(a.keyword,a.filterNodes);f.baseUrl=a.url();f.type="tree";f.primaryKey=a.primaryKey();f.textColName=a.textColName();f.timeout=a.timeout();f.data=a.nodes;f.customHeaders=a.customHeaders();f.loadByPost=a.loadByPost();f.onload=k;f.onerror=n;f.init();a.autoLoad()&&a.load()};a.filterNodes=function(b,d){var c=null,c=cube.notEmpty(d)?d.childNodes():a.nodes(),e=0;if(cube.notEmpty(b))for(var g=a.textColName(),
f=c.length-1;f>=0;f--){var h=0;c[f].hasChildren()&&(h=a.filterNodes(b,c[f]));c[f][g].indexOf(b)!=-1||h>0?(c[f].visible(!0),e++):c[f].visible(!1)}else for(f=c.length-1;f>=0;f--)c[f].visible(!0);return e};a.getNodeById=function(b){return a.nodes()["#"+b]};a.checkChildNodes=function(b,d){var c=b.childNodes;cube.isObservable(c)&&(c=c());$.each(c,function(){this.indeterminate(!1);d?(this.checked(!0),a.checkedNode.push(this),a.checkedNodeId.push(String(this.id))):(this.checked(!1),a.checkedNode.remove(this),
a.checkedNodeId.remove(String(this.id)));(cube.isObservable(this.hasChildren)&&this.hasChildren()==!0||this.hasChildren==!0)&&a.checkChildNodes(this,d)})};a.checkParentNodes=function(b,d){var c=null,e=a.nodes(),g=[],f=a.checkedNode();b&&(c=e["#"+b.parentId]);d||(b.indeterminate(!1),c&&c.indeterminate(!1));if(c)for(;c;){g=c.childNodes;cube.isObservable(g)&&(g=g());var h=0,i=0;$.each(g,function(){(f.indexOf(this)!=-1||this.checked())&&h++;this.indeterminate()&&i++});if(h!=0&&h==g.length)if(a.checkboxType()==
"checkbox"){if(!a.onlyCheckLeafNode()||a.onlyCheckLeafNode()&&!c.hasChildren())a.checkedNode.push(c),a.checkedNodeId.push(String(c.id));c.checked(!0);c.indeterminate(!1)}else c.indeterminate(!0);else a.checkboxType()=="checkbox"&&(c.checked(!1),a.checkedNode.remove(c),a.checkedNodeId.remove(String(c.id))),h==0&&i==0?c.indeterminate(!1):c.indeterminate(!0);c=e["#"+c.parentId]}};a.expandNode=function(b,d){var b=b||this,d=cube.isNumber(d)?d:a.level(),c=cube.isObservable(b.hasChildren)?b.hasChildren():
b.hasChildren,e=cube.isObservable(b.childNodes)?b.childNodes():b.childNodes;if(cube.notEmpty(a.url())&&c&&(cube.isEmpty(e)||e.length==0))a.isNodeShowLoading(!0),f.onload=null,f.load(b,function(c){b.childNodes(c.nodes);a.isNodeShowLoading(!1);a.checkCascade()&&a.checkedNode().indexOf(b)!=-1&&a.checkChildNodes(b,!0)});b.expanded(!b.expanded());if(a.onToggleExpand!=null&&!cube.isObservable(a.onToggleExpand))a.onToggleExpand(b,d,b.expanded())};a.checkNode=function(b,d){var c=$(d.currentTarget?d.currentTarget:
d.srcElement);if(a.checkboxType()=="radio"){var e=a.nodes(),f=null;b&&(f=e["#"+b.parentId]);var l=!1;a.checkedNode().indexOf(b)!=-1&&(c.attr("checked",!1),l=!0);if(a.onlyCheckedOne())for(var h in e)e[h]&&typeof e[h].checked=="function"&&(e[h].checked(!1),a.checkedNode.remove(e[h]),a.checkedNodeId.remove(e[h].id));else f?(c=f.childNodes,cube.isObservable(c)&&(c=c()),$.each(c,function(){this.checked(!1);a.checkedNode.remove(this);a.checkedNodeId.remove(this.id)})):$.each(e,function(){this.checked(!1);
a.checkedNode.remove(this);a.checkedNodeId.remove(this.id)});l||a.checkedNode.push(b)}a.checkedNode().indexOf(this)!=-1?(this.checked(!0),a.checkedNodeId.push(this.id)):(this.checked(!1),a.checkedNodeId.remove(this.id));a.checkCascade()&&a.checkCascadeNodes(this,this.checked());if(a.onCheckedChanged!=null&&!cube.isObservable(a.onCheckedChanged))a.onCheckedChanged(a.checkedNode());return!0};a.checkCascadeNodes=function(b,d){a.checkboxType()=="checkbox"&&(cube.isObservable(b.hasChildren)&&b.hasChildren()==
!0||b.hasChildren==!0)&&a.checkChildNodes(b,d);a.checkParentNodes(b,d)};a.selectNode=function(b,d){a.nodes();var b=b||this,d=cube.isNumber(d)?d:a.level(),c=cube.isObservable(b.hasChildren)?b.hasChildren():b.hasChildren;if(!a.onlyCheckLeafNode()||!c)if(a.selectedNode(b),a.selectedNodeId(b.id),a.onSelectedChanged!=null&&!cube.isObservable(a.onSelectedChanged))a.onSelectedChanged(b,d);if(a.isEnabledAccordion())a.setExpandedById(b.id);else if(a.type()=="menu"){var e=cube.isObservable(b.childNodes)?b.childNodes():
b.childNodes;if(cube.notEmpty(a.url())&&c&&(cube.isEmpty(e)||e.length==0))a.isNodeShowLoading(!0),f.onload=null,f.load(b,function(c){b.childNodes(c.nodes);a.isNodeShowLoading(!1)});b.expanded(!b.expanded());if(a.onToggleExpand!=null&&!cube.isObservable(a.onToggleExpand))a.onToggleExpand(b,d,b.expanded())}};a.removeSelectNode=function(){var b=a.selectedNode();if(b){var d=null;if(a.onRemoveSelected!=null&&!cube.isObservable(a.onRemoveSelected))d=a.onRemoveSelected;f.remove(b,d)}};a.removeCheckedNode=
function(){var b=a.checkedNode();if(b&&b.length>0)if(cube.notEmpty(a.url()))f.remove(b);else for(var d=0;d<b.length;d++)f.remove(b[d])};a.appendNode=function(b,d,c){var e=f.create(b,d),g=e[a.primaryKey()];if(typeof c!="undefined"&&c==!0)f.save(function(b){var c=null,c=b&&b.resultValue&&b.resultValue.items.length>0?b.resultValue.items[0]:e;f.data()["#"+g][a.primaryKey()]=c[a.primaryKey()];if(a.onNodeSaved!=null&&!cube.isObservable(a.onNodeSaved))a.onNodeSaved(c)});else return e};a.setSelectedNodeById=
function(b){a.selectedNodeId(b);a.setExpandedById(b)};a.setCheckedNodeById=function(b){for(var d=a.nodes(),c=0;c<b.length;c++){var e=d["#"+b[c]];cube.notEmpty(e)&&a.checkedNode().indexOf(e)==-1&&(e.checked(!0),a.checkedNode.push(e),a.checkedNodeId.push(String(b[c])),a.checkCascade()&&a.checkCascadeNodes(e,!0))}};a.setExpandedById=function(b){var d=a.nodes();a.selectedNode(d["#"+b]);var c=null;(b=d["#"+b])&&(c=d["#"+b.parentId]);a.isEnabledAccordion()&&a.treeExpanded(d);if(c)for(;c;)c.expanded(!0),
c=d["#"+c.parentId]};a.dblClickNode=function(b,d){var b=b||this,d=cube.isNumber(d)?d:a.level(),c=cube.isObservable(b.hasChildren)?b.hasChildren():b.hasChildren;if(!a.onlyCheckLeafNode()||!c)if(a.selectedNode(b),a.selectedNodeId(b.id),a.onDblClickTreeNode!=null&&!cube.isObservable(a.onDblClickTreeNode))a.onDblClickTreeNode(b,d);var e=cube.isObservable(b.childNodes)?b.childNodes():b.childNodes;if(cube.notEmpty(a.url())&&c&&(cube.isEmpty(e)||e.length==0))a.isNodeShowLoading(!0),f.onload=null,f.load(b,
function(c){b.childNodes(c.nodes);a.isNodeShowLoading(!1);a.checkCascade()&&a.checkedNode().indexOf(b)!=-1&&a.checkChildNodes(b,!0)});b.expanded(!b.expanded());if(a.onToggleExpand!=null&&!cube.isObservable(a.onToggleExpand))a.onToggleExpand(b,d,b.expanded())};a.ctxMenuItemChanged=function(b){var d=a.selectedNode();if(a.onCtxMenuItemChanged!=null&&!cube.isObservable(a.onCtxMenuItemChanged))a.onCtxMenuItemChanged(b,d);else b.route=="#edit"?(a.editItem(d),a.ctxMenuEdit(!0)):b.route=="#add"?(b=a.appendNode({text:""},
{parentId:d.id,order:!1},!1),a.editItem(b),a.ctxMenuEdit(!0)):b.route=="#delete"&&cube.indicate("confirm",cube.msg("CONFIRM_DELETE"),function(){if(f.checkSaved(d[a.primaryKey()]))a.removeSelectNode();else{var b=a.nodes(),e=b["#"+d.parentId];e&&cube.isObservable(e.childNodes)&&(e.childNodes.remove(d),delete b["#"+d[a.primaryKey()]])}})};a.ctxtmenu=function(b,d){if(a.isEnabledContextMenu()){a.selectedNode(b);var c=a.contextMenuItems(),e=a.addLevel();e>0&&b.level>e&&(c=cube.clone(c),c.splice(1,1));cube.showContextmenu(d,
{contextMenuItems:c,onSelectItemChanged:a.ctxMenuItemChanged})}};a.treeExpanded=function(b){var b=a.nodes(),d=b["#"+a.selectedNodeId()],c=null,e=[];d&&(c=b["#"+d.parentId]);if(c)for(;c;)e.push(String(c.id)),c=b["#"+c.parentId];for(var f in b)f.indexOf("#")==0&&(b[f]==d||e.indexOf(String(b[f].id))!=-1?b[f].expanded(!0):b[f].expanded(!1))};var j=null;a.editItem=function(b){if(typeof b.text!="undefined"&&!cube.isObservable(b.text))b.text=cube.obj(b.text);j=b.text();a._editedItem(b)};a.saveItem=function(){var b=
cube.clone(a._editedItem());if(typeof b.text!="undefined"&&cube.isObservable(b.text))b.text=b.text();f.setValue(b,a.textColName(),b.text);var d=!0,c={node:b,cancel:!1,params:null};a.onNodeSaving!=null&&!cube.isObservable(a.onNodeSaving)&&(d=a.onNodeSaving(c));if(!(d===!1||c.cancel)){if(cube.notEmpty(c.params)&&cube.isObject(c.params))for(var e in c.params)f.setValue(b,e,c.params[e]);f.save({parentID:b.parentId},function(c){var d=null,d=c&&c.resultValue&&c.resultValue.items&&c.resultValue.items.length>
0?c.resultValue.items[0]:b;if(a.onNodeSaved!=null&&!cube.isObservable(a.onNodeSaved))a.onNodeSaved(d);a._editedItem(null)})}};a.cancelSaveItem=function(){a._editedItem().text(j);a._editedItem(null);j=null};a.showEdit=function(b){a._showeditedItem(b)};a.hideEdit=function(){a._showeditedItem(null)};a.getEnable=function(b){if(a.onlyCheckLeafNode()&&b.hasChildren())return!1;var d=a.readOnlyCondition();if(!cube.isEmpty(d))if(cube.isArray(d))for(var c=0;c<d.length;c++)if(cube.isNumber(d[c])){if(b.level==
d[c])return!1}else{if(b.itemType==d[c])return!1}else if(cube.isNumber(d)){if(b.level==d)return!1}else if(b.itemType==d)return!1;return!0};a.save=function(b){var d=[];a.isShowCheckbox()?d=a.checkedNodeId():d.push(a.selectedNodeId());f.save({items:d},!0,b)};a.load=function(b){a.isShowLoading(!0);var d=a.args();cube.notEmpty(b)&&(d=cube.isEmpty(d)?b:$.extend(d,b));f.onload=k;f.data=a.nodes;f.init();f.load(d)};cube.endViewModel(a,i)}cube.importComponent("datacontainer.treenodetmpl");cube.importComponent("editor.commoneditor");
cube.importComponent("controls.loading");i.prototype.dispose=function(){this.checkedNodeSub.dispose();this.selectedNodeIdSub.dispose();this.checkNodeIdSub.dispose();this.keywordSub.dispose();this.urlSub.dispose()};return i});define("treegrid",["../datagrid/datagrid.js","entityContainer"],function(n,o){function m(l){l._lazyInit=!0;n.call(this,l);var g={},a=this;a.treeField=null;a.expanded=!1;a.parentItem=null;var c=new o;g._init=a._init;a._init=function(){g._init();c.primaryKey=a.primaryKey();c.actions=a.actions();c.type="grid";c.timeout=a.timeout();c.dicts=a.dicts();c.loadMeta=!1;c.customHeaders=a.customHeaders();c.loadByPost=a.loadByPost();c.init()};g.editItem=a.editItem;a.editItem=function(i,f,b){g.editItem(i,f);a.parentItem=
b};g.setSelectedItem=a.setSelectedItem;a.setSelectedItem=function(i,f,b){g.setSelectedItem(i,f);if(a._isEdited())a.parentItem=b};a.appendItem=function(i,f){var b=null,e=a._selectedItems();cube.notEmpty(e)&&cube.isArray(e)&&e.length>0&&(b=e[0]);if(a.isAllEdited()||a.validate(0)){var c={},e=!1,j=a.columns();if(a.isAllEdited()){var g=a._editorValid(),l=g.length;g[l]={}}var k=a._appendedItem;cube.notEmpty(i)&&!cube.isBoolean(i)&&(k=i);var m=0,d;for(d in k){m++;c[d]=a.isAllEdited()?cube.obj(cube.isObservable(k[d])?
k[d]():k[d]):cube.isObservable(k[d])?k[d]():k[d];if(a.isAllEdited()){var h={validStatus:cube.obj(""),validHint:cube.obj("")};g[l][d]=h}for(h=0;h<j.length;h++)if(d==j[h].name&&typeof j[h].value!="undefined"){cube.isObservable(j[h].value)?(a._appendedItem[d]=j[h].value,a._appendedItemObj[d]=j[h].value()):(a._appendedItem[d](j[h].value),a._appendedItemObj[d]=j[h].value);e=!0;break}if(!e){if(cube.notEmpty(a._appendedItem[d])&&cube.isObservable(a._appendedItem[d]))a._appendedItem[d](null);cube.notEmpty(a._appendedItemObj[d])&&
(a._appendedItemObj[d]=null);e=!1}}if(m==0)(e=a._columns)&&e.length>0&&$.each(e,function(){c[this.name]=typeof this.value!="undefined"?cube.isObservable(this.value)?this.value:cube.obj(this.value):cube.obj(null);if(a.isAllEdited()){var b={validStatus:cube.obj(""),validHint:cube.obj("")};g[l][this.name]=b}});cube.notEmpty(b)?(c.parentId=b[a.primaryKey()],b.items.push(c)):a.items.push(c);if(cube.notEmpty(f)&&f===!0){b={};for(d in c)b[d]=cube.obj(c[d]);a._isEdited(!0);a._editedItem=b;a._selectedItem(c)}a.itemsChange()}};
a.loadChildren=function(i){var f=i[a.primaryKey()],b=a.url();b.lastIndexOf("/")!=b.length-1&&(b+="/");c.setBaseUrl(b+f+"/children");c.onload=function(a){i.items(a.items)};c.load()};a.shiftupItem=function(c,f){var b=a.items;if(a.parentItem!=null)b=f.items;var e=b.indexOf(c);e>0&&(b.splice(e,1),b.splice(e-1,0,c))};a.shiftdownItem=function(c,f){var b=a.items;if(a.parentItem!=null)b=f.items;var e=b.indexOf(c);e<b().length-1&&(b.splice(e,1),b.splice(e+1,0,c))};a.replaceItem=function(c,f){var b=a.items;
if(a.parentItem!=null)b=a.parentItem.items;b&&(cube.isNumber(c)?b.replace(b()[a._editedItemIndex],f):b.replace(a._editedItemObj,f))};cube.endViewModel(a,l)}cube.importComponent("datacontainer.treegriditem");m.prototype.dispose=function(){};return m});define("treegriditem",[],function(){function d(b){var a=this;a.item=b.item;a.parentItem=b.parentItem;a.grid=b.grid;a.level=b.level||1;a.index=b.index||0;a.expanded=cube.obj(!1);var c=!1;a._init=function(){if(cube.isEmpty(a.item.items))a.item.items=cube.array();else if(!cube.isObservable(a.item.items))a.item.items=cube.array(a.item.items);a.grid.expanded()&&!c&&a.expandItem()};a.expandItem=function(){var b=a.expanded();a.expanded(!b);!c&&a.expanded()&&(a.grid.loadChildren(a.item),c=!0)};a.onload=function(){a.grid.itemsChange()}}
d.prototype.dispose=function(){};return d});define("treenodetmpl",[],function(){function b(b){var a=this;a.isShowCheckbox=!1;a.checkboxType="checkbox";a.type="default";a.nodes=[];a.selectedNode=null;a.selectedNodeId=null;a.checkedNode=[];a.level=1;a.selectNode=null;a.checkNode=null;a.dblClickNode=null;a.expandNode=null;a.ctxtmenu=null;a._editedItem=null;a.saveItem=null;a.cancelSaveItem=null;a.editItem=null;a._showeditedItem=null;a.isAllowEdit=!1;a.isNodeShowLoading=!1;a.ctxMenuEdit=!1;a.onToggleExpand=null;a.onSelectedChanged=null;a.onDblClickTreeNode=null;
a._init=function(){a.level(a.level()+1)};a.showEdit=function(b){a._showeditedItem(b)};a.hideEdit=function(){a._showeditedItem(null)};a._selectNode=function(){a.selectNode(this,a.level())};a._dblClickNode=function(){a.dblClickNode(this,a.level())};a._expandNode=function(){a.expandNode(this,a.level())};a.getEnable=null;cube.endViewModel(a,b)}cube.importComponent("datacontainer.treenodeTmpl");b.prototype.dispose=function(){};return b});define("modaldialog",[],function(){function l(l){function n(){a.isShowDialog(!1);a.eleId()!=null&&window.setTimeout(function(){$("#"+a.eleId()).remove();$(".cube.modal.fade.in:last").focus()},310)}function q(b){b==!0?(a.animatShowBck(b),window.setTimeout(function(){a.animatShowDialog(b)},150)):(window.setTimeout(function(){a.animatShowBck(b)},310),window.setTimeout(function(){a.animatShowDialog(b)},10))}function u(b){$.ajax({url:b,crossDomain:cube.crosDomain(b),success:function(b){a.ajaxHtml(b)}})}var a=this;a.width=
null;a.height=null;a.top=null;a.bottom=null;a.isWidthHeightAuto=!1;a.footerHeight="auto";a.isMax=!1;a.isMin=!1;a.title="";a.content=null;a.templateOptions=null;a.isOut=!1;a.ajaxHtml="";a.result=null;a.isShowDialog=!1;a.isShowCloseBtn=!0;a.isShowMinBtn=!0;a.isShowMaxBtn=!0;a.closeBtnText=cube.msg("CLOSE");a.isShowConfirmBtn=!0;a.confirmBtnText=cube.msg("CONFIRM");a.submitFormOnConfirm=!1;a.customBtns=[];a.reverseBtn=!1;a.onConfirmBtnClick=null;a.onCloseBtnClick=null;a.onRendered=null;a.animatShowBck=
!1;a.animatShowDialog=!1;a.eleId=null;a.zIndex=1050;a._footerHeight=null;a.$e=null;a.isdrag=!1;a.tx=0;a.ty=0;a.bodyHeight=0;a.ismedDialog=!0;var e=null,r=null,s=null;a._init=function(){a.isdrag=!1;var b=a.templateOptions();cube.notEmpty(b)&&cube.notEmpty(b.name)&&b.name.indexOf("http")==0&&b.type!="viewModel"&&a.isOut(!0);q(a.isShowDialog());a.isShowDialogSub=cube.subscribe(a.isShowDialog,q);if(b!=null){if(typeof b.params=="undefined")b.params={};b.params.dialog=this;if(a.isOut()){if(cube.isEmpty(b.type))b.type=
"ajax";if("ajax"==b.type)u(b.name);else if("iframe"==b.type)b.params.dialog={},b.name+=(b.name.indexOf("?")>0?"&":"?")+"params="+JSON.stringify(b.params)}}};a.headmousedown=function(b,c){var d=a.$e.find(".modal").width(),f=a.$e.find(".modal").height();s=document.documentElement.clientHeight-30;r=document.documentElement.clientWidth-10;if(a.ismedDialog()){a.isdrag=!0;$(document).unbind("mousemove").bind("mousemove",a.headmousemove);a.tx=c.clientX;a.ty=c.clientY;e=c.currentTarget?c.currentTarget:c.srcElement;
e=e.parentNode;e.style.top=$(e).position().top+"px";if(cube.isEmpty(e.style.left))e.style.left="0px";e.style.width=d+"px";e.style.height=f+"px";e.style.bottom="";e.style.right=""}};a.headmousemove=function(b){if(a.isdrag&&a.ismedDialog()){var c=b.clientX-a.tx,d=b.clientY-a.ty,f=e.style.top,g=e.style.left,f=parseInt(f.substr(0,f.indexOf("px"))),g=parseInt(g.substr(0,g.indexOf("px"))),d=f+d,c=g+2*c;if(d<s&&d>0&&c<r)e.style.top=d+"px",e.style.left=c+"px";a.tx=b.clientX;a.ty=b.clientY}};a.headmouseup=
function(){a.isdrag=!1;$(document).unbind("mousemove",a.headmousemove)};window.onmouseup=document.onmouseup=function(){a.isdrag=!1};a.mouseout=function(a,c){for(var d=c.relatedTarget?c.relatedTarget:c.toElement;d&&d!=a;)d=d.parentNode};a.closeDialog=function(){if(a.onCloseBtnClick!=null&&!cube.isObservable(a.onCloseBtnClick))if(a.isOut()&&"iframe"==a.templateOptions().type)a._getCrosResult("close");else{var b=null;cube.notEmpty(a.result)&&(b=cube.isFunction(a.result)?a.result():a.result);b={cancel:!1,
result:b};a.onCloseBtnClick(b);if(b.cancel)return!1}n()};var o=0,p=0,j=0,k=0;a.maxDialog=function(){a.ismedDialog(!1);!a.isMax()&&!a.isMin()&&(o=a.top(),p=a.bottom(),a.isWidthHeightAuto()?(j=a.$e.find(".modal").width()+"px",k=a.$e.find(".modal").height()+"px"):(j=a.width(),k=a.height()));a.isMax(!0);a.isMin(!1);a.top("0px");a.bottom("0px");a.$e.find(".modal").css("left","0px");a.width("100%");a.height("100%")};a.minDialog=function(){a.ismedDialog(!1);!a.isMax()&&!a.isMin()&&(o=a.top(),p=a.bottom(),
a.isWidthHeightAuto()?(j=a.$e.find(".modal").width()+"px",k=a.$e.find(".modal").height()+"px"):(j=a.width(),k=a.height()));a.isMin(!0);a.isMax(!1);a.top("");a.bottom("0px");a.$e.find(".modal").css("left","0px");a.width("300px");a.height("50px")};a.normalDialog=function(){a.ismedDialog(!0);a.isMin(!1);a.isMax(!1);a.top(o);a.bottom(p);a.width(j);a.height(k)};a.confirmDialog=function(){if(a.onConfirmBtnClick!==null&&!cube.isObservable(a.onConfirmBtnClick))if(a.isOut()&&"iframe"==a.templateOptions().type)a._getCrosResult("confirm");
else{var b=null;cube.notEmpty(a.result)&&(b=cube.isFunction(a.result)?a.result():a.result);b={cancel:!1,result:b};a.onConfirmBtnClick(b);if(b.cancel)return!1}if(a.submitFormOnConfirm()){if(a.$e!==null&&(b=a.$e.find("dataform"))&&b.length>0)for(var c=0;c<b.length;c++){var d=cube.getPageViewModelByNode(b.eq(c));if(d&&d.submitForm){if(d.onSaved==null||cube.isObservable(d.onSaved))d.onSaved=function(){cube.indicate(cube.msg("SAVE_SUCCESS"));n()};d.submitForm()}}}else n()};a._getCrosResult=function(b){var c=
function(c){c=c.data;c=JSON.parse(c);c={cancel:!1,result:c};if(b=="close")a.onCloseBtnClick(c);else a.onConfirmBtnClick(c);if(c.cancel)return!1};window.addEventListener?window.addEventListener("message",c,!1):window.attachEvent("onmessage",c);document.iframe_dialog&&document.iframe_dialog.postMessage('{"__result__": true}',"*")};a.customClick=function(b){cube.notEmpty(b.click)&&typeof b.click=="function"&&b.click(a)};var t=0,m=0;a._resize=function(b,c,d,f,g){d=d+f+a._footerHeight()+g;t=="0"&&(m=c.outerHeight(),
t++);a.height()=="auto"&&a.isWidthHeightAuto()&&(m=a.$e.find(".modal-body").outerHeight());b=="a"&&(rationalHeight=parseInt($(window).height()*0.8-d));b=="b"&&(rationalHeight=parseInt($(window).height()*0.9-parseInt(a.bottom().replace("px",""))-d));b=="c"&&(rationalHeight=parseInt($(window).height()*0.9-parseInt(a.top().replace("px",""))-d));b=="d"&&(rationalHeight=parseInt($(window).height()-parseInt(a.top().replace("px",""))-parseInt(a.bottom().replace("px",""))-d));if(a.isWidthHeightAuto()||b==
"d")m>rationalHeight&&!a.isMax()&&!a.isMin()?(rationalHeight<0?a.bodyHeight("0px"):a.bodyHeight(rationalHeight+"px"),(b=="a"||b=="c")&&a.bottom(parseInt($(window).height()*0.1)+"px"),b=="b"&&a.top(parseInt($(window).height()*0.1)+"px")):m<=rationalHeight?(b=="b"&&a.top("auto"),a.bodyHeight("auto")):(b=="b"&&a.top("auto"),b=="d"&&(rationalHeight<0?a.bodyHeight("0px"):a.bodyHeight(rationalHeight+"px")))};a._tabindexKeydown=function(b){var b=b.which||b.keyCode,c=$(document.activeElement);b==27&&a.closeDialog();
b==13&&!c.is("input")&&!c.is("textarea")&&a.confirmDialog()};a.onload=function(b){a.$e=$(b);a.$e.children(".modal").attr("tabindex",1).keydown(a._tabindexKeydown);a.$e.children(".modal-backdrop").attr("tabindex",1).keydown(a._tabindexKeydown);a.$e.children(".modal").focus();var c=document;if(window.name&&window.name.indexOf("iframe_")==0)try{if(top.document&&top.cube)c=top.document}catch(d){}var c=c.documentElement.clientHeight,f=a.$e.find(".modal-header").outerHeight(),g=a.$e.find(".modal-footer").outerHeight(),
e=a.$e.find(".modal-body"),h=a.$e.find(".modal-body").outerHeight(),i=parseInt(c-f-g-a._footerHeight())/2+"px";!a.isShowCloseBtn()&&!a.isShowConfirmBtn()&&a.customBtns()==[]&&a.footerHeight()=="auto"?a._footerHeight(g):a._footerHeight(0);cube.isEmpty(a.top())?cube.isEmpty(a.height())?(a.isWidthHeightAuto()?a.height("auto"):a.height("480px"),cube.isEmpty(a.bottom())?($(window).resize(function(){var b=$(this);a._resize("a",b,f,g,h)}),e.resize(function(){var b=$(this);a._resize("a",b,f,g,h)})):(parseInt(a.bottom().replace("px",
""))>c?(a.bottom(i),a.top(i)):parseInt(a.bottom().replace("px",""))+parseInt(a.height().replace("px",""))>c&&a.bottom("auto"),$(window).resize(function(){var b=$(this);a._resize("b",b,f,g,h)}),e.resize(function(){var b=$(this);a._resize("b",b,f,g,h)}))):cube.isEmpty(a.bottom())?(a.top(parseInt(c-parseInt(a.height().replace("px","")))/2+"px"),a.bottom(parseInt(c-parseInt(a.top().replace("px",""))-parseInt(a.height().replace("px","")))+"px")):(parseInt(a.bottom().replace("px",""))>c?(a.bottom(i),a.top(i)):
parseInt(a.bottom().replace("px",""))+parseInt(a.height().replace("px",""))>c&&a.bottom("auto"),a.top(parseInt(c-parseInt(a.bottom().replace("px",""))-parseInt(a.height().replace("px","")))+"px")):(parseInt(a.top().replace("px",""))>c&&a.top(i),cube.isEmpty(a.bottom())?cube.isEmpty(a.height())?(a.isWidthHeightAuto()?a.height("auto"):a.height("480px"),$(window).resize(function(){var b=$(this);a._resize("c",b,f,g,h)}),e.resize(function(){var b=$(this);a._resize("c",b,f,g,h)})):(a.height(a.height()),
a.top(a.top()),a.bottom(parseInt(c)-parseInt(a.top().replace("px",""))-parseInt(a.height().replace("px",""))+"px")):(cube.isEmpty(a.height())?(a.height(c-parseInt(a.top().replace("px",""))-parseInt(a.bottom().replace("px",""))),$(window).resize(function(){var b=$(this);a._resize("d",b,f,g,h)})):(a.height(a.height()),a.bottom(a.bottom()),a.top(a.top())),parseInt(a.top().replace("px",""))+parseInt(a.bottom().replace("px",""))>c&&(a.bodyHeight("0px"),a.top(i),a.bottom(i))));cube.isEmpty(a.width())?a.isWidthHeightAuto()?
a.width("auto"):a.width("640px"):a.width(a.width());c=parseInt(a.height())-f-g-a._footerHeight()-h;isNaN(c)||(c<0&&!a.isWidthHeightAuto()?a.bodyHeight("0px"):a.bodyHeight(c+"px"));if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(b)};cube.endViewModel(a,l)}l.prototype.dispose=function(){this.isShowDialogSub.dispose()};return l});define("msgdialog",[],function(){function e(e){function h(b){var c=a.msgType()!="confirm"?150:0;b==!0&&(a.animatShowBck(b),window.setTimeout(function(){a.animatShowDialog(b)},c))}var a=this;a.title="";a.content="";a.templateOptions={};a.isShowDialog=!1;a.showTime=0;a.msgType="info";a.zIndex=1070;a.isShowCancelBtn=!0;a.reverseBtn=!1;a.animatShowBck=!1;a.animatShowDialog=!1;a.isdrag=!1;a.tx=0;a.ty=0;a.eleId=null;a.onConfirmBtnClick=null;var d=a.onRendered=null,i=null,j=null;a._init=function(){a.isdrag=!1;h(a.isShowDialog());
a.isShowDialogSub=cube.subscribe(a.isShowDialog,h);var b=a.showTime();b>0&&a.msgType()!="confirm"&&window.setTimeout(function(){a.disableMsgDlg()},b)};a.confirmDialog=function(){var b={cancel:!1},c=!0;a.onConfirmBtnClick!=null&&!cube.isObservable(a.onConfirmBtnClick)&&(c=a.onConfirmBtnClick(b));!b.cancel&&(cube.isEmpty(c)||c)&&a.disableMsgDlg()};a.headmousedown=function(b,c){j=document.documentElement.clientHeight-a.$e.find(".modal").height();i=document.documentElement.clientWidth-a.$e.find(".modal").width();
a.isdrag=!0;$(document).unbind("mousemove").bind("mousemove",a.headmousemove);a.tx=c.clientX;a.ty=c.clientY;d=c.currentTarget?c.currentTarget:c.srcElement;d=d.parentNode;d.style.top=$(d).position().top+"px";if(cube.isEmpty(d.style.left))d.style.left="0px"};a.headmousemove=function(b){if(a.isdrag){var c=b.clientX-a.tx,f=b.clientY-a.ty,e=d.style.top,g=d.style.left,e=parseInt(e.substr(0,e.indexOf("px"))),g=parseInt(g.substr(0,g.indexOf("px"))),f=e+f,c=g+2*c;if(f<j&&f>0&&c<i)d.style.top=f+"px",d.style.left=
c+"px";a.tx=b.clientX;a.ty=b.clientY}};a.headmouseup=function(){a.isdrag=!1;$(document).unbind("mousemove",a.headmousemove)};document.onmouseup=function(){a.isdrag=!1};a.mouseout=function(b,c){if(a.msgType()!="confirm"){for(var d=c.relatedTarget?c.relatedTarget:c.toElement;d&&d!=b;)d=d.parentNode;d!=b&&a.disableMsgDlg()}};a.disableMsgDlg=function(){if(!a.isdrag){var b=a.msgType()!="confirm"?150:0;window.setTimeout(function(){a.animatShowDialog(!1);a.isShowDialog(!1);window.setTimeout(function(){a.animatShowBck(!1);
a.eleId()!=null&&$("#"+a.eleId()).remove()},350)},b)}};a.onload=function(b){a.$e=$(b);if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(b)};cube.endViewModel(a,e)}e.prototype.dispose=function(){this.isShowDialogSub.dispose()};return e});define("popoverdialog",[],function(){function b(b){var a=this;a.isShowDialog=!0;a.popoverDirection="right";a.msgType="info";a.title="";a.content="";a.zIndex=1060;a.left=null;a.arrowLeft=null;a.right=null;a.top=null;a.bottom=null;a.isShowCloseBtn=!1;a.eleWidth=null;a.eleId=null;a.isFixed=!1;a.onRendered=null;a._init=function(){a.isFixed()&&(a.top()==null&&a.top("auto"),a.left()==null&&a.left("auto"),a.right()==null&&a.right("auto"),a.bottom()==null&&a.bottom("auto"));a.isShowDialogSub=cube.subscribe(a.isShowDialog,
function(b){b||a.eleId()!=null&&$("#"+a.eleId()).remove()})};a.closeDialog=function(){a.isShowDialog(!1);a.eleId()!=null&&window.setTimeout(function(){$("#"+a.eleId()).remove()},310)};a.onload=function(b){var e=$(b).children(".popover");if(a.isFixed())e.css("position","fixed");else{if(a.popoverDirection()=="top"){var c=e.height(),d=a.top();cube.notEmpty(d)&&a.top(parseInt(d)-c-2+"px")}if(a.popoverDirection()=="top"||a.popoverDirection()=="bottom"){a.arrowLeft("50%");var c=e.outerWidth(),d=a.left(),
f=a.eleWidth();cube.notEmpty(d)&&cube.notEmpty(f)&&(e.width(c),a.left(parseInt(d)-(c-f)/2+"px"),parseInt(d)-(c-f)/2<0&&(a.left("0px"),a.arrowLeft(c/2+parseInt(d)-(c-f)/2+"px")))}}if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(b)};cube.endViewModel(a,b)}b.prototype.dispose=function(){this.isShowDialogSub.dispose()};return b});define("commoneditor",["Validator","CheckUtil"],function(j,l){function f(g){function f(c,b){var d=a.validType();c==!1?d==null?d="NOTNULL":d.indexOf("NOTNULL")==-1&&(d+=",NOTNULL"):d!=null&&cube.notEmpty(b)&&typeof b.validType!="undefined"&&b.validType.indexOf("NOTNULL")==-1&&(d=d.replace("NOTNULL",""));a.validType(d)}function m(){setTimeout(function(){var c=a.value()+"",b=/^[+|-]?\d*[\.]?\d*$/;(!/\-*(\d+(\.\d+)*)e([\+\-])(\d+)/.test(c)&&!b.test(c)&&!/^[+|-]?\d/.test(c)||/[a-zA-Z]+/.test(c))&&a.value("")},100)}function n(a,
b){if(cube.notEmpty(a)){cube.isString(a)||(a=String(a));var d=new Date(a.replace(/-/g,"/"));l.isDigit(a)&&(a.length==10&&(a+="000"),a.length==13&&(d=new Date(parseInt(a))));b=b.replace(/yyyy/g,d.getFullYear());b=b.replace(/MM/g,h(d.getMonth()+1,"00"));b=b.replace(/dd/g,h(d.getDate(),"00"));b=b.replace(/HH/g,h(d.getHours(),"00"));b=b.replace(/mm/g,h(d.getMinutes(),"00"));b=b.replace(/ss/g,h(d.getSeconds(),"00"))}else return a;return b}function h(a,b){if(a==null)return"";if(typeof b=="undefined")return a+
"";if(typeof b=="number")return a+"";var d=a+"";if(b!=null&&b!=""){var d=d.split("."),e=b.split(".");d[0].length<e[0].length&&(d[0]=e[0].substring(0,e[0].length-d[0].length)+d[0]);if(e.length==1)return d[0];else{if(d.length>1)for(;d[1].length<e[1].length;)d[1]+="0";else d[1]=e[1];return(new Number(d[0]+"."+d[1])).toFixed(e[1].length)}}else return d}var a=this;a.name="";a.value="";a.isShowNull=!0;a.isSelectedFirst=!1;a.isCheckListVer=!1;a.isExtDisplay=!1;a.isTextEllipsis=!1;a.isValueIsEmptyEnter=!1;
a.dropdownMenuHeight="auto";a.isShowScroll=!1;a.isShowCheckbox=!1;a.isClickShow=!1;a.isAllowEdit=!1;a.blurValid=!1;a.autoMatching=!0;a._checkListvalue=[];a.readOnly=!1;a.editorType="TextEditor";a.prefixText="";a.suffixText="";a.maxLength=null;a.textMode="normal";a.textAlign="left";a.nullable=!0;a.validType=null;a.validOptions=null;a.validStatus=null;a.validHint=null;a.customValidate=null;a.isValid=!0;a.hasFocus=!1;a.type="checkbox";a.list=[];a.treeOptions={};a.isSelectedClose=!0;a.width="100%";a.height=
"100px";a.increment=1;a.format=null;a.customBtnText=null;a.labelAutowrap=!0;a.labelValue="";a.labelTitle="";a.customBtnIcon="folder-open";a.customBtnEnabled=!0;a.transferHeight="200px";a.transferWidth="100px";a.checkListCols=null;a.displayAddButton=!0;a.displayDeleteButton=!0;a.displayAddAllButton=!0;a.displayDeleteAllButton=!0;a.listRight=cube.array([]);a._addData=null;a._deleteData=null;a._isValueIsEmptyEnter=!1;a._value=null;a._isValided=null;a.isShowPopDialog=!1;a.validHintType="inline";a.itemIndex=
null;a.onChanged=null;a.onSelectedChanged=null;a.onClick=null;a.onFocus=null;var i=a.onRendered=null;a._init=function(){var c=a.list();cube.notEmpty(c)&&!cube.isArray(c)&&a.itemIndex()!=null&&cube.notEmpty(c[a.itemIndex()])&&a.list(c[a.itemIndex()]);a.customBtnIcon()==null&&a.customBtnIcon("folder-open");c=a.editorType();c=="TextEditor"&&a.textMode()=="multiline"&&cube.notEmpty(a.value())&&cube.isString(a.value())&&(a.value(a.value().replace(/\\r\\n/gi,"\n").replace(/\\n/gi,"\r\n")),a.onChanged(a.name(),
a.value()));a.format()!=null&&a.value(n(a.value(),a.format()));a.valueSub=cube.subscribe(a.value,a._changed);a.checkListvalueSub=cube.subscribe(a._checkListvalue,a._checkListValuechanged);a.hasFocusSub=cube.subscribe(a.hasFocus,function(b){if(b&&a.onFocus!=null&&!cube.isObservable(a.onFocus))a.onFocus(a.value(),a)});c=="NumberEditor"&&cube.isEmpty(a.validType())&&(a.validType("DIGIT"),a._value(a.value()));a._changeCheckListvalue(c);if(c=="LabelEditor"){a.labelValue(cube.escapeString(a.value()));a.labelTitle(a.value());
for(var c=a.list(),b=a.value(),d=0;d<c.length;d++)if(c[d].value==b){a.labelValue(cube.escapeString(c[d].text));a.labelTitle(c[d].text);break}}if(typeof g.maxLength!="undefined"&&g.maxLength!=null)c=a.validOptions(),c==null&&(c={}),c.maxLength=g.maxLength,a.validOptions(c);cube.notEmpty(a.checkListCols())&&a.initList();a.validHint("");a.validStatus("");f(a.nullable(),g);a.nullableSub=cube.subscribe(a.nullable,f)};a._changeCheckListvalue=function(c,b){if(typeof b!="undefined"&&cube.isEmpty(b))a._checkListvalue([]);
else if((c=="CheckListEditor"||c=="DropDownEditor"&&a.isShowCheckbox()==!0)&&cube.notEmpty(a.value()))c=="CheckListEditor"&&a.type()=="radio"?a._checkListvalue(a.value()):a._checkListvalue(String(a.value()).split(","))};a._list=cube.array([]);a.initList=function(){for(var c=a.list().length,b=a.checkListCols(),d=c/b,e=0;e<d;e++){for(var k=cube.array([]),f=0;f<b;f++){var g=a.list()[e*b+f];e*b+f<c&&k().push(g)}a._list().push(k)}};a._selectListItem=function(){typeof this.value!="undefined"?a.value(this.value):
a.value(this)};a.setNumberDown=function(){if(!a.readOnly()){var c=parseFloat(a.value());isNaN(c)&&(c=0,a.isValueIsEmptyEnter()&&(a._isValided(!0),a._isValueIsEmptyEnter(!0)));var b=a.validOptions();if(b&&(b=b.maxValue,typeof b!="undefined"&&c>=b))return;a.value(c+a.increment())}};a.setNumberUp=function(){if(!a.readOnly()){var c=parseFloat(a.value());isNaN(c)&&(c=0,a.isValueIsEmptyEnter()&&(a._isValided(!0),a._isValueIsEmptyEnter(!0)));var b=a.validOptions();if(b&&(b=b.minValue,typeof b!="undefined"&&
c<=b))return;a.value(c-a.increment())}};a._input_keydown=function(c,b){if(a.readOnly()&&b.keyCode==8)return b.keyCode=0,!1;var d=null;return a.isValueIsEmptyEnter()?d=cube.notEmpty(a._value())?!1:cube.isEmpty(a._value())&&a._isValided()==!1?!0:a._isValueIsEmptyEnter()?!1:!0:!0};a._input_keyup=function(){m()};a._input_keypress=function(c,b){if(a.value()==null)return!0;if(a.value().toString().indexOf("-")==-1&&b.which==45)return!0;return a.value().toString().indexOf(".")==-1&&b.which==46?!0:b.which>=
48&&b.which<=57&&b.ctrlKey==!1&&b.shiftKey==!1||b.which==0||b.which==8?!0:b.ctrlKey==!0&&(b.which==99||b.which==118)?!0:!1};a._changed=function(c,b){b!=!1&&a.isValid()&&a._valid();var d=a.editorType();if(d=="LabelEditor"){a.labelValue(cube.escapeString(a.value()));a.labelTitle(a.value());var e=a.list(),c=a.value();if(cube.isArray(e))for(var f=0;f<e.length;f++)if(e[f].value==c){a.labelValue(cube.escapeString(e[f].text));a.labelTitle(e[f].text);break}}else d=="NumberEditor"&&a.isValueIsEmptyEnter()&&
cube.isEmpty(a._value())&&(event.srcElement.className=="btn btn-success"&&(a._isValided(!1),a._isValueIsEmptyEnter(!1)),(event.srcElement.className=="caret-down"||event.srcElement.className=="caret-up")&&a._isValided(!0));a._changeCheckListvalue(d,c);if(a.onChanged!=null&&!cube.isObservable(a.onChanged))if(d=a.itemIndex(),d!=null)a.onChanged(a.name(),a.value(),d);else a.onChanged(a.name(),a.value())};a._onclick=function(c){if(a.onClick!=null&&!cube.isObservable(a.onClick)&&(a.editorType()!="CustomEditor"&&
!a.readOnly()||a.editorType()=="CustomEditor"&&a.customBtnEnabled()))(c=a.onClick(a.value(),c))&&a.value(c)};a._onkeydown=function(a,b){if(a.readOnly()&&b.keyCode==8)return b.keyCode=0,!1;return!0};a._checkListValuechanged=function(){var c=a.editorType();if(c=="CheckListEditor"||c=="DropDownEditor")c=a._checkListvalue(),a.value(cube.isArray(c)?c.join(","):c)};a._valid=function(){a.isValueIsEmptyEnter()&&(a._isValided(!0),cube.notEmpty(a.value())?a._isValueIsEmptyEnter(!0):a._isValueIsEmptyEnter(!1));
if(a.isValid()&&!a.readOnly()){var c=a.validType();if(a.editorType()=="NumberEditor"){var b=a.value();if(cube.isEmpty(b)&&c.indexOf("NOTNULL")==-1)return;else b!="-"&&(b=j.validate(a.value(),"DIGIT",null),b.successful||a.value(""))}var d;a.customValidate!=null&&cube.isFunction(a.customValidate)&&!cube.isObservable(a.customValidate)&&(d=a.customValidate(a.value()));d==!1||$.isPlainObject(d)&&d.successful==!1?(a.validStatus("error"),$.isPlainObject(d)&&d.hint&&(a.validHintType()=="pop"?(a.isShowPopDialog(!1),
a.isShowPopDialog(!0),cube.showPopDialog($(i),{content:d.hint,popoverDirection:"bottom",msgType:"error",isShowDialog:a.isShowPopDialog})):a.validHint(d.hint))):(cube.isEmpty(c)||c.indexOf("NOTNULL")==-1)&&cube.isEmpty(a.value())?(a.validStatus(""),a.validHint(""),a.isShowPopDialog(!1)):(b=j.validate(a.value(),c,a.validOptions()),b.successful?(a.validStatus(""),a.validHint(""),a.isShowPopDialog(!1)):(a.validStatus("error"),a.validHintType()=="pop"?(a.isShowPopDialog(!1),a.isShowPopDialog(!0),cube.showPopDialog($(i),
{content:b.hint,popoverDirection:"bottom",msgType:"error",isShowDialog:a.isShowPopDialog})):a.validHint(b.hint)))}};a.onload=function(c,b){i=c;var d=a.editorType();if(d!="DropDownEditor"&&d!="DropDownTreeEditor"&&a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(c,b)};cube.endViewModel(a,g)}f.prototype.dispose=function(){this.isShowPopDialog(!1);this.valueSub.dispose();this.checkListvalueSub.dispose();this.nullableSub.dispose();this.hasFocusSub.dispose()};return f});define("datetimeeditor",["CheckUtil","Validator"],function(k,t){function l(l){function r(c){var b=a.validType();c==!1?b==null?b="NOTNULL":b.indexOf("NOTNULL")==-1&&(b+=", NOTNULL"):b!=null&&(b=b.replace("NOTNULL",""));a.validType(b)}function s(c){var b,d=a.validType();a.customValidate!=null&&cube.isFunction(a.customValidate)&&!cube.isObservable(a.customValidate)&&(b=a.customValidate(c));if(b==!1||$.isPlainObject(b)&&b.successful==!1)return a.validStatus("error"),$.isPlainObject(b)&&b.hint&&(a.validHintType()=="pop"?
(a.isShowPopDialog(!1),a.isShowPopDialog(!0),cube.showPopDialog($(o),{content:b.hint,popoverDirection:"bottom",msgType:"error",isShowDialog:a.isShowPopDialog})):a.validHint(b.hint)),!1;if(!(cube.isEmpty(d)||d.indexOf("NOTNULL")==-1)||!cube.isEmpty(c))if((d.indexOf("NOTNULL")!=-1||cube.notEmpty(c))&&d!=null)if(b=t.validate(c,d),b.successful)a.validStatus(""),a.validHint(""),a.isShowPopDialog(!1);else{a.validStatus("error");a.validHint(b.hint);if(a.validHintType()=="pop")a.isShowPopDialog(!1),!cube.isObservable(a.popNode)&&
a.popNode!=null&&a.popNode.remove(),a.isShowPopDialog(!0),a.popNode=cube.showPopDialog($(o),{content:b.hint,popoverDirection:"bottom",msgType:"error",isShowDialog:a.isShowPopDialog});b=a.validFailValue();b=="empty"?(a.value(""),a._value("")):b=="current"?a.value(i(new Date,a.format(),!0)):a.value(c);return!1}}function i(c,b,d,e){if(cube.notEmpty(c)){d=null;if(k.isTime(c))return c;else cube.isDate(c)?d=c:(cube.isString(c)||(c=String(c)),d=new Date(c.replace(/-/g,"/")),isNaN(d.getMonth())&&(c=c.replace(/-/g,
""),c=c.replace(/\s*/g,""),c=c.replace(/:/g,"")),k.isDigit(c)&&(c.length==10?String(c).substring(0,1)=="1"?c+="000":(c=c.substring(0,4)+"/"+c.substring(4,6)+"/"+c.substring(6,8)+" "+c.substring(8,10)+":00:00",d=new Date(c)):c.length==6?(c=c.substring(0,4)+"/"+c.substring(4,6)+"/01",d=new Date(c)):c.length==8?(c=c.substring(0,4)+"/"+c.substring(4,6)+"/"+c.substring(6,8),d=new Date(c)):c.length==12?(c=c.substring(0,4)+"/"+c.substring(4,6)+"/"+c.substring(6,8)+" "+c.substring(8,10)+":"+c.substring(10,
12)+":00",d=new Date(c)):c.length==14&&(c=c.substring(0,4)+"/"+c.substring(4,6)+"/"+c.substring(6,8)+" "+c.substring(8,10)+":"+c.substring(10,12)+":"+c.substring(12,14),d=new Date(c)),c.length==13&&(d=new Date(parseInt(c)))));if(typeof e=="undefined"){if(isNaN(d.getMonth()))if(k.isDateTime(c))e="",c=c.split(" "),c[1].length==2?e=c[1]+":00:00":c[1].length==4&&(e=c[1]+":00"),d=new Date(c[0].replace(/-/g,"/")+" "+e);else return c;a.year(d.getFullYear());a.quarter(Math.ceil((d.getMonth()+1)/3));a.month(d.getMonth()+
1);a.day(d.getDate());a.hour(d.getHours());a.minute(d.getMinutes());a.second(d.getSeconds())}}else if(!d)return"";b=b.replace(/yyyy/g,a.year());b=a.showQuarterPicker()?b.replace(/MM/g,j(a.quarter(),"01")):b.replace(/MM/g,j(a.month(),"00"));b=b.replace(/dd/g,j(a.day(),"00"));b=b.replace(/HH/g,j(a.hour(),"00"));b=b.replace(/mm/g,j(a.minute(),"00"));return b=b.replace(/ss/g,j(a.second(),"00"))}function j(a,b){if(a==null)return"";if(typeof b=="undefined")return a+"";if(typeof b=="number")return a+"";
var d=a+"";if(b!=null&&b!=""){var d=d.split("."),e=b.split(".");d[0].length<e[0].length&&(d[0]=e[0].substring(0,e[0].length-d[0].length)+d[0]);if(e.length==1)return d[0];else{if(d.length>1)for(;d[1].length<e[1].length;)d[1]+="0";else d[1]=e[1];return(new Number(d[0]+"."+d[1])).toFixed(e[1].length)}}else return d}var a=this;a.name="";a.width="100%";a.popoverDirection="bottom";a.msgType="info";a.prefixText="";a.suffixText="";a.showTimePicker=!0;a.showDayPicker=!0;a.showMonthPicker=!0;a.showQuarterPicker=
!1;a.isClickCloseDialog=!1;a.format="yyyy-MM-dd";a.dataFormat=null;a.leftOffset="0px";a.calendarFocus=!1;a.isShowDialog=!1;a.date=new Date;a.year=a.date.getFullYear();a.quarter=Math.ceil((a.date.getMonth()+1)/3);a.month=a.date.getMonth()+1;a.day=a.date.getDate();a.hour=a.date.getHours();a.minute=a.date.getMinutes();a.second=a.date.getSeconds();a.value="";a.minValue=null;a.maxValue=null;a.readOnly=!1;a.maxLength=null;a.isAllowEdit=!0;a.validType="DATE";a.validStatus=null;a.validHint=null;a.customValidate=
null;a.isShowValue=!1;a.textAlign="left";a.nullable=!0;a.isShowPopDialog=!1;a.validHintType="inline";a.validFailValue="default";a.isValid=!0;a.isExtDisplay=!1;a.hasFocus=!1;a.onFocus=null;var o=a.onRendered=null;a.onChanged=null;a.popNode=null;a._value=null;a.$scrollDiv=null;a.timeStart=0;a._timeEditor=!1;a.$e=null;var p=!1;a._init=function(){a.showQuarterPicker()&&(a.showTimePicker(!1),a.showMonthPicker(!1));(a.format()=="HH:mm:ss"||a.format()=="HH:mm"||a.format()=="HH")&&a._timeEditor(!0);a.validHint("");
a.validStatus("");a.setValidType();r(a.nullable());a.nullableSub=cube.subscribe(a.nullable,r);a.formatSub=cube.subscribe(a.format,a.setValidType);a._valueSub=cube.subscribe(a._value,a._changed);a.valueSub=cube.subscribe(a.value,a._valuechanged);a._value(i(a.value(),a.format(),a.isShowValue()));a.yearSub=cube.subscribe(a.year,a._calendarchanged);a.quarterSub=cube.subscribe(a.quarter,a._calendarchanged);a.monthSub=cube.subscribe(a.month,a._calendarchanged);a.daySub=cube.subscribe(a.day,a._calendarchanged);
a.hourSub=cube.subscribe(a.hour,a._calendarchanged);a.minuteSub=cube.subscribe(a.minute,a._calendarchanged);a.secondSub=cube.subscribe(a.second,a._calendarchanged);a.hasFocusSub=cube.subscribe(a.hasFocus,function(c){if(c&&a.onFocus!=null&&!cube.isObservable(a.onFocus))a.onFocus(a.value(),a)})};a.setValidType=function(c){var b=c;cube.isEmpty(b)&&(b=a.format());var d=a.validType(),d="DATE";b=="HH:mm:ss"?d="TIME":d=="DATE"&&(b=="yyyy"?(a.showTimePicker(!1),a.showMonthPicker(!1),a.showDayPicker(!1),a.showQuarterPicker(!1)):
b.indexOf("dd")==-1&&b.indexOf("HH")==-1&&(a.showTimePicker(!1),a.showDayPicker(!1)),b.indexOf("HH")!=-1&&b.indexOf("dd")!=-1?(d="DATETIME",a.validType().indexOf("NOTNULL")!=-1&&(d+=", NOTNULL")):b.indexOf("HH")!=-1&&b.indexOf("dd")==-1&&(d="TIME",a.validType().indexOf("NOTNULL")!=-1&&(d+=", NOTNULL")));a.validType(d);cube.notEmpty(c)&&a._valuechanged(a._value())};a.setTimeUp=function(){a._setTimeChanged("up")};a.setTimeDown=function(){a._setTimeChanged("down")};a._input_keydown=function(c,b){if((a.readOnly()||
!a.isAllowEdit())&&b.keyCode==8)return b.keyCode=0,!1;return a._timeEditor()&&!a.isAllowEdit()?!1:!0};a._setTimeChanged=function(c){if(!a.readOnly()){var b=c=="down"?-1:1,d="";if(cube.isEmpty(a._value()))var e=new Date,f=parseInt(e.getHours()),g=parseInt(e.getMinutes()),e=parseInt(e.getSeconds());else e=a._value().split(":"),f=parseInt(e[0],10),g=parseInt(e[1],10),e=parseInt(e[2],10);a.timeStart()==0?(f+=b,c=="down"?f==-1&&(f=23):f==24&&(f=0)):a.timeStart()==1?(g+=b,c=="down"?g==-1&&(g=59,f-=1,f==
-1&&(f=23)):g==60&&(g=0,f+=1,f==24&&(f=0))):a.timeStart()==2&&(e+=b,c=="down"?e==-1&&(e=59,g-=1,g==-1&&(g=59,f-=1,f==-1&&(f=23))):e==60&&(e=0,g+=1,g==60&&(g=0,f+=1,f==24&&(f=0))));f<=9&&(f="0"+f);g<=9&&(g="0"+g);e<=9&&(e="0"+e);a.format()=="HH:mm:ss"?d=f+":"+g+":"+e:a.format()=="HH:mm"?d=f+":"+g:a.format()=="HH"&&(d=f);a._value(d)}};a._input_selectionchanged=function(c){var b=0,b=$(c).getSelection().start;b==0||b==1||b==2?a.timeStart(0):b==3||b==4||b==5?a.timeStart(1):b==6||b==7||b==8?a.timeStart(2):
a.timeStart(0)};a.showPopoverDialog=function(c,b){var d=$(c).parent().siblings(".par").children(".popover");if(a._timeEditor())a._input_selectionchanged(c,b);else if(!a.readOnly()){a.isExtDisplay()&&a.showlog(c,d,b);a.isShowDialog(!0);a.isShowPopDialog(!1);a.calendarFocus(!0);var d=a.$e.find(".popover.info").offset().left,e=a.$e.find(".popover.info").width(),f=$(window).width();d+e>f&&a.leftOffset("-"+(d+e-f+15)+"px")}};a.showlog=function(a,b,d){var e=null,f=!0;a.className=="btn btn-default"?(e=$(a).siblings("input")[0],
f=$(window).width()-d.clientX+d.offsetX-40>b.innerWidth()?!0:!1):(e=$(a)[0],f=$(window).width()-d.clientX-e.offsetWidth+d.offsetX-40>b.innerWidth()?!0:!1);a=e.offsetWidth;e=e.offsetHeight;b.css("position","fixed");b.css("z-index","5000");var g=d.target?d.target:d.srcElement,i=d.layerY?d.layerY:d.offsetY,h=d.clientX-d.offsetX+0;$(window).height()-d.clientY-e+d.offsetY>b.innerHeight()?(g.className=="btn btn-default"?b.css("left",h-a):g.className=="icon-calendar"?b.css("left",h-a-12):b.css("left",h),
b.css("top",d.clientY+e-i),b.removeClass("top"),b.removeClass("right"),b.addClass("bottom"),$("body>.popover.arrow").css("top","-11px")):(d.clientY-d.offsetY-10>b.innerHeight()?(g.className=="btn btn-default"?b.css("left",h-a):g.className=="icon-calendar"?b.css("left",h-a-12):b.css("left",h),b.css("top",d.clientY-b.innerHeight()-i),b.removeClass("bottom"),b.removeClass("right"),b.addClass("top")):(g.className=="btn btn-default"?f?b.css("left",h+40):b.css("left",h+10-a):g.className=="icon-calendar"?
f?b.css("left",h-12+40):b.css("left",h-12+10-a):f?b.css("left",h+40+a):b.css("left",h+10),b.css("top",d.clientY-b.innerHeight()/2-i+e/2),b.removeClass("bottom"),b.removeClass("top"),b.addClass("right")),$("body>.popover.arrow").css("top","100%"))};var m=!1;a.emptyTime=function(){var c=new Date;m=!0;a._value("");a.year(c.getFullYear());a.quarter(Math.ceil((c.getMonth()+1)/3));a.month(c.getMonth()+1);a.day(c.getDate());a.hour(c.getHours());a.minute(c.getMinutes());a.second(c.getSeconds());m=!1};a.confirmTime=
function(){a._calendarchanged();a.isShowDialog(!1)};var n=!1,q=!1;a.mouseoverPopoverDialog=function(){q=!0};a.mousedownInnerPopoverDialog=function(){n=!0;q=!1};a.onSelectDate=function(){cube.isEmpty(a._value())&&a._calendarchanged()};a.hiddenPopoverDialog=function(){n==!1||q==!0&&n==!0?(a.isShowDialog(!1),a.calendarFocus(!1)):a.calendarFocus(!0);n=!1};a._calendarchanged=function(){if(!m&&a._checkDate()){var c=i(null,a.format(),!0);a._value(c)}};a._checkDate=function(){var c=null,b=a.minValue();cube.notEmpty(b)&&
k.isDate(b)&&(c=(new Date(b)).getTime());var b=null,d=a.maxValue();cube.notEmpty(d)&&k.isDate(d)&&(b=(new Date(d)).getTime());d=(new Date(a.year()+"-"+a.month()+"-"+a.day())).getTime();if(c!=null&&d<c)return!1;if(b!=null&&d>b)return!1;return!0};a._valuechanged=function(c){if(!p){if(cube.notEmpty(c)){var b=i(c,a.format(),!0);c!=b&&b==a._value()&&a._changed(b);a._value(b)}else a.emptyTime();if(a.onChanged!=null&&!cube.isObservable(a.onChanged))a.onChanged(a.name(),a.value())}};a._changed=function(c){p=
!0;a.isShowPopDialog(!1);if(cube.notEmpty(c)){c=i(c,a.format(),!0);if(!m&&s(c)==!1)return;a.dataFormat()!=null&&(c=i(c,a.dataFormat(),!0,!0));a.value(c)}else a.value("");if(a.onChanged!=null&&!cube.isObservable(a.onChanged))a.onChanged(a.name(),a.value());p=!1};a.dateClick=function(){};a._valid=function(c,b){a.isValid()&&s(b.target.value)};a.onload=function(c,b){o=c;a.$e=$(c);if(a.isExtDisplay())window.onmousewheel=document.onmousewheel=function(){a.hiddenPopoverDialog()};if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(c,
b)};cube.endViewModel(a,l)}cube.importComponent("controls.calendar");l.prototype.dispose=function(){this.isShowPopDialog(!1);this._valueSub.dispose();this.valueSub.dispose();this.nullableSub.dispose();this.yearSub.dispose();this.quarterSub.dispose();this.monthSub.dispose();this.daySub.dispose();this.hourSub.dispose();this.minuteSub.dispose();this.secondSub.dispose();this.formatSub.dispose();this.hasFocusSub.dispose()};return l});define("dropdowneditor",[],function(){function h(e){var a=this;a.items=[];a.t_items=[];a.isShowNull=!0;a.isSelectedFirst=!1;a.isShowCheckbox=!1;a.isAllowEdit=!1;a.hasFocus=!1;a.autoMatching=!0;a.readOnly=!1;a.selectedValue=null;a.isClickShow=!1;a._checkListvalue=[];a.dropdownFocus=!1;a._checkText="";a.selectedItem=cube.comp(function(){return a.getSelectedItem()},a);a.isSplit=!1;a.width="auto";a.dropdownMenuHeight="auto";a.isShowScroll=!1;a.isShowDropdownOptions=!1;a.disabled=!1;a.isHrefRoute=!1;a.isExtDisplay=!1;
a.isTextEllipsis=!1;a.addItem=!1;a.textAlign="left";a._ulHeight=null;a._isInputValueChange=!0;a.onSelectedChanged=null;a.onFocus=null;a.onRendered=null;a.commonRendered=null;a._init=function(){a.isAllowEdit()?a.t_items(cube.clone(a.items())):a.t_items=a.items;a.dropdownMenuHeight!="auto"&&a.isShowScroll(!0);a.itemschanged();a.itemsSub=cube.subscribe(a.items,a.itemschanged);a.checkListvalueSub=cube.subscribe(a._checkListvalue,a._checkListValuechanged);a.isShowCheckbox()==!0&&cube.notEmpty(a.selectedValue())&&
a._checkListvalue(a.selectedValue().split(","));if(a.isAllowEdit()&&a.autoMatching())a.checkTextSub=cube.subscribe(a._checkText,function(b){a._isInputValueChange()&&(cube.notEmpty(b)?(a.t_items.removeAll(),$.each(a.items(),function(){this.text.indexOf(b)!=-1&&a.t_items.push(this)})):(a.t_items(cube.clone(a.items())),a._checkListvalue([])),a.t_items().length>0?a.doOpenDropdownOptions():a.doCloseDropdownOptions(),a.selectedValue(b))});a.selectedValueSub=cube.subscribe(a.selectedValue,function(b){if(!a._isInputValueChange()){cube.isEmpty(b)&&
a._checkListvalue([]);if(a.onSelectedChanged!=null&&!cube.isObservable(a.onSelectedChanged))a.onSelectedChanged(a.getSelectedItem());if(a.isHrefRoute())window.location.hash=b}});a.hasFocusSub=cube.subscribe(a.hasFocus,function(b){if(b&&a.onFocus!=null&&!cube.isObservable(a.onFocus))a.onFocus(a.selectedValue(),a)})};a.doOpenDropdownOptions=function(b,d){var c=$(b).siblings(".dropdown-menu");b.className=="btn dropdown-toggle"&&d.target.className!="caret"&&c.animate({scrollTop:0},100);if(!a.isClickShow()||
!(typeof d!="undefined"&&d.type=="mouseover"&&b.tagName=="BUTTON"))a.isExtDisplay()&&b!=void 0&&b.className=="btn dropdown-toggle"&&d.target.className!="caret"&&a.showlog(b,c,d),a.disabled()==!1&&a.readOnly()==!1&&!a.isShowDropdownOptions()&&(a.isShowDropdownOptions(!0),a.dropdownFocus(!0))};a.showlog=function(b,d,c){d.css("position","fixed");d.css("z-index","5000");var f=c.target?c.target:c.srcElement,e=c.layerY?c.layerY:c.offsetY,g=c.layerX?c.layerX:c.offsetX;if((f.className.indexOf("btn dropdown-toggle")!=
-1||f.parentElement.className.indexOf("btn dropdown-toggle")!=-1)&&c.clientX!=g)$(window).height()-c.clientY-b.offsetHeight>d.innerHeight()?(d.css("left",c.clientX-g-f.offsetLeft),d.css("top",c.clientY-e+b.offsetHeight-f.offsetTop)):(b=c.clientY-e-d.innerHeight(),a._ulHeight(b),d.css("left",c.clientX-g-f.offsetLeft),d.css("top",b-f.offsetTop))};a.appendItems=function(){a.items.push({value:e.data.addItem.value(),text:e.data.addItem.value()})};a.doCloseDropdownOptions=function(b,d){if(a.isClickShow()&&
d!=void 0){var c=d.toElement||d.relatedTarget;if(c&&c.tagName=="SPAN"){if(c=$(c).parent().parent(),c.hasClass("dropdowneditor"))return}else if(c&&c.tagName=="BUTTON"){if($(c).hasClass("dropdown-toggle"))return}else if(c&&c.tagName=="INPUT"&&(c=$(c).parent().parent(),c.hasClass("dropdowneditor")))return}a.disabled()==!1&&a.isShowDropdownOptions()&&a.isShowDropdownOptions(!1)};a.selectItem=function(){if(a.isShowCheckbox()){for(var b=a._checkListvalue(),d=!1,c=0;c<b.length;c++)if(b[c]==this.value){d=
!0;break}d?a._checkListvalue.remove(this.value):a._checkListvalue.push(this.value)}else a._isInputValueChange(!1),a.selectedValue(this.value),a.isShowDropdownOptions(!1),a._isInputValueChange(!0);a.isAllowEdit()&&a.getSelectedItem()};a.appendItem=function(b){a.items.push(b)};a._checkListValuechanged=function(){a.selectedValue(a._checkListvalue().join(","));a.isAllowEdit()&&a.getSelectedItem()};a.itemschanged=function(b){if(cube.isEmpty(a.selectedValue())||typeof b!="undefined")(a.isShowNull()||a.isShowCheckbox())&&
!a.isSelectedFirst()?a.selectedValue(""):!a.isShowNull()&&cube.notEmpty(a.items())&&a.items().length>0&&a.isSelectedFirst()&&a.selectedValue(a.items()[0].value)};a.getSelectedItem=function(){var b=null;if(a.isShowCheckbox()){if(a.items()&&a.items().length>0){var b=[],d=[],c=a._checkListvalue();$.each(a.items(),function(){for(var a=0;a<c.length;a++)c[a]==this.value&&(b.push(this),d.push(this.text))});a._isInputValueChange(!1);a._checkText(d.join(","));d.length==0&&(b=null);a._isInputValueChange(!0)}}else a.items()&&
a.items().length>0&&(cube.isEmpty(a.selectedValue())?(a._isInputValueChange(!1),a._checkText(""),a._isInputValueChange(!0)):$.each(a.items(),function(){a.selectedValue()==this.value&&(b=this,a._isInputValueChange(!1),a._checkText(this.text),a._isInputValueChange(!0))}));return b};a.doClickDropdownOptions=function(b,d){var c=$(b).parent().siblings(".dropdown-menu");b.className=="btn dropdown-toggle split-toggle"&&c.animate({scrollTop:0},100);a.isExtDisplay()&&b.className=="btn dropdown-toggle split-toggle"&&
a.showlog(b,c,d);!a.disabled()&&!a.readOnly()&&(a.isShowDropdownOptions()?a.isShowDropdownOptions(!1):a.isShowDropdownOptions(!0),a.dropdownFocus(!0))};a.mouseoverPopoverDialog=function(){a.dropdownFocus(!0)};a.mousedownInnerPopoverDialog=function(){a.dropdownFocus(!0)};a.onload=function(b,d){a.commonRendered!=null&&!cube.isObservable(a.commonRendered)&&a.commonRendered(b,d);if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(b,d)};cube.endViewModel(a,e)}h.prototype.dispose=function(){this.selectedItem.dispose();
this.itemsSub.dispose();this.checkListvalueSub.dispose();this.selectedValueSub.dispose();this.hasFocusSub.dispose()};return h});define("dropdowntreeeditor",[],function(){function h(h){var a=this;a.treeOptions={};a.selectedValue=null;a.readOnly=!1;a.width="auto";a.isShowScroll=!1;a.isAllowEdit=!1;a.hasFocus=!1;a.autoMatching=!0;a.isSelectedClose=!0;a.isExtDisplay=!1;a.isShowDropdownOptions=!1;a.dropdownMenuHeight="auto";a.disabled=!1;a.textAlign="left";a._checkText=null;a._ulHeight=null;a.dropdownFocus=!1;a.onSelectedChanged=null;a.onFocus=null;a.onRendered=null;var i=a.commonRendered=null,k=!1;a._init=function(){var b=a.treeOptions(),c=typeof b.isShowCheckbox==
"undefined"?!1:b.isShowCheckbox;if(typeof b.selectedNode=="undefined"&&(b.selectedNode=cube.obj(null),!c))a.selectedNodeSub=cube.subscribe(b.selectedNode,a.selectedChanged);if(typeof b.selectedNodeId=="undefined")b.selectedNodeId=cube.obj(null);else if(!cube.isObservable(b.selectedNodeId))b.selectedNodeId=cube.obj(b.selectedNodeId);if(typeof b.checkedNode=="undefined"&&(b.checkedNode=cube.array(),c))a.checkedNodeSub=cube.subscribe(b.checkedNode,a.selectedChanged);if(a.isAllowEdit()&&a.autoMatching())b.keyword=
a._checkText;b.onLoaded=a.nodesChanged;a.selectedValueSub=cube.subscribe(a.selectedValue,function(a){cube.isEmpty(a)&&(cube.isObservable(b.selectedNodeId)&&b.selectedNodeId(null),cube.isObservable(b.checkedNode)&&b.checkedNode([]))});a.hasFocusSub=cube.subscribe(a.hasFocus,function(b){if(b&&a.onFocus!=null&&!cube.isObservable(a.onFocus))a.onFocus(a.selectedValue(),a)})};a.getCheckText=function(b,c,d,e){cube.isObservable(b)&&(b=b());d&&$.each(b,function(){for(var b=0;b<d.length;b++)d[b]==this.id&&
(c.push(this.text),e.push(this)),(cube.isObservable(this.hasChildren)&&this.hasChildren()==!0||this.hasChildren==!0)&&a.getCheckText(this.childNodes,c,d,e)});a._checkText(c.join(","))};a.nodesChanged=function(b){var c=a.selectedValue();cube.isString(c)&&(c=c.split(","));var d=a.treeOptions();a.getCheckText(b,[],c,d.checkedNode)};a.selectedChanged=function(b){var c="",d="";if(cube.isArray(b)){for(var e=0;e<b.length;e++)c+=b[e].text+",",d+=b[e].id+",";cube.notEmpty(c)&&(c=c.substring(0,c.length-1));
cube.notEmpty(d)&&(d=d.substring(0,d.length-1))}else cube.notEmpty(b)&&(c+=b.text,d+=b.id);a._checkText(c);a.selectedValue(d);if(a.onSelectedChanged!=null&&!cube.isObservable(a.onSelectedChanged))a.onSelectedChanged(d);a.isSelectedClose()&&!cube.isArray(b)&&a.isShowDropdownOptions(!1)};a.doClickDropdownOptions=function(b,c){i=$(b).parents(".input-append").siblings(".dropdown-menu");k=!1;if(a.disabled()==!1&&a.readOnly()==!1){var d=a.isShowDropdownOptions();d||(a.isExtDisplay()&&b!=void 0&&a.showlog(b,
c),a.isAllowEdit()?a.isShowDropdownOptions(!0):(d?a.isShowDropdownOptions(!1):a.isShowDropdownOptions(!0),a.dropdownFocus(!0)))}};a.showlog=function(b,c){var d=$(b).parents(".input-append").siblings(".dropdown-menu");d.css("position","fixed");d.css("z-index","5000");d.css("min-width",d.innerWidth()+"px");a.width()=="auto"||cube.isEmpty(a.width())?d.css("width","auto"):d.css("width",a.width());var e=c.target?c.target:c.srcElement,g=c.layerY?c.layerY:c.offsetY,f=c.layerX?c.layerX:c.offsetX;a._resize(b,
d,c,e,g,f);d.resize(function(){a._resize(b,d,c,e,g,f)})};a._resize=function(a,c,d,e,g,f){d.target.className=="caret"?(f=d.clientX-f-e.offsetLeft-4,e=d.clientY-g-e.offsetTop-3):(f=d.clientX-f-e.offsetLeft,e=d.clientY-g-e.offsetTop);k||(c.css("left",f),$(window).height()-d.clientY-a.offsetHeight>c.innerHeight()?c.css("top",e+a.offsetHeight):c.css("top",e-c.innerHeight()))};var j=!1,l=!1;a.doCloseDropdownOptions=function(){a.disabled()==!1&&a.isShowDropdownOptions()&&(j==!1||l==!0&&j==!0?(a.isShowDropdownOptions(!1),
a.dropdownFocus(!1),j=!1,a.isExtDisplay()&&(i.css("position","relative"),i.css("width","0px"),i.css("left","0px"),k=!0)):a.dropdownFocus(!0))};a.mouseoverPopoverDialog=function(){l=!0;a.dropdownFocus(!0)};a.mousedownInnerPopoverDialog=function(){j=!0;l=!1;a.dropdownFocus(!0)};a.onload=function(b,c){a.commonRendered!=null&&!cube.isObservable(a.commonRendered)&&a.commonRendered(b,c);if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(b,c)};cube.endViewModel(a,h)}h.prototype.dispose=
function(){this.selectedNodeSub&&this.selectedNodeSub.dispose();this.checkedNodeSub&&this.checkedNodeSub.dispose();this.hasFocusSub.dispose()};return h});define("fileeditor",["FileUploader","cryptocore","md5","JSONUtil"],function(l,q,P,u){function o(o){function G(c){if(typeof FileReader=="function"&&v(c.name)&&H(c.name,c.size)){if(c.type.indexOf("image/")!=-1){var b=new FileReader;b.onload=function(b){r(c.name)&&(a._unuploadCount(a._unuploadCount()+1),b={index:a._items().length+1,name:c.name,src:b.target.result,isImage:!0,isIE:!1,file:c,status:cube.obj(cube.msg("NOTUPLOAD")),progress:cube.obj("0%")},a._items.push(b),a.autoUpload()&&a.uploadFile(b))};b.readAsDataURL(c)}else b=
s(c.name),r(c.name)&&(a._unuploadCount(a._unuploadCount()+1),b={index:a._items().length+1,name:c.name,css:b,isImage:!1,file:c,status:cube.obj(cube.msg("NOTUPLOAD")),progress:cube.obj("0%")},a._items.push(b),a.autoUpload()&&a.uploadFile(b));a.isGetMd5()&&(w=204800,h=0,b=new FileReader,x(c,b))}}function I(c,b){var d="";if(window.navigator.userAgent.indexOf("MSIE")>-1)c.select(),$("#"+a.id()).find("#_fileSelectionHiddenArea").focus(),d=document.selection.createRange().text;if(a.ieHasFile().indexOf(d)==
-1){a.ieHasFile.push(d);var e=J(d);if(v(d)&&r(e))if(K(d)){var f=a.previewSize()=="big"?160:100,g={width:f,height:f},i=$("<div></div>"),j=$("<div style='margin:0px auto;'>");j.css("filter",m(d,"image"));if(navigator.userAgent.indexOf("MSIE 9.0")>-1){var h=document.createElement("div");(document.body||document.documentElement).appendChild(h);with(h.runtimeStyle)filter=m(d,"image"),zoom=width=height=1,overflow="scroll",position="absolute",right="9999em",top="-9999em",border=0;setTimeout(function(){var c=
{height:h.offsetHeight,width:h.offsetWidth};h.parentNode.removeChild(h);c=y(g,c);j.appendTo(i);j[0].style.filter=m(d,"scale");j.width(c.width).height(c.height);a._unuploadCount(a._unuploadCount()+1);c={path:d,index:a._items().length+1,name:e,view:i.html(),isImage:!0,isIE:!0,fileId:b,status:cube.obj(cube.msg("NOTUPLOAD")),progress:cube.obj("0%")};a._items.push(c);a.autoUpload()&&a.uploadFile(c)},500)}else f=L(d),f=y(g,f),j.appendTo(i),j[0].style.filter=m(d,"scale"),j.width(f.width).height(f.height),
a._unuploadCount(a._unuploadCount()+1),f={path:d,index:a._items().length+1,name:e,view:i.html(),isImage:!0,isIE:!0,fileId:b,status:cube.obj(cube.msg("NOTUPLOAD")),progress:cube.obj("0%")},a._items.push(f),a.autoUpload()&&a.uploadFile(f)}else f=s(e),a._unuploadCount(a._unuploadCount()+1),f={path:d,index:a._items().length+1,name:e,css:f,isImage:!1,fileId:b,status:cube.obj(cube.msg("NOTUPLOAD")),progress:cube.obj("0%")},a._items.push(f),a.autoUpload()&&a.uploadFile(f)}}function x(a,b){var d=Math.min(h+
w,a.size);b.onload=function(e){h=d;b.readAsBinaryString?t.update(q.enc.Latin1.parse(e.target.result)):t.update(M(e.target.result));parseFloat(h);parseFloat(a.size);h<a.size?x(a,b):(e=t.finalize(),a.md5=e.toString())};if(a.slice)var e=a.slice(h,d);else a.webkitSlice?e=a.webkitSlice(h,d):File.prototype.mozSlice&&(e=a.mozSlice(h,d));b.readAsBinaryString?b.readAsBinaryString(e):b.readAsArrayBuffer(e)}function M(a){for(var a=new Uint8Array(a),b=[],d=0;d<a.length;d+=4)b.push(a[d]<<24|a[d+1]<<16|a[d+2]<<
8|a[d+3]);return q.lib.WordArray.create(b,a.length)}function r(c){if(a.maxCount()>0&&a._items().length>=a.maxCount())return a._validitems.push({name:c,msg:cube.msg("UPLOAD_MAXALLOWED",a.maxCount())}),!1;return!0}function H(c,b){b/=1024;if(a.maxFileSize()>0&&b>=a.maxFileSize())return a._validitems.push({name:c,msg:cube.msg("UPLOAD_SIZE_LIMIT",N(a.maxFileSize()*1024))}),!1;return!0}function N(a){var b=null;return b=a<1024?a+"B":a>=1024&&a<1048576?z(a/1024)+"KB":z(a/1048576)+"MB"}function z(a){var b=
parseFloat(a);return b=isNaN(b)?0:Math.round(a*100)/100}function v(c){if(cube.isEmpty(c))return!1;var b=c.split("."),b=b[b.length-1];if((","+a.allowTypes()).indexOf(b)==-1)return a._validitems.push({name:c,msg:cube.msg("FILE_TYPE_LIMITED",b)}),!1;return!0}function K(a){if(cube.isEmpty(a))return!1;a=a.split(".");if(",jpg,jpeg,gif,png,bmp".indexOf(a[a.length-1])==-1)return!1;return!0}function m(a,b){return"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a+"', sizingMethod='"+b+"')"}function L(a){var b=
document.createElement("div");(document.body||document.documentElement).appendChild(b);with(b.runtimeStyle)filter=m(a,"image"),zoom=width=height=1,position="absolute",right="9999em",top="-9999em",border=0;a={height:b.offsetHeight,width:b.offsetWidth};b.parentNode.removeChild(b);return a}function y(c,b){var d={};c.width<b.width||c.height<b.height?(d=c.width/b.width<c.height/b.height?c.width/b.width:c.height/b.height,d={width:b.width*d,height:b.height*d}):d=b;if(d.width==1&&d.height==1){var e=a.previewSize();
d.width=e=="big"?160:90;d.height=e=="big"?160:90}return d}function J(a){a=a.split("\\");a=a[a.length-1];a=a.split("/");return a[a.length-1]}function s(a){var b={"icon-word":"doc,docx","icon-excel":"xls,xlsx","icon-ppt":"ppt,pptx","icon-pdf":"pdf","icon-txt":"txt","icon-rar":"zip,rar,tar,tgz,arj","icon-music":"wav,mp3,ogg","icon-film":"avi,mpg,mpeg,rm,move","icon-picture":"jpg,jpeg,gif,png,bmp"},d="",a=a.split(".");a.length>1&&(d=a[a.length-1].toLowerCase());for(var e in b)if(b[e].indexOf(d)!=-1)return e;
return"icon-file"}function A(c){var b={cancel:!1,item:c,params:a.params(),fileUploaderParams:null};if(a.onItemUploading!=null&&!cube.isObservable(a.onItemUploading)&&(a.onItemUploading(b),b.cancel)){c.status(cube.msg("UPLOADCACEL"));return}c.status(cube.msg("UPLOADING"));var d=new l;d.url=a.url();d.file=c.file;d.paramsByPost=a.paramsByPost();d.params=n(b.params);if(cube.notEmpty(b.fileUploaderParams))d.params=b.fileUploaderParams;d.onprogresschange=function(b){c.progress(b+"%");cube.isNumber(b)&&
a.progress(parseFloat(a.progress())+b/B+"%");c.status()==cube.msg("UPLOADFAIL")&&c.progress("0%")};d.onprogresscomplete=function(){};d.onprogresserror=function(){c.status(cube.msg("UPLOADFAIL"))};d.oncanceled=function(){c.status(cube.msg("UPLOADCACEL"))};d.onuploadcomplete=function(b){var d=b.resultValue,g=c.name,b=b.resultValue,i=null;b.charAt(2)==":"&&(i=b.substring(3,b.length),b=parseInt(b.substring(0,2)));var h=u.getItem(a._validitems(),"name",g);h&&a._validitems.remove(h);if(b==-2||b==-3||b==
-4||b==-5){if(c.status(cube.msg("UPLOADFAIL")),c.progress("0%"),b==-3?a._validitems.push({name:g,msg:cube.msg("FILE_TYPE_LIMITED",[i])}):b==-4?a._validitems.push({name:g,msg:cube.msg("FILE_TYPE_ALLOWED",[i])}):b==-5?a._validitems.push({name:g,msg:cube.msg("UPLOAD_SIZE_LIMIT",[a.maxFileSize()+"KB"])}):i?a._validitems.push({name:g,msg:i}):a._validitems.push({name:g,msg:cube.msg("UPLOADFAIL")}),a.onItemUploadFail!=null&&!cube.isObservable(a.onItemUploadFail))a.onItemUploadFail(c,d)}else if(c.status()!=
cube.msg("UPLOADED")){a._unuploadCount(a._unuploadCount()-1);a._uploadedCount(a._uploadedCount()+1);c.status(cube.msg("UPLOADED"));if(a.onItemUploaded!=null&&!cube.isObservable(a.onItemUploaded)&&(g={cancel:!1},a.onItemUploaded(c,d,g),g.cancel==!0)){a._unuploadCount(a._unuploadCount()+1);a._uploadedCount(a._uploadedCount()-1);c.status(cube.msg("UPLOADFAIL"));c.progress("0%");return}a._onChanged();for(b=g=0;b<a._items().length;b++)a._items()[b].status()!=cube.msg("UPLOADED")&&g++;if(g==0){if(a.onAllItemUploaded!=
null&&!cube.isObservable(a.onAllItemUploaded))a.onAllItemUploaded(a.name(),a._items(),d);a._onChanged()}}};d.upload()}function n(c){var b={},d=a.type();if(a.filePath())b.filePath=a.filePath();if(d=="form"||d=="grid")b.tableName=a.tableName(),b.primaryKey=a.primaryKey(),b.pkVal=a.pkVal(),b.colName=a.colName();b.uploadMode=a.uploadMode();b.isVirtual=a.isVirtual();b.params=cube.notEmpty(c)?c:a.params();return b}function O(c){var b=null,d=a.type(),c=c.replace(/\+/g,"%2B"),e=a.filePath()?a.filePath().replace(/\+/g,
"%2B"):"",f=e?"&filePath="+e:"";if(d=="path")b=encodeURI(encodeURI(a.url()+"?option=download&filePath="+e+"&fileName="+c+"&uploadMode="+a.uploadMode()+"&rnd="+cube.random()));else if(d=="form"||d=="grid")b=encodeURI(encodeURI(a.url()+"?option=download&tableName="+a.tableName()+"&pkVal="+a.pkVal()+"&colName="+a.colName()+"&fileName="+c+"&uploadMode="+a.uploadMode()+f+"&rnd="+cube.random()));return b}function C(c){if(c.status()!=cube.msg("UPLOADED")){var b={cancel:!1,item:c,params:a.params(),fileUploaderParams:null};
if(a.onItemUploading!=null&&!cube.isObservable(a.onItemUploading)){if(a.isGetMd5()&&!c.file)c.file={md5:""};a.onItemUploading(b);if(b.cancel){c.status(cube.msg("UPLOADCACEL"));return}}c.status(cube.msg("UPLOADING"));var d=document.getElementById(a.id()),e=$("#"+a.id()).find("#file_"+c.fileId);e.get(0).disabled=!1;var f=D();E(f);f.send("option=startUpload&rnd="+cube.random());if(f.status==200){if(!f.responseText)throw c.status(cube.msg("UPLOADFAIL")),"error";p=f.responseText.replace(/^\s*/,"").replace(/\s*$/,
"")}else throw c.status(cube.msg("UPLOADFAIL")),"error";F(c);c=cube.notEmpty(b.params)?b.params:a.params();cube.isObject(c)&&(c=JSON.stringify(c));if(cube.notEmpty(b.fileUploaderParams)){var g,c=a.url(),b=b.fileUploaderParams,h=f="";for(g in b)f!=""&&(f+="&"),f+=typeof b[g]=="string"&&b[g].replace(/^\s*/,"").replace(/\s*$/,"")==""?g+"=":g=="fileName"?g+"="+b[g]:g=="params"?g+"="+JSON.stringify(b[g]):g+"="+encodeURIComponent(encodeURIComponent(b[g]));h=c+(cube.isEmpty(f)?"":(cube.isEmpty(c)?"":"?")+
f);g=h+"&rnd="+cube.random();d.action=g}else if(a.type()=="path")d.action=encodeURI(a.url()+"?option=upload&maxFileSize="+a.maxFileSize()+"&sessionId="+p+"&fileName="+a.name()+"&filePath="+a.filePath()+"&uploadMode="+a.uploadMode()+"&params="+c+"&isVirtual="+a.isVirtual()+"&rnd="+cube.random());else if(a.type()=="form"||a.type()=="grid")d.action=encodeURI(a.url()+"?option=upload&maxFileSize="+a.maxFileSize()+"&sessionId="+p+"&tableName="+a.tableName()+"&primaryKey="+a.primaryKey()+"&pkVal="+a.pkVal()+
"&colName="+a.colName()+(a.filePath()?"&filePath="+a.filePath():"")+"&uploadMode="+a.uploadMode()+"&params="+c+"&isVirtual="+a.isVirtual()+"&rnd="+cube.random());d.submit();e.get(0).disabled=!0}}function F(c){var b=D();E(b);b.send("option=getProgress&sessionId="+p+"&rnd="+cube.random());if(b.status==200&&(b=b.responseText.replace("&","&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/script/gi,"").replace(/%/g,"&#37").replace(/\r/g,"").replace(/\n/g,
""))){var d=b.split(":");if(d[0]==-2)throw d.length>1&&d[1]&&a._validitems.push({name:c.name,msg:d[1]}),c.status(cube.msg("UPLOADFAIL")),"error";else if(d[0]==-3)throw c.status(cube.msg("UPLOADFAIL")),a._validitems.push({name:c.name,msg:cube.msg("FILE_TYPE_LIMITED",[d[1]])}),"error";else if(d[0]==-4)throw c.status(cube.msg("UPLOADFAIL")),a._validitems.push({name:c.name,msg:cube.msg("FILE_TYPE_ALLOWED",[d[1]])}),"error";else if(d[0]==-5)throw c.status(cube.msg("UPLOADFAIL")),a._validitems.push({name:c.name,
msg:cube.msg("UPLOAD_SIZE_LIMIT",[a.maxFileSize()+"KB"])}),"error";b=parseInt(b,10);if(isNaN(b))throw c.status(cube.msg("UPLOADFAIL")),"error";if(b!=-1)try{window.setTimeout(function(){F(c)},500)}catch(e){}else if(b==-1){c.status(cube.msg("UPLOADED"));c.progress("100%");a._unuploadCount(a._unuploadCount()-1);a._uploadedCount(a._uploadedCount()+1);if(a.onItemUploaded!=null&&!cube.isObservable(a.onItemUploaded)&&(d={cancel:!1},a.onItemUploaded(c,b,d),d.cancel==!0)){a._unuploadCount(a._unuploadCount()+
1);a._uploadedCount(a._uploadedCount()-1);c.status(cube.msg("UPLOADFAIL"));c.progress("0%");return}a._onChanged();for(d=b=0;d<a._items().length;d++)a._items()[d].status()!=cube.msg("UPLOADED")&&b++;if(b==0){if(a.onAllItemUploaded!=null&&!cube.isObservable(a.onAllItemUploaded))a.onAllItemUploaded(a.name(),a._items());a._onChanged()}}}}function D(){var a=null;window.ActiveXObject?a=new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest&&(a=new XMLHttpRequest);return a}function E(c){var b=cube.getIEVersion();
cube.ieCorsProxy&&b>-1&&b<=9&&cube.crosDomain(a.url())?(c.open("POST",cube.mappath(cube.ieCorsProxyHost),!1),c.setRequestHeader("X-CorsProxy-Url",a.url())):c.open("POST",a.url(),!1);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8")}var a=this;a.id="";a.name="";a.url="";a.removeUrl="";a.readOnly=!1;a.isShowPreview=!0;a.previewSize="big";a.previewModel=!1;a.autoUpload=!1;a.isShowUploadButton=!0;a.isShowRemoveButton=!0;a.isShowDownloadButton=!0;a.isShowThumbnail=!0;
a.isShowControl=!0;a.maxCount=0;a.maxFileSize=0;a.allowTypes="jpg,jpeg,gif,png,bmp,tiff,txt";a.type="path";a.filePath=null;a.tableName="";a.primaryKey="";a.pkVal="";a.colName="";a.uploadMode="file";a.params="";a.paramsByPost=!1;a.isVirtual=!1;a.autoLoadFiles=!0;a.isGetMd5=!1;a.isIE=!1;a.onItemRemoving=null;a.onItemRemoved=null;a.onAllItemRemoving=null;a.onAllItemRemoved=null;a.onItemUploading=null;a.onItemUploaded=null;a.onItemUploadFail=null;a.onAllItemUploaded=null;a.onDownloading=null;a.onRendered=
null;a.onChanged=null;a._items=[];a._validitems=[];a._files=[];a._showErrorMessage=!1;a._uploadedCount=0;a._unuploadCount=0;a._fileAccept="";a.ieHasFile=[];a.animatShowDialog=!1;a.progress="0%";var B=0;a._init=function(){typeof FileReader=="function"?a.isIE(!1):a.isIE(!0);a._fileAccept("."+a.allowTypes().replace(/\,/g,",."));cube.isEmpty(a.id())&&a.id("fileForm_"+cube.random().toString().split("&")[0]);a._validitemsSub=cube.subscribe(a._validitems,function(){a._validitems().length>0?a._showErrorMessage(!0):
a._showErrorMessage(!1)});if(cube.notEmpty(a.url())){var c=new l;c.url=a.url();c.params=n();var b=[];a.autoLoadFiles()&&(b=c.getUploadedFiles());for(c=0;c<b.length;c++){var d=s(b[c].attName);a._items.push({index:c+1,name:b[c].attName,css:d,isImage:d=="icon-picture"?!0:!1,isIE:!1,src:d=="icon-picture"?O(b[c].attName):"",status:cube.obj(cube.msg("UPLOADED")),progress:cube.obj("100%")})}a._onChanged()}};var k=1;a.fileChange=function(c,b){a._validitems.removeAll();if(typeof FileReader=="function"){var d=
b.target.files;if(d&&d.length>0)for(var e=0;e<d.length;e++)G(d[e]);d=$(b.target);e=d.clone().val("");d.after(e);d.remove();e.attr("data-bind","event: {change: fileChange}, attr:{disabled: readOnly, accept: _fileAccept}");cube.bindTemlate(e,{fileChange:a.fileChange,readOnly:a.readOnly,_fileAccept:a._fileAccept})}else I(b.target,k),b.target.disabled=!0,b.target.style.display="none",k=cube.random().toString().split("&")[0],d="file_"+k,a._files.push("<input name='file' id='"+d+"' type='file'>"),d=$("#"+
d),d.attr("data-bind","event: {change: fileChange}, attr:{disabled: readOnly, accept: _fileAccept}"),cube.bindTemlate(d,{fileChange:a.fileChange,readOnly:a.readOnly,_fileAccept:a._fileAccept})};a.removeFile=function(){var c=this;cube.indicate("confirm",cube.msg("CONFIRM_DELETE"),function(){var b=!0;if(a.onItemRemoving!=null&&!cube.isObservable(a.onItemRemoving)){var d={cancel:!1,item:c};a.onItemRemoving(d);if(d.cancel)return}(d=u.getItem(a._validitems(),"name",c.name))&&a._validitems.remove(d);var e=
c.index;if(c.status()==cube.msg("UPLOADED")||c.status()==cube.msg("DELETEFAIL")){var d=new l,f=a.url(),g=a.removeUrl();cube.notEmpty(g)&&(f=g);d.url=f;d.params=n();if(d=d.removeFile(c.name)){a._items.remove(c);cube.notEmpty(c.path)&&a.ieHasFile.remove(c.path);a._uploadedCount(a._uploadedCount()-1);if(a.onItemRemoved!=null&&!cube.isObservable(a.onItemRemoved))a.onItemRemoved(c,d);a._onChanged()}else c.status(cube.msg("DELETEFAIL")),b=!1}else if(a._items.remove(c),cube.notEmpty(c.path)&&a.ieHasFile.remove(c.path),
a._unuploadCount(a._unuploadCount()-1),a.onItemRemoved!=null&&!cube.isObservable(a.onItemRemoved))a.onItemRemoved(c);if(b&&(b=$("#"+a.id()).find("input"))){var h=1;b.each(function(){a.isIE()?h==e&&($(c).remove(),a._items.remove(h)):$(c).val("");h++});if((b=$("#"+a.id()).find("input"))&&b.length==0)k=cube.random().toString().split("&")[0],b="file_"+k,a._files.push("<input name='file' id='"+b+"' type='file'>"),b=$("#"+b),b.attr("data-bind","event: {change: fileChange}, attr:{disabled: readOnly, accept: _fileAccept}"),
cube.bindTemlate(b,{fileChange:a.fileChange,readOnly:a.readOnly,_fileAccept:a._fileAccept})}})};a.clearFiles=function(c){a._items().length>0&&cube.indicate("confirm",cube.msg("CONFIRM_DELETEALL"),function(){a._clearFiles(c)})};a.clearFilesWithoutConfirm=function(c){a._items().length>0&&a._clearFiles(c)};a._clearFiles=function(c){if(a.onAllItemRemoving!=null&&!cube.isObservable(a.onAllItemRemoving)){var b={cancel:!1,items:a._items()};a.onAllItemRemoving(b);if(b.cancel)return}a._validitems.removeAll();
if(c!=!1)for(c=a._items().length-1;c>=0;c--){b=!0;if(a._items()[c].status()==cube.msg("UPLOADED")||a._items()[c].status()==cube.msg("DELETEFAIL")){var d=new l,e=a.url(),f=a.removeUrl();cube.notEmpty(f)&&(e=f);d.url=e;d.params=n();d.removeFile(a._items()[c].name)?(cube.notEmpty(a._items()[c].path)&&a.ieHasFile.remove(a._items()[c].path),a._items.remove(a._items()[c]),a._uploadedCount(a._uploadedCount()-1)):(a._items()[c].status(cube.msg("DELETEFAIL")),b=!1)}else cube.notEmpty(a._items()[c].path)&&
a.ieHasFile.remove(a._items()[c].path),a._items.remove(a._items()[c]),a._unuploadCount(a._unuploadCount()-1);if(b&&(b=$("#"+a.id()).find("input"))&&b.eq(c))if(a.isIE()?b.eq(c).remove():b.eq(c).val(""),(b=$("#"+a.id()).find("input"))&&b.length==0)k=cube.random().toString().split("&")[0],b="file_"+k,a._files.push("<input name='file' id='"+b+"' type='file'>"),b=$("#"+b),b.attr("data-bind","event: {change: fileChange}, attr:{disabled: readOnly, accept: _fileAccept}"),cube.bindTemlate(b,{fileChange:a.fileChange,
readOnly:a.readOnly,_fileAccept:a._fileAccept})}if(a._items().length==0){a._unuploadCount(0);a._uploadedCount(0);if(a.onAllItemRemoved!=null&&!cube.isObservable(a.onAllItemRemoved))a.onAllItemRemoved();a._onChanged()}};a.uploadFile=function(c){a.isIE()?C(c):A(c)};a.uploadFiles=function(){a._validitems.removeAll();B=a._unuploadCount();a.isShowControl()||a.closeDialog();for(var c=0;c<a._items().length;c++)a._items()[c].status()!=cube.msg("UPLOADED")&&(a.isIE()?C(a._items()[c]):A(a._items()[c]))};a.downloadFile=
function(){if(!(a.onDownloading!=null&&!cube.isObservable(a.onDownloading)&&a.onDownloading(this)==!1)){var c=new l;c.url=a.url();c.params=n();c.onprogresschange=function(a){item.progress(a+"%")};c.onprogresscomplete=function(){item.status(cube.msg("DOWNLOADED"))};c.onprogresserror=function(){item.status(cube.msg("DOWNLOADFAIL"))};c.oncanceled=function(){item.status(cube.msg("DOWNLOADCANCEL"))};c.download(this.name)}};a.hidePreview=function(){a.isShowPreview(!1)};var w=204800,h=0;a._onChanged=function(){if(a.onChanged!=
null&&!cube.isObservable(a.onChanged)){for(var c="",b=a._items(),d=0;d<b.length;d++)c+=b[d].name+";";c!=""&&(c=c.substring(0,c.length-1));a.onChanged(a.name(),c)}};a.showDialog=function(){a.animatShowDialog(!0)};a.closeDialog=function(){a.animatShowDialog(!1)};var t=q.algo.MD5.create(),p="";a.onload=function(c){if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(c)};cube.endViewModel(a,o)}o.prototype.dispose=function(){this._validitemsSub.dispose()};return o});define("imageeditor",["cropper","FileUploader","text!croppercss"],function(t,l){return function(u){function n(){var b=o();b.open("post",a.url(),!1);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8");b.send("option=getProgress&sessionId="+h+"&rnd="+cube.random());if(b.status==200&&(b=b.responseText.replace("&","&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/script/gi,"").replace(/%/g,"&#37").replace(/\r/g,"").replace(/\n/g,
""))){var c=b.split(":");if(c[0]==-2)throw a.status(cube.msg("UPLOADFAIL")),"error";else if(c[0]==-3)throw a.status(cube.msg("UPLOADFAIL")),"error";else if(c[0]==-4)throw a.status(cube.msg("UPLOADFAIL")),"error";else if(c[0]==-5)throw a.status(cube.msg("UPLOADFAIL")),"error";b=parseInt(b,10);if(isNaN(b))throw"error";if(b!=-1)try{window.setTimeout(function(){n()},500)}catch(d){}else b==-1&&(a.status(cube.msg("UPLOADED")),a.uploaded(!0))}}function o(){var a=null;window.ActiveXObject?a=new ActiveXObject("Microsoft.XMLHTTP"):
window.XMLHttpRequest&&(a=new XMLHttpRequest);return a}function p(b,c){if(typeof FileReader=="function"){a.isIE(!1);var d=null,e=b.files,g=null;e&&(g=e[0]);g?/^image\/\w+$/.test(g.type)?(d=new FileReader,d.onload=function(){a.hasImage(!0);a.editable(!0);a.imageType(g.type);a.name(g.name);a.imageUrl(d.result);c()},d.readAsDataURL(g)):(a.status(cube.msg("SELECTPICTURE")),c()):c()}else{a.isIE(!0);a.editable(!0);var f="";if(window.navigator.userAgent.indexOf("MSIE")>-1)b.select(),$("#_fileSelectionHiddenArea").focus(),
f=document.selection.createRange().text;var h={width:parseInt(a.width()),height:parseInt(a.height())},k=$("#_show_area"),i=$("<div style='margin:0px auto;'>");i.css("filter",a._imgloader(f,"image"));if(v(f))if(navigator.userAgent.indexOf("MSIE 9.0")>-1){var j=document.createElement("div");(document.body||document.documentElement).appendChild(j);with(j.runtimeStyle)filter=a._imgloader(f,"image"),zoom=width=height=1,overflow="scroll",position="absolute",right="9999em",top="-9999em",border=0;setTimeout(function(){var b=
{height:j.offsetHeight,width:j.offsetWidth};j.parentNode.removeChild(j);b=q(h,b);k.html("");i.appendTo(k);i[0].style.filter=a._imgloader(f,"scale");i.width(b.width).height(b.height);a.hasImage(!0);a.name(r(f))},500)}else e=me._getImgSize(f),e=q(h,e),k.html(""),i.appendTo(k),i[0].style.filter=a._imgloader(f,"scale"),i.width(e.width).height(e.height),a.hasImage(!0),a.name(r(f));else a.status(cube.msg("SELECTPICTURE")),c()}}function v(b){if(cube.isEmpty(b))return!1;b=b.split(".");b=b[b.length-1];return(","+
a._allowTypes()+",").indexOf(","+b+",")>-1}function q(b,c){var d={};b.width<c.width||b.height<c.height?(d=b.width/c.width<b.height/c.height?b.width/c.width:b.height/c.height,d={width:c.width*d,height:c.height*d}):d=c;if(d.width==1&&d.height==1)d.width=parseInt(a.width()),d.height=parseInt(a.height());return d}function r(a){a=a.split("\\");a=a[a.length-1];a=a.split("/");return a[a.length-1]}function m(){var b={};if(a.filePath())b.filePath=a.filePath();b.tableName=a.tableName();b.primaryKey=a.primaryKey();
b.pkVal=a.pkVal();b.colName=a.colName();b.uploadMode=a.uploadMode();b.isVirtual=a.isVirtual();b.maxFileSize=a.maxFileSize()*1024;return b}function s(b){var c=null,d=a.type(),b=b.replace(/\+/g,"%2B"),e=a.filePath()?a.filePath().replace(/\+/g,"%2B"):"",g=e?"&filePath="+e:"";if(d=="path")c=encodeURI(encodeURI(a.url()+"?option=download&filePath="+e+"&fileName="+b+"&uploadMode="+a.uploadMode()+"&rnd="+cube.random()));else if(d=="form"||d=="grid")c=encodeURI(encodeURI(a.url()+"?option=download&tableName="+
a.tableName()+"&pkVal="+a.pkVal()+"&colName="+a.colName()+"&fileName="+b+"&uploadMode="+a.uploadMode()+g+"&rnd="+cube.random()));return c}function w(a){for(var a=window.atob(a.split(",")[1]),c=new ArrayBuffer(a.length),d=new Uint8Array(c),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);return new Blob([c],{type:"image/png"})}var a=this;a.id="";a.width=600;a.height=400;a.showToolbar=!0;a.url=null;a.maxFileSize=0;a.type="path";a.filePath=null;a.tableName="";a.primaryKey="";a.pkVal="";a.colName="";a.uploadMode=
"file";a.isVirtual=!1;a.udsParam=null;a.image=null;a.hasImage=!1;a.uploaded=!1;a.status="";a.progress="0%";a.editable=!1;a.imageType="";a.name="";a.imageUrl="";a.originalImageUrl="";a.cropper=null;a.cropping=!1;a.cropped=!1;a.data=null;a.canvasData=null;a.cropBoxData=null;a._allowTypes="jpg,jpeg,gif,png,bmp";a.isIE=!1;a.isOperate=!1;a.isServerImage=!1;a.onRendered=null;a._init=function(){typeof FileReader=="function"?a.isIE(!1):a.isIE(!0);a.data=null;a.canvasData=null;a.cropBoxData=null;a.cropper=
null;cube.isEmpty(a.id())&&a.id("imageForm_"+cube.random().toString().split("&")[0]);var b=new l;b.url=a.url();b.params=m();(b=b.getUploadedFiles())&&b.length>0&&a.name(b[b.length-1].attName);b=a.name();a.type()!="grid"&&cube.isString(b)&&cube.notEmpty(b)&&(a.imageUrl(s(b)),a.hasImage(!0),a.uploaded(!0),a.isServerImage(!0))};a.imageInputChange=function(b,c){p(c.target,function(){c.target.value=""});a.uploaded(!1)};a.dragover=function(a,c){c.preventDefault()};a.drop=function(a,c){var d=c.dataTransfer?
c.dataTransfer:c.originalEvent.dataTransfer;c.preventDefault();p(d,function(){})};a.imageLoad=function(b,c){a.image=c.target;a.hasImage(!0);a.start()};a.remove=function(){if(!a.cropping()){if(a.uploaded()){var b=new l;b.url=a.url();b.params=m();if(!b.removeFile(a.name())){cube.indicate("info",cube.msg("DELETEFAIL"));return}}a.stop();a.editable(!1);a.data=null;a.image=null;a.imageType("");a.name("");a.imageUrl("");a.originalImageUrl("");a.hasImage(!1);a.cropped(!1);a.status("");a.isServerImage(!1)}};
a.stop=function(){if(a.cropper)a.cropper.destroy(),a.cropper=null,a.cropping(!1)};a.clear=function(){a.cropping()&&(a.cropper.clear(),a.cropping(!1))};a.restore=function(){a.imageUrl(a.originalImageUrl());a.cropper.replace(a.originalImageUrl());a.data=a.cropper.getData();a.canvasData=a.cropper.getCanvasData();a.cropBoxData=a.cropper.getCropBoxData();a.cropper.clear();a.originalImageUrl("");a.isOperate(!0)};a.move=function(){a.cropper.setDragMode("move");a.isOperate(!0)};a.cropOk=function(){var b=
a.cropper,c=a.imageType();if(a.cropping())a.originalImageUrl(a.imageUrl()),a.data=b.getData(),a.canvasData=b.getCanvasData(),a.cropBoxData=b.getCropBoxData(),a.imageUrl(b.getCroppedCanvas(c=="image/png"?null:{fillColor:"#fff"}).toDataURL(c)),b.replace(a.imageUrl()),b.clear(),a.cropped(!0),a.cropping(!1),a.isOperate(!0)};a.crop=function(){a.cropper.setDragMode("crop");a.isOperate(!0)};a.zoomin=function(){a.cropper.zoom(0.1);a.isOperate(!0)};a.zoomout=function(){a.cropper.zoom(-0.1);a.isOperate(!0)};
a.rolateleft=function(){a.cropper.rotate(-90);a.isOperate(!0)};a.rolateright=function(){a.cropper.rotate(90);a.isOperate(!0)};a.horizontal=function(){a.cropper.scaleX(-a.cropper.getData().scaleX||-1);a.isOperate(!0)};a.vertical=function(){a.cropper.scaleY(-a.cropper.getData().scaleY||-1);a.isOperate(!0)};a.start=function(){if(!a.cropped())a.cropper=new t(a.image,{autoCrop:!1,checkOrientation:!1,checkCrossOrigin:!1,dragMode:"move",background:!1,built:function(){if(a.data)a.cropper.crop().setData(a.data).setCanvasData(a.canvasData).setCropBoxData(a.cropBoxData),
a.data=null,a.canvasData=null,a.cropBoxData=null},crop:function(b){b.width>0&&b.height>0&&!a.cropping()&&a.cropping(!0)}})};a.upload=function(){a.status(cube.msg("UPLOADING"));if(a.isIE())a.ieUploadFile();else{var b=new l;b.url=a.url();if(a.isOperate()==!0){a.cropper.cropped=!0;var c=a.imageType();a.imageUrl(a.cropper.getCroppedCanvas(c=="image/png"?null:{fillColor:"#fff"}).toDataURL(c))}b.file=w(a.imageUrl());b.file.name=a.name();b.params=m();b.onprogresschange=function(b){a.progress(b+"%")};b.onprogresscomplete=
function(b){b=b.event.target.responseText.replace(/\s*/g,"");b=="-1"?(a.status(cube.msg("UPLOADED")),a.uploaded(!0)):b.split(":")[0]=="-5"&&a.status(cube.msg("UPLOADFAIL")+","+cube.msg("UPLOAD_SIZE_LIMIT",[a.maxFileSize()+"KB"]))};b.onprogresserror=function(){a.status(cube.msg("UPLOADFAIL"))};b.oncanceled=function(){a.status(cube.msg("UPLOADCACEL"))};b.upload()}};a.download=function(){window.open(s(a.name()))};var h="";a.ieUploadFile=function(){var b=document.getElementById(a.id()),c=o();c.open("POST",
a.url(),!1);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8");c.send("option=startUpload&rnd="+cube.random());if(c.status==200){if(!c.responseText)throw"error";h=c.responseText}else throw"error";n();if(a.type()=="path")b.action=encodeURI(a.url()+"?option=upload&maxFileSize="+a.maxFileSize()+"&sessionId="+h+"&fileName="+a.name()+"&filePath="+a.filePath()+"&uploadMode="+a.uploadMode()+"&isVirtual="+a.isVirtual()+"&rnd="+cube.random());else if(a.type()=="form"||a.type()==
"grid")b.action=encodeURI(a.url()+"?option=upload&maxFileSize="+a.maxFileSize()+"&sessionId="+h+"&tableName="+a.tableName()+"&primaryKey="+a.primaryKey()+"&pkVal="+a.pkVal()+"&colName="+a.colName()+(a.filePath()?"&filePath="+a.filePath():"")+"&uploadMode="+a.uploadMode()+"&udsParam="+a.udsParam()+"&isVirtual="+a.isVirtual()+"&rnd="+cube.random());b.submit()};a._imgloader=function(a,c){return"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a+"', sizingMethod='"+c+"')"};a.onload=function(b){if(a.onRendered!=
null&&!cube.isObservable(a.onRendered))a.onRendered(b)};cube.endViewModel(a,u)}});define("transfereditor",[],function(){return function(h){var a=this;a.width="auto";a.value="";a.list=[];a.transferHeight="200px";a.transferWidth="100px";a.displayAddButton=!0;a.displayDeleteButton=!0;a.displayAddAllButton=!0;a.displayDeleteAllButton=!0;a.listRight=cube.array([]);a._addData=null;a._deleteData=null;a.onRendered=null;a.commonRendered=null;a._init=function(){if(cube.notEmpty(a.value())){for(var c=String(a.value()).split(","),b=0;b<c.length;b++)for(var d=c[b],e=a.list(),f=0;f<e.length;f++){var g=a.list()[f];
d==a.list()[f].value&&(a.listRight.push(g),a.list.remove(g))}a.setTransferEditorValue()}};a._selectListItem=function(c){a._addData(c);a._deleteData(c)};a._abAddItem=function(c){for(var b=a.list(),d=0;d<b.length;d++){var e=a.list()[d];c.text==a.list()[d].text&&(a.list.remove(e),a.listRight.push(e))}a.setTransferEditorValue()};a._abRemoveItem=function(c){for(var b=a.listRight(),d=0;d<b.length;d++){var e=a.listRight()[d];c.text==e.text&&(a.list.push(e),a.listRight.remove(e))}a.setTransferEditorValue()};
a._addItem=function(){for(var c=a.listRight(),b=0;b<c.length;b++){var d=a.listRight()[b];if(a._addData()==a.listRight()[b])return}cube.notEmpty(a._addData())&&a.listRight.push(a._addData());c=a.list();for(b=0;b<c.length;b++)d=a.list()[b],a._addData()==a.list()[b]&&a.list.remove(d);a.setTransferEditorValue()};a._removeItem=function(){for(var c=a.list(),b=0;b<c.length;b++){var d=a.list()[b];if(a._deleteData()==a.list()[b])return}cube.notEmpty(a._deleteData())&&a.list.push(a._deleteData());c=a.listRight();
for(b=0;b<c.length;b++)d=a.listRight()[b],a._deleteData()==a.listRight()[b]&&a.listRight.remove(d);a.setTransferEditorValue()};a._addAllItems=function(){for(var c=a.list(),b=0;b<c.length;b++){var d=a.list()[b];a.listRight.push(d)}a.list.removeAll();a.setTransferEditorValue()};a._removeAllItems=function(){for(var c=a.listRight(),b=0;b<c.length;b++){var d=a.listRight()[b];a.list.push(d)}a.listRight.removeAll();a.setTransferEditorValue()};a.setTransferEditorValue=function(){for(var c=a.listRight(),b=
"",d=0;d<c.length;d++){var e=a.listRight()[d].value,b=b==""?e:String(a.value())+","+e;a.value(b)}c.length==0&&a.value("")};a.onload=function(c,b){a.commonRendered!=null&&!cube.isObservable(a.commonRendered)&&a.commonRendered(c,b);if(a.onRendered!=null&&!cube.isObservable(a.onRendered))a.onRendered(c,b)};cube.endViewModel(a,h)}});define("formeditor",[],function(){return function(a){this.type="";cube.endViewModel(this,a)}});define("richeditor",["Validator","JSONUtil"],function(i,j){function g(f){function g(a){var d=$.Deferred(),c=new FileReader;c.onload=function(a){d.resolve(a.target.result)};c.onerror=d.reject;c.onprogress=d.notify;c.readAsDataURL(a);return d.promise()}var a=this;a.name="";a.value="";a.width="auto";a.height="auto";a.textareaHeight="200px";a.readOnly=!1;a.isShowCodeBtn=!1;a.validType=null;a.validOptions=null;a.validStatus=null;a.validHint=null;a.style="";a.isCodeMode=!1;a.cmdLists=[{type:"list",cmdKey:"FontName",
desc:"\u5b57\u4f53",options:[{name:"\u5b8b\u4f53",value:"\u5b8b\u4f53"},{name:"\u5fae\u8f6f\u96c5\u9ed1",value:"\u5fae\u8f6f\u96c5\u9ed1"},{name:"\u6977\u4f53",value:"\u6977\u4f53"},{name:"Serif",value:"Serif"},{name:"Sans",value:"Sans"},{name:"Arial",value:"Arial"},{name:"Arial Black",value:"Arial Black"},{name:"Courier",value:"Courier"},{name:"Courier New",value:"Courier New"},{name:"Comic Sans MS",value:"Comic Sans MS"},{name:"Helvetica",value:"Helvetica"},{name:"Times",value:"Times"},{name:"Times New Roman",
value:"Times New Roman"}],isShowOptions:cube.obj(!1),value:cube.obj("\u5b8b\u4f53"),icon:"icon-font"},{type:"list",cmdKey:"FontSize",desc:"\u5b57\u4f53\u5927\u5c0f",options:[{name:"\u5927\u53f7",value:5},{name:"\u4e2d\u53f7",value:3},{name:"\u5c0f\u53f7",value:1}],isShowOptions:cube.obj(!1),value:cube.obj("\u5927\u53f7"),icon:"icon-text-height"},{type:"group",items:[{type:"complex",cmdKey:"ForeColor",desc:"\u5b57\u4f53\u989c\u8272",icon:"icon-heart",value:cube.obj(""),options:{editorType:"color"},
isShowOptions:cube.obj(!1)},{type:"complex",cmdKey:"BackColor",desc:"\u6587\u5b57\u80cc\u666f",icon:"icon-tags",value:cube.obj(""),options:{editorType:"color"},isShowOptions:cube.obj(!1)}]},{type:"group",items:[{type:"single",cmdKey:"Bold",desc:"\u7c97\u4f53",icon:"icon-bold",value:cube.obj("")},{type:"single",cmdKey:"Italic",desc:"\u659c\u4f53",icon:"icon-italic",value:cube.obj("")},{type:"single",cmdKey:"Strikethrough",desc:"\u5220\u9664",icon:"icon-strikethrough",value:cube.obj("")},{type:"single",
cmdKey:"Underline",desc:"\u4e0b\u5212\u7ebf",icon:"icon-underline",value:cube.obj("")}]},{type:"group",items:[{type:"single",cmdKey:"InsertUnorderedList",desc:"\u9879\u76ee\u7f16\u53f7",icon:"icon-list-ul",value:cube.obj("")},{type:"single",cmdKey:"Insertorderedlist",desc:"\u6570\u5b57\u7f16\u53f7",icon:"icon-list-ol",value:cube.obj("")},{type:"single",cmdKey:"Outdent",desc:"\u51cf\u5c11\u7f29\u8fdb",icon:"icon-indent-main",value:cube.obj("")},{type:"single",cmdKey:"Indent",desc:"\u7f29\u8fdb",icon:"icon-indent-right",
value:cube.obj("")}]},{type:"group",items:[{type:"single",cmdKey:"Justifyleft",desc:"\u5c45\u5de6",icon:"icon-align-main",value:cube.obj("")},{type:"single",cmdKey:"Justifycenter",desc:"\u5c45\u4e2d",icon:"icon-align-center",value:cube.obj("")},{type:"single",cmdKey:"Justifyright",desc:"\u5c45\u53f3",icon:"icon-align-right",value:cube.obj("")},{type:"single",cmdKey:"Justifyfull",desc:"\u4e24\u7aef\u5bf9\u9f50",icon:"icon-align-justify",value:cube.obj("")}]},{type:"group",items:[{type:"complex",cmdKey:"createLink",
desc:"\u8d85\u7ea7\u94fe\u63a5",icon:"icon-link",value:cube.obj(""),options:{editorType:"text"},isShowOptions:cube.obj(!1)},{type:"single",cmdKey:"Unlink",desc:"\u53d6\u6d88\u8d85\u7ea7\u94fe\u63a5",icon:"icon-cut",value:cube.obj("")}]},{type:"group",items:[{type:"complex",cmdKey:"InsertImg",desc:"\u63d2\u5165\u56fe\u7247",icon:"icon-picture",value:cube.obj(""),options:{editorType:"file"},isShowOptions:cube.obj(!1)}]},{type:"group",items:[{type:"single",cmdKey:"Undo",desc:"\u64a4\u9500",icon:"icon-undo",
value:cube.obj("")},{type:"single",cmdKey:"Redo",desc:"\u91cd\u65b0\u952e\u5165",icon:"icon-repeat",value:cube.obj("")}]},{type:"group",items:[{type:"single",cmdKey:"CUBE_CODE",desc:"\u7f16\u8f91\u6e90\u7801",icon:"icon-edit",value:cube.obj("")}]}];a.curCmd=null;a.fontName=null;a.fontSize=null;a.selectionRange=null;var h=!0;a.onChanged=null;a._init=function(){var b=a.style(),d=a.width(),c=a.height();b.indexOf("width")==-1&&(b=b+";width:"+d+";");b.indexOf("height")==-1&&(b=b+";height:"+c+";");a.style(b);
a.valueSub=cube.subscribe(a.value,a._changed);if(typeof f.maxLength!="undefined")b=a.validOptions(),b==null&&(b={}),b.maxLength=f.maxLength,a.validOptions(b);if(typeof f.nullable!="undefined"&&(!f.nullable||!f.nullable()))b=a.validType(),b==null?b="NOTNULL":b+=",NOTNULL",a.validType(b)};a.getEditorSelection=function(){a.isCodeMode()||a.saveSelection()};a.showOptions=function(){!a.isCodeMode()&&!a.readOnly()&&(a.curCmd(this),this.isShowOptions(!0),a.restoreSelection())};a.hiddenOptions=function(){a.isCodeMode()||
this.isShowOptions(!1)};a.execCommand=function(b){a.readOnly()||(a.curCmd()!=null&&(a.curCmd().cmdKey=="FontName"?a.fontName(b.name):a.curCmd().cmdKey=="FontSize"&&a.fontSize(b.name)),a.isCodeMode()?a.curCmd().cmdKey=="CUBE_CODE"&&a.isCodeMode(!a.isCodeMode()):(a.restoreSelection(),this.cmdKey!=null&&a.curCmd(this),a.curCmd().type=="list"&&a.curCmd().value(this.value),a.curCmd().cmdKey=="CUBE_SAVE"?a.value($("div.richeditor").html()):a.curCmd().cmdKey=="CUBE_CODE"?(a.value($("div.richeditor").html()),
a.isCodeMode(!a.isCodeMode())):this.options!=null&&this.options.editorType=="file"?/^image\//.test(this.value().type)&&$.when(g(this.value())).done(function(a){document.execCommand("insertimage","false",a)}):document.execCommand(a.curCmd().cmdKey,0,a.curCmd().value()),(a.curCmd().type=="list"||a.curCmd().type=="complex")&&a.curCmd().isShowOptions(!1),a.saveSelection()))};a._changed=function(){if(a.onChanged!=null&&!cube.isObservable(a.onChanged))a.onChanged(a.name(),a.value())};a._valid=function(b,
d){var c=d.target.innerText.replace(/(\n)/g,""),e=d.target.innerHTML;h=!1;a.value(e);h=!0;e=a.validType();e!=null&&(c=i.validate(c,e,a.validOptions()),c.successful?(a.validHint(""),a.validStatus("")):(a.validHint(c.hint),a.validStatus("error")))};a._click=function(b,d){var c=d.target;if(c){var c=$(c),e=c.css("font-family"),c=c.attr("size");j.getItem(a.cmdLists(),"name",e,3)?a.fontName(e):a.fontName(null);c==5?a.fontSize("\u5927\u53f7"):c==3?a.fontSize("\u4e2d\u53f7"):c==1?a.fontSize("\u5c0f\u53f7"):
a.fontSize(null)}};a.saveSelection=function(){var b=null;if(window.getSelection){var d=window.getSelection($("div.richeditor"));d.getRangeAt&&d.rangeCount&&(b=d.getRangeAt(0))}else document.selection&&(b=document.selection.createRange());if(b!=null)a.selectionRange=b};a.restoreSelection=function(){var b;if(a.selectionRange&&!cube.isObservable(a.selectionRange))if(window.getSelection){b=window.getSelection($("div.richeditor"));try{b.removeAllRanges()}catch(d){document.body.createTextRange().select(),
document.selection.empty()}b.addRange(a.selectionRange)}else document.selection&&(selrange=document.selection.createRange(a.selectionRange))};ko.bindingHandlers.editableHtml={init:function(){},update:function(a,d){if(h){var c=ko.utils.unwrapObservable(d());$(a).html(c)}}};a.onload=function(b){b=$(b);if(a.height()!="auto"||a.style().indexOf("height")!=-1){var d=b.find(".btn-toolbar").outerHeight();a.textareaHeight(parseInt(b.height())-parseInt(d)-10+"px")}};cube.endViewModel(a,f)}g.prototype.dispose=
function(){this.valueSub.dispose()};return g});define("borderlayout",[],function(){function d(d){var a=this;a.top=null;a.left=null;a.center=null;a.right=null;a.bottom=null;a.centerHeightAuto=!1;a.$center=null;a.$left=null;a.$right=null;a.btnbgcolor=null;a._btnheight=null;a.topDisplay=!0;a.bottomDisplay=!0;a.rightDisplay=!0;a.leftDisplay=!0;a.centerWidth=null;var k=!1,l=!1,m=!1,n=!1,o=!1;a._init=function(){if(cube.notEmpty(a.center())){var c=a.center().width;a.centerWidth=cube.obj(c)}};a.setTopPanel=function(){a.topDisplay()?a.topDisplay(!1):a.topDisplay(!0)};
a.setBottomPanel=function(){a.bottomDisplay()?a.bottomDisplay(!1):a.bottomDisplay(!0)};a.setRightPanel=function(){a.rightDisplay()?(a.rightDisplay(!1),cube.notEmpty(a.center())&&(a.centerWidth(parseInt(a.centerWidth().replace("%",""))+parseInt(a.right().width.replace("%",""))+"%"),a.$center.css({width:a.centerWidth()}))):(a.rightDisplay(!0),cube.notEmpty(a.center())&&(a.centerWidth(parseInt(a.centerWidth().replace("%",""))-parseInt(a.right().width.replace("%",""))+"%"),a.$center.css({width:a.centerWidth()})))};
a.setLeftPanel=function(){a.leftDisplay()?(a.leftDisplay(!1),cube.notEmpty(a.center())&&(a.centerWidth(parseInt(a.centerWidth().replace("%",""))+parseInt(a.left().width.replace("%",""))+"%"),a.$center.css({width:a.centerWidth()}))):(a.leftDisplay(!0),cube.notEmpty(a.center())&&(a.centerWidth(parseInt(a.centerWidth().replace("%",""))-parseInt(a.left().width.replace("%",""))+"%"),a.$center.css({width:a.centerWidth()})))};a.onloading=function(c){var c=$(c),e=c.children("section"),b=cube.getIEVersion();
e.each(function(c,e){var f=$(e),g=f.attr("type"),h=f.attr("width"),d=f.attr("height"),i=f.attr("visible"),p=f.attr("border"),q=f.attr("isShowCloseBtn"),j=f.wrap("<div></div>").parent().html();b>-1&&b<9&&(j=j.replace(/<:/g,"<").replace(/<\/:/g,"</"));cube.notEmpty(i)&&(i=i=="false"?!1:!0);h={width:h,height:d,visible:cube.obj(i),border:p,content:j,isShowCloseBtn:q};g=="top"?(a.top(h),k=!0):g=="left"?(a.left(h),l=!0):g=="center"?(a.center(h),m=!0,g=a.center().width,a.centerWidth=cube.obj(g)):g=="right"?
(a.right(h),n=!0):g=="bottom"&&(a.bottom(h),o=!0);f.remove()});c=c.attr("centerHeightAuto");cube.notEmpty(c)&&a.centerHeightAuto(Boolean(c))};a.onload=function(c,e){var b=$(c);k&&cube.applyBindings(b.find(">.borderlayout>.row-fluid:nth-child(1)>.top>div").children(),e);l&&cube.applyBindings(b.find(">.borderlayout>.middle>.main>div").children(),e);m&&cube.applyBindings(b.find(">.borderlayout>.middle>.center>div").children(),e);n&&cube.applyBindings(b.find(">.borderlayout>.middle>.right>div").children(),
e);o&&cube.applyBindings(b.find(">.borderlayout>.row-fluid:nth-child(3)>.bottom>div").children(),e);a.$center=b.children(".borderlayout").children(".middle").children(".center");a.$left=b.children(".borderlayout").children(".middle").children(".left");a.$right=b.children(".borderlayout").children(".middle").children(".right");a._btnheight(b.children(".borderlayout").children(".middle").height()/2-48+"px");if(a.centerHeightAuto()){var d=b.children(".borderlayout").children(".row-fluid").children(".top"),
b=b.children(".borderlayout").children(".row-fluid").children(".bottom"),d=$(document).height()-d.height()-b.height();a.$center.height(d-10);a.$center.css("overflow","auto")}};cube.endViewModel(a,d)}d.prototype.dispose=function(){};return d});define("columntypelayout",[],function(){return function(f){var b=this;b.columns=[];var h=0;b.onloading=function(c){c=$(c).children("section");h=b.columns().length;var e=cube.getIEVersion();c.each(function(c,g){var a=$(g),d=a.wrap("<div></div>").parent().html();e>-1&&e<9&&(d=d.replace(/<:/g,"<").replace(/<\/:/g,"</"));d={columnWidth:a.attr("columnWidth"),columnborder:a.attr("columnborder"),name:a.attr("name"),content:d};b.columns.push(d);a.remove()})};b.onload=function(c,e){for(var f=$(c),g=b.columns(),a=h;a<g.length;a++)cube.applyBindings(f.find(">.col-layout>tbody>tr>td:nth-child("+
(a+1)+")").children("div").eq(0).children(),e)};cube.endViewModel(b,f)}});define("fluidlayout",[],function(){return function(f){var a=this;a.width="100%";a.height="100%";a.items=[];var h=0;a.onloading=function(c){c=$(c).children("section");h=a.items().length;var e=cube.getIEVersion();c.each(function(c,g){var b=$(g),d=b.wrap("<div></div>").parent().html();e>-1&&e<9&&(d=d.replace(/<:/g,"<").replace(/<\/:/g,"</"));d={colspan:b.attr("colspan"),textAlign:b.attr("textAlign"),content:d};a.items.push(d);b.remove()})};a.onload=function(c,e){for(var f=$(c),g=a.items(),b=h;b<g.length;b++)cube.applyBindings(f.find(">.container>div:nth-child("+
(b+1)+")>div").children(),e)};cube.endViewModel(a,f)}});define("gridlayout",[],function(){return function(g){var a=this;a.width="100%";a.height="100%";a.items=[];var i=0;a.onloading=function(b){b=$(b).children("section");i=a.items().length;var f=cube.getIEVersion();b.each(function(b,h){var c=[],j=$(h);j.children("section").each(function(a,b){var d=$(b),e=d.wrap("<div></div>").parent().html();f>-1&&f<9&&(e=e.replace(/<:/g,"<").replace(/<\/:/g,"</"));e={colspan:d.attr("colspan"),width:d.attr("width"),height:d.attr("height"),content:e};c.push(e);d.remove()});a.items.push(c);
j.remove()})};a.onload=function(b,f){for(var g=$(b),h=a.items(),c=i;c<h.length;c++)g.find(">.container-fluid>.row-fluid:nth-child("+(c+1)+")").children("div").each(function(a,b){cube.applyBindings($(b).children().children(),f)})};cube.endViewModel(a,g)}});define("include",[],function(){function c(c){function g(b){$.ajax({url:b,crossDomain:!h(b),success:function(b){a.ajaxHtml(b)}})}function h(a){if(cube.notEmpty(a)&&a.indexOf("http")!=0)return!0;if((a=a.match(/((http|https):\/\/[^\/]+)\//i))&&a.length>1&&a[1]==window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""))return!0;$.support.cors=!0;return!1}var a=this;a.url=null;a.type="ajax";a.iframeHeight="100%";a._url=null;a.ajaxHtml="";a.isOut=!1;a.params={};a.oldparams=
{};a._params={};a._init=function(){a.oldparams=c.params;a.compurl();a.urlSub=cube.subscribe(a.url,a.compurl)};a.compurl=function(){var b=a.url();cube.notEmpty(b)&&b.indexOf("http")==0&&a.type()!="viewModel"&&a.isOut(!0);if(a.isOut()&&"ajax"==a.type())g(b);else{var c=cube.clone(a.oldparams);if(b!=null&&b.indexOf("?")!=-1){for(var e=b.split("?")[1].split("&"),d=0;d<e.length;d++){var f=e[d].split("=");c[f[0]]=unescape(f[1])}b=b.split("?")[0]}a._params(c)}a._url(b)};cube.endViewModel(a,c)}c.prototype.dispose=
function(){this.urlSub.dispose()};return c});define("submenutmpl",[],function(){function b(b){var a=this;a.children=[];a.selectMenuItem=null;a.hoverItem=null;a.childrenHoverItem=null;a.parentItem=null;a.isList=!1;a.isHorizontalChildren=!1;a.openSubItems=function(b,d){if(!a.isList()){a.childrenHoverItem(this);var c=$(d.currentTarget?d.currentTarget:d.srcElement),c=$(c).children("div").children("ul"),e=c.outerHeight()+c.offset().top-$(window).height();e>0&&c.css("top",-e-5+"px")}};a.closeSubItems=function(){!a.isList()&&!a.isHorizontalChildren()&&a.childrenHoverItem(null)};
cube.endViewModel(a,b)}b.prototype.dispose=function(){};return b});define("pageheader",[],function(){function a(a){this.subTitle=this.title=this.style="";this.titleSize="h1";this.isSubtitleWrap=!1;cube.endViewModel(this,a)}a.prototype.dispose=function(){};return a});