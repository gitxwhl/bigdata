<?xml version="1.0" encoding="UTF-8"?>
<sqls>
    <sql id="GetBlackCntInfos" desc="黑名单等级列表">
        <mysql>
            select
            COUNT( CASE WHEN BLACKLIST_LEVEL = '01' THEN 1 ELSE NULL END ) AS BLACKLIST_LEVEL1,
            COUNT( CASE WHEN BLACKLIST_LEVEL = '02' THEN 1 ELSE NULL END ) AS BLACKLIST_LEVEL2,
            COUNT( CASE WHEN BLACKLIST_LEVEL = '03' THEN 1 ELSE NULL END ) AS BLACKLIST_LEVEL3
            from SRP_WORK_BLACKLISTORG
            WHERE
            ${filter} and ( DELETELOGO is null or DELETELOGO != '1' );
        </mysql>
    </sql>

    <sql id="GetBlackCntInfosByTimMonth" desc="本月纳入黑名单数">
        <mysql>
            SELECT
            COUNT( CASE WHEN DATE_FORMAT( RELEASE_DATE, '%Y%m' ) = DATE_FORMAT( CURDATE( ), '%Y%m' ) THEN 1 ELSE NULL
            END ) AS RELEASE_CNT_MONTH
            FROM SRP_WORK_BLACKLISTORG
            WHERE
            ${filter} and ( DELETELOGO is null or DELETELOGO != '1' );
        </mysql>
    </sql>

    <sql id="GetBlackCntInfosByTimYear" desc="本年纳入黑名单数">
        <mysql>
            SELECT
            COUNT( CASE WHEN YEAR ( RELEASE_DATE ) = YEAR ( now( ) ) THEN 1 ELSE NULL
            END ) AS RELEASE_CNT_YEAR
            FROM SRP_WORK_BLACKLISTORG
            WHERE
            ${filter} and ( DELETELOGO is null or DELETELOGO != '1' );
        </mysql>
    </sql>

    <sql id="GetBlackCntInfosByAreaMonth" desc="各单位本月纳入黑名单数及本月解除黑名单数情况">
        <mysql>
            SELECT
            column_type_name DATAREPORT_ORG,
            column_type_code DATAREPORT_ORG_ID,
            COUNT( CASE WHEN DATE_FORMAT( RELEASE_DATE, '%Y%m' ) = DATE_FORMAT( CURDATE( ), '%Y%m' ) THEN 1 ELSE NULL
            END ) AS RELEASE_CNT,
            COUNT( CASE WHEN DATE_FORMAT( BLACKLISTREL_DATE, '%Y%m' ) = DATE_FORMAT( CURDATE( ), '%Y%m' ) and NOW() >= BLACKLISTREL_DATE THEN 1 ELSE
            NULL END ) AS BLACKLISTREL_CNT
            FROM (select column_type_name,column_type_code,column_num from srp_risk_sys_tab where column_code = 'DATAREPORT_ORG' )
            a
            left join SRP_WORK_BLACKLISTORG b on a.column_type_code = b.PROVINCE_CODE
            WHERE
            ${filter}
            and ( b.DELETELOGO is null or b.DELETELOGO != '1' )
            GROUP BY
            column_type_name,
            column_type_code ORDER BY column_num+0 asc;
        </mysql>
    </sql>

    <sql id="GetBlackCntInfosByAreaYear" desc="各单位本年纳入黑名单数及本年解除黑名单数情况">
        <mysql>
            SELECT
            column_type_name DATAREPORT_ORG,
            column_type_code DATAREPORT_ORG_ID,
            COUNT( CASE WHEN year(RELEASE_DATE)=year(now()) THEN 1 ELSE NULL END ) AS RELEASE_CNT,
            COUNT( CASE WHEN year(BLACKLISTREL_DATE)=year(now()) and NOW() >= BLACKLISTREL_DATE THEN 1 ELSE NULL END ) AS BLACKLISTREL_CNT
            FROM
            ( SELECT column_type_name, column_type_code, column_num FROM srp_risk_sys_tab WHERE column_code = 'DATAREPORT_ORG' ) a
            LEFT JOIN SRP_WORK_BLACKLISTORG b ON a.column_type_code = b.PROVINCE_CODE
            WHERE
            ${filter}
            AND ( b.DELETELOGO IS NULL OR b.DELETELOGO != '1' )
            GROUP BY
            column_type_name,
            column_type_code
            ORDER BY
            column_num + 0 ASC;
        </mysql>
    </sql>

    <sql id="GetBlackCntInfosByAreaAll" desc="各单位全部纳入黑名单数及全部解除黑名单数情况">
        <mysql>
            SELECT
            column_type_name DATAREPORT_ORG,
            column_type_code DATAREPORT_ORG_ID,
            COUNT(RELEASE_DATE IS NOT NULL) AS RELEASE_CNT,
            COUNT(CASE WHEN  NOW() >= BLACKLISTREL_DATE THEN 1 ELSE NULL END) AS BLACKLISTREL_CNT
            FROM
            ( SELECT column_type_name, column_type_code, column_num FROM srp_risk_sys_tab WHERE column_code = 'DATAREPORT_ORG' ) a
            LEFT JOIN SRP_WORK_BLACKLISTORG b ON a.column_type_code = b.PROVINCE_CODE
            WHERE
            ${filter}
            AND ( b.DELETELOGO IS NULL OR b.DELETELOGO != '1' )
            GROUP BY
            column_type_name,
            column_type_code
            ORDER BY
            column_num + 0 ASC;
        </mysql>
    </sql>

    <sql id="GetNegativeCntInfos" desc="负面清单总数">
        <mysql>
            SELECT
            count( 1 ) NEGATIVELIST_CNT
            FROM
            SRP_WORK_NEGATIVELISTORG
            WHERE
            ${filter} and ( DELETELOGO is null or DELETELOGO != '1' );
        </mysql>
    </sql>

    <sql id="GetNegativeCntInfosByTimMonth" desc="本月纳入负面清单数">
        <mysql>
            SELECT
            COUNT( CASE WHEN DATE_FORMAT( RELEASE_DATE, '%Y%m' ) = DATE_FORMAT( CURDATE( ), '%Y%m' ) THEN 1 ELSE NULL END ) AS RELEASE_CNT_MONTH
            FROM
            SRP_WORK_NEGATIVELISTORG
            WHERE
            ${filter}
            AND ( DELETELOGO IS NULL OR DELETELOGO != '1' );
        </mysql>
    </sql>

    <sql id="GetNegativeCntInfosByTimYear" desc="本年纳入负面清单数">
        <mysql>
            SELECT
            COUNT( CASE WHEN YEAR ( RELEASE_DATE ) = YEAR ( now( ) ) THEN 1 ELSE NULL END ) AS RELEASE_CNT_YEAR
            FROM
            SRP_WORK_NEGATIVELISTORG
            WHERE
            ${filter}
            AND ( DELETELOGO IS NULL OR DELETELOGO != '1' );
        </mysql>
    </sql>

    <sql id="GetNegativeCntInfosByAreaMonth" desc="各单位本月纳入负面清单数及本月解除负面清单数情况">
        <mysql>
            SELECT
            column_type_name DATAREPORT_ORG,
            column_type_code DATAREPORT_ORG_ID,
            COUNT( CASE WHEN DATE_FORMAT( RELEASE_DATE, '%Y%m' ) = DATE_FORMAT( CURDATE( ), '%Y%m' ) THEN 1 ELSE NULL
            END ) AS RELEASE_CNT,
            COUNT( CASE WHEN DATE_FORMAT( NEGATIVELISTREL_DATE, '%Y%m' ) = DATE_FORMAT( CURDATE( ), '%Y%m' ) THEN 1 ELSE
            NULL END ) AS NEGATIVELISTREL_CNT
            FROM (select column_type_name,column_type_code,column_num from srp_risk_sys_tab where column_code = 'DATAREPORT_ORG' )
            a
            left join SRP_WORK_NEGATIVELISTORG b on a.column_type_code = b.PROVINCE_CODE
            WHERE
            ${filter}
            and ( b.DELETELOGO is null or b.DELETELOGO != '1' )
            GROUP BY
            column_type_name,
            column_type_code ORDER BY column_num+0 asc;
        </mysql>
    </sql>


    <sql id="GetNegativeCntInfosByAreaYear" desc="各单位本年纳入负面清单数及本年解除负面清单数情况">
        <mysql>
            SELECT
            column_type_name DATAREPORT_ORG,
            column_type_code DATAREPORT_ORG_ID,
            COUNT( CASE WHEN year(RELEASE_DATE)=year(now()) THEN 1 ELSE NULL END ) AS RELEASE_CNT,
            COUNT( CASE WHEN year(NEGATIVELISTREL_DATE)=year(now()) THEN 1 ELSE NULL END ) AS NEGATIVELISTREL_CNT
            FROM
            ( SELECT column_type_name, column_type_code, column_num FROM srp_risk_sys_tab WHERE column_code = 'DATAREPORT_ORG' ) a
            LEFT JOIN SRP_WORK_NEGATIVELISTORG b ON a.column_type_code = b.PROVINCE_CODE
            WHERE
            ${filter}
            AND ( b.DELETELOGO IS NULL OR b.DELETELOGO != '1' )
            GROUP BY
            column_type_name,
            column_type_code
            ORDER BY
            column_num + 0 ASC;
        </mysql>
    </sql>

    <sql id="GetNegativeCntInfosByAreaAll" desc="各单位全部纳入负面清单数及全部解除负面清单数情况">
        <mysql>
            SELECT
            column_type_name DATAREPORT_ORG,
            column_type_code DATAREPORT_ORG_ID,
            COUNT(RELEASE_DATE IS NOT NULL) AS RELEASE_CNT,
            COUNT(CASE WHEN  NOW() >= NEGATIVELISTREL_DATE THEN 1 ELSE NULL END) AS BLACKLISTREL_CNT
            FROM
            ( SELECT column_type_name, column_type_code, column_num FROM srp_risk_sys_tab WHERE column_code = 'DATAREPORT_ORG' ) a
            LEFT JOIN SRP_WORK_NEGATIVELISTORG b ON a.column_type_code = b.PROVINCE_CODE
            WHERE
            ${filter}
            AND ( b.DELETELOGO IS NULL OR b.DELETELOGO != '1' )
            GROUP BY
            column_type_name,
            column_type_code
            ORDER BY
            column_num + 0 ASC;
        </mysql>
    </sql>

    <sql id="GetBlackInfosList" desc="黑名单列表">
        <mysql>
            SELECT
            a.BLACKLISTORG_ID,
            a.SITEINFO_NAME,
            a.SITEINFO_ID,
            b.PROVINCE_CODE,
            a.ORG_ADDRESS,
            a.LEGAL_REPRESENTATIVE,
            a.PROJECT_MANAGER,
            a.BLACKLIST_LEVEL,
            a.INCLUSION_CONDITION,
            a.RELEASE_DATE,
            a.BLACKLISTREL_DATE,
            a.PUBLISH_ORG,
            a.PUBLISH_ORG_ID,
            a.REPORT_PERSON,
            a.REPORT_DATE,
            a.DATAFILL_ORG,
            a.ANNEX,
            ( CASE WHEN NOW( ) >= a.BLACKLISTREL_DATE THEN '解除' ELSE '未解除' END ) AS ISENABLEENTER,
            b.BASICINFO_CONTRACTOR,
            b.BASICINFO_CREDITCODE,
            b.BASICINFO_LEGALREPRESENTATIVE,
            c.column_type_name DATAREPORT_ORG,
            c.column_type_name DATAREPORT_ORG_ID
            FROM
            SRP_WORK_BLACKLISTORG a
            LEFT JOIN SRP_WORK_SITEINFO b ON a.SITEINFO_ID = b.SITEINFO_ID
            LEFT JOIN ( SELECT * FROM srp_risk_sys_tab WHERE column_code = 'DATAREPORT_ORG' ) c ON b.PROVINCE_CODE = c.column_type_code
            WHERE
            ${filter}
        </mysql>
    </sql>

    <sql id="GetBlackInfosCnt" desc="企业黑名单信息查询列表总数">
        <mysql>
            SELECT
            COUNT( 1 ) AS BLACK_CNT
            from SRP_WORK_BLACKLISTORG a
            LEFT JOIN SRP_WORK_SITEINFO b on a.SITEINFO_ID = b.SITEINFO_ID
            WHERE
            ${filter};
        </mysql>
    </sql>


    <sql id="GetNegativeInfosList" desc="负面清单列表">
        <mysql>
            select
            a.NEGATIVELISTORG_ID,
            a.ORG_NAME,
            a.SITEINFO_ID,
            a.ORG_ADDRESS,
            a.LEGAL_REPRESENTATIVE,
            a.PROJECT_MANAGER,
            a.INCLUSION_CONDITION,
            a.RELEASE_DATE,
            a.NEGATIVELISTREL_DATE,
            a.PUBLISH_ORG,
            a.PUBLISH_ORG_ID,
            a.REPORT_PERSON,
            a.REPORT_DATE,
            a.DATAFILL_ORG,
            a.ANNEX,

            b.BASICINFO_CONTRACTOR,
            b.BASICINFO_CREDITCODE,
            b.BASICINFO_LEGALREPRESENTATIVE,
            b.PROVINCE_CODE,
            b.ORG_NATURE,
            b.DATAREPORT_ORG,
            c.column_type_name DATAREPORT_ORG_ID

            from SRP_WORK_NEGATIVELISTORG a
            LEFT JOIN SRP_WORK_SITEINFO b on a.SITEINFO_ID = b.SITEINFO_ID
            LEFT JOIN (SELECT * FROM srp_risk_sys_tab WHERE column_code = 'DATAREPORT_ORG') c on b.PROVINCE_CODE = c.column_type_code
            WHERE
            ${filter} ORDER BY a.RELEASE_DATE DESC, a.NEGATIVELISTREL_DATE DESC
        </mysql>

    </sql>

    <sql id="GetNegativeInfosCnt" desc="企业负面清单信息查询列表总数">
        <mysql>
            SELECT
            COUNT( 1 ) AS NEGATIVE_CNT
            from SRP_WORK_NEGATIVELISTORG a
            LEFT JOIN SRP_WORK_SITEINFO b on a.SITEINFO_ID = b.SITEINFO_ID
            WHERE
            ${filter};
        </mysql>
    </sql>

    <sql id="deleteBlacklist" desc="黑名单列表数据删除">
        <mysql>
            update SRP_WORK_BLACKLISTORG set  DELETELOGO = "1" where BLACKLISTORG_ID in ( ${filter} )
        </mysql>
    </sql>

    <sql id="deleteInventory" desc="负面清单列表数据删除">
        <mysql>
            update SRP_WORK_NEGATIVELISTORG set  DELETELOGO = "1" where NEGATIVELISTORG_ID in ( ${filter} )
        </mysql>
    </sql>
</sqls>
