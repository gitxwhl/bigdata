<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.property.mapper.WyequipmentinspectionMapper">
  <resultMap id="BaseResultMap" type="com.property.entity.Wyequipmentinspection">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="inspection" jdbcType="VARCHAR" property="inspection" />
    <result column="incequipment" jdbcType="VARCHAR" property="incequipment" />
    <result column="plantime" jdbcType="VARCHAR" property="plantime" />
    <result column="planner" jdbcType="VARCHAR" property="planner" />
    <result column="begintime" jdbcType="VARCHAR" property="begintime" />
    <result column="endtime" jdbcType="VARCHAR" property="endtime" />
    <result column="inspectionperson" jdbcType="VARCHAR" property="inspectionperson" />
    <result column="results" jdbcType="VARCHAR" property="results" />
    <result column="remarks" jdbcType="VARCHAR" property="remarks" />
    <result column="missing" jdbcType="VARCHAR" property="missing" />
    <result column="company" jdbcType="VARCHAR" property="company" />
    <result column="missingequipment" jdbcType="VARCHAR" property="missingequipment" />
  </resultMap>
  <!--    获取总数量-->
  <select id="getTotalSize" resultType="java.lang.Integer">
    select count(id) from wy_equipmentinspection
    <where>
      <if test="company != null and company != ''">
        AND company = #{company}
      </if>
      <if test="inspection != null and inspection != ''">
        AND inspection like "%"#{inspection}"%"
      </if>
      <if test="plantime != null and plantime != ''">
        AND plantime = #{plantime}
      </if>
      <if test="begintime != null and begintime != ''">
        AND begintime = #{begintime}
      </if>
    </where>
  </select>


  <!--获取设备巡检信息-->
  <select id="selectEquipmentInspection" resultType="java.util.Map">
    select  a.id,
            a.inspection,
            a.incequipment,
            a.plantime,
            a.planner,
            a.begintime,
            a.inspectionperson,
            b.paravalue results,
            a.remarks,
            a.missing
    from (select * from wy_equipmentinspection) a
    left join (select * from sys_parameter where paraname = 'results') b on a.results = b.parakey
    <where>
      <if test="company != null and company != ''">
        AND a.company = #{company}
      </if>
      <if test="inspection != null and inspection != ''">
        AND a.inspection like "%"#{inspection}"%"
      </if>
      <if test="plantime != null and plantime != ''">
        AND a.plantime = #{plantime}
      </if>
      <if test="begintime != null and begintime != ''">
        AND a.begintime = #{begintime}
      </if>
    </where>
  </select>

  <!--    添加巡检计划信息-->
  <insert id="insertEquipmentInspection" parameterType="com.property.entity.Wyequipmentinspection">
        insert into wy_equipmentinspection (inspection,incequipment,plantime,planendtime,planner,company)
        values (#{inspection},#{incequipment},#{plantime},#{planendtime},#{planner},#{company})
  </insert>

  <!--    添加巡检记录信息 -->
  <select id="getIncEqu" resultType="String">
    select incequipment from wy_equipmentinspection where inspection = #{inspection}
  </select>
  <update id="updateEquipmentInspection" parameterType="com.property.entity.Wyequipmentinspection">
      UPDATE wy_equipmentinspection
        SET begintime = #{begintime},endtime = #{endtime},inspectionperson = #{inspectionperson},
            results = #{results},remarks = #{remarks},missing = #{missing}
        WHERE
            inspection = #{inspection}
  </update>

  <!--    获取线路名称-->
  <select id="getInspection" resultType="java.util.Map" >
    select id,inspection text from wy_equipmentinspection
  </select>

  <!--    获取设备信息-->
  <select id="getIncequipment" resultType="java.util.Map">
    select id,name text from wy_equipment
    where del_flag = '0'
  </select>

  <!--    获取巡检结果-->
  <select id="getResults" resultType="java.util.Map">
    select parakey id,paravalue text from sys_parameter
    where paraname = 'results'
  </select>
</mapper>