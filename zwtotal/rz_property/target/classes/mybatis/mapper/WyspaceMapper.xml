<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.property.mapper.WyspaceMapper">
  <resultMap id="BaseResultMap" type="com.property.entity.Wyspace">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="spacename" jdbcType="VARCHAR" property="spacename" />
    <result column="builtarea" jdbcType="VARCHAR" property="builtarea" />
    <result column="greeningratio" jdbcType="VARCHAR" property="greeningratio" />
    <result column="detailedaddress" jdbcType="VARCHAR" property="detailedaddress" />
    <result column="description" jdbcType="VARCHAR" property="description" />
    <result column="enclosure" jdbcType="VARCHAR" property="enclosure" />
  </resultMap>

  <!--保洁区域列表-->
  <select id="getCleanSpace" resultType="Wyspace">
        SELECT
            *
        FROM
            wy_space
        WHERE
            del_flag = '0'
            <if test="spaceName != null and spaceName != ''">
                <bind name="SpaceName" value="'%' + spaceName + '%'"/>
                AND spacename like #{SpaceName}
            </if>
        limit #{index},#{pageSize}
  </select>

  <!--保洁区域数量-->
  <select id="getCleanSpaceCnt" resultType="java.lang.Integer">
        SELECT
            count(1)
        FROM
            wy_space
        WHERE
            del_flag = '0'
            <if test="spaceName != null and spaceName != ''">
                <bind name="SpaceName" value="'%' + spaceName + '%'"/>
                AND spacename like #{SpaceName}
            </if>
  </select>

  <!--通过设备id查询设备名称-->
  <select id="getEquipmentById" resultType="java.util.LinkedHashMap">
        SELECT
            name
        FROM
            wy_equipment
        WHERE
            id in (${ids})
  </select>

    <!--新增保洁区域-->
    <insert id="addCleanSpace" parameterType="Wyspace">
        INSERT INTO wy_space(
            spacename,builtarea,detailedaddress,description,enclosure,equipmentIds,del_flag
        )VALUES (
            #{spacename},#{builtarea},#{detailedaddress},#{description},#{enclosure},#{equipmentIds},#{delFlag}
        )
    </insert>

    <!--修改保洁区域-->
    <update id="updateCleanSpace" parameterType="Wyspace">
        UPDATE wy_space
        SET spacename = #{spacename},builtarea = #{builtarea},detailedaddress = #{detailedaddress},
            description = #{description},enclosure = #{enclosure}
            <if test="equipmentIds != null and equipmentIds != ''">
                ,equipmentIds = #{equipmentIds}
            </if>
        WHERE
            id = #{id}
    </update>

    <!--删除保洁区域-->
    <update id="deleteCleanSpace" parameterType="Wyspace">
        UPDATE wy_space
        SET del_flag = '1'
        WHERE
            id = #{id}
    </update>

    <!--查询可关联的设备-->
    <select id="getEquipment" resultType="java.util.LinkedHashMap">
        SELECT
            id,
            name
        FROM
            wy_equipment
        WHERE
            del_flag = '0'
    </select>

    <!--通过设备名称查询设备id-->
    <select id="getEquipmentId" resultType="java.util.LinkedHashMap">
        SELECT id FROM wy_equipment WHERE name in (${name}) and del_flag = '0'
    </select>

    <!--通过id查询附件-->
    <select id="getEnclosureById" resultType="java.lang.String">
        SELECT enclosure FROM wy_space WHERE id = #{id}
    </select>
</mapper>