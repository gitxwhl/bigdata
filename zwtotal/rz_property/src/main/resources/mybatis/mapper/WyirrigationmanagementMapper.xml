<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.property.mapper.WyirrigationmanagementMapper">
    <resultMap id="WyirrigationmanagementMapper" type="com.property.entity.Wyirrigationmanagement">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="programname" jdbcType="VARCHAR" property="programname"/>
        <result column="spacename" jdbcType="VARCHAR" property="spacename"/>
        <result column="vegetationname" jdbcType="VARCHAR" property="vegetationname"/>
        <result column="irrigationtime" jdbcType="VARCHAR" property="irrigationtime"/>
        <result column="irrigationmethod" jdbcType="VARCHAR" property="irrigationmethod"/>
        <result column="evaluation" jdbcType="VARCHAR" property="evaluation"/>
        <result column="isplan" jdbcType="VARCHAR" property="isplan"/>
        <result column="enclosure" jdbcType="VARCHAR" property="enclosure"/>
        <result column="details" jdbcType="VARCHAR" property="details"/>
    </resultMap>

    <!-- 新增-->
    <insert id="getNewlyIncreasedPlan" parameterType="com.property.entity.Wyirrigationmanagement">
        INSERT INTO wy_irrigationmanagement (
            programname,
            spacename,
            vegetationname,
            irrigationtime,
            irrigationmethod)
        VALUES
        ( #{programname}, #{spacename}, #{vegetationname}, #{irrigationtime}, #{irrigationmethod})
  </insert>
<!--修改计划-->
    <update id="getamendPlan" parameterType="com.property.entity.Wyirrigationmanagement">
        UPDATE wy_irrigationmanagement
        SET programname = #{programname},
            spacename = #{spacename},
            vegetationname = #{vegetationname},
            irrigationtime = #{irrigationtime},
            irrigationmethod = #{irrigationmethod}
        WHERE
		    id = #{id}
    </update>

    <!--获取供应商数量-->
    <select id="getWyirrigationmanagementCnt" resultType="java.lang.Integer">
        SELECT
        count(1)
        FROM
        ( SELECT * FROM wy_irrigationmanagement ) a
        WHERE
        1=1
        <if test="programname != null and programname != ''">
            <bind name="Programname" value="'%'+ programname + '%'"/>
            AND a.programname like #{Programname}
        </if>
    </select>
    <!--获取供应商列表数据-->
    <select id="getWyirrigationmanagementList" resultMap="WyirrigationmanagementMapper">
       SELECT
                    a.id,
					a.programname,
					a.spacename,
					a.vegetationname,
					a.irrigationtime,
					d.paravalue irrigationmethod,
					a.evaluation,
					a.isplan,
					a.enclosure,
					a.details,
					a.rategradestar
        FROM
            ( SELECT * FROM wy_irrigationmanagement ) a
            LEFT JOIN ( SELECT * FROM sys_parameter WHERE paraname = 'irrigationmethod' ) d ON a.irrigationmethod = d.parakey
        WHERE
        1=1
        <if test="programname != null and programname != ''">
            <bind name="Programname" value="'%'+ programname + '%'"/>
            AND a.programname like #{Programname}
        </if>
        limit #{startIndex},#{pageSize}

    </select>

  <select id="getIrrigateExamine" resultType="com.property.entity.Wyirrigationmanagement">
        SELECT
        isplan,
        rategradestar
        FROM
        wy_irrigationmanagement a
        WHERE
        1 = 1
        <if test="startTime != null and startTime != ''">
            AND a.irrigationtime >= STR_TO_DATE(#{startTime},'%Y-%m-%d')
        </if>
        <if test="finishTime != null and finishTime != ''">
            AND a.irrigationtime &lt;= STR_TO_DATE(#{finishTime},'%Y-%m-%d')
        </if>
    </select>
<!--按时执行-->
    <select id="getexecute" resultType="java.lang.Integer">
        SELECT
        COUNT(1)
        FROM
        wy_irrigationmanagement a
        WHERE
        1 = 1
        <if test="startTime != null and startTime != ''">
            AND a.irrigationtime >= STR_TO_DATE(#{startTime},'%Y-%m-%d')
        </if>
        <if test="finishTime != null and finishTime != ''">
            AND a.irrigationtime &lt;= STR_TO_DATE(#{finishTime},'%Y-%m-%d')
        </if>
            AND a.isplan =1
    </select>

<!--未按时执行-->
    <select id="getNotexecute" resultType="java.lang.Integer">
        SELECT
        COUNT(1)
        FROM
        wy_irrigationmanagement a
        WHERE
        1 = 1
        <if test="startTime != null and startTime != ''">
            AND a.irrigationtime >= STR_TO_DATE(#{startTime},'%Y-%m-%d')
        </if>
        <if test="finishTime != null and finishTime != ''">
            AND a.irrigationtime &lt;= STR_TO_DATE(#{finishTime},'%Y-%m-%d')
        </if>
        AND a.isplan =2
    </select>
<!--一星-->
    <select id="getOneStar" resultType="java.lang.Integer">
        SELECT
        COUNT(1)
        FROM
        wy_irrigationmanagement a
        WHERE
        1 = 1
        <if test="startTime != null and startTime != ''">
            AND a.irrigationtime >= STR_TO_DATE(#{startTime},'%Y-%m-%d')
        </if>
        <if test="finishTime != null and finishTime != ''">
            AND a.irrigationtime &lt;= STR_TO_DATE(#{finishTime},'%Y-%m-%d')
        </if>
        AND a.rategradestar =1
    </select>
<!--二星-->
    <select id="getTwoStar" resultType="java.lang.Integer">
        SELECT
        COUNT(1)
        FROM
        wy_irrigationmanagement a
        WHERE
        1 = 1
        <if test="startTime != null and startTime != ''">
            AND a.irrigationtime >= STR_TO_DATE(#{startTime},'%Y-%m-%d')
        </if>
        <if test="finishTime != null and finishTime != ''">
            AND a.irrigationtime &lt;= STR_TO_DATE(#{finishTime},'%Y-%m-%d')
        </if>
        AND a.rategradestar =2
    </select>
<!--三星-->
    <select id="getThreeStar" resultType="java.lang.Integer">
        SELECT
        COUNT(1)
        FROM
        wy_irrigationmanagement a
        WHERE
        1 = 1
        <if test="startTime != null and startTime != ''">
            AND a.irrigationtime >= STR_TO_DATE(#{startTime},'%Y-%m-%d')
        </if>
        <if test="finishTime != null and finishTime != ''">
            AND a.irrigationtime &lt;= STR_TO_DATE(#{finishTime},'%Y-%m-%d')
        </if>
        AND a.rategradestar =3
    </select>

<!--四星-->
    <select id="getFourStar" resultType="java.lang.Integer">
        SELECT
        COUNT(1)
        FROM
        wy_irrigationmanagement a
        WHERE
        1 = 1
        <if test="startTime != null and startTime != ''">
            AND a.irrigationtime >= STR_TO_DATE(#{startTime},'%Y-%m-%d')
        </if>
        <if test="finishTime != null and finishTime != ''">
            AND a.irrigationtime &lt;= STR_TO_DATE(#{finishTime},'%Y-%m-%d')
        </if>
        AND a.rategradestar =4
    </select>

<!--五星-->
    <select id="getFiveStar" resultType="java.lang.Integer">
        SELECT
        COUNT(1)
        FROM
        wy_irrigationmanagement a
        WHERE
        1 = 1
        <if test="startTime != null and startTime != ''">
            AND a.irrigationtime >= STR_TO_DATE(#{startTime},'%Y-%m-%d')
        </if>
        <if test="finishTime != null and finishTime != ''">
            AND a.irrigationtime &lt;= STR_TO_DATE(#{finishTime},'%Y-%m-%d')
        </if>
        AND a.rategradestar =5
    </select>


</mapper>