<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.canteen.mapper.StPurchaseorderMapper">
    <resultMap id="StPurchaseorderMapper" type="com.canteen.entity.StPurchaseorder">
        <result property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="no" column="no"/>
        <result property="type" column="type"/>
        <result property="timestamp" column="timestamp"/>
        <result property="supplier" column="supplier"/>
        <result property="purchasingunit" column="purchasingunit"/>
        <result property="detailed" column="detailed"/>
        <result property="state" column="state"/>
    </resultMap>

    <!--菜单计划查询数量-->
    <select id="getPurchaseIndentCnt" resultType="java.lang.Integer">
        SELECT
        count(*)
        FROM
        ( SELECT * FROM st_purchaseorder ) a
        LEFT JOIN ( SELECT * FROM sys_parameter WHERE paraname = 'type' ) b ON a.type = b.parakey
        WHERE
        1 = 1
        <if test="name != null and name != ''">
            <bind name="Name" value="'%'+ name + '%'"/>
            AND a.name like #{Name}
        </if>
        <if test="no != null and no != ''">
            <bind name="No" value="'%'+ no + '%'"/>
            AND a.no like #{No}
        </if>
        <if test="type != null and type != ''">
            AND a.type = #{type}
        </if>
        <if test="timestamp != null and timestamp != ''">
            AND STR_TO_DATE(a.timestamp,'%Y-%m-%d') = STR_TO_DATE(#{timestamp},'%Y-%m-%d')
        </if>

    </select>
    <!--采购订单列表查询-->
    <select id="getPurchaseIndentList" resultType="StPurchaseorder">
        SELECT
        a.id,
        a.name,
        a.no,
        b.paravalue type,
        DATE_FORMAT(a.timestamp,'%Y.%m.%d') timestamp,
        c.name supplier,
        a.purchasingunit,
        a.detailed,
        a.state
        FROM
        ( SELECT * FROM st_purchaseorder ) a
        LEFT JOIN ( SELECT * FROM sys_parameter WHERE paraname = 'type' ) b ON a.type = b.parakey
        LEFT JOIN ( SELECT * FROM st_supplier) c ON a.supplier = c.id
        WHERE
        1=1
        <if test="name != null and name != ''">
            <bind name="Name" value="'%'+ name + '%'"/>
            AND a.name like #{Name}
        </if>
        <if test="no != null and no != ''">
            <bind name="No" value="'%'+ no + '%'"/>
            AND a.no like #{No}
        </if>
        <if test="type != null and type != ''">
            AND a.type = #{type}
        </if>
        <if test="timestamp != null and timestamp != ''">
            AND STR_TO_DATE(a.timestamp,'%Y-%m-%d') = STR_TO_DATE(#{timestamp},'%Y-%m-%d')
        </if>
    </select>
</mapper>