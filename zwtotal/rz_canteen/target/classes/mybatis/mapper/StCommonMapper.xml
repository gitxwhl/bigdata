<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.canteen.mapper.StCommonMapper">

    <resultMap id="StOperationrestaurant" type="com.canteen.entity.StOperationrestaurant">
        <id column="id" property="id"/>
        <result property="parentIds" column="parent_ids"/>
        <result property="restaurantName" column="RestaurantName"/>
        <result property="restaurantCode" column="RestaurantCode"/>
    </resultMap>


    <resultMap id="getStGoodcommodityMap" type="com.canteen.entity.StGoodcommodity">
        <id column="id" property="id"/>
        <result property="parentId" column="parent_id"/>
        <result property="parentIds" column="parent_ids"/>
        <result property="no" column="no"/>
        <result property="branchName" column="branchname"/>
        <result property="name" column="name"/>
        <result property="weight" column="weight"/>
        <result property="introduction" column="introduction"/>
        <result property="price" column="price"/>
        <result property="number" column="number"/>
        <result property="company" column="company"/>
        <result property="restaurant" column="restaurant"/>
        <result property="isshelf" column="isshelf"/>
        <result property="picture" column="picture"/>
    </resultMap>


    <resultMap id="UserPersonResult" type="com.canteen.entity.User">
        <id column="DID" property="did" />
        <result column="ACCOUNT" property="account" />
        <result column="PASSWORD" property="password" />
        <result column="PASSWDAPP" property="passwdapp" />
        <result column="uname" property="name" />
        <result column="SEX" property="sex" />
        <result column="ORGANIZATION_ID" property="organizationId" />
        <result column="DOMAIN_ID" property="domainId" />
        <result column="DEPARTMENT_ID" property="departmentId" />
        <result column="MOBILE" property="mobile" />
        <result column="EMAIL" property="email" />
        <result column="USER_TYPE" property="userType" />
        <result column="SALT" property="salt" />
        <result column="password_time" property="passwordTime" />
        <result column="last_time" property="lastTime" />
        <result column="CREATE_USER" property="createUser" />
        <result column="ENABLE" property="enable" />
        <result column="BPM_USER_ID" property="bpmUserId" />
        <result column="NOTE" property="note" />
        <result column="PERMISSION" property="permission" />
        <result column="OFFICE_TEL" property="officeTel" />
        <result column="ROLEID" property="roleid" />
        <result column="ISEXPAND" property="isexpand" />
        <result column="IS_DRAW" property="isDraw" />
        <result column="POSITION" property="position" />
        <result column="BIRTHDAY" property="birthday" />
        <result column="IDENTITY" property="identity" />
        <result column="IMG_URL" property="imgUrl" />
        <result column="CREATE_TIME" property="createTime" />
        <association property="department" column="ID" javaType="com.canteen.entity.Department">
            <id column="ID" property="id"/>
            <result column="dname" property="dname"/>
        </association>
    </resultMap>

    <resultMap id="departMantResult" type="com.canteen.entity.Department">
        <id column="ID" property="id" />
        <result column="NAME" property="dname" />
    </resultMap>


    <select id="getCompanyOrDeptList" parameterType="java.lang.String" resultType="java.util.HashMap">
        SELECT id,name FROM department WHERE
        <if test="type ==1">
            note ='CORP'
        </if>
        <if test="type ==2">
            PARENT_ID=#{parentId} AND
            note ='DEPT'
        </if>
    </select>
    <select id="getRestaurantList" parameterType="java.lang.String" resultType="java.util.HashMap">
        SELECT id,RestaurantName AS name
         FROM st_operationrestaurant
         WHERE parent_ids IN (#{id});
    </select>


    <select id="getPersonList" parameterType="java.lang.String" resultType="java.util.HashMap">
      SELECT did as id,name,mobile,email,ACCOUNT FROM  USER WHERE DEPARTMENT_ID = #{parentId}
    </select>
    <select id="getStOperationList" parameterType="java.lang.String" resultMap="StOperationrestaurant">
         SELECT
            a.id,
            a.parent_ids,
            a.RestaurantName,
            a.RestaurantCode,
            a.decide
        FROM
	    ( SELECT * FROM st_operationrestaurant where iscanteen = #{type}) a
    </select>

    <select id="getGoodType" parameterType="java.lang.String" resultMap="getStGoodcommodityMap">
        SELECT
            id,
            parent_id,
            parent_ids,
            `no`,
            branchname,
            `name`
            FROM
                st_goodcommodity
                WHERE
	        level IN(1,2)
    </select>


    <select id="findCompanyId" resultMap="UserPersonResult">
       SELECT
        dp.id,
        dp.`NAME` dname
        FROM department dp WHERE
        dp.ID=
          (
            SELECT
                            d.PARENT_ID
            FROM
                `user` u
                LEFT JOIN department d
                ON
                u.DEPARTMENT_ID = d.ID
                WHERE u.ACCOUNT='sjz_zhaos' AND d.`NOTE` = 'DEPT'
            )
    </select>




    <select id="findDeparmentId" resultMap="UserPersonResult">
        SELECT
            u.ACCOUNT,
            u.`NAME` uname,
            u.`MOBILE`,
            d.`NAME` dname,
            d.ID
        FROM
            `user` u
            LEFT JOIN department d
            ON
            u.DEPARTMENT_ID = d.ID
            WHERE u.ACCOUNT=#{account} AND d.`NOTE` = 'DEPT'
    </select>


    <select id="findCompany" resultMap="departMantResult">
        SELECT
            b.ID,
            b.`NAME`
            FROM
            (
            SELECT ID FROM department WHERE PARENT_ID ='101'
            ) a
            JOIN
            (
            SELECT * FROM department WHERE NOTE ='CORP'
            ) b
            ON
            a.ID = b.PARENT_ID
    </select>

    <select id="findShiCompany" resultMap="departMantResult">
        SELECT
         b.ID,
         b.`NAME`
         FROM department b
         WHERE b.PARENT_ID = '101'
         AND NOTE ='CORP'
    </select>

    <select id="finddeparmentIds" resultMap="departMantResult" resultType="java.util.Map">
            SELECT
            ID,
            `NAME`
            FROM
            department
            WHERE PARENT_ID =#{ID}
    </select>



</mapper>
