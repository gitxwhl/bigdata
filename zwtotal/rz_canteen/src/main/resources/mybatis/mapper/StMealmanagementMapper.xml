<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.canteen.mapper.StMealmanagementMapper">

    <!--直接取餐-->
    <select id="directList" resultType="java.util.LinkedHashMap">
        SELECT
            a.id,
            c.name,
            c.no,
            c.phone,
            c.rank,
            a.face,
            a.card,
            a.number
        FROM
            st_mealmanagement a
            LEFT JOIN st_personnel c ON a.personnel = c.id
            LEFT JOIN st_operationrestaurant d ON a.restaurant = d.RestaurantCode
        WHERE
            a.buffet is null
            <if test="mode != null and mode != ''">
                <if test="mode == '1'.toString()">
                    AND a.face = '是'
                </if>
                <if test="mode == '2'.toString()">
                    AND a.card = '是'
                </if>
                <if test="mode == '3'.toString()">
                    AND a.number = '是'
                </if>
            </if>
            <if test="name != null and name != ''">
                <bind name="Name" value="'%' + name + '%'"/>
                AND c.name like #{Name}
            </if>
            <if test="restaurant != null and restaurant != ''">
                AND d.id in (${restaurant})
            </if>
            limit #{index},#{pageSize}
    </select>

    <!--直接取餐数量-->
    <select id="directListCnt" resultType="java.lang.Integer">
        SELECT
            count(1)
        FROM
            st_mealmanagement a
            LEFT JOIN st_personnel c ON a.personnel = c.id
            LEFT JOIN st_operationrestaurant d ON a.restaurant = d.RestaurantCode
        WHERE
            a.buffet is null
            <if test="mode != null and mode != ''">
                <if test="mode == '1'.toString()">
                    AND a.face = '是'
                </if>
                <if test="mode == '2'.toString()">
                    AND a.card = '是'
                </if>
                <if test="mode == '3'.toString()">
                    AND a.number = '是'
                </if>
            </if>
            <if test="name != null and name != ''">
                <bind name="Name" value="'%' + name + '%'"/>
                AND c.name like #{Name}
            </if>
            <if test="restaurant != null and restaurant != ''">
                AND d.id in (${restaurant})
            </if>
    </select>

    <!--餐柜取餐-->
    <select id="plateList" resultType="java.util.LinkedHashMap">
        SELECT
            a.id,
            b.name,
            b.number no,
            b.specification,
            b.addr,
            a.face,
            a.card,
            a.number
        FROM
            st_mealmanagement a
            LEFT JOIN st_cabinet b ON a.buffet = b.id
            LEFT JOIN st_personnel c ON a.personnel = c.id
            LEFT JOIN st_operationrestaurant d ON a.restaurant = d.RestaurantCode
        WHERE
            a.buffet is not  null
            <if test="mode != null and mode != ''">
                <if test="mode == '1'.toString()">
                    AND a.face = '是'
                </if>
                <if test="mode == '2'.toString()">
                    AND a.card = '是'
                </if>
                <if test="mode == '3'.toString()">
                    AND a.number = '是'
                </if>
            </if>
            <if test="name != null and name != ''">
                <bind name="Name" value="'%' + name + '%'"/>
                AND b.name like #{Name}
            </if>
            <if test="restaurant != null and restaurant != ''">
                AND d.id in (${restaurant})
            </if>
            limit #{index},#{pageSize}
    </select>

    <!--餐柜取餐数量-->
    <select id="plateListCnt" resultType="java.lang.Integer">
        SELECT
            count(1)
        FROM
            st_mealmanagement a
            LEFT JOIN st_cabinet b ON a.buffet = b.id
            LEFT JOIN st_personnel c ON a.personnel = c.id
            LEFT JOIN st_operationrestaurant d ON a.restaurant = d.RestaurantCode
        WHERE
            a.buffet is not null
            <if test="mode != null and mode != ''">
                <if test="mode == '1'.toString()">
                    AND a.face = '是'
                </if>
                <if test="mode == '2'.toString()">
                    AND a.card = '是'
                </if>
                <if test="mode == '3'.toString()">
                    AND a.number = '是'
                </if>
            </if>
            <if test="name != null and name != ''">
                <bind name="Name" value="'%' + name + '%'"/>
                AND b.name like #{Name}
            </if>
            <if test="restaurant != null and restaurant != ''">
                AND d.id in (${restaurant})
            </if>
    </select>

    <!--更改取餐方式-->
    <update id="updateMode" parameterType="StMealmanagement">
        UPDATE
            st_mealmanagement
        <trim prefix="SET" suffixOverrides=",">
            <if test="card != null and card != ''">
                card = #{card},
            </if>
            <if test="face != null and face != ''">
                face = #{face},
            </if>
            <if test="number != null and number != ''">
                number = #{number},
            </if>
        </trim>
        WHERE
            id = #{id}
    </update>
</mapper>