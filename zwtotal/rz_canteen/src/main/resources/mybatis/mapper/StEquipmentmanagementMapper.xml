<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.canteen.mapper.StEquipmentmanagementMapper">
    <resultMap id="equipmentResultMap" type="com.canteen.entity.StEquipmentmanagement">
        <result property="id" column="id"/>
        <result property="equipmentName" column="equipmentname"/>
        <result property="equipmentCode" column="equipmentcode"/>
        <result property="restaurant" column="restaurant"/>
        <result property="purchaseBatch" column="purchasebatch"/>
        <result property="totalDevices" column="totaldevices"/>
        <result property="useQuantity" column="usequantity"/>
        <result property="examineQuantity" column="examinequantity"/>
        <result property="scrapQuantity" column="scrapquantity"/>
        <result property="remarks" column="remarks"/>
    </resultMap>

    <!--获取设备列表-->
    <select id="getEquipmentList" resultMap="equipmentResultMap">
        SELECT
            a.id,
            a.equipmentname,
            a.equipmentcode,
            b.RestaurantName restaurant,
            a.purchasebatch,
            a.totaldevices,
            a.usequantity,
            a.examinequantity,
            a.scrapquantity,
            a.remarks
        FROM
            ( SELECT * FROM st_equipmentmanagement ) a
            LEFT JOIN ( SELECT * FROM st_operationrestaurant ) b ON a.restaurant = b.RestaurantCode
        WHERE
            a.del_flag = '0'
            <if test="restaurantName != null and restaurantName != ''">
                AND b.id in(${restaurantName})
            </if>
            <if test="equipmentName != null and equipmentName != ''">
                <bind name="EquipmentName" value="'%'+ equipmentName + '%'"/>
                AND a.equipmentname LIKE #{EquipmentName}
            </if>
            <if test="equipmentCode != null and equipmentCode != ''">
                <bind name="EquipmentCode" value="'%'+ equipmentCode + '%'"/>
                AND a.equipmentcode LIKE #{EquipmentCode}
            </if>
            limit #{startIndex},#{pageSize}
    </select>

    <!--查询设备数量-->
    <select id="getEquipmentCnt" resultType="java.lang.Integer">
        SELECT
            count(1)
        FROM
            ( SELECT * FROM st_equipmentmanagement ) a
            LEFT JOIN ( SELECT * FROM st_operationrestaurant ) b ON a.restaurant = b.RestaurantCode
        WHERE
            a.del_flag = '0'
            <if test="restaurantName != null and restaurantName != ''">
                AND b.id in(${restaurantName})
            </if>
            <if test="equipmentName != null and equipmentName != ''">
                <bind name="EquipmentName" value="'%'+ equipmentName + '%'"/>
                AND a.equipmentname LIKE #{EquipmentName}
            </if>
            <if test="equipmentCode != null and equipmentCode != ''">
                <bind name="EquipmentCode" value="'%'+ equipmentCode + '%'"/>
                AND a.equipmentcode LIKE #{EquipmentCode}
            </if>
    </select>

    <!--删除设备-->
    <update id="deleteEquipment">
        UPDATE st_equipmentmanagement SET del_flag = '1' WHERE id = #{id}
    </update>

    <!--新增设备-->
    <insert id="insertEquipment" parameterType="com.canteen.entity.StEquipmentmanagement">
        INSERT INTO st_equipmentmanagement ( equipmentname, equipmentcode, restaurant, purchasebatch, totaldevices, usequantity,
                    examinequantity, scrapquantity, remarks, del_flag )
        VALUES
            ( #{equipmentName}, #{equipmentCode}, #{restaurant}, #{purchaseBatch}, #{totalDevices}, #{useQuantity},
              #{examineQuantity}, #{scrapQuantity}, #{remarks}, #{delFlag})
    </insert>

    <!--修改设备-->
    <update id="updateEquipment" parameterType="com.canteen.entity.StEquipmentmanagement">
        UPDATE st_equipmentmanagement
        SET equipmentname = #{equipmentName},
            equipmentcode = #{equipmentCode},
            restaurant = #{restaurant},
            usequantity = #{useQuantity},
            examinequantity = #{examineQuantity},
            scrapquantity = #{scrapQuantity},
            remarks = #{remarks}
        WHERE
	        id = #{id}
    </update>

    <!--通过id查询设备-->
    <select id="selectEquipmentById" resultMap="equipmentResultMap">
        SELECT * FROM st_equipmentmanagement WHERE id = #{id}
    </select>
</mapper>